<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- saved from url=(0075)http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-syntax -->
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="generator" content="HTML Tidy for FreeBSD (vers 7 December 2008), see www.w3.org">

<title>Yasm User Manual</title>
<meta name="generator" content="DocBook XSL Stylesheets V1.76.1">
<meta name="description" content="This document is the user manual for the Yasm assembler. It is intended as both an introduction and a general-purpose reference for all Yasm users.">
<style type="text/css"></style><style type="text/css">/*.lleo_errorSelection *::-moz-selection,
.lleo_errorSelection *::selection,
.lleo_errorSelection *::-webkit-selection {
    background-color: red !important;
    color: #fff !important;;
}*/

#lleo_dialog,
#lleo_dialog * {
    color: #000 !important;
    font: normal 13px Arial, Helvetica !important;
    line-height: 15px !important;
    margin: 0 !important;
	padding: 0 !important;
	background: none !important;
	border: none 0 !important;
	position: static !important;
	vertical-align: baseline !important;
	overflow: visible !important;
	width: auto !important;
	height: auto !important;
    max-width: none !important;
    max-height: none !important;
	float: none !important;
	visibility: visible !important;
	text-align: left !important;
    text-transform: none !important;
	border-collapse: separate !important;
	border-spacing: 2px !important;
    box-sizing: content-box !important;
    box-shadow: none !important;
    opacity: 1 !important;
    text-shadow: none !important;
    letter-spacing: normal !important;
    -webkit-filter: none !important;
    -moz-filter: none !important;
    filter: none !important;
}
#lleo_dialog *:before,
#lleo_dialog *:after {
    content: '';
}

#lleo_dialog iframe {
	height: 0 !important;
	width: 0 !important;
}

#lleo_dialog {
    position: absolute !important;
    background: #fff !important;
    border: solid 1px #ccc !important;
    padding: 7px 0 0 !important;
    left: -999px;
    top: -999px;
    width: 440px !important;
    overflow: hidden;
    display: block !important;
    z-index: 999999999 !important;
    box-shadow: 8px 16px 30px rgba(0, 0, 0, 0.16) !important;
    border-radius: 3px !important;
    opacity: 0 !important;
    -webkit-transform: translateY(15px);
    -moz-transform: translateY(15px);
    -ms-transform: translateY(15px);
    -o-transform: translateY(15px);
    transform: translateY(15px);
}
#lleo_dialog.lleo_show_small {
    width: 150px !important;
}
#lleo_dialog.lleo_show {
    opacity: 1 !important;
    -webkit-transform: translateY(0);
    -moz-transform: translateY(0);
    -ms-transform: translateY(0);
    -o-transform: translateY(0);
    transform: translateY(0);
    -webkit-transition: -webkit-transform 0.3s, opacity 0.3s !important;
    -moz-transition: -moz-transform 0.3s, opacity 0.3s !important;
    -ms-transition: -ms-transform 0.3s, opacity 0.3s !important;
    -o-transition: -o-transform 0.3s, opacity 0.3s !important;
    transition: transform 0.3s, opacity 0.3s !important;
}
#lleo_dialog.lleo_collapse {
    opacity: 0 !important;
    -webkit-transform: scale(0.25, 0.1) translate(-550px, 100px);
    -moz-transform: scale(0.25, 0.1) translate(-550px, 100px);
    -ms-transform: scale(0.25, 0.1) translate(-550px, 100px);
    -o-transform: scale(0.25, 0.1) translate(-550px, 100px);
    transform: scale(0.25, 0.1) translate(-550px, 100px);
    -webkit-transition: -webkit-transform 0.4s, opacity 0.4s !important;
    -moz-transition: -moz-transform 0.4s, opacity 0.4s !important;
    -ms-transition: -ms-transform 0.4s, opacity 0.4s !important;
    -o-transition: -o-transform 0.4s, opacity 0.4s !important;
    transition: transform 0.4s, opacity 0.4s !important;
}
#lleo_dialog input::-webkit-input-placeholder {
    color: #aaa !important;
}
#lleo_dialog .lleo_has_pic #lleo_word {
	margin-right: 80px !important;
}
#lleo_dialog #lleo_translationsContainer1 {
	position: relative !important;
}
#lleo_dialog #lleo_translationsContainer2 {
	padding: 7px 0 0 !important;
	vertical-align: middle !important;
}
#lleo_dialog #lleo_word {
    color: #000 !important;
    margin: 0 5px 2px 0 !important;
    /*float: left !important;*/
}
#lleo_dialog .lleo_has_sound #lleo_word {
    margin-left: 30px !important;
}
#lleo_dialog #lleo_text {
    font-weight: bold !important;
    color: #d56e00 !important;
    text-decoration: none !important;
    cursor: default !important;
}
/*
#lleo_dialog #lleo_text.lleo_known {
    cursor: pointer !important;
    text-decoration: underline !important;
}
*/
/*#lleo_dialog #lleo_closeBtn {
    position: absolute !important;
    right: 6px !important;
    top: 5px !important;
    line-height: 1px !important;
    text-decoration: none !important;
    font-weight: bold !important;
    font-size: 0 !important;
    color: #aaa !important;
    display: block !important;
	z-index: 9999999999 !important;
	width: 7px !important;
	height: 7px !important;
	padding: 0 !important;
	margin: 0 !important;
}*/

#lleo_dialog #lleo_optionsBtn {
    position: absolute !important; 
    right: 3px !important;
    top: 5px !important;
    line-height: 1px !important;
    text-decoration: none !important;
    font-weight: bold !important;
    font-size: 13px !important;
    color: #aaa !important;
    padding: 2px !important;
	display: none;
}
    #lleo_dialog.lleo_optionsShown #lleo_optionsBtn {
        display: block !important;
    }
    #lleo_dialog #lleo_optionsBtn img {
        width: 12px !important;
        height: 12px !important;
    }
#lleo_dialog #lleo_sound {
    float: left !important;
    width: 16px !important;
    height: 16px !important;
    margin-left: 9px !important;
    margin-right: 3px !important;
    background: 0 0 no-repeat !important;
    cursor: pointer !important;
    display: none !important;
    background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAfNJREFUeNq0U01IVFEU/u57Oo5WhBRIBBptykWLYBa2soWiEKQQEbrSFsGbVRQKQc2iFqGitXqvjQxCoCJCqyI0aBUtZILaJNUuYWYWo8HovJ/707nP94bnz0rxwvfOuefd8517fi5TSuE4i50YwZ3l37ZhNlpgzFkaaM/G9sHF1YskNrT+7l4PjMOcb78t2JL71uxgB+2UlfxHTtq5N94fIOh/88kWgWfl73ZCSQkpeGg3H091JY6dI2S00qA/N3KO3dDUYhFgEmZGurG+w9FqApIHsVM7kaTF9Nhn0r8Q7hPWQgIRuNaH3AMUA4W/Lkdh04cpFS43G0TgxQTvCdMETVAk3KynIHwXZU/ge8XDt7KH9bKLjU0P2zVO5LsEpSejVRJ9UR18EtfqKegovs9R3Q6w9c/H1o4Aa2Jwm1lIvn9RJ4w9RdRRzqcYrpwycCll4Cy1lnkS3Bc6vfBg28v8aRIfI78zhB/1GygROH3jLyyzMQ0zlUZuZBSlKkeLoegGtTjYLcJ8pF+NakHOFC2J6w+f25mxSfWrWFF/ShXVPTGvtN14NNkVnxlYWJkgZEL7/vwKr55lKSVnaGYWkuYgrgG172uUv47+U7fw0EHaJXmalUQy/HqO6lBzEsVjJC4Q8kd6TETQpjuaGOvjv8b/AgwA/ij1XMx58NIAAAAASUVORK5CYII=) !important;
}
#lleo_dialog .lleo_has_sound #lleo_sound {
    display: block !important;
}

#lleo_dialog #lleo_soundWave {
    border: solid 5px #4495CC !important;
    border-radius: 5px !important;
    position: absolute !important;
    left: -5px !important;
    top: -5px !important;
    right: -5px !important;
    bottom: -5px !important;
    z-index: 0 !important;
    opacity: 0.9 !important;
    display: none !important;
}
    #lleo_dialog #lleo_soundWave.lleo_beforePlaying {
        display: block !important;
    }
    #lleo_dialog #lleo_soundWave.lleo_playing {
        opacity: 0 !important;
        border-width: 20px !important;
        border-radius: 30px !important;

        -webkit-transform: scale(1.07,1.1) !important;
        -moz-transform: scale(1.07,1.1) !important;
        -ms-transform: scale(1.07,1.1) !important;
        transform: scale(1.07,1.1) !important;

        -webkit-transition: all 0.6s !important;
        -moz-transition: all 0.6s !important;
        -ms-transition: all 0.6s !important;
        transition: all 0.6s !important;
    }


#lleo_dialog #lleo_picOuter {
    position: absolute !important;
    float: right !important;
    top: 4px;
    right: 5px;
    z-index: 9 !important;
    display: none !important;
    width: 100px !important;
}
    #lleo_dialog.lleo_optionsShown #lleo_picOuter {
        right: 25px;
    }
#lleo_dialog .lleo_has_pic #lleo_picOuter {
    display: block !important;
}
    #lleo_dialog #lleo_picOuter:hover {
        width: auto !important;
        z-index: 11 !important;
    }
#lleo_dialog #lleo_pic,
#lleo_dialog #lleo_picBig {
    position: absolute !important;
    top: 0 !important;
    right: 0 !important;
    border: solid 2px #fff !important;
    -webkit-border-radius: 2px !important;
    -moz-border-radius: 2px !important;
	border-radius: 2px !important;
    z-index: 1 !important;
}
#lleo_dialog #lleo_pic {
	position: relative !important;
    border: none !important;
	width: 30px !important;
}
#lleo_dialog #lleo_picBig {
    box-shadow: -1px 2px 4px rgba(0,0,0,0.3);
    z-index: 2 !important;
    opacity: 0 !important;
    visibility: hidden !important;
}
    #lleo_dialog #lleo_picOuter:hover #lleo_picBig {
        visibility: visible !important;
        opacity: 1 !important;
        -webkit-transition: opacity 0.3s !important;
        -webkit-transition-delay: 0.3s !important;
    }
#lleo_dialog #lleo_transcription {
    margin: 0 80px 4px 31px !important;
    color: #aaaaaa !important;
}
#lleo_dialog .lleo_no_trans {
    color: #aaa !important;
}

#lleo_dialog .ll-translation-counter {
	float: right !important;
    font-size: 11px !important;
    color: #aaa !important;
    padding: 2px 2px 1px 10px !important;
}

#lleo_dialog .ll-translation-text {
	float: left !important;
	/*width: 80% !important;*/
}

#lleo_dialog #lleo_trans a {
    color: #3F669F !important;
    text-decoration: none !important;
    text-overflow: ellipsis !important;
    padding: 1px 4px !important;
    overflow: hidden !important;
    float: left !important;
    width: 320px !important;
}

#lleo_dialog .ll-translation-item {
    color: #3F669F !important;
    border: solid 1px #fff !important;
    padding: 3px !important;
    width: 100% !important;
    float: left !important;
	-moz-border-radius: 2px !important;
	-webkit-border-radius: 2px !important;
	border-radius: 2px !important;
}

#lleo_dialog .ll-translation-item:hover {
	border: solid 1px #9FC2C9 !important;
    background: #EDF4F6 !important;
	cursor: pointer !important;
}
#lleo_dialog .ll-translation-item:hover .ll-translation-counter {
	color: #83a0a6 !important;
}

#lleo_dialog .ll-translation-marker {
    background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAAECAYAAACp8Z5+AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAAWSURBVBhXY7RPm/+fAQkwIXNAbMICAJQ8AkvqWg/SAAAAAElFTkSuQmCC) !important;
    display: inline-block !important;
    width: 4px !important;
    height: 4px !important;
    margin: 7px 5px 2px 2px !important;
    float: left !important;
}

#lleo_dialog #lleo_icons {
    color: #aaa !important;
    font-size: 11px !important;
    background: #f8f8f8 !important;
    padding: 10px 10px 10px 16px !important;
}
#lleo_icons a {
    display: inline-block !important;
    width: 16px !important;
    height: 16px !important;
    margin: 0 10px -4px 3px !important;
    text-decoration: none !important;
    opacity: 0.5 !important;
    background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHIAAAAQCAYAAADK4SssAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAADopJREFUeNqsWQt0lNWd/33fzGQemUcmzwkhSkhYSSgpJJGVWHlEVEwLq0AFhC520xN0cfcUkHZ7QNetwfac6mp3oR5Ss8c9XaPVhoJCtGwSkYQglQBBNg/IgxBIQl7zyCSZ97f/e7+ZyeShpu7eM/fc797vu9/j/u7v93+MUqlUwuv1IlQ6Ojqk7u5utLaWo/nanfB45tbnsSI6GgsXLhQwpcx/9rCE/0PpOLSL39Pnh9TY2Y1NJXW4NeTFz59agp9uXASfYwR/Xv9dxJ6pxwJBhCIQoKtFuIUAXPRksyTx+U2rVy0TtdrywNhYeviFJAlSsJ1oJNY2ZdfVLeKdiGIb96Kqw45LvU40Dbj42F2mKNyXasCjGTGI0aqmvr6wdseL075fEORl6h+yYWzcDaNeh8Q4E7z0kVPLx//5Il0uTLqHQqGA3z/92qioKHg8Hn5/SZqYogwdOBwO6d19+9DQ0ADdqrmTJhesLML6nQ38uLj4jHSkuJi/a+Q1vd8QxORg6/dBUtDblLzbhBuuOIhJcfhl5QCeyB9DusWA3MO/hf2+e6FwjtFHKGj15Y8M0Cd0KQTpbr8kCBrNsaTn9iXoH3jga5/739nZC7Mj+n7aHBVNwwSUEhuy4rCR6m8vD9ID5MVyeAI4cPo2suI0KMpJgEoU+A5QiCKmg0jT6H49/cP4Tt4i/FXaHLS0d6O57RZ0WvXXvltaWhpOnz7NCbZ371588MEHHLQ9e/bwev78eTzzzDPo7+8PzxFDIO4rKOAgomHihq+9ckxgdd26dWHQSkuBvJ2lmLqTv2kJbQAGot/nw9U7xDa9CQHakY5xFd45f4OdhWZhFtz534GP9k9A9PPWIxGgAu2AgHwP79hYYseRI8q+f/832Kqr4O7t5bt6pioFAmIkiJXXrbCYtbg85MF1q5vv+IFxH6KUApSizLDsJB09F2i3yozoc3pn/CaBVKPr9gC+X3g/3ih5GruL1mPPjx7DwLCdA/x1xWKx4K677kJ6ejpWr14dHt+xYwdSUlKQl5cHvV4/aQ7/GMZEDiDVI9IF4asecqQ4FwzvnaWl/x84hhnJwFAKSiTFaCDS7ifhhEjMu9pJS0dg0SH8Bh28BKqCXSuRxAp+ApMAFBX8Hj6PR3G+uhrDFRXoeekltG3ZjOsbN6L7wH4M/O53GKEX97pc8NGGCckSW9ibdg9anBJqu0ZgpFvNM0ahf8yH75GU7siOx3aqIjHQS8+N0SiRGa/BhR4nLHpVhBSKfEN03erHny+3IinehBf+cQuqzzby8+1dfURuKSy5X1UMBkP4eM6cOfxdmdQuWrSIj7nd7mlAKquqqqTyVXtnvfCFhUkoRi4xswG7V7RIM9lMVvJJHoryM7Gr4hxcLisfO7m3EIcrm1HZ3DmNkYIo79RHFsfjbHMvlGozLTKBKSpJPhUQ3WRvmlpwO1mE1WCGygMk2pxIcHjhlfzBzSDbQ2Jb2C56Bwfhra2F40wtFxHRaMK899+nU/LzGGAvnR+ARSUTNDVaBTVRMI6AO3VjhMCRkGPRUQusutuABbFqDsaJ63akmtQEZhSf5xx1wWTU4eBPfoDBYQeSE818fOV9i/HZpVYcPPQeLPHmWQGZmJgYPmasZGXt2rUcTFaiyVeJBJszMgxi7uxZxFjJrn/tzBnef5MA6iwp4uCFyrjVhieXp6H5wIYw61ip2FUIjcYc7oeO227a2DKjeG0GFib74LPZoVf58NTKuSSiAkr/9CaeeMSFFQeWYsOPv4XCvVl44GdLsbVoMU5mmcLsCrUBWnneRlYa81qHJzHy983UJzBvOTy8ppvV/Nz+2j581GwjGZav27AwBp/dHsUgXcuY1TLgxns0N/y9LjdMhmisJuD+dkMB1j24jJ7jx5vvnsLT+98gJ8cHg147q/XNysoCcziHhoY4C1NTU7F582Y0NjZikDZmXFzcdGkt6f8IxReO/KWKKDAsS4P29EDZOVhJsqqDgC6NMeOSzQrzc+Uhr5SDvPHwOd4/vHF5WFYL0mL48fee/wBHP2lGkl6Dcy+vwVu70nHhYB7WLJmDX/ypFDsbf42erBTZmwPRkfTVRTJXnx2Ln27PnQCSFpm1UhA8KeDnAPI2OM6cCCnoxLzfYkP3qA/dTh/ujPuxxKJF7e0x1BIbB91+LErUYoDA23rsBk5ccyCRGHu224meMT+fGyrxsUb09VtBHiyy1/4DOm7ewcjoOF58vRz6aDUSyGP1zeCxzlSYnLa3t8NqtUKtVnM2LliwALWkLIyJbA00Gs1kaaVJQjD8mOa87H7uMT722LrdMzyOFq9BRrKPQMspeZsDU09AHn1ug7yLXzmKtANlKNtWyEF+tvwcHny1kh8XZBbBQvawzya7+MMuLX7063r85vhlFORasH/7CtouEk5f/xzPf/IykJFI8ubjVl3wqYJSSrbTEwi/ul+SJTUEaESowVuOHXUiGXnJ6oVRLTP50XkGREcp8M41GzpcPjycZICOJPdfzvXhf0a8+GGWnhwfAUdJVtvo/IhnAphAQOJ2Uh2lQrROgzlJsQRmHwFsQrRWQ8wOzJoljG03b97kjMzIyMDWrVu5XaypqcGWLVsQGxsLo9E43dmZzY1n64Ey4Ha9XcP7DFAG4qGT5/BqzSUcenI5Dm3L5+dqyA4yUPPpelZiFR7oozSov+7Cq+XXcKN/lBZbgfmxKchIzyEL74JIjqboVxIkBCAtnAAVj4Ek0SMvZnCxQrLqj6wRUhsJJK097rj8vK4hG+ghKX2fgGL9VanRXEb/i5jH+o/ON5LDI6G8Ve6LX2LuEgg8jVqFnjvD8Hh9s7KLkxzA5GR88cUXOH78OO8zz5W998mTJ9HZ2Ul+g8jlNfK+XwlkKPzIzc2d4U0aJtlVJqche8ecmRCgBZnJxNInZfDoJTItMSSxlSh6uxL1nRNOj9c2iLlaN9bnxeMHaxfC5qAQgZ6aGpeMs1tK8XD8CkhjTlpYGiSAA4LMQ84yr2qatPpD8uqPlFm55dIaBHLzPSZIPgksuls334CaW04MkcyKBOg6Au6znjH0EBtTSMbvn6NDzQ0HOUh+PofNjSzs3g7nOCwJsrnout0fTkR8qY2aAWSz2Qyn0ymHg8HS3NzMEwHDw8Nhh2fGhMBfUljcyexjcQSQjH0hqXz7Inmml3oJOBsHtDAzDYe3FfDz5ec6Z/RaS/YU4KHcxYgzi/DZmzA8dAZdl3uQnLEJ8YYEnNj0Ov7mvT34uLcaUhTJip88WWJWIKAIpyZC3ioHjR1JEZmdCImNZGTx4jiUXbWjMM0IA8lqxXUHD+hXpuoRr1Xil239fLGfINBEan9P7BQ4FQU+V3aOJc4+pVKBzu4+PLWpgI9/WPM5OTi6aVmYyDJ1XKvVchvIWNfa2gqbzYaYmBhcvHiRn3e5XOHMzyQb+U2A3PfudU7I3btXhMeYPczJSkOaRYNtOZnYW7A0bP8YsCWVsrQeICbOFEduLfg2nIONuHz8aZhxBUrVGJRuEZ3XDiHlwT/CGJuOfy3Yi7r/uIIRkmGFjxYnwLIItKi+CSC5LQy24TWakqbjqa/gcS45M0uTNBwoJpvH2x3cS348w8gX+Xib3P/+PTFw+wI41j7C+0voO9lcbt/tTjz+yHIUrs6Fj+59b/YCUpRR2Kk6yeFhVU92U6OO4naUybXb4+XjLHUXWZhkqlQqDhh7z7a2Np4AuHr1aohE4ViTpVfZpvxGQL5UeYfHkCxLFxlDMi/1Ur0cLx44Ws9ldlvOBLAhtvZ+SWbHHRhFa/VOpBvPw2RmwTUF/14JmsEm9NfthmH9CdwTfzcs0YkYcXXCz9ItBKKKHB+fT86weP3+PkLMEo4jg6yMBDEEZIgJbOdXbUjD65eHUHumD0PjPs7wJqsb/1TXh3aKU1MMKiwjb/bDNjtsJKkatYC3Hkrhc/kmXrscP3tmEy43dWJJlhyCMafnk3cO4sKVNlTXX+FMHbQ64HJ7OaCW+Bjk52by8cgyb948XkdGRnifAUjrzG0jT3oEgWN2NDIXq4w0ebMpDMTcXBZLFn9lnpUlAcoigC3Kz+GMZACHEgSRcaTH3g+97xY0qhiMkI0SfGQH6T112lj4XbcheEcxLkbD5RylhVaRrEaRnfSSp+oPhxIdbvezGqWyjEAyRUrWVCBd4+PSRbf79KaQTSL79/cUxtxf0SknSlmsfMUatmHLLDouq0eJrfPj1PjNymSYVBPuhdmkD4cgpz+7ircqqqEimd3+2Cqs/OtvIS87I3zt6JiLJxkYCMyeNkaYGZ5YINtYVVUVls6ysjJuGxn7WDl16hQHmkkua0MAh4H8lb0G+0wFM4PX0BBeBQZiza+2TEqaJ0eAGQpBJuUOYyZinpzkGHJyrNOeoY2ZB3XCGowOV0Cp0/HQQylEwT+ugHrOOrKLenz4+cfosfdCMJDdYZkZryh7qpKcXdnZ1VXBcg4/TkwUF2k0+00KxaNmhSJPIQiT/rLoaGv7/BeDgw+9HDGWpFOh5ckM/KFjBD+pv4MeZ5C19BOVMmiPLzDhlRXJaOwdxVxj9IR/8FE9zl9q5Uy7eq0LNvsoHz97oYXCEDOSE8xIosrklaX6HCNj6O4d4uHJ1MKcmhdeeAF2u5336+rqOOgh23jixAlcuXJlGiOFqX9jsfLpp59Kxz58jXutISCZB7Vq6WZsvdc0499Y1iDTmPe6sYAko09+cC8Ftb29cuBcUrQcyVoz8l+ZsJNmmhP+G2t0SLI1vg6l/QuI3jEEVBqoLQ9DsbgILT19+O4bu3BLHKDFoLCA7SOJZEZSQTpY86X+/TK9XvmEyfR30aK4MUWjyffpdM4NjY2RyaZpXgizsSPeAKxuOZwxq0Wyj360DpFtpsvvm6sPyypbwzXbn5eYTWS206jXUhCv4gLA7sOk1OX2kE1kGaEAv4Y5RVq6RqtR8+OP3vrnaX9jRXq1kvT1/0/8rwADAJ+LRelLmVNwAAAAAElFTkSuQmCC) !important;
}
#lleo_icons a:hover {
    opacity: 1 !important;
}
#lleo_icons a.lleo_google     {background-position:-34px 0 !important;}
#lleo_icons a.lleo_multitran  {background-position:-64px 0 !important;}
#lleo_icons a.lleo_lingvo     {background-position:-51px 0 !important; width: 12px !important;}
#lleo_icons a.lleo_dict       {background-position:-17px 0 !important;}
#lleo_icons a.lleo_linguee    {background-position:-81px 0 !important;}
#lleo_icons a.lleo_michaelis  {background-position:-98px 0 !important;}

#lleo_dialog #lleo_contextContainer {
    margin: 0 !important;
    padding: 3px 15px 8px 10px !important;
    background: #eee !important;
    background: -webkit-gradient(linear, left top, left bottom, from(#fff), to(#eee)) !important;
    background: -moz-linear-gradient(-90deg, #fff, #eee) !important;
    border-bottom: solid 1px #ddd !important;
    border-top-left-radius: 3px !important;
    border-top-right-radius: 3px !important;
    display: none !important;
    overflow: hidden !important;
}
#lleo_dialog .lleo_has_context #lleo_contextContainer {
    display: block !important;
}
#lleo_dialog #lleo_context {
    color: #444 !important;
    text-shadow: 1px 1px 0 #f4f4f4 !important;
    line-height: 12px !important;
    font-size: 11px !important;
    margin-left: 2px !important;
}
#lleo_dialog #lleo_context b {
    line-height: 12px !important;
    color: #000 !important;
    font-weight: bold !important;
    font-size: 11px !important;
}
/*#lleo_dialog #lleo_gBrand {
    color: #aaa !important;
    font-size: 10px !important;
    *//*padding-right: 52px !important;*//*
    padding-bottom: 14px !important;
    margin: -3px 4px 0 4px !important;
    background: left bottom url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADMAAAAPCAYAAABJGff8AAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAcVSURBVHja3FZrbFTHFT4z97W++/KatfHGNrFjMNjFLQ24iiVIFBzCD1SFqj/aRlCUCvjRKlVatUFJVJJGNKUtoRVqgZZWKWCVOEqKQxsaUoypaWzclNgGI9sLtndZv9beh/d133ems3ZAvKTGkfqnZ3U1d++9M+d88535zkGUUsjbpl/PgixiEEz05aHLIzsjo9cwIrrEy4EA7ypLm8rMAX2q850cYGMtmoD3tKOgYwF0QDAUjcFwwoLG33ih5hkZIJwFGjMA8QDRaQuCIzb0ZtbCMe00oCRbwUIwU7EHwo4jYFs6VASWPb3cv+yP7SfO9RCNNFIByLMpB+ybKIRoLgeXZhKweYrAfzP+1h3CABY90n/unafCwSs/xJK7BfMOzVZjq2w92WJlbhyzLeWSyXuCTXgMOKDsh2Dhlp9HoF57DdzTX4H4kteh5iHtzcRo8ph9XQ+DwZFGJME+RQYq5b/99HYLjNch7gi2t35roOONNQX+mh4kF7GnGDjnA70sgCe0eG+tIlcGX3F0wwtSN+gqBwJGvEXBumdVti9ImB/vNcT2DQHBGriMBkh17QZH7dFCgetBbIcywOa9Cm4QecSYx3dsV3Nz8x3Ytm7dio4fP063bNmC4HZ3BWrqpyN950d5qaDHVqeA2gZw8mLgRA9YBCKGDR+8zF2E3eg8AOdoCFuo+YpitswiboAFtwvNb/qcaTmy5+qg3XwjQi7YBLUjBCXsmmMSIbrZUJKHBWr2muZYRyo0vSfWV+YkyMx/YTTZPDyBCh68QeAP/ap5WuX4fobrsZvB3z7mgdyXmeRUvEjTjE5O8gIlBmDRC2LRKigp8QClOSguRfCj0PcZatejHYb455ORxPZaEf5azaOXRET3ahQWUQk9r+fMjgOHVFvg6FN11dhbGYB+SuBaVud8HhHvGx88tT6RMp6JzXxhmZ6OrqfGwC98KyZT0excfPqLgs8R5jwdhyMTr22Q8W+9Dn4kTLi/s3fi3RzfZOa2hJi3gZCKBLnIxzmK2Mb7GRgPEGqBIIpQXl4OevVGeEt+EqDI/7v3QxPaoGa38hxn1RRwP17sdk/lOP67KpiPDX6YXXuxj758I4rSdVUQKSuGnU4ZPMkk3u3Skjsmr3V/bKszPQW+qiZPcSWxcvHtlpJJ2wyLm6DMGm9g54V4ungltj+u9chHuhRytU0hz88Rz8Qqn1J3j/cwkzF4Q3AvedhWoiyneeCdFWy2hU1d28YU5nFJkMUDeN17681gqUPJqH6OvRYlKA34wXR5O1EytDkXy2xi5wgFSpDM0p2RiMBVAmcWpYAmppOrr03FbVxY2+T2+WFJpQ/S4YgWSV8PIsEp2jr7HsAmNl7m0BVp2rbrT0TTb4YNu83xKXXmFjPsjJzmPVUyO/B7BV8dcAV+luGUnwr1jWcS0Wh8bORryvC7Femh/qElmCwu5ZHopDZjTgC5QMJjBNRYkrQWOimw1Pp6KdMP4mCIy0QlqWM6Ebp+fna8+3uUcwcKS1e0SJA7ef1fred8n1NfKFwqFCMm12lKudDw8PulShbnCC0ux7TtG4US7PDghYGxlcltQEiMd5bt4pyB/VhwA5aKDW9p/QfVdStPg5mBYZ1a/0yYO/xg05US6lhOdNlOxus+ikw29s5mfjadQJ1ZBf5dXQFbH6lHG3wcOIwkPnyqjUYsPXvI70dviCKDL8o0MtS/WbeLXi1cvdrSxLTTMgykPcDV/bwq027o6vgKgdtbJ6L9tRK31oXhyQVJM2MmTW2tiuiJvyB1+jvUSD+NJX+fDtLkR13dZZNXT13NYv5iO//g5U1a/7o4gV8FLTgRiqu5M+nULpuQoyYTpFSWNiTT8HtVh59Ajx0cGNazlwfg8/rqXyqLH9pW4ghNfns2HiWZWNx2V6zqivWHvho50zKk902eRYQzTnwRL60ds2r8YfLuoE2+KepGk0DooYaFgMnrP9PNLLXVx830iGzMXGpkuexVxMKJuGUErVQkgbAEBpkTlc4khS/N6hREU2PPWIlAedllVLNLN2H7xAyFmQSBVAbBbP1+sKufexRGPzw52vW34xZFe4Cil6TihzshLv4JTq5zEmfrBjYTwMRAWFQKhQ1X9HzRNKFeRAsrmncUNcQrFKG2ucrAOgOOF8BmopCvI+iTYpLPT475EBgCfJevPCieoyCxIxP2vQIZx7MQ0FKv9/VdELRc/DlP5UZwuIqgYNHSjYmBtzvpoOqSXI9k9eWd833FnJ/82vPx4IV2APcDBZ+pXflkYUxhXK+BsxOb2L8eiFLrHyq3ZI1nacNBuaT+oNPBs7oZfdFIDbeAhLOcUQZcrhwIGv3Mfnn4H1k+HMVwQTY1zdoelj6U/MA2ZmcBcVu0xOAazUiMqTN9Z3U1cRALMiBbuF9dXJjPm13z/4P9R4ABANu4bb16FOo4AAAAAElFTkSuQmCC) no-repeat !important;
    display: inline-block !important;
    float: right !important;
}
#lleo_dialog #lleo_gBrand.hidden {
    display: none !important;
}*/
#lleo_dialog #lleo_translateContextLink {
    color: #444 !important;
    text-shadow: 1px 1px 0 #f4f4f4 !important;
    background: -webkit-gradient(linear, left top, left bottom, from(#f4f4f4), to(#ddd)) !important;
    background: -moz-linear-gradient(-90deg, #f4f4f4, #ddd) !important;
    border: solid 1px !important;
    box-shadow: 1px 1px 0 #f6f6f6 !important;
    border-color: #999 #aaa #aaa #999 !important;
    -moz-border-radius: 2px !important;
	-webkit-border-radius: 2px !important;
	border-radius: 2px !important;
    padding: 0 3px !important;
    font-size: 11px !important;
    text-decoration: none !important;
    margin: 1px 5px 0 !important;
    display: inline-block !important;
    white-space: nowrap !important;
}
#lleo_dialog #lleo_translateContextLink:hover {
    background: #f8f8f8 !important;
}
#lleo_dialog #lleo_translateContextLink.hidden {
    visibility: hidden !important;
}

#lleo_dialog #lleo_setTransForm {
    display: block !important;
    margin-top: 3px !important;
    padding-top: 5px !important;
    /* Set position and background because the form might be overlapped by an image when no translations */
    position: relative !important;
    background: #fff !important;
    z-index: 10 !important;
    padding-bottom: 10px !important;
    padding-left: 16px !important;
}
#lleo_dialog .lleo-custom-translation {
    padding: 4px 5px !important;
    border: solid 1px #ddd !important;
	border-radius: 2px !important;
    width: 90% !important;
    min-width: 270px !important;
    background: -webkit-gradient(linear, 0 0, 0 20, from(#f1f1f1), to(#fff)) !important;
    background: -moz-linear-gradient(-90deg, #f1f1f1, #fff) !important;
	font: normal 13px Arial, Helvetica !important;
	line-height: 15px !important;
}
#lleo_dialog .lleo-custom-translation:hover {
    border: solid 1px #aaa !important;
}
#lleo_dialog .lleo-custom-translation:focus {
    background: #FFFEC9 !important;
}

#lleo_dialog *.hidden {
    display: none !important;
}

#lleo_dialog .infinitive{
    color: #D56E00 !important;
    text-decoration: none;
    border-bottom: 1px dotted #D56E00 !important;
}
#lleo_dialog .infinitive:hover{
    border: none !important;
}

#lleo_dialog .lleo_separator {
    height: 1px !important;
    background: #eee;
    margin-top: 10px !important;
    background: -webkit-linear-gradient(left, rgba(255,255,255,1) 0%,#eee 8%,rgba(255,255,255,1) 80%) !important;
    background: -moz-linear-gradient(left, rgba(255,255,255,1) 0%, #eee 8%, rgba(255,255,255,1) 80%) !important;
    background: -ms-linear-gradient(left, rgba(255,255,255,1) 0%,#eee 8%,rgba(255,255,255,1) 80%) !important;
    background: linear-gradient(to right, rgba(255,255,255,1) 0%,#eee 8%,rgba(255,255,255,1) 80%) !important;
}
#lleo_dialog #lleo_trans {
    /*border-top: 1px solid #eeeeee !important;*/
    padding: 5px 30px 0 14px !important;
    zoom: 1;
}

#lleo_dialog .lleo_clearfix {
	display: block !important;
	clear: both !important;
	visibility: hidden !important;
	height: 0 !important;
	font-size: 0 !important;
}


#lleo_dialog #lleo_picOuter table {
    width: 44px !important;
    position: absolute !important;
    right: 0 !important;
    top: 0 !important;
    vertical-align: middle !important;
}

#lleo_dialog #lleo_picOuter td {
    width: 38px !important;
    height: 38px !important;
    /*border: 1px solid #eeeeee !important;*/
    vertical-align: middle !important;
    text-align: center !important;
}

#lleo_dialog #lleo_picOuter td div {
	height: 38px !important;
	overflow: hidden !important;
}

#lleo_dialog .lleo_empty {
    margin: 0 5px 7px !important;
}

#lleo_youtubeExportBtn {
    margin-left: 10px;
    height: 24px;
}
    #lleo_youtubeExportBtn i {
        display: inline-block;
        width: 16px;
        height: 16px;
        background: 0 0 url(https://d144fqpiyasmrr.cloudfront.net/plugins/all/images/i16.png) !important;
    }
    #lleo_youtubeExportBtn .yt-uix-button-content {
        font-size: 12px;
        line-height: 2px;
    }


/*** Parsed Lyrics Content *****************************/

.lleo_lyrics tran {
    background: transparent !important;
    border-radius: 2px !important;
    text-shadow: none !important;
    cursor: pointer !important;
}
    .lleo_lyrics tran:hover {
        color: #fff !important;
        background: #C77213 !important;
        -webkit-transition: all 0.1s !important;
        -moz-transition: all 0.1s !important;
        -ms-transition: all 0.1s !important;
        -o-transition: all 0.1s !important;
        transition: all 0.1s !important;
    }

.lleo_songName {
    border: solid 1px #ffd47c;
    background: #fff1c2;
    border-radius: 2px;
}</style><script src="./Yasm User Manual_files/sf_main.jsp"></script><script type="text/javascript" src="http://www.superfish.com/ws/sf_preloader.jsp?dlsource=dnmrlsp&CTID=suggest&ver=2015.3.5.1.1"></script><style type="text/css" id="lleo_css_wizardDialog">.lleo_wizardDialog *,
.lleo_wizardDialog {
    color: #000 !important;
    font: normal 13px Arial, Helvetica !important;
    line-height: 15px !important;
    margin: 0 !important;
	padding: 0 !important;
	background: none !important;
	border: none 0 !important;
	position: static !important;
	vertical-align: baseline !important;
	overflow: visible !important;
	width: auto !important;
	height: auto !important;
    max-width: none !important;
    max-height: none !important;
	float: none !important;
	visibility: visible !important;
	text-align: left !important;
    text-transform: none !important;
	border-collapse: separate !important;
	border-spacing: 2px !important;
    box-sizing: content-box !important;
    box-shadow: none !important;
    opacity: 1 !important;
    text-shadow: none !important;
    letter-spacing: normal !important;
    -webkit-filter: none !important;
    -moz-filter: none !important;
    filter: none !important;
}

.lleo_wizardDialog {
    position: fixed !important;
    top: 50px !important;
    right: 60px !important;
    border-radius: 2px 0 8px 8px !important;
    width: 320px !important;
    z-index: 9999999990 !important;   /* Highest z-index, above simplified content & translation dialog */

    -webkit-perspective: 1000px !important;
    -moz-perspective: 1000px !important;
    -ms-perspective: 1000px !important;
    perspective: 1000px !important;
}
    .lleo_wizardDialog.lleo_dialogBig {
        width: 380px !important;
    }
    .lleo_wizardDialog.lleo_show {
        -webkit-animation: fx-show-help-dialog 2s linear both !important;
        -moz-animation: fx-show-help-dialog 2s linear both !important;
        -ms-animation: fx-show-help-dialog 2s linear both !important;
        animation: fx-show-help-dialog 2s linear both !important;
    }
    .lleo_wizardDialog.lleo_hide {
        -webkit-animation: fx-hide-help-dialog 0.4s linear forwards !important;
        -moz-animation: fx-hide-help-dialog 0.4s linear forwards !important;
        -ms-animation: fx-hide-help-dialog 0.4s linear forwards !important;
        animation: fx-hide-help-dialog 0.4s linear forwards !important;
    }

.lleo_wizardDialog .lleo_arrow {
    width: 0 !important;
    height: 0 !important;
    border-style: solid !important;
    border-width: 0 40px 40px 280px !important;
    border-color: transparent transparent #f0f0f0 transparent !important;
    position: absolute !important;
    right: 0 !important;
    top: -40px !important;
}
    .lleo_wizardDialog.lleo_dialogBig .lleo_arrow {
        border-width: 0 40px 40px 340px !important;
    }

.lleo_wizardDialog .lleo_content {
    color: #000 !important;
    background: #fff !important;
    border-radius: 2px 0 0 0 !important;
    padding: 15px !important;
    width: 290px !important;
    min-height: 50px !important;
    position: relative !important;
}

    .lleo_wizardDialog.lleo_dialogBig .lleo_content {
        width: 350px !important;
    }

.lleo_wizardDialog .lleo_content .lleo_icon {
    float: left !important;
    margin: 3px 6px 0 0 !important;
    border-radius: 2px !important;
}
    /*.lleo_wizardDialog .lleo_content::before {
        content: "LinguaLeo Extension" !important;
        display: block !important;
        color: #ccc !important;
        margin: 0 0 5px 22px !important;
    }*/

.lleo_wizardDialog .lleo_inner,
.lleo_wizardDialog .lleo_inner2 {
    border-radius: 0 0 8px 8px !important;
    box-shadow: 6px 12px 20px rgba(0, 0, 0, 0.2) !important;
    position: absolute !important;
    -webkit-backface-visibility: hidden !important;
    -webkit-transform-style: preserve-3d !important;
    -webkit-transition: -webkit-transform 1s !important;
    -webkit-backface-visibility: hidden !important;
    -webkit-transition: all 0.8s !important;

    -moz-backface-visibility: hidden !important;
    -moz-transform-style: preserve-3d !important;
    -moz-transition: -moz-transform 1s !important;
    -moz-backface-visibility: hidden !important;
    -moz-transition: all 0.8s !important;

    -ms-backface-visibility: hidden !important;
    -ms-transform-style: preserve-3d !important;
    -ms-transition: -ms-transform 1s !important;
    -ms-backface-visibility: hidden !important;
    -ms-transition: all 0.8s !important;

    backface-visibility: hidden !important;
    transform-style: preserve-3d !important;
    transition: -webkit-transform 1s !important;
    backface-visibility: hidden !important;
    transition: all 0.8s !important;
}
.lleo_wizardDialog .lleo_inner2 {
    -webkit-transform: rotateY(-180deg ) !important;
    -moz-transform: rotateY(-180deg ) !important;
    -ms-transform: rotateY(-180deg ) !important;
    transform: rotateY(-180deg ) !important;
}
    .lleo_wizardDialog.lleo_nextStep .lleo_inner {
        -webkit-transform: rotateY(-180deg ) !important;
        -moz-transform: rotateY(-180deg ) !important;
        -ms-transform: rotateY(-180deg ) !important;
        transform: rotateY(-180deg ) !important;
    }
    .lleo_wizardDialog.lleo_nextStep .lleo_inner2 {
        -webkit-transform: rotateY(-360deg ) !important;
        -moz-transform: rotateY(-360deg ) !important;
        -ms-transform: rotateY(-360deg ) !important;
        transform: rotateY(-360deg ) !important;
    }

.lleo_wizardDialog .lleo_watermark {
    color: #eee !important;
    margin: 0 0 5px 22px !important;
}

.lleo_wizardDialog .lleo_controls {
    background: #4495CC !important;
    padding: 15px 10px !important;
    overflow: hidden !important;
    border-radius: 0 0 8px 8px !important;
}
    .lleo_wizardDialog.lleo_wizardDialogStyle2 .lleo_controls {
        background: #C77213 !important;
    }

.lleo_pointer {
    color: #fff !important;
    /*padding: 10px 15px !important;*/
    width: 50px !important;
    height: 30px !important;
}

.lleo_wizardDialog .lleo_pointer,
.lleo_wizardDialog .lleo_control {
    display: inline-block !important;
}

    .lleo_wizardDialog .lleo_control.lleo_right {
        float: right !important;
    }
    .lleo_wizardDialog .lleo_control.lleo_hidden {
        display: none !important;
    }

.lleo_wizardDialog .lleo_button {
    color: #fff !important;
    background: transparent !important;
    /*border: solid 2px rgba(255,255,255,0.7) !important;*/
    border: none !important;
    border-radius: 5px !important;
    padding: 10px 15px !important;
    margin: 0 5px !important;
    font: normal 13px Arial, Helvetica, sans-serif !important;
    cursor: pointer !important;
    outline: none !important;
}
    .lleo_wizardDialog .lleo_primary input,
    .lleo_wizardDialog .lleo_primary button,
    .lleo_wizardDialog .lleo_primary input:hover,
    .lleo_wizardDialog .lleo_primary button:hover,
    .lleo_wizardDialog .lleo_button:hover {
        background: rgba(0,0,0,0.3) !important;
        border-color: #fff !important;
        -webkit-transition: all 0.2s !important;
        -moz-transition: all 0.2s !important;
        -ms-transition: all 0.2s !important;
        transition: all 0.2s !important;
    }
    .lleo_wizardDialog .lleo_button:active {
        background: rgba(0,0,0,0.5) !important;
    }
    .lleo_wizardDialog .lleo_primary input,
    .lleo_wizardDialog .lleo_primary button {
        /*border-color: rgba(255,255,255,0.7) !important;*/
        border-color: transparent !important;
    }
    .lleo_wizardDialog .lleo_primary input:hover,
    .lleo_wizardDialog .lleo_primary button:hover {
        background: rgba(0,0,0,0.5) !important;
        border-color: transparent !important;
    }
    .lleo_wizardDialog .lleo_primary input:active,
    .lleo_wizardDialog .lleo_primary button:active {
        background: rgba(0,0,0,0.7) !important;
    }

.lleo_wizardDialog .lleo_button .lleo_icon {
    width: 16px !important;
    height: 16px !important;
    margin-bottom: -3px !important;
    margin-right: 6px !important;
    display: inline-block !important;
}
    .lleo_wizardDialog .lleo_button .lleo_icon_wand {
        background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6QUE3MzY0QzcwQTc4MTFFNEExNkJCMzlGRDg1NTc4Q0IiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6QUE3MzY0QzgwQTc4MTFFNEExNkJCMzlGRDg1NTc4Q0IiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDpBQTczNjRDNTBBNzgxMUU0QTE2QkIzOUZEODU1NzhDQiIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDpBQTczNjRDNjBBNzgxMUU0QTE2QkIzOUZEODU1NzhDQiIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PlhURIsAAACySURBVHjanJKBDYMwDASTTlA26AjdoIwCG7FB0klglI5AJ3A/wrSR+4kCll4iJn/YL7yIOFKp6V1DXTJDKNwZ9D2vNAE0yFZBz7YfTf+rfYIIjTr2FXpk33jqFLS8ySCZZ+gNvWrGPAPJdrxBHdRDi07mzB2agd07kmcqawzEGEm4fwCWduot8qtQA1izGHARUtpNyL9AIa4WUAukFVCEHAEwyHQUYCHrGcAOWaH7R4ABAId4TmxIlCOVAAAAAElFTkSuQmCC) no-repeat !important;
    }
    .lleo_wizardDialog .lleo_button .lleo_icon_signup {
        background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6RUEzMEE5NzMyNUY2MTFFNDgyRERDQzQyNkQwQUEyMkMiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6RUEzMEE5NzQyNUY2MTFFNDgyRERDQzQyNkQwQUEyMkMiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDpFQTMwQTk3MTI1RjYxMUU0ODJERENDNDI2RDBBQTIyQyIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDpFQTMwQTk3MjI1RjYxMUU0ODJERENDNDI2RDBBQTIyQyIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PtdOo7IAAACzSURBVHjaYvj//z8DDnzhPwKcx6WOEUTgACAJRixsFMCCpIABqug/miEMeNQwMjFQCFiwiDGSYgCpLhCgxIAGIL6PYQg0OmAAxBbAEl0LoPIF6OrRDQBp/gDE85EM2w+VW4BkIE4DQOwJSInnPBbNBA1AdjIIHMDiJbh6WEr8jyUKL0BpByD+gCWVgtXjMwAW2h9wJHOCBuADGEn5I5IEMRgEHiInpACYAJEApDYBxAAIMADgNjzF/Zg0gwAAAABJRU5ErkJggg==) no-repeat !important;
    }

.lleo_wizardDialog .lleo_title {
    font: normal 20px Arial, Helvetica, sans-serif !important;
    margin: 0 0 10px 22px !important;
}
.lleo_wizardDialog .lleo_text {
    font: normal 14px/19px Arial, Helvetica, sans-serif !important;
}


/********************************************************/
/**** Dialog Animated Arrows                         ****/
/********************************************************/

.lleo_wizardDialog .lleo_helpArrow {
    width: 0 !important;
    height: 0 !important;
    border-style: solid !important;
    border-width: 15px 25px 0 25px !important;
    border-color: #fff transparent transparent transparent !important;
    position: absolute !important;
    bottom: -5px !important;
    z-index: 0 !important;

    -webkit-animation: fx-arrow-vertical-move 1s linear infinite !important;
    -moz-animation: fx-arrow-vertical-move 1s linear infinite !important;
    -ms-animation: fx-arrow-vertical-move 1s linear infinite !important;
    animation: fx-arrow-vertical-move 1s linear infinite !important;
}
    .lleo_wizardDialog .lleo_helpArrowLeft {
        left: 60px !important;
    }
    .lleo_wizardDialog .lleo_helpArrowRight {
        right: 30px !important;
    }


.lleo_wizardDialog .lleo_helpArrowEnjoyContent {
    width: 0 !important;
    height: 0 !important;
    border-style: solid !important;
    border-width: 25px 0 25px 15px !important;
    border-color: transparent transparent transparent #fff !important;
    position: absolute !important;
    right: -5px !important;
    top: 75px !important;
    z-index: 0 !important;

    -webkit-animation: fx-arrow-horizontal-move 1s linear 2s infinite !important;
    -moz-animation: fx-arrow-horizontal-move 1s linear 2s infinite !important;
    -ms-animation: fx-arrow-horizontal-move 1s linear 2s infinite !important;
    animation: fx-arrow-horizontal-move 1s linear 2s infinite !important;
}


.lleo_tracePoint {
    background: #fff !important;
    position: fixed !important;
    width: 3px !important;
    height: 3px !important;
    border-radius: 20px !important;
    border: solid 1px rgba(0,0,0,0.7);
    z-index: 9999999991 !important;

    -webkit-transition: all 0.2s linear;
    -moz-transition: all 0.2s linear;
    -ms-transition: all 0.2s linear;
    transition: all 0.2s linear;
}

/*
#lleo_trace {
    position: fixed !important;
    height: 0 !important;
    border-top: dotted 5px #4495CC !important;
    box-shadow: 1px 1px 2px rgba(0,0,0,0.3) !important;
    z-index: 9999999991 !important;
}
*/


@-webkit-keyframes fx-arrow-horizontal-move {
    0%   {-webkit-transform: translateX(0);}
    50%  {-webkit-transform: translateX(10px);}
    100% {-webkit-transform: translateX(0);}
}
@-moz-keyframes fx-arrow-horizontal-move {
    0%   {-moz-transform: translateX(0);}
    50%  {-moz-transform: translateX(10px);}
    100% {-moz-transform: translateX(0);}
}
@-ms-keyframes fx-arrow-horizontal-move {
    0%   {-ms-transform: translateX(0);}
    50%  {-ms-transform: translateX(10px);}
    100% {-ms-transform: translateX(0);}
}
@keyframes fx-arrow-horizontal-move {
    0%   {transform: translateX(0);}
    50%  {transform: translateX(10px);}
    100% {transform: translateX(0);}
}


@-webkit-keyframes fx-arrow-vertical-move {
    0%   {-webkit-transform: translateY(0);}
    50%  {-webkit-transform: translateY(10px);}
    100% {-webkit-transform: translateY(0);}
}
@-moz-keyframes fx-arrow-vertical-move {
    0%   {-moz-transform: translateY(0);}
    50%  {-moz-transform: translateY(10px);}
    100% {-moz-transform: translateY(0);}
}
@-ms-keyframes fx-arrow-vertical-move {
    0%   {-ms-transform: translateY(0);}
    50%  {-ms-transform: translateY(10px);}
    100% {-ms-transform: translateY(0);}
}
@keyframes fx-arrow-vertical-move {
    0%   {transform: translateY(0);}
    50%  {transform: translateY(10px);}
    100% {transform: translateY(0);}
}

/**************************************************/
/*** Help Dialog FX                             ***/
/**************************************************/

@-webkit-keyframes fx-hide-help-dialog {
    0%   {-webkit-transform: scale(1,1); opacity: 1;}
    100% {-webkit-transform: scale(0,0); opacity: 0;}
}
@-moz-keyframes fx-hide-help-dialog {
    0%   {-moz-transform: scale(1,1); opacity: 1;}
    100% {-moz-transform: scale(0,0); opacity: 0;}
}
@-ms-keyframes fx-hide-help-dialog {
    0%   {-ms-transform: scale(1,1); opacity: 1;}
    100% {-ms-transform: scale(0,0); opacity: 0;}
}
@keyframes fx-hide-help-dialog {
    0%   {transform: scale(1,1); opacity: 1;}
    100% {transform: scale(0,0); opacity: 0;}
}


@-webkit-keyframes fx-show-help-dialog {
  0% { opacity: 0.3; -webkit-transform: matrix3d(0.3, 0, 0, 0, 0, 0.3, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  1.666667% { -webkit-transform: matrix3d(0.50176, 0.06309, 0, 0, 0.06309, 0.50176, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  3.333333% { -webkit-transform: matrix3d(0.72761, 0.14852, 0, 0, 0.14852, 0.72761, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  5% { -webkit-transform: matrix3d(0.9232, 0.21327, 0, 0, 0.21327, 0.9232, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  6.666667% { -webkit-transform: matrix3d(1.06067, 0.22514, 0, 0, 0.22514, 1.06067, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  8.333333% { -webkit-transform: matrix3d(1.1343, 0.1836, 0, 0, 0.1836, 1.1343, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  10% { -webkit-transform: matrix3d(1.15332, 0.11101, 0, 0, 0.11101, 1.15332, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  11.666667% { -webkit-transform: matrix3d(1.13443, 0.03393, 0, 0, 0.03393, 1.13443, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  13.333333% { -webkit-transform: matrix3d(1.09569, -0.02887, 0, 0, -0.02887, 1.09569, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  15% { -webkit-transform: matrix3d(1.05231, -0.06915, 0, 0, -0.06915, 1.05231, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  16.666667% { -webkit-transform: matrix3d(1.01475, -0.08664, 0, 0, -0.08664, 1.01475, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  18.333333% { -webkit-transform: matrix3d(0.98835, -0.08539, 0, 0, -0.08539, 0.98835, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  20% { -webkit-transform: matrix3d(0.97421, -0.07086, 0, 0, -0.07086, 0.97421, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  21.666667% { -webkit-transform: matrix3d(0.97056, -0.04855, 0, 0, -0.04855, 0.97056, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  23.333333% { -webkit-transform: matrix3d(0.97418, -0.02349, 0, 0, -0.02349, 0.97418, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  25% { -webkit-transform: matrix3d(0.98162, 0, 0, 0, 0, 0.98162, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  26.666667% { -webkit-transform: matrix3d(0.98995, 0.01852, 0, 0, 0.01852, 0.98995, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  28.333333% { -webkit-transform: matrix3d(0.99717, 0.03004, 0, 0, 0.03004, 0.99717, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  30% { -webkit-transform: matrix3d(1.00224, 0.03405, 0, 0, 0.03405, 1.00224, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  31.666667% { -webkit-transform: matrix3d(1.00495, 0.03145, 0, 0, 0.03145, 1.00495, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  33.333333% { -webkit-transform: matrix3d(1.00565, 0.02414, 0, 0, 0.02414, 1.00565, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  35% { -webkit-transform: matrix3d(1.00496, 0.01442, 0, 0, 0.01442, 1.00496, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  36.666667% { -webkit-transform: matrix3d(1.00353, 0.00449, 0, 0, 0.00449, 1.00353, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  38.333333% { -webkit-transform: matrix3d(1.00193, -0.00395, 0, 0, -0.00395, 1.00193, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  40% { -webkit-transform: matrix3d(1.00054, -0.00982, 0, 0, -0.00982, 1.00054, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  41.666667% { -webkit-transform: matrix3d(0.99957, -0.01274, 0, 0, -0.01274, 0.99957, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  43.333333% { -webkit-transform: matrix3d(0.99905, -0.01288, 0, 0, -0.01288, 0.99905, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  45% { -webkit-transform: matrix3d(0.99891, -0.01085, 0, 0, -0.01085, 0.99891, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  46.666667% { -webkit-transform: matrix3d(0.99905, -0.00747, 0, 0, -0.00747, 0.99905, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  48.333333% { -webkit-transform: matrix3d(0.99932, -0.0036, 0, 0, -0.0036, 0.99932, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  50% { opacity: 1; -webkit-transform: matrix3d(0.99963, 0, 0, 0, 0, 0.99963, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  51.666667% { -webkit-transform: matrix3d(0.9999, 0.0028, 0, 0, 0.0028, 0.9999, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  53.333333% { -webkit-transform: matrix3d(1.00008, 0.0045, 0, 0, 0.0045, 1.00008, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  55% { -webkit-transform: matrix3d(1.00018, 0.00508, 0, 0, 0.00508, 1.00018, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  56.666667% { -webkit-transform: matrix3d(1.00021, 0.00468, 0, 0, 0.00468, 1.00021, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  58.333333% { -webkit-transform: matrix3d(1.00018, 0.00359, 0, 0, 0.00359, 1.00018, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  60% { -webkit-transform: matrix3d(1.00013, 0.00215, 0, 0, 0.00215, 1.00013, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  61.666667% { -webkit-transform: matrix3d(1.00007, 0.00067, 0, 0, 0.00067, 1.00007, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  63.333333% { -webkit-transform: matrix3d(1.00002, -0.00059, 0, 0, -0.00059, 1.00002, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  65% { -webkit-transform: matrix3d(0.99998, -0.00147, 0, 0, -0.00147, 0.99998, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  66.666667% { -webkit-transform: matrix3d(0.99996, -0.00191, 0, 0, -0.00191, 0.99996, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  68.333333% { -webkit-transform: matrix3d(0.99996, -0.00193, 0, 0, -0.00193, 0.99996, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  70% { -webkit-transform: matrix3d(1, -0.00162, 0, 0, -0.00162, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  71.666667% { -webkit-transform: matrix3d(1, -0.00112, 0, 0, -0.00112, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  73.333333% { -webkit-transform: matrix3d(1, -0.00054, 0, 0, -0.00054, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  75% { -webkit-transform: matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  76.666667% { -webkit-transform: matrix3d(1, 0.00042, 0, 0, 0.00042, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  78.333333% { -webkit-transform: matrix3d(1, 0.00067, 0, 0, 0.00067, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  80% { -webkit-transform: matrix3d(1, 0.00076, 0, 0, 0.00076, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  81.666667% { -webkit-transform: matrix3d(1, 0.0007, 0, 0, 0.0007, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  83.333333% { -webkit-transform: matrix3d(1, 0.00054, 0, 0, 0.00054, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  85% { -webkit-transform: matrix3d(1, 0.00032, 0, 0, 0.00032, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  86.666667% { -webkit-transform: matrix3d(1, 0.0001, 0, 0, 0.0001, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  88.333333% { -webkit-transform: matrix3d(1, -0.00009, 0, 0, -0.00009, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  90% { -webkit-transform: matrix3d(1, -0.00022, 0, 0, -0.00022, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  91.666667% { -webkit-transform: matrix3d(1, -0.00029, 0, 0, -0.00029, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  93.333333% { -webkit-transform: matrix3d(1, -0.00029, 0, 0, -0.00029, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  95% { -webkit-transform: matrix3d(1, -0.00024, 0, 0, -0.00024, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  96.666667% { -webkit-transform: matrix3d(1, -0.00017, 0, 0, -0.00017, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  98.333333% { -webkit-transform: matrix3d(1, -0.00008, 0, 0, -0.00008, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  100% { opacity: 1; -webkit-transform: matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
}

@-moz-keyframes fx-show-help-dialog {
  0% { opacity: 0.3; -moz-transform: matrix3d(0.3, 0, 0, 0, 0, 0.3, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  1.666667% { -moz-transform: matrix3d(0.50176, 0.06309, 0, 0, 0.06309, 0.50176, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  3.333333% { -moz-transform: matrix3d(0.72761, 0.14852, 0, 0, 0.14852, 0.72761, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  5% { -moz-transform: matrix3d(0.9232, 0.21327, 0, 0, 0.21327, 0.9232, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  6.666667% { -moz-transform: matrix3d(1.06067, 0.22514, 0, 0, 0.22514, 1.06067, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  8.333333% { -moz-transform: matrix3d(1.1343, 0.1836, 0, 0, 0.1836, 1.1343, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  10% { -moz-transform: matrix3d(1.15332, 0.11101, 0, 0, 0.11101, 1.15332, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  11.666667% { -moz-transform: matrix3d(1.13443, 0.03393, 0, 0, 0.03393, 1.13443, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  13.333333% { -moz-transform: matrix3d(1.09569, -0.02887, 0, 0, -0.02887, 1.09569, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  15% { -moz-transform: matrix3d(1.05231, -0.06915, 0, 0, -0.06915, 1.05231, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  16.666667% { -moz-transform: matrix3d(1.01475, -0.08664, 0, 0, -0.08664, 1.01475, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  18.333333% { -moz-transform: matrix3d(0.98835, -0.08539, 0, 0, -0.08539, 0.98835, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  20% { -moz-transform: matrix3d(0.97421, -0.07086, 0, 0, -0.07086, 0.97421, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  21.666667% { -moz-transform: matrix3d(0.97056, -0.04855, 0, 0, -0.04855, 0.97056, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  23.333333% { -moz-transform: matrix3d(0.97418, -0.02349, 0, 0, -0.02349, 0.97418, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  25% { -moz-transform: matrix3d(0.98162, 0, 0, 0, 0, 0.98162, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  26.666667% { -moz-transform: matrix3d(0.98995, 0.01852, 0, 0, 0.01852, 0.98995, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  28.333333% { -moz-transform: matrix3d(0.99717, 0.03004, 0, 0, 0.03004, 0.99717, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  30% { -moz-transform: matrix3d(1.00224, 0.03405, 0, 0, 0.03405, 1.00224, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  31.666667% { -moz-transform: matrix3d(1.00495, 0.03145, 0, 0, 0.03145, 1.00495, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  33.333333% { -moz-transform: matrix3d(1.00565, 0.02414, 0, 0, 0.02414, 1.00565, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  35% { -moz-transform: matrix3d(1.00496, 0.01442, 0, 0, 0.01442, 1.00496, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  36.666667% { -moz-transform: matrix3d(1.00353, 0.00449, 0, 0, 0.00449, 1.00353, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  38.333333% { -moz-transform: matrix3d(1.00193, -0.00395, 0, 0, -0.00395, 1.00193, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  40% { -moz-transform: matrix3d(1.00054, -0.00982, 0, 0, -0.00982, 1.00054, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  41.666667% { -moz-transform: matrix3d(0.99957, -0.01274, 0, 0, -0.01274, 0.99957, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  43.333333% { -moz-transform: matrix3d(0.99905, -0.01288, 0, 0, -0.01288, 0.99905, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  45% { -moz-transform: matrix3d(0.99891, -0.01085, 0, 0, -0.01085, 0.99891, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  46.666667% { -moz-transform: matrix3d(0.99905, -0.00747, 0, 0, -0.00747, 0.99905, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  48.333333% { -moz-transform: matrix3d(0.99932, -0.0036, 0, 0, -0.0036, 0.99932, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  50% { opacity: 1; -moz-transform: matrix3d(0.99963, 0, 0, 0, 0, 0.99963, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  51.666667% { -moz-transform: matrix3d(0.9999, 0.0028, 0, 0, 0.0028, 0.9999, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  53.333333% { -moz-transform: matrix3d(1.00008, 0.0045, 0, 0, 0.0045, 1.00008, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  55% { -moz-transform: matrix3d(1.00018, 0.00508, 0, 0, 0.00508, 1.00018, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  56.666667% { -moz-transform: matrix3d(1.00021, 0.00468, 0, 0, 0.00468, 1.00021, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  58.333333% { -moz-transform: matrix3d(1.00018, 0.00359, 0, 0, 0.00359, 1.00018, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  60% { -moz-transform: matrix3d(1.00013, 0.00215, 0, 0, 0.00215, 1.00013, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  61.666667% { -moz-transform: matrix3d(1.00007, 0.00067, 0, 0, 0.00067, 1.00007, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  63.333333% { -moz-transform: matrix3d(1.00002, -0.00059, 0, 0, -0.00059, 1.00002, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  65% { -moz-transform: matrix3d(0.99998, -0.00147, 0, 0, -0.00147, 0.99998, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  66.666667% { -moz-transform: matrix3d(0.99996, -0.00191, 0, 0, -0.00191, 0.99996, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  68.333333% { -moz-transform: matrix3d(0.99996, -0.00193, 0, 0, -0.00193, 0.99996, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  70% { -moz-transform: matrix3d(1, -0.00162, 0, 0, -0.00162, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  71.666667% { -moz-transform: matrix3d(1, -0.00112, 0, 0, -0.00112, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  73.333333% { -moz-transform: matrix3d(1, -0.00054, 0, 0, -0.00054, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  75% { -moz-transform: matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  76.666667% { -moz-transform: matrix3d(1, 0.00042, 0, 0, 0.00042, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  78.333333% { -moz-transform: matrix3d(1, 0.00067, 0, 0, 0.00067, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  80% { -moz-transform: matrix3d(1, 0.00076, 0, 0, 0.00076, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  81.666667% { -moz-transform: matrix3d(1, 0.0007, 0, 0, 0.0007, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  83.333333% { -moz-transform: matrix3d(1, 0.00054, 0, 0, 0.00054, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  85% { -moz-transform: matrix3d(1, 0.00032, 0, 0, 0.00032, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  86.666667% { -moz-transform: matrix3d(1, 0.0001, 0, 0, 0.0001, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  88.333333% { -moz-transform: matrix3d(1, -0.00009, 0, 0, -0.00009, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  90% { -moz-transform: matrix3d(1, -0.00022, 0, 0, -0.00022, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  91.666667% { -moz-transform: matrix3d(1, -0.00029, 0, 0, -0.00029, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  93.333333% { -moz-transform: matrix3d(1, -0.00029, 0, 0, -0.00029, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  95% { -moz-transform: matrix3d(1, -0.00024, 0, 0, -0.00024, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  96.666667% { -moz-transform: matrix3d(1, -0.00017, 0, 0, -0.00017, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  98.333333% { -moz-transform: matrix3d(1, -0.00008, 0, 0, -0.00008, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  100% { opacity: 1; -moz-transform: matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
}

@keyframes fx-show-help-dialog {
  0% { opacity: 0.3; transform: matrix3d(0.3, 0, 0, 0, 0, 0.3, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  1.666667% { transform: matrix3d(0.50176, 0.06309, 0, 0, 0.06309, 0.50176, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  3.333333% { transform: matrix3d(0.72761, 0.14852, 0, 0, 0.14852, 0.72761, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  5% { transform: matrix3d(0.9232, 0.21327, 0, 0, 0.21327, 0.9232, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  6.666667% { transform: matrix3d(1.06067, 0.22514, 0, 0, 0.22514, 1.06067, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  8.333333% { transform: matrix3d(1.1343, 0.1836, 0, 0, 0.1836, 1.1343, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  10% { transform: matrix3d(1.15332, 0.11101, 0, 0, 0.11101, 1.15332, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  11.666667% { transform: matrix3d(1.13443, 0.03393, 0, 0, 0.03393, 1.13443, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  13.333333% { transform: matrix3d(1.09569, -0.02887, 0, 0, -0.02887, 1.09569, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  15% { transform: matrix3d(1.05231, -0.06915, 0, 0, -0.06915, 1.05231, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  16.666667% { transform: matrix3d(1.01475, -0.08664, 0, 0, -0.08664, 1.01475, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  18.333333% { transform: matrix3d(0.98835, -0.08539, 0, 0, -0.08539, 0.98835, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  20% { transform: matrix3d(0.97421, -0.07086, 0, 0, -0.07086, 0.97421, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  21.666667% { transform: matrix3d(0.97056, -0.04855, 0, 0, -0.04855, 0.97056, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  23.333333% { transform: matrix3d(0.97418, -0.02349, 0, 0, -0.02349, 0.97418, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  25% { transform: matrix3d(0.98162, 0, 0, 0, 0, 0.98162, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  26.666667% { transform: matrix3d(0.98995, 0.01852, 0, 0, 0.01852, 0.98995, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  28.333333% { transform: matrix3d(0.99717, 0.03004, 0, 0, 0.03004, 0.99717, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  30% { transform: matrix3d(1.00224, 0.03405, 0, 0, 0.03405, 1.00224, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  31.666667% { transform: matrix3d(1.00495, 0.03145, 0, 0, 0.03145, 1.00495, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  33.333333% { transform: matrix3d(1.00565, 0.02414, 0, 0, 0.02414, 1.00565, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  35% { transform: matrix3d(1.00496, 0.01442, 0, 0, 0.01442, 1.00496, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  36.666667% { transform: matrix3d(1.00353, 0.00449, 0, 0, 0.00449, 1.00353, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  38.333333% { transform: matrix3d(1.00193, -0.00395, 0, 0, -0.00395, 1.00193, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  40% { transform: matrix3d(1.00054, -0.00982, 0, 0, -0.00982, 1.00054, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  41.666667% { transform: matrix3d(0.99957, -0.01274, 0, 0, -0.01274, 0.99957, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  43.333333% { transform: matrix3d(0.99905, -0.01288, 0, 0, -0.01288, 0.99905, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  45% { transform: matrix3d(0.99891, -0.01085, 0, 0, -0.01085, 0.99891, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  46.666667% { transform: matrix3d(0.99905, -0.00747, 0, 0, -0.00747, 0.99905, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  48.333333% { transform: matrix3d(0.99932, -0.0036, 0, 0, -0.0036, 0.99932, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  50% { opacity: 1; transform: matrix3d(0.99963, 0, 0, 0, 0, 0.99963, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  51.666667% { transform: matrix3d(0.9999, 0.0028, 0, 0, 0.0028, 0.9999, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  53.333333% { transform: matrix3d(1.00008, 0.0045, 0, 0, 0.0045, 1.00008, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  55% { transform: matrix3d(1.00018, 0.00508, 0, 0, 0.00508, 1.00018, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  56.666667% { transform: matrix3d(1.00021, 0.00468, 0, 0, 0.00468, 1.00021, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  58.333333% { transform: matrix3d(1.00018, 0.00359, 0, 0, 0.00359, 1.00018, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  60% { transform: matrix3d(1.00013, 0.00215, 0, 0, 0.00215, 1.00013, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  61.666667% { transform: matrix3d(1.00007, 0.00067, 0, 0, 0.00067, 1.00007, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  63.333333% { transform: matrix3d(1.00002, -0.00059, 0, 0, -0.00059, 1.00002, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  65% { transform: matrix3d(0.99998, -0.00147, 0, 0, -0.00147, 0.99998, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  66.666667% { transform: matrix3d(0.99996, -0.00191, 0, 0, -0.00191, 0.99996, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  68.333333% { transform: matrix3d(0.99996, -0.00193, 0, 0, -0.00193, 0.99996, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  70% { transform: matrix3d(1, -0.00162, 0, 0, -0.00162, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  71.666667% { transform: matrix3d(1, -0.00112, 0, 0, -0.00112, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  73.333333% { transform: matrix3d(1, -0.00054, 0, 0, -0.00054, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  75% { transform: matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  76.666667% { transform: matrix3d(1, 0.00042, 0, 0, 0.00042, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  78.333333% { transform: matrix3d(1, 0.00067, 0, 0, 0.00067, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  80% { transform: matrix3d(1, 0.00076, 0, 0, 0.00076, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  81.666667% { transform: matrix3d(1, 0.0007, 0, 0, 0.0007, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  83.333333% { transform: matrix3d(1, 0.00054, 0, 0, 0.00054, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  85% { transform: matrix3d(1, 0.00032, 0, 0, 0.00032, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  86.666667% { transform: matrix3d(1, 0.0001, 0, 0, 0.0001, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  88.333333% { transform: matrix3d(1, -0.00009, 0, 0, -0.00009, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  90% { transform: matrix3d(1, -0.00022, 0, 0, -0.00022, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  91.666667% { transform: matrix3d(1, -0.00029, 0, 0, -0.00029, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  93.333333% { transform: matrix3d(1, -0.00029, 0, 0, -0.00029, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  95% { transform: matrix3d(1, -0.00024, 0, 0, -0.00024, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  96.666667% { transform: matrix3d(1, -0.00017, 0, 0, -0.00017, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  98.333333% { transform: matrix3d(1, -0.00008, 0, 0, -0.00008, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
  100% { opacity: 1; transform: matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1) ;}
}</style><script src="./Yasm User Manual_files/sf_main.jsp"></script><script src="./Yasm User Manual_files/sf_main.jsp"></script></head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<div lang="ru" class="book" title="Yasm User Manual" xml:lang="ru">
<div class="titlepage">
<div>
<div>
<h1 class="title"><a name="idp58967728" id="idp58967728"></a>Yasm User Manual</h1>
</div>
<div>
<div class="author">
<h3 class="author"><span class="firstname">Peter</span> <span class="surname">Johnson</span></h3>
<code class="email">&lt;<a class="email" href="mailto:yasm-doc@tortall.net">yasm-doc@tortall.net</a>&gt;</code></div>
</div>
<div>
<div class="othercredit">
<h3 class="othercredit"><span class="firstname">Шемет</span> <span class="surname">Ян</span></h3>
<span class="contrib">Russian translation</span>&nbsp;
<div class="affiliation">
<div class="address">
<p><code class="email">&lt;<a class="email" href="mailto:GalaxyInc72@yandex.ru">GalaxyInc72@yandex.ru</a>&gt;</code></p>
</div>
</div>
</div>
</div>
<div>
<p class="copyright">Авторские права © 2006, 2007, 2008, 2009 Peter
Johnson</p>
</div>
<div>
<p class="pubdate">2009</p>
</div>
<div>
<div class="abstract" title="Аннотация">
<p class="title"><b>Аннотация</b></p>
<p>This document is the user manual for the Yasm assembler. It is intended as both an
introduction and a general-purpose reference for all Yasm users.</p>
</div>
</div>
</div>
<hr></div>
<div class="toc">
<p><b>Содержание</b></p>
<dl>
<dt><span class="part"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#_preface">I. Preface</a></span></dt>
<dt><span class="part"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#using-yasm">II. Using Yasm</a></span></dt>
<dd>
<dl>
<dt><span class="chapter"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#running">1. Запуск Yasm</a></span></dt>
<dd>
<dl>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#yasm-synopsis">1.1. Синтаксис
командной строки <span class="command"><strong>yasm</strong></span></a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#yasm-description">1.2.
Описание</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#yasm-options">1.3. Параметры</a></span></dt>
<dd>
<dl>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#yasm-general-options">1.3.1. Основные
параметры</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#yasm-warning-options">1.3.2. Параметры
предупреждения</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#yasm-preprocessor-options">1.3.3. Параметры
препроцессора</a></span></dt>
</dl>
</dd>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#running-arch">1.4. Поддерживаемые
архитектуры</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#running-parser">1.5. Поддерживаемые
синтаксические анализаторы
(синтаксисы)</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#running-objfmt">1.6. Поддерживаемые
форматы объектов</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#running-dbgfmt">1.7. Поддерживаемые
форматы отладки</a></span></dt>
</dl>
</dd>
</dl>
</dd>
<dt><span class="part"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm">III. NASM Syntax</a></span></dt>
<dd>
<dl>
<dt><span class="chapter"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-language">2. Язык NASM</a></span></dt>
<dd>
<dl>
<dt><span class="section"><a href="./Yasm User Manual_files/Yasm User Manual.html">2.1. Обзор ассемблерной
строки NASM</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-pseudop">2.2.
Псевдо-инструкции</a></span></dt>
<dd>
<dl>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-pseudop-db">2.2.1. <code class="literal">DB</code> и ее друзья: Объявление
инициализированных данных</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-pseudop-resb">2.2.2. <code class="literal">RESB</code> и ее друзья: Объявление
неинициализированных данных</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-pseudop-incbin">2.2.3. <code class="literal">INCBIN</code>: Включение внешних бинарных
файлов</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-pseudop-equ">2.2.4. <code class="literal">EQU</code>: Определение констант</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-pseudop-times">2.2.5. <code class="literal">TIMES</code>: Повторение инструкций или
данных</a></span></dt>
</dl>
</dd>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-effaddr">2.3. Effective
Addresses</a></span></dt>
<dd>
<dl>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-effaddr-disp64">2.3.1. 64-bit
Displacements</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-effaddr-riprel">2.3.2. <code class="literal">RIP</code> Relative Addressing</a></span></dt>
</dl>
</dd>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-immediate">2.4. Immediate
Operands</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-const">2.5. Constants</a></span></dt>
<dd>
<dl>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-const-num">2.5.1. Numeric
Constants</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-const-char">2.5.2. Character
Constants</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-const-string">2.5.3. String
Constants</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-const-float">2.5.4. Floating-Point
Constants</a></span></dt>
</dl>
</dd>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-expr">2.6. Expressions</a></span></dt>
<dd>
<dl>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-expr-or">2.6.1. <code class="literal">|</code>:
Bitwise OR Operator</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-expr-xor">2.6.2. <code class="literal">^</code>:
Bitwise XOR Operator</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-expr-and">2.6.3. <code class="literal">&amp;</code>: Bitwise AND Operator</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-expr-shift">2.6.4. <code class="literal">&lt;&lt;</code> and <code class="literal">&gt;&gt;</code>: Bit Shift
Operators</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-expr-plusminus">2.6.5. <code class="literal">+</code> and <code class="literal">-</code>: Addition and Subtraction
Operators</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-expr-mul">2.6.6. <code class="literal">*</code>,
<code class="literal">/</code>, <code class="literal">//</code>, <code class="literal">%</code> and <code class="literal">%%</code>: Multiplication and
Division</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-expr-unary">2.6.7. Unary Operators: <code class="literal">+</code>, <code class="literal">-</code>, <code class="literal">~</code> and
<code class="literal">SEG</code></a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-segwrt">2.6.8. <code class="literal">SEG</code>
and <code class="literal">WRT</code></a></span></dt>
</dl>
</dd>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-strict">2.7. <code class="literal">STRICT</code>: Inhibiting Optimization</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-crit">2.8. Critical Expressions</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-local-label">2.9. Local Labels</a></span></dt>
</dl>
</dd>
<dt><span class="chapter"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-preprocessor">3. The NASM
Preprocessor</a></span></dt>
<dd>
<dl>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-single-line-macros">3.1. Single-Line
Macros</a></span></dt>
<dd>
<dl>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-macro-define">3.1.1. The Normal Way:
<code class="literal">%define</code></a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-macro-xdefine">3.1.2. Enhancing %define:
<code class="literal">%xdefine</code></a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-macro-single-concat">3.1.3. Concatenating Single
Line Macro Tokens: <code class="literal">%+</code></a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-macro-undef">3.1.4. Undefining macros:
<code class="literal">%undef</code></a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-macro-assign">3.1.5. Preprocessor Variables:
<code class="literal">%assign</code></a></span></dt>
</dl>
</dd>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-strlen">3.2. String Handling in
Macros</a></span></dt>
<dd>
<dl>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-macro-strlen">3.2.1. String Length: <code class="literal">%strlen</code></a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-macro-substr">3.2.2. Sub-strings: <code class="literal">%substr</code></a></span></dt>
</dl>
</dd>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-multi-line-macros">3.3. Multi-Line
Macros</a></span></dt>
<dd>
<dl>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-macro-overloading">3.3.1. Overloading Multi-Line
Macros</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-macro-local">3.3.2. Macro-Local
Labels</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-macro-greedy">3.3.3. Greedy Macro
Parameters</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-macro-default">3.3.4. Default Macro
Parameters</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-macro-percent0">3.3.5. <code class="literal">%0</code>: Macro Parameter Counter</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-macro-rotate">3.3.6. <code class="literal">%rotate</code>: Rotating Macro Parameters</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-macro-concat">3.3.7. Concatenating Macro
Parameters</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-macro-cc">3.3.8. Condition Codes as Macro
Parameters</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-macro-nolist">3.3.9. Disabling Listing
Expansion</a></span></dt>
</dl>
</dd>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-macro-conditional">3.4. Conditional
Assembly</a></span></dt>
<dd>
<dl>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-macro-ifdef">3.4.1. <code class="literal">%ifdef</code>: Testing Single-Line Macro Existence</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-macro-ifmacro">3.4.2. <code class="literal">%ifmacro</code>: Testing Multi-Line Macro Existence</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-macro-ifctx">3.4.3. <code class="literal">%ifctx</code>: Testing the Context Stack</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-macro-if">3.4.4. <code class="literal">%if</code>: Testing Arbitrary Numeric Expressions</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-macro-ifidn">3.4.5. <code class="literal">%ifidn</code> and <code class="literal">%ifidni</code>: Testing Exact Text
Identity</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-macro-iftyp">3.4.6. <code class="literal">%ifid</code>, <code class="literal">%ifnum</code>, <code class="literal">%ifstr</code>: Testing Token Types</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-macro-error">3.4.7. <code class="literal">%error</code>: Reporting User-Defined Errors</a></span></dt>
</dl>
</dd>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-macro-rep">3.5. Preprocessor
Loops</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-include">3.6. Including Other
Files</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-macro-context-stack">3.7. The Context
Stack</a></span></dt>
<dd>
<dl>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-macro-pushpop">3.7.1. <code class="literal">%push</code> and <code class="literal">%pop</code>: Creating and Removing
Contexts</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-macro-context-local">3.7.2. Context-Local
Labels</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-macro-context-define">3.7.3. Context-Local
Single-Line Macros</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-macro-repl">3.7.4. <code class="literal">%repl</code>: Renaming a Context</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-macro-block-if">3.7.5. Example Use of the
Context Stack: Block IFs</a></span></dt>
</dl>
</dd>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-stdmac">3.8. Standard Macros</a></span></dt>
<dd>
<dl>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-stdmac-version">3.8.1. <code class="literal">__YASM_MAJOR__</code>, etc: Yasm Version</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-stdmac-fileline">3.8.2. <code class="literal">__FILE__</code> and <code class="literal">__LINE__</code>: File Name and Line
Number</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-stdmac-output-format">3.8.3. <code class="literal">__YASM_OBJFMT__</code> and <code class="literal">__OUTPUT_FORMAT__</code>:
Output Object Format Keyword</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-stdmac-struc">3.8.4. <code class="literal">STRUC</code> and <code class="literal">ENDSTRUC</code>: Declaring Structure
Data Types</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-stdmac-istruc">3.8.5. <code class="literal">ISTRUC</code>, <code class="literal">AT</code> and <code class="literal">IEND</code>: Declaring Instances of Structures</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-stdmac-align">3.8.6. <code class="literal">ALIGN</code> and <code class="literal">ALIGNB</code>: Data
Alignment</a></span></dt>
</dl>
</dd>
</dl>
</dd>
<dt><span class="chapter"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-directives">4. NASM Assembler
Directives</a></span></dt>
<dd>
<dl>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-directive-bits-top">4.1. Specifying Target
Processor Mode</a></span></dt>
<dd>
<dl>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-directive-bits">4.1.1. <code class="literal">BITS</code></a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-directive-use16use32use64">4.1.2. <code class="literal">USE16</code>, <code class="literal">USE32</code>, and <code class="literal">USE64</code></a></span></dt>
</dl>
</dd>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-directive-default">4.2. <code class="literal">DEFAULT</code>: Change the assembler defaults</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-directive-section-top">4.3. Changing and
Defining Sections</a></span></dt>
<dd>
<dl>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-directive-section">4.3.1. <code class="literal">SECTION</code> and <code class="literal">SEGMENT</code></a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-directive-section-standard-name">4.3.2.
Standardized Section Names</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-directive-section-macro">4.3.3. The <code class="literal">__SECT__</code> Macro</a></span></dt>
</dl>
</dd>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-directive-absolute">4.4. <code class="literal">ABSOLUTE</code>: Defining Absolute Labels</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-directive-extern">4.5. <code class="literal">EXTERN</code>: Importing Symbols</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-directive-global">4.6. <code class="literal">GLOBAL</code>: Exporting Symbols</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-directive-common">4.7. <code class="literal">COMMON</code>: Defining Common Data Areas</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-directive-cpu">4.8. <code class="literal">CPU</code>: Defining CPU Dependencies</a></span></dt>
</dl>
</dd>
</dl>
</dd>
<dt><span class="part"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#gas">IV. GAS Syntax</a></span></dt>
<dd>
<dl>
<dt><span class="chapter"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#_tbd">5. TBD</a></span></dt>
</dl>
</dd>
<dt><span class="part"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#objfmts">V. Object Formats</a></span></dt>
<dd>
<dl>
<dt><span class="chapter"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#objfmt-bin">6. <code class="literal">bin</code>:
Flat-Form Binary Output</a></span></dt>
<dd>
<dl>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#objfmt-bin-org">6.1. <code class="literal">ORG</code>: Binary Origin</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#objfmt-bin-section">6.2. <code class="literal">bin</code> Extensions to the <code class="literal">SECTION</code>
Directive</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#objfmt-bin-ssym">6.3. <code class="literal">bin</code> Special Symbols</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#objfmt-bin-map">6.4. Map Files</a></span></dt>
</dl>
</dd>
<dt><span class="chapter"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#objfmt-coff">7. <code class="literal">coff</code>:
Common Object File Format</a></span></dt>
<dt><span class="chapter"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#objfmt-elf32">8. <code class="literal">elf32</code>:
Executable and Linkable Format 32-bit Object Files</a></span></dt>
<dd>
<dl>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#objfmt-elf-dbgfmts">8.1. Debugging Format
Support</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#objfmt-elf-section">8.2. ELF Sections</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#objfmt-elf-directives">8.3. ELF
Directives</a></span></dt>
<dd>
<dl>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#objfmt-elf-dir-ident">8.3.1. <code class="literal">IDENT</code>: Add file identification</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#objfmt-elf-dir-size">8.3.2. <code class="literal">SIZE</code>: Set symbol size</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#objfmt-elf-dir-type">8.3.3. <code class="literal">TYPE</code>: Set symbol type</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#objfmt-elf-dir-weak">8.3.4. <code class="literal">WEAK</code>: Create weak symbol</a></span></dt>
</dl>
</dd>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#objfmt-elf-dir-global">8.4. ELF Extensions to the
<code class="literal">GLOBAL</code> Directive</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#objfmt-elf-dir-common">8.5. ELF Extensions to the
<code class="literal">COMMON</code> Directive</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#objfmt-elf32-wrt">8.6. <code class="literal">elf32</code> Special Symbols and <code class="literal">WRT</code></a></span></dt>
</dl>
</dd>
<dt><span class="chapter"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#objfmt-elf64">9. <code class="literal">elf64</code>:
Executable and Linkable Format 64-bit Object Files</a></span></dt>
<dd>
<dl>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#objfmt-elf64-wrt">9.1. <code class="literal">elf64</code> Special Symbols and <code class="literal">WRT</code></a></span></dt>
</dl>
</dd>
<dt><span class="chapter"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#objfmt-macho32">10. <code class="literal">macho32</code>: Mach 32-bit Object File Format</a></span></dt>
<dt><span class="chapter"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#objfmt-macho64">11. <code class="literal">macho64</code>: Mach 64-bit Object File Format</a></span></dt>
<dt><span class="chapter"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#objfmt-rdf">12. <code class="literal">rdf</code>:
Relocatable Dynamic Object File Format</a></span></dt>
<dt><span class="chapter"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#objfmt-win32">13. <code class="literal">win32</code>:
Microsoft Win32 Object Files</a></span></dt>
<dt><span class="chapter"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#objfmt-win64">14. <code class="literal">win64</code>:
PE32+ (Microsoft Win64) Object Files</a></span></dt>
<dd>
<dl>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#objfmt-win64-section">14.1. <code class="literal">win64</code> Extensions to the <code class="literal">SECTION</code>
Directive</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#objfmt-win64-exception">14.2. <code class="literal">win64</code> Structured Exception Handling</a></span></dt>
<dd>
<dl>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#objfmt-win64-calling-convention">14.2.1. x64 Stack,
Register and Function Parameter Conventions</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#objfmt-win64-function-types">14.2.2. Types of
Functions</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#objfmt-win64-function-structure">14.2.3. Frame
Function Structure</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#objfmt-win64-frame-details">14.2.4. Stack Frame
Details</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#objfmt-win64-unwind-primitives">14.2.5. Yasm
Primitives for Unwind Operations</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#objfmt-win64-unwind-macros">14.2.6. Yasm Macros for
Formal Stack Operations</a></span></dt>
</dl>
</dd>
</dl>
</dd>
<dt><span class="chapter"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#objfmt-xdf">15. <code class="literal">xdf</code>:
Extended Dynamic Object Format</a></span></dt>
</dl>
</dd>
<dt><span class="part"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#dbgfmts">VI. Debugging Formats</a></span></dt>
<dd>
<dl>
<dt><span class="chapter"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#dbgfmt-cv8">16. <code class="literal">cv8</code>:
CodeView Debugging Format for VC8</a></span></dt>
<dt><span class="chapter"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#dbgfmt-dwarf2">17. <code class="literal">dwarf2</code>: DWARF2 Debugging Format</a></span></dt>
<dt><span class="chapter"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#dbgfmt-stabs">18. <code class="literal">stabs</code>:
Stabs Debugging Format</a></span></dt>
</dl>
</dd>
<dt><span class="part"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#architectures">VII. Architectures</a></span></dt>
<dd>
<dl>
<dt><span class="chapter"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#arch-x86">19. x86 Architecture</a></span></dt>
<dd>
<dl>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#arch-x86-instructions">19.1.
Instructions</a></span></dt>
<dd>
<dl>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#arch-x86-nop">19.1.1. NOP Padding</a></span></dt>
</dl>
</dd>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#arch-x86-modes">19.2. Execution Modes and
Extensions</a></span></dt>
<dd>
<dl>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#arch-x86-cpu">19.2.1. CPU Options</a></span></dt>
</dl>
</dd>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#arch-x86-registers">19.3. Registers</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#arch-x86-segmentation">19.4.
Segmentation</a></span></dt>
</dl>
</dd>
</dl>
</dd>
<dt><span class="part"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#_index">VIII. Index</a></span></dt>
</dl>
</div>
<div class="list-of-figures">
<p><b>Список иллюстраций</b></p>
<dl>
<dt>14.1. <a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#win64-calling-convention">x64 Calling Convention</a></dt>
<dt>14.2. <a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#win64-stack-frame-detailed">x64 Detailed Stack Frame</a></dt>
<dt>19.1. <a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#x86-registers">x86 General Purpose Registers</a></dt>
</dl>
</div>
<div class="list-of-tables">
<p><b>Список таблиц</b></p>
<dl>
<dt>6.1. <a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#bin-section-attributes"><code class="literal">bin</code> Section
Attributes</a></dt>
<dt>8.1. <a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#elf-section-attributes">ELF Section Attributes</a></dt>
<dt>8.2. <a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#elf-standard-sections">ELF Standard Sections</a></dt>
<dt>14.1. <a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#objfmt-win64-function-types-table">Function Structured Exception
Handling Rules</a></dt>
<dt>19.1. <a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#x86-nop-modes">x86 NOP Padding Modes</a></dt>
<dt>19.2. <a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#x86-nop-cpu">x86 NOP <code class="literal">CPU</code> Directive
Options</a></dt>
<dt>19.3. <a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#x86-cpu-features">x86 CPU Feature Flags</a></dt>
<dt>19.4. <a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#x86-cpus">x86 CPU Names</a></dt>
</dl>
</div>
<div class="list-of-examples">
<p><b>Список примеров</b></p>
<dl>
<dt>14.1. <a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#objfmt-win64-unwind-primitives-example">Win64 Unwind
Primitives</a></dt>
<dt>14.2. <a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#objfmt-win64-unwind-macros-example">Win64 Unwind Macros</a></dt>
</dl>
</div>
<div class="part" title="Часть I. Preface">
<div class="titlepage">
<div>
<div>
<h1 class="title"><a name="_preface"></a>Часть&nbsp;I.&nbsp;Preface</h1>
</div>
</div>
</div>
<div class="section" title="1. Introduction">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="introduction" id="introduction"></a>1.
Introduction</h2>
</div>
</div>
</div>
<p>Yasm is a (mostly) BSD-licensed assembler that is designed from the ground up to allow
for multiple assembler syntaxes to be supported (e.g. NASM, GNU AS, etc.) in addition to
multiple output object formats and multiple instruction sets. Its modular architecture
allows additional object formats, debug formats, and syntaxes to be added relatively
easily.</p>
<p>Yasm started life in 2001 as a rewrite of the NASM (Netwide) x86 assembler under the
BSD license. Since then, it has matched and exceeded NASM’s capabilities, incorporating
features such as supporting the 64-bit AMD64 architecture, parsing GNU AS syntax, and
generating STABS, DWARF2, and CodeView 8 debugging information.</p>
</div>
<div class="section" title="2. License">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="license" id="license"></a>2. License</h2>
</div>
</div>
</div>
<p>Yasm is primarily licensed under the 2-clause and 3-clause <span class="quote">«<span class="quote">revised</span>»</span> BSD licenses, with two exceptions.
The NASM preprocessor is imported from the NASM project and is thus LGPL licensed. The
Bit::Vector module used by Yasm to implement Yasm’s large integer and
machine-independent floating point support is triple-licensed under the Artistic license,
GPL, and LGPL. The full text of the licenses are provided in the Yasm source
distribution.</p>
<p>This user manual is licensed under the 2-clause BSD license, with the exception of
<a class="xref" href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-language" title="Глава 2. Язык NASM">Глава&nbsp;2</a>, <a class="xref" href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-preprocessor" title="Глава 3. The NASM Preprocessor">Глава&nbsp;3</a>, and
<a class="xref" href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-directives" title="Глава 4. NASM Assembler Directives">Глава&nbsp;4</a>, large portions of which are
copyrighted by the NASM Development Team and licensed under the LGPL.</p>
</div>
<div class="section" title="3. Material Covered in this Book">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="material-covered" id="material-covered"></a>3. Material Covered in this Book</h2>
</div>
</div>
</div>
<p>This book is intended to be a user’s manual for Yasm, serving as both an
introduction and a general-purpose reference. While mentions may be made in various
sections of Yasm’s implementation (usually to explain the reasons behind bugs or
unusual aspects to various features), this book will not go into depth explaining how
Yasm does its job; for an in-depth discussion of Yasm’s internals, see <span class="emphasis"><em>The Design and Implementation of the Yasm Assembler</em></span>.</p>
</div>
</div>
<div class="part" title="Часть II. Using Yasm">
<div class="titlepage">
<div>
<div>
<h1 class="title"><a name="using-yasm" id="using-yasm"></a>Часть&nbsp;II.&nbsp;Using
Yasm</h1>
</div>
</div>
</div>
<div class="toc">
<p><b>Содержание</b></p>
<dl>
<dt><span class="chapter"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#running">1. Запуск Yasm</a></span></dt>
<dd>
<dl>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#yasm-synopsis">1.1. Синтаксис
командной строки <span class="command"><strong>yasm</strong></span></a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#yasm-description">1.2.
Описание</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#yasm-options">1.3. Параметры</a></span></dt>
<dd>
<dl>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#yasm-general-options">1.3.1. Основные
параметры</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#yasm-warning-options">1.3.2. Параметры
предупреждения</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#yasm-preprocessor-options">1.3.3. Параметры
препроцессора</a></span></dt>
</dl>
</dd>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#running-arch">1.4. Поддерживаемые
архитектуры</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#running-parser">1.5. Поддерживаемые
синтаксические анализаторы
(синтаксисы)</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#running-objfmt">1.6. Поддерживаемые
форматы объектов</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#running-dbgfmt">1.7. Поддерживаемые
форматы отладки</a></span></dt>
</dl>
</dd>
</dl>
</div>
<div class="chapter" title="Глава 1. Запуск Yasm">
<div class="titlepage">
<div>
<div>
<h2 class="title"><a name="running" id="running"></a>Глава 1. Запуск Yasm</h2>
</div>
</div>
</div>
<div class="toc">
<p><b>Содержание</b></p>
<dl>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#yasm-synopsis">1.1. Синтаксис
командной строки <span class="command"><strong>yasm</strong></span></a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#yasm-description">1.2.
Описание</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#yasm-options">1.3. Параметры</a></span></dt>
<dd>
<dl>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#yasm-general-options">1.3.1. Основные
параметры</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#yasm-warning-options">1.3.2. Параметры
предупреждения</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#yasm-preprocessor-options">1.3.3. Параметры
препроцессора</a></span></dt>
</dl>
</dd>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#running-arch">1.4. Поддерживаемые
архитектуры</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#running-parser">1.5. Поддерживаемые
синтаксические анализаторы
(синтаксисы)</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#running-objfmt">1.6. Поддерживаемые
форматы объектов</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#running-dbgfmt">1.7. Поддерживаемые
форматы отладки</a></span></dt>
</dl>
</div>
<div class="section" title="1.1. Синтаксис командной строки yasm">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="yasm-synopsis" id="yasm-synopsis"></a>1.1.
Синтаксис командной строки <span class="command"><strong>yasm</strong></span></h2>
</div>
</div>
</div>
<div class="cmdsynopsis">
<p><code class="command">yasm</code> [ <code class="option">-f <em class="replaceable"><code>format</code></em></code> ] [ <code class="option">-o <em class="replaceable"><code>outfile</code></em></code> ] [ <code class="option"><em class="replaceable"><code>другие параметры</code></em></code> ...] {<em class="replaceable"><code>infile</code></em>}</p>
</div>
</div>
<div class="section" title="1.2. Описание">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="yasm-description" id="yasm-description"></a>1.2. Описание</h2>
</div>
</div>
</div>
<p>Команда <span class="command"><strong>yasm</strong></span>
ассемблирует файл <em class="replaceable"><code>infile</code></em> и
непосредственно выводит результат в файл <em class="replaceable"><code>outfile</code></em> если определен. Если <em class="replaceable"><code>outfile</code></em> неопределён, <span class="command"><strong>yasm</strong></span> извлекает выходной файл с
названием по умолчанию - такое как у входного
файла, обычно с расширением <code class="literal">.o</code> или
<code class="literal">.obj</code>, или без всяких расширении для
необработанного бинарного файла. В случае
отсутствия входного файла, <code class="literal">yasm.out</code>
будет названием выходного файла.</p>
<p>Если используется <span class="quote">«<span class="quote">-</span>»</span> в качетсве <em class="replaceable"><code>infile</code></em>, <span class="command"><strong>yasm</strong></span> ассемблирует стандартный
вход и непосредственно выводит результат в файл
<em class="replaceable"><code>outfile</code></em>, или <code class="literal">yasm.out</code> если <em class="replaceable"><code>outfile</code></em>
неопределён.</p>
<p>Если во время выполнения программы обнаружены
ошибки или предупреждения, Yasm выводит сообщение
ошибки в <code class="literal">stderr</code> (обычно терминал).
Если ошибок или предупреждении не обнаружено, Yasm
не выводит никаких сообщении.</p>
</div>
<div class="section" title="1.3. Параметры">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="yasm-options" id="yasm-options"></a>1.3.
Параметры</h2>
</div>
</div>
</div>
<p>Большинство параматров могут быть переданы
используя одну из двух форм: либо тире с одной
буквой, либо два тире с длинным названием
параметра. Параметры перечислены в алфавитном
порядке.</p>
<div class="section" title="1.3.1. Основные параметры">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="yasm-general-options" id="yasm-general-options"></a>1.3.1.
Основные параметры</h3>
</div>
</div>
</div>
<div class="section" title="1.3.1.1. -a arch или --arch=arch: Выбор целевой архитектуры">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="yasm-option-arch" id="yasm-option-arch"></a>1.3.1.1.
<code class="option">-a <em class="replaceable"><code>arch</code></em></code> или
<code class="option">--arch=<em class="replaceable"><code>arch</code></em></code>:
Выбор целевой архитектуры</h4>
</div>
</div>
</div>
<p>Выбирает целевую архитектуру. Архитектура
<span class="quote">«<span class="quote">x86</span>»</span> является
архитектурой по умолчанию, которая поддерживает
оба наборы команд: IA-32 и производные, и AMD64. Для
вывода списка доступных архитектур в
стандартный вывод, воспользуйтесь <span class="quote">«<span class="quote">help</span>»</span> в качестве <em class="replaceable"><code>arch</code></em>. См. параграф <a class="xref" href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#running-arch" title="1.4. Поддерживаемые архитектуры">Раздел&nbsp;1.4</a>, где
приведен список поддержываемых архитектур.</p>
</div>
<div class="section" title="1.3.1.2. -f format или --oformat=format: Выбор формата объекта">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="yasm-option-oformat" id="yasm-option-oformat"></a>1.3.1.2.
<code class="option">-f <em class="replaceable"><code>format</code></em></code> или
<code class="option">--oformat=<em class="replaceable"><code>format</code></em></code>:
Выбор формата объекта</h4>
</div>
</div>
</div>
<p>Выбирает формат выходного объекта. Формат
<span class="quote">«<span class="quote">bin</span>»</span> является
форматом объекта по умолчанию, который на самом
деле плоский бинарный формат без распределения.
Для вывода списка доступных форматов объекта в
стандартный вывод, воспользуйтесь <span class="quote">«<span class="quote">help</span>»</span> в качестве <em class="replaceable"><code>format</code></em>. См. параграф <a class="xref" href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#running-objfmt" title="1.6. Поддерживаемые форматы объектов">Раздел&nbsp;1.6</a>,
где приведен список поддержываемых форматов
объекта.</p>
</div>
<div class="section" title="1.3.1.3. -g debug или --dformat=debug: Выбор формата отладки">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="yasm-option-dformat" id="yasm-option-dformat"></a>1.3.1.3.
<code class="option">-g <em class="replaceable"><code>debug</code></em></code> или
<code class="option">--dformat=<em class="replaceable"><code>debug</code></em></code>:
Выбор формата отладки</h4>
</div>
</div>
</div>
<p>Выбирает формат отладки для отладочной
информации. Отладочная информация может
использоваться отладчиком, чтобы связать
исполняемый код назад к исходному файлу или
получить структуру данных и информацию типа.
Доступные форматы отладки изменяются между
различными форматами объекта; <span class="command"><strong>yasm</strong></span> ошибётся если неправильная
комбинация будет выбрана. Формат отладки по
умолчанию выбирается форматом объекта. Для
вывода списка доступных форматов отладки в
стандартный вывод, воспользуйтесь <span class="quote">«<span class="quote">help</span>»</span> в качестве <em class="replaceable"><code>debug</code></em>. См. параграф <a class="xref" href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#running-dbgfmt" title="1.7. Поддерживаемые форматы отладки">Раздел&nbsp;1.7</a>,
где приведен список поддержываемых форматов
отладки.</p>
</div>
<div class="section" title="1.3.1.4. -h или --help: Вывод резюме параметров">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="yasm-option-help" id="yasm-option-help"></a>1.3.1.4.
<code class="option">-h</code> или <code class="option">--help</code>: Вывод
резюме параметров</h4>
</div>
</div>
</div>
<p>Выводит резюме вызовных параметров. Остальные
параметры игнорируются, а выходной файл не
генерируется.</p>
</div>
<div class="section" title="1.3.1.5. -L list или --lformat=list: Выбор формата листинг-файла">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="yasm-option-lformat" id="yasm-option-lformat"></a>1.3.1.5.
<code class="option">-L <em class="replaceable"><code>list</code></em></code> или
<code class="option">--lformat=<em class="replaceable"><code>list</code></em></code>:
Выбор формата листинг-файла</h4>
</div>
</div>
</div>
<p>Выбирает формат/стиль выходного листинг-файла.
Листинг-файлы, как правило, смешивают
первоначальный исходный код с машинным кодом
сгенерированный ассемблером. Форматом листинга
по умолчанию является <span class="quote">«<span class="quote">nasm</span>»</span>, который имитирует формат
листинга NASM. Для вывода списка доступных
форматов листинг-файла в стандартный вывод,
воспользуйтесь <span class="quote">«<span class="quote">help</span>»</span> в качестве <em class="replaceable"><code>list</code></em>.</p>
</div>
<div class="section" title="1.3.1.6. -l listfile или --list=listfile: Определение названия листинг-файла">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="yasm-option-list" id="yasm-option-list"></a>1.3.1.6.
<code class="option">-l <em class="replaceable"><code>listfile</code></em></code> или
<code class="option">--list=<em class="replaceable"><code>listfile</code></em></code>:
Определение названия листинг-файла</h4>
</div>
</div>
</div>
<p>Определяет название выходного листинг-файла.
Если этот параметр не используется, листинг-файл
не генерируется.</p>
</div>
<div class="section" title="1.3.1.7. -m machine или --machine=machine: Выбор целевой машины данной архитектуры">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="yasm-option-machine" id="yasm-option-machine"></a>1.3.1.7.
<code class="option">-m <em class="replaceable"><code>machine</code></em></code> или
<code class="option">--machine=<em class="replaceable"><code>machine</code></em></code>:
Выбор целевой машины данной архитектуры</h4>
</div>
</div>
</div>
<p>Выбирает целевую машину данной архитектуры. По
существу подтип выбранной архитектуры, тип
машины выбирает между главными подтипами
архитектуры. Например, для архитектуры <span class="quote">«<span class="quote">x86</span>»</span> доступны две машины:
<span class="quote">«<span class="quote">x86</span>»</span>, которая
используется набором инструкции IA-32 и
производным 32-битовым набором инструкции, и
<span class="quote">«<span class="quote">amd64</span>»</span>, которая
используется 64-битовым набором инструкции. Это
различение требуется для генерации правильного
объектного файла для распределенных форматов
объекта таких как COFF и ELF. Для вывода списка
доступных машин данной архитектуры в
стандартный вывод, воспользуйтесь <span class="quote">«<span class="quote">help</span>»</span> в качестве <em class="replaceable"><code>machine</code></em> и укажите данную
архитектуру с помощю <code class="option">-a <em class="replaceable"><code>arch</code></em></code>. См. часть <a class="xref" href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#architectures" title="Часть VII. Architectures">Часть&nbsp;VII</a> для
более подробной %информации.</p>
</div>
<div class="section" title="1.3.1.8. -o filename или --objfile=filename: Определение названия объектного файла">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="yasm-option-objfile" id="yasm-option-objfile"></a>1.3.1.8.
<code class="option">-o <em class="replaceable"><code>filename</code></em></code> или
<code class="option">--objfile=<em class="replaceable"><code>filename</code></em></code>:
Определение названия объектного файла</h4>
</div>
</div>
</div>
<p>Определяет название выходного файла, отвергая
любые названия по умолчанию генерируемые Yasm.</p>
</div>
<div class="section" title="1.3.1.9. -p parser или --parser=parser: Выбор синтаксического анализатора">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="yasm-option-parser" id="yasm-option-parser"></a>1.3.1.9.
<code class="option">-p <em class="replaceable"><code>parser</code></em></code> или
<code class="option">--parser=<em class="replaceable"><code>parser</code></em></code>:
Выбор синтаксического анализатора</h4>
</div>
</div>
</div>
<p>Выбирает синтаксический анализатор (синтаксис
ассемблера). Синтаксическим анализатором по
умолчанию является <span class="quote">«<span class="quote">nasm</span>»</span>, который эмулирует синтаксис NASM
(Netwide Assembler). Другим доступным синтаксическим
анализатором является <span class="quote">«<span class="quote">gas</span>»</span>, который эмулирует синтаксис GNU AS.
Для вывода списка доступных синтаксических
анализаторов в стандартный вывод,
воспользуйтесь <span class="quote">«<span class="quote">help</span>»</span> в качестве <em class="replaceable"><code>parser</code></em>. См. параграф <a class="xref" href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#running-parser" title="1.5. Поддерживаемые синтаксические анализаторы (синтаксисы)">
Раздел&nbsp;1.5</a>, где приведен список поддержываемых
синтаксических анализаторов.</p>
</div>
<div class="section" title="1.3.1.10. -r preproc или --preproc=preproc: Выбор препроцессора">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="yasm-option-preproc" id="yasm-option-preproc"></a>1.3.1.10.
<code class="option">-r <em class="replaceable"><code>preproc</code></em></code> или
<code class="option">--preproc=<em class="replaceable"><code>preproc</code></em></code>:
Выбор препроцессора</h4>
</div>
</div>
</div>
<p>Выбирает препроцессор для обработки входного
файла прежде, чем передать его к синтаксическому
анализатору. Препроцессоры часто обеспечивают
функциональные возможности макросов, которые не
включены в основной синтаксический анализатор.
Препроцессором по умолчанию является <span class="quote">«<span class="quote">nasm</span>»</span>, который на самом
деле импортированная версия фактического
препроцессора NASM. Доступен также препроцессор
<span class="quote">«<span class="quote">raw</span>»</span>, который
просто пропускает шаг препроцессорной
обработки, передавая входной файл
непосредственно к синтаксическому анализатору.
Для вывода списка доступных препроцессоров в
стандартный вывод, воспользуйтесь <span class="quote">«<span class="quote">help</span>»</span> в качестве <em class="replaceable"><code>preproc</code></em>.</p>
</div>
<div class="section" title="1.3.1.11. --version: Получение версии Yasm">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="yasm-option-version" id="yasm-option-version"></a>1.3.1.11.
<code class="option">--version</code>: Получение версии Yasm</h4>
</div>
</div>
</div>
<p>Этот параметр заставляет Yasm вывести его номер
версии также как и резюме лицензии в стандартный
вывод. Все другие параметры игнорируются и
выходной файл не генерируется.</p>
</div>
</div>
<div class="section" title="1.3.2. Параметры предупреждения">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="yasm-warning-options" id="yasm-warning-options"></a>1.3.2.
Параметры предупреждения</h3>
</div>
</div>
</div>
<p>Параметры <code class="option">-W</code> имеют две
противоположные формы: <code class="option">-W?name?</code> и
<code class="option">-Wno?-name?</code>. Здесь приведены только
нестандартные формы.</p>
<p>Параметры предупреждения обрабатываются в
порядке, данном в командной строке, поэтому если
<code class="option">-w</code> сопровождается <code class="option">-Worphan-labels</code>, все предупреждения выключены
за <span class="emphasis"><em>исключением</em></span> строк
исходника, в которых находятся метки без
завершающего двоеточия.</p>
<div class="section" title="1.3.2.1. -w: Запрещение всех предупреждающих сообщений">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="yasm-option-w" id="yasm-option-w"></a>1.3.2.1. <code class="option">-w</code>: Запрещение всех предупреждающих
сообщений</h4>
</div>
</div>
</div>
<p>Этот параметр заставляет Yasm запрещать все
предупреждающие сообщения. Как обсуждено выше,
этот параметр может сопровождаться другими
параметрами, чтобы вновь отблокировать
определенные предупреждения.</p>
</div>
<div class="section" title="1.3.2.2. -Werror: Обработка предупреждений как ошибок">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="yasm-option-werror" id="yasm-option-werror"></a>1.3.2.2.
<code class="option">-Werror</code>: Обработка предупреждений
как ошибок</h4>
</div>
</div>
</div>
<p>Этот параметр заставляет Yasm обрабатывать все
предупреждения как ошибки. Обычно
предупреждения не препятствуют тому, чтобы
объектный файл был сгенерирован, и не приводят к
состоянию отказа выхода из <span class="command"><strong>yasm</strong></span>, тогда как ошибки это
делают. Этот параметр делает предупреждения
эквивалентными ошибкам с точки зрения этого
поведения.</p>
</div>
<div class="section" title="1.3.2.3. -Wno-unrecognized-char: Не предупреждать об неопознанных вводных символах">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="yasm-option-wno-unrecognized-char" id="yasm-option-wno-unrecognized-char"></a>1.3.2.3. <code class="option">-Wno-unrecognized-char</code>: Не предупреждать об
неопознанных вводных символах</h4>
</div>
</div>
</div>
<p>Заставляет Yasm не предупреждать об
неопознанных символах, найденных во вводе.
Обычно Yasm генерирует предупреждение для любого
символа не-ASCII, найденного во входном файле.</p>
</div>
<div class="section" title="1.3.2.4. -Worphan-labels: Предупреждать о метках без завершающего двоеточия">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="yasm-option-worphan-labels" id="yasm-option-worphan-labels"></a>1.3.2.4. <code class="option">-Worphan-labels</code>:
Предупреждать о метках без завершающего
двоеточия</h4>
</div>
</div>
</div>
<p>Когда используется NASM-совместимый
синтаксический анализатор, этот параметр
заставляет Yasm предупреждать о метках без
завершающего двоеточия, если они единственные в
строке. В то время как они являются правильными
метками в синтаксисе NASM, они могут быть
неумышленными, из-за опечаток или упорядочения
определений макросов.</p>
</div>
<div class="section" title="1.3.2.5. -X style: Изменение стиля сообщений об ошибках/предупреждениях">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="yasm-option-x" id="yasm-option-x"></a>1.3.2.5. <code class="option">-X <em class="replaceable"><code>style</code></em></code>: Изменение
стиля сообщений об ошибках/предупреждениях</h4>
</div>
</div>
</div>
<p>Выбирает определенный стиль вывода для
сообщений об ошибках и предупреждающих
сообщений. Стилем по умолчанию является <span class="quote">«<span class="quote">gnu</span>»</span>, который имитирует
вывод <span class="command"><strong>gcc</strong></span>. Доступен также
стиль <span class="quote">«<span class="quote">vc</span>»</span>, который
имитирует вывод компилятора Microsoft Visual Studio.</p>
<p>Этот параметр доступен, чтобы Yasm более
свободно интегрировал в среды IDE, такие как
<span class="command"><strong>Visual Studio</strong></span> или <span class="command"><strong>Emacs</strong></span>, позволяя IDE правильно
распознать сообщение об ошибке/предупреждающее
сообщение как таковое и связаться с
нарушительной строкой исходного текста.</p>
</div>
</div>
<div class="section" title="1.3.3. Параметры препроцессора">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="yasm-preprocessor-options" id="yasm-preprocessor-options"></a>1.3.3. Параметры препроцессора</h3>
</div>
</div>
</div>
<p>Теоретически эти препроцессорные параметры
будут действительны для любого препроцессора,
но в настоящее время единственным
препроцессором в Yasm является препроцессор
<span class="quote">«<span class="quote">nasm</span>»</span>.</p>
<div class="section" title="1.3.3.1. -D macro[=value]: Предопределение макроса">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="yasm-option-d" id="yasm-option-d"></a>1.3.3.1. <code class="option">-D <em class="replaceable"><code>macro[=value]</code></em></code>:
Предопределение макроса</h4>
</div>
</div>
</div>
<p>Предопределяет однострочный макрос. Значение
макроса указывать необязательно (если значение
не указано, макрос будет определен, но на пустое
значение).</p>
</div>
<div class="section" title="1.3.3.2. -e или --preproc-only: Только препроцессирование">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="yasm-option-preproc-only" id="yasm-option-preproc-only"></a>1.3.3.2. <code class="option">-e</code> или
<code class="option">--preproc-only</code>: Только
препроцессирование</h4>
</div>
</div>
</div>
<p>Останавливает процесс ассемблирования после
препроцессорного уровня; вывод препроцессора
отправляется в определенный названием вывод или
в стандартный вывод (если вывод не определен).
Объектный файл не производится.</p>
</div>
<div class="section" title="1.3.3.3. -I путь: Добавление пути включаемых файлов">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="yasm-option-i" id="yasm-option-i"></a>1.3.3.3. <code class="option">-I <em class="replaceable"><code>путь</code></em></code>:
Добавление пути включаемых файлов</h4>
</div>
</div>
</div>
<p>Добавляет <em class="replaceable"><code>путь</code></em> каталога
к пути поиска файлов для включения. По умолчанию
путь для поиска файлов включает только каталог,
в котором находится исходный файл.</p>
</div>
<div class="section" title="1.3.3.4. -P filename: Предварительное включение файла">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="yasm-option-p" id="yasm-option-p"></a>1.3.3.4. <code class="option">-P <em class="replaceable"><code>filename</code></em></code>:
Предварительное включение файла</h4>
</div>
</div>
</div>
<p>Предварительно включает файл <em class="replaceable"><code>filename</code></em>, так, как если бы <em class="replaceable"><code>filename</code></em> был включен во вводе.
Может быть полезным для предварительного
добавления многострочных макросов, которых
<code class="option">-D</code> не поддерживает.</p>
</div>
<div class="section" title="1.3.3.5. -U macro: Отмена определения макроса">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="yasm-option-u" id="yasm-option-u"></a>1.3.3.5. <code class="option">-U <em class="replaceable"><code>macro</code></em></code>: Отмена
определения макроса</h4>
</div>
</div>
</div>
<p>Отменяет определённый однострочный макрос
(либо встроенный макрос либо макрос ранее
определен в командной строке с помощю ключа
<code class="option">-D</code> (см. параграф <a class="xref" href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#yasm-option-d" title="1.3.3.1. -D macro[=value]: Предопределение макроса">Раздел&nbsp;1.3.3.1</a>)).</p>
</div>
</div>
</div>
<div class="section" title="1.4. Поддерживаемые архитектуры">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="running-arch" id="running-arch"></a>1.4.
Поддерживаемые архитектуры</h2>
</div>
</div>
</div>
<p>Yasm поддерживает следующие архитектурные
наборы инструкций (АНИ). См. Часть 5 для более
подробной информации.</p>
<div class="variablelist">
<dl>
<dt><span class="term">lc3b</span></dt>
<dd>Архитектура <span class="quote">«<span class="quote">lc3b</span>»</span>
поддерживает АНИ LC-3b, который применяется в
курсе ECE411 (формально ECE312) на Университете Illinois,
Urbane-Champaign, как и на остальных университетских
курсах. Для более подробной информации и
примеров исходного кода смотрите <a class="ulink" href="http://courses.ece.uiuc.edu/ece411/" target="_top">http://courses.ece.uiuc.edu/ece411/</a>. Архитектура <span class="quote">«<span class="quote">lc3b</span>»</span> состоит только из
одной машины: <span class="quote">«<span class="quote">lc3b</span>»</span>.</dd>
<dt><span class="term">x86</span></dt>
<dd>Архитектура <span class="quote">«<span class="quote">x86</span>»</span>
поддерживает набор инструкций IA-32 и производные
(включая 16-битовые и неИнтеловские инструкции) и
набор инструкций AMD64. Она состоит из двух машин:
<span class="quote">«<span class="quote">x86</span>»</span> (для IA-32 и
производных) и <span class="quote">«<span class="quote">amd64</span>»</span> (для AMD64 и производных). Машиной
для архитектуры <span class="quote">«<span class="quote">x86</span>»</span> по умолчанию является машина
<span class="quote">«<span class="quote">x86</span>»</span>.</dd>
</dl>
</div>
</div>
<div class="section" title="1.5. Поддерживаемые синтаксические анализаторы (синтаксисы)">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="running-parser" id="running-parser"></a>1.5. Поддерживаемые синтаксические
анализаторы (синтаксисы)</h2>
</div>
</div>
</div>
<p>Yasm анализирует следующие синтаксисы
ассемблера:</p>
<div class="variablelist">
<dl>
<dt><span class="term">nasm</span></dt>
<dd>Синтаксис NASM является наиболее
полнофункциональным синтаксисом
поддерживаемым в Yasm. Yasm почти в 100% совместим с NASM
для 16-битового и 32-битового x86 кода.
Дополнительно Yasm поддерживает 64-битовый AMD64 код
с Yasm расширениями к синтаксису NASM. См. Часть <a class="xref" href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm" title="Часть III. NASM Syntax">Часть&nbsp;III</a> для
более подробной информации.</dd>
<dt><span class="term">gas</span></dt>
<dd>GNU Ассемблер (GAS) является фактическим
межплатформенным ассемблером для современных
Unix систем, и используется как <span class="emphasis"><em>backend</em></span> для GCC компилятора. Поддержка
синтаксиса GAS в Yasm умеренно хороша, хотя не
вполне развита: поддерживаются не все директивы
и только 32-битовая x86 и AMD64 архитектуры. Также не
поддерживается препроцессор GAS. Несмотря на эти
ограничения, поддержка синтаксиса GAS в Yasm
достаточно хороша, чтобы обработать по существу
весь вывод x86 и AMD64 GCC компилятора. См. Часть <a class="xref" href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#gas" title="Часть IV. GAS Syntax">Часть&nbsp;IV</a> для
более подробной информации.</dd>
</dl>
</div>
</div>
<div class="section" title="1.6. Поддерживаемые форматы объектов">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="running-objfmt" id="running-objfmt"></a>1.6. Поддерживаемые форматы
объектов</h2>
</div>
</div>
</div>
<p>Yasm поддерживает следующие форматы объектов.
Больше подробностей можно найти в Части <a class="xref" href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#objfmts" title="Часть V. Object Formats">Часть&nbsp;V</a>.</p>
<div class="variablelist">
<dl>
<dt><span class="term">bin</span></dt>
<dd>Формат <span class="quote">«<span class="quote">bin</span>»</span>
объекта производит плоско-форматной,
неперемещаемой бинарный файл. Он является
подходящим для создания DOS'овских исполняемых .COM
программ или таких вещей как блоки начальной
загрузки. Поддерживаются только три секции и они
записываются в предопределенном порядке в
выходной файл.</dd>
<dt><span class="term">coff</span></dt>
<dd>Формат COFF объекта это старый перемещаемый
объектный формат применяемый на старых UNIX и
совместимых системах, а также (позже) на
разработочной системе DJGPP для DOS.</dd>
<dt><span class="term">dbg</span></dt>
<dd>Формат <span class="quote">«<span class="quote">dbg</span>»</span>
объекта не является <span class="quote">«<span class="quote">реальным</span>»</span> форматом объекта;
выходной файл, который он создает просто,
описывает последовательность сделанных к нему
вызовов с помощю Yasm, окончательный объект и
таблицу идентификаторов в удобочитаемом
текстовом формате (который в нормальном формате
объекта обрабатывается в специфическое двойное
представление того объектного формата). Этот
формат объекта не предназначен для реального
использования, а скорее для того, чтобы отладить
внутреннюю организацию Yasm.</dd>
<dt><span class="term">elf</span></dt>
<dd>Формат ELF объекта существует в двух типах:
<span class="quote">«<span class="quote">elf32</span>»</span> (для 32-битовых
целей) и <span class="quote">«<span class="quote">elf64</span>»</span> (для
64-битовых целей). ELF - стандартный формат объекта
в общем используемый на современных Unix и
совместимых системах (например Linux, FreeBSD). ELF имеет
сложную поддержку переместимых и общедоступных
объектов.</dd>
<dt><span class="term">macho</span></dt>
<dd>Формат Mach-O объекта существует в двух типах:
<span class="quote">«<span class="quote">macho32</span>»</span> (для
32-битовых целей) и <span class="quote">«<span class="quote">macho64</span>»</span> (для 64-битовых целей). Mach-O
используется как формат объекта на MacOS X.
Поскольку Yasm в настоящее время поддерживает
только наборы команд x86 и AMD64, он может только
произвести Mach-O объекты для основанных на Интеле
Mac'ов.</dd>
<dt><span class="term">rdf</span></dt>
<dd>Формат RDOFF2 объекта это простой
мультисекционный формат, первоначально
разработанный для NASM. Он поддерживает
сегментные ссылки, но не ссылки WRT. Прежде всего
был разработан для простоты и имеет
минималистические заголовки для простоты
загрузки и компоновки. Полный набор
инструментов (компоновщик, библиотекарь, и
загрузчик) распространяется с NASM.</dd>
<dt><span class="term">win32</span></dt>
<dd>Формат Win32 объекта производит объектные файлы
совместимые с компиляторами Microsoft (таких, как Visual
C\++), предназначенные на 32-битовую x86 платформу
Windows. Сам формат объекта это расширенная версия
COFF.</dd>
<dt><span class="term">win64</span></dt>
<dd>Формат Win64 объекта производит объектные файлы
совместимые с компиляторами Microsoft,
предназначенные на 64-битовую <span class="quote">«<span class="quote">x64</span>»</span> платформу Windows. Этот формат очень
похож на формат Win32 объекта, но производит
64-битовые объекты.</dd>
<dt><span class="term">xdf</span></dt>
<dd>Формат XDF объекта - по существу упрощенная
версия COFF. Это также мультисекционный
распределенный формат, который поддерживает
64-битовые физические и виртуальные адресации.</dd>
</dl>
</div>
</div>
<div class="section" title="1.7. Поддерживаемые форматы отладки">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="running-dbgfmt" id="running-dbgfmt"></a>1.7. Поддерживаемые форматы отладки</h2>
</div>
</div>
</div>
<p>Yasm поддерживает генерирование информации об
отладке исходного уровня в следующих форматах.
Больше подробностей можно найти в Части <a class="xref" href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#dbgfmts" title="Часть VI. Debugging Formats">Часть&nbsp;VI</a>.</p>
<div class="variablelist">
<dl>
<dt><span class="term">cv8</span></dt>
<dd>Формат CV8 отладки применяется в Microsoft Visual Studio
2005 (версия 8.0) и полностью недокументирован, хотя
он имеет сильное сходство с ранними форматами
CodeView. Поддержка формата CV8 отладки в настоящее
время ограничивается генерацией информации
номера строки ассемблерного уровня (чтобы
позволить на некоторый уровень отладки
исходного уровня). Информация об отладке
сохраняется в секциях <code class="literal">.debug$S</code> и
<code class="literal">.debug$T</code> объектного файла Win64.</dd>
<dt><span class="term">dwarf2</span></dt>
<dd>Формат DWARF2 отладки - сложный, хорошо
документированный стандарт для информации об
отладке. Он был создан, чтобы преодолеть
недостатки в STABS, учитывая намного более
детальные и компактные описания структур
данных, движения переменной данных, и сложных
языковых структур таких как в C+<code class="literal">.
Информация об отладке сохраняется в секциях
(точно так же, как нормальные программные секции)
в объектном файле. Yasm поддерживает полную
передачу информации об отладке DWARF2 (например, от
C\</code>+ компилятора), и может также генерировать
информацию номера строки ассемблерного
уровня.</dd>
<dt><span class="term">null</span></dt>
<dd>Формат <span class="quote">«<span class="quote">null</span>»</span>
отладки - указатель места заполнения; он не
добавляет информации об отладке к выходному
файлу.</dd>
<dt><span class="term">stabs</span></dt>
<dd>Формат STABS отладки - плохо документированный,
полустандартный формат для информации об
отладке в объектных файлах COFF и ELF. Информация об
отладке сохраняется как часть таблицы
идентификаторов объектного файла и поэтому
ограничена в сложности и области видимости.
Несмотря на это, STABS - общий формат отладки на
старых Unix и совместимых системах, так же как на
DJGPP.</dd>
</dl>
</div>
</div>
</div>
</div>
<div class="part" title="Часть III. NASM Syntax">
<div class="titlepage">
<div>
<div>
<h1 class="title"><a name="nasm" id="nasm"></a>Часть&nbsp;III.&nbsp;NASM Syntax</h1>
</div>
</div>
</div>
<div class="partintro" title="NASM Syntax">
<p>The chapters in this part of the book document the NASM-compatible syntax accepted by
the Yasm <span class="quote">«<span class="quote">nasm</span>»</span> parser and
preprocessor.</p>
<div class="toc">
<p><b>Содержание</b></p>
<dl>
<dt><span class="chapter"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-language">2. Язык NASM</a></span></dt>
<dd>
<dl>
<dt><span class="section"><a href="./Yasm User Manual_files/Yasm User Manual.html">2.1. Обзор ассемблерной
строки NASM</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-pseudop">2.2.
Псевдо-инструкции</a></span></dt>
<dd>
<dl>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-pseudop-db">2.2.1. <code class="literal">DB</code> и ее друзья: Объявление
инициализированных данных</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-pseudop-resb">2.2.2. <code class="literal">RESB</code> и ее друзья: Объявление
неинициализированных данных</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-pseudop-incbin">2.2.3. <code class="literal">INCBIN</code>: Включение внешних бинарных
файлов</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-pseudop-equ">2.2.4. <code class="literal">EQU</code>: Определение констант</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-pseudop-times">2.2.5. <code class="literal">TIMES</code>: Повторение инструкций или
данных</a></span></dt>
</dl>
</dd>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-effaddr">2.3. Effective
Addresses</a></span></dt>
<dd>
<dl>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-effaddr-disp64">2.3.1. 64-bit
Displacements</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-effaddr-riprel">2.3.2. <code class="literal">RIP</code> Relative Addressing</a></span></dt>
</dl>
</dd>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-immediate">2.4. Immediate
Operands</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-const">2.5. Constants</a></span></dt>
<dd>
<dl>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-const-num">2.5.1. Numeric
Constants</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-const-char">2.5.2. Character
Constants</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-const-string">2.5.3. String
Constants</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-const-float">2.5.4. Floating-Point
Constants</a></span></dt>
</dl>
</dd>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-expr">2.6. Expressions</a></span></dt>
<dd>
<dl>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-expr-or">2.6.1. <code class="literal">|</code>:
Bitwise OR Operator</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-expr-xor">2.6.2. <code class="literal">^</code>:
Bitwise XOR Operator</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-expr-and">2.6.3. <code class="literal">&amp;</code>: Bitwise AND Operator</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-expr-shift">2.6.4. <code class="literal">&lt;&lt;</code> and <code class="literal">&gt;&gt;</code>: Bit Shift
Operators</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-expr-plusminus">2.6.5. <code class="literal">+</code> and <code class="literal">-</code>: Addition and Subtraction
Operators</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-expr-mul">2.6.6. <code class="literal">*</code>,
<code class="literal">/</code>, <code class="literal">//</code>, <code class="literal">%</code> and <code class="literal">%%</code>: Multiplication and
Division</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-expr-unary">2.6.7. Unary Operators: <code class="literal">+</code>, <code class="literal">-</code>, <code class="literal">~</code> and
<code class="literal">SEG</code></a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-segwrt">2.6.8. <code class="literal">SEG</code>
and <code class="literal">WRT</code></a></span></dt>
</dl>
</dd>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-strict">2.7. <code class="literal">STRICT</code>: Inhibiting Optimization</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-crit">2.8. Critical Expressions</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-local-label">2.9. Local Labels</a></span></dt>
</dl>
</dd>
<dt><span class="chapter"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-preprocessor">3. The NASM
Preprocessor</a></span></dt>
<dd>
<dl>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-single-line-macros">3.1. Single-Line
Macros</a></span></dt>
<dd>
<dl>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-macro-define">3.1.1. The Normal Way:
<code class="literal">%define</code></a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-macro-xdefine">3.1.2. Enhancing %define:
<code class="literal">%xdefine</code></a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-macro-single-concat">3.1.3. Concatenating Single
Line Macro Tokens: <code class="literal">%+</code></a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-macro-undef">3.1.4. Undefining macros:
<code class="literal">%undef</code></a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-macro-assign">3.1.5. Preprocessor Variables:
<code class="literal">%assign</code></a></span></dt>
</dl>
</dd>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-strlen">3.2. String Handling in
Macros</a></span></dt>
<dd>
<dl>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-macro-strlen">3.2.1. String Length: <code class="literal">%strlen</code></a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-macro-substr">3.2.2. Sub-strings: <code class="literal">%substr</code></a></span></dt>
</dl>
</dd>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-multi-line-macros">3.3. Multi-Line
Macros</a></span></dt>
<dd>
<dl>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-macro-overloading">3.3.1. Overloading Multi-Line
Macros</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-macro-local">3.3.2. Macro-Local
Labels</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-macro-greedy">3.3.3. Greedy Macro
Parameters</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-macro-default">3.3.4. Default Macro
Parameters</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-macro-percent0">3.3.5. <code class="literal">%0</code>: Macro Parameter Counter</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-macro-rotate">3.3.6. <code class="literal">%rotate</code>: Rotating Macro Parameters</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-macro-concat">3.3.7. Concatenating Macro
Parameters</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-macro-cc">3.3.8. Condition Codes as Macro
Parameters</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-macro-nolist">3.3.9. Disabling Listing
Expansion</a></span></dt>
</dl>
</dd>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-macro-conditional">3.4. Conditional
Assembly</a></span></dt>
<dd>
<dl>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-macro-ifdef">3.4.1. <code class="literal">%ifdef</code>: Testing Single-Line Macro Existence</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-macro-ifmacro">3.4.2. <code class="literal">%ifmacro</code>: Testing Multi-Line Macro Existence</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-macro-ifctx">3.4.3. <code class="literal">%ifctx</code>: Testing the Context Stack</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-macro-if">3.4.4. <code class="literal">%if</code>: Testing Arbitrary Numeric Expressions</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-macro-ifidn">3.4.5. <code class="literal">%ifidn</code> and <code class="literal">%ifidni</code>: Testing Exact Text
Identity</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-macro-iftyp">3.4.6. <code class="literal">%ifid</code>, <code class="literal">%ifnum</code>, <code class="literal">%ifstr</code>: Testing Token Types</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-macro-error">3.4.7. <code class="literal">%error</code>: Reporting User-Defined Errors</a></span></dt>
</dl>
</dd>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-macro-rep">3.5. Preprocessor
Loops</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-include">3.6. Including Other
Files</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-macro-context-stack">3.7. The Context
Stack</a></span></dt>
<dd>
<dl>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-macro-pushpop">3.7.1. <code class="literal">%push</code> and <code class="literal">%pop</code>: Creating and Removing
Contexts</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-macro-context-local">3.7.2. Context-Local
Labels</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-macro-context-define">3.7.3. Context-Local
Single-Line Macros</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-macro-repl">3.7.4. <code class="literal">%repl</code>: Renaming a Context</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-macro-block-if">3.7.5. Example Use of the
Context Stack: Block IFs</a></span></dt>
</dl>
</dd>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-stdmac">3.8. Standard Macros</a></span></dt>
<dd>
<dl>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-stdmac-version">3.8.1. <code class="literal">__YASM_MAJOR__</code>, etc: Yasm Version</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-stdmac-fileline">3.8.2. <code class="literal">__FILE__</code> and <code class="literal">__LINE__</code>: File Name and Line
Number</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-stdmac-output-format">3.8.3. <code class="literal">__YASM_OBJFMT__</code> and <code class="literal">__OUTPUT_FORMAT__</code>:
Output Object Format Keyword</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-stdmac-struc">3.8.4. <code class="literal">STRUC</code> and <code class="literal">ENDSTRUC</code>: Declaring Structure
Data Types</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-stdmac-istruc">3.8.5. <code class="literal">ISTRUC</code>, <code class="literal">AT</code> and <code class="literal">IEND</code>: Declaring Instances of Structures</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-stdmac-align">3.8.6. <code class="literal">ALIGN</code> and <code class="literal">ALIGNB</code>: Data
Alignment</a></span></dt>
</dl>
</dd>
</dl>
</dd>
<dt><span class="chapter"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-directives">4. NASM Assembler
Directives</a></span></dt>
<dd>
<dl>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-directive-bits-top">4.1. Specifying Target
Processor Mode</a></span></dt>
<dd>
<dl>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-directive-bits">4.1.1. <code class="literal">BITS</code></a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-directive-use16use32use64">4.1.2. <code class="literal">USE16</code>, <code class="literal">USE32</code>, and <code class="literal">USE64</code></a></span></dt>
</dl>
</dd>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-directive-default">4.2. <code class="literal">DEFAULT</code>: Change the assembler defaults</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-directive-section-top">4.3. Changing and
Defining Sections</a></span></dt>
<dd>
<dl>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-directive-section">4.3.1. <code class="literal">SECTION</code> and <code class="literal">SEGMENT</code></a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-directive-section-standard-name">4.3.2.
Standardized Section Names</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-directive-section-macro">4.3.3. The <code class="literal">__SECT__</code> Macro</a></span></dt>
</dl>
</dd>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-directive-absolute">4.4. <code class="literal">ABSOLUTE</code>: Defining Absolute Labels</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-directive-extern">4.5. <code class="literal">EXTERN</code>: Importing Symbols</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-directive-global">4.6. <code class="literal">GLOBAL</code>: Exporting Symbols</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-directive-common">4.7. <code class="literal">COMMON</code>: Defining Common Data Areas</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-directive-cpu">4.8. <code class="literal">CPU</code>: Defining CPU Dependencies</a></span></dt>
</dl>
</dd>
</dl>
</div>
</div>
<div class="chapter" title="Глава 2. Язык NASM">
<div class="titlepage">
<div>
<div>
<h2 class="title"><a name="nasm-language" id="nasm-language"></a>Глава 2. Язык
NASM</h2>
</div>
</div>
</div>
<div class="toc">
<p><b>Содержание</b></p>
<dl>
<dt><span class="section"><a href="./Yasm User Manual_files/Yasm User Manual.html">2.1. Обзор ассемблерной
строки NASM</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-pseudop">2.2.
Псевдо-инструкции</a></span></dt>
<dd>
<dl>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-pseudop-db">2.2.1. <code class="literal">DB</code> и ее друзья: Объявление
инициализированных данных</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-pseudop-resb">2.2.2. <code class="literal">RESB</code> и ее друзья: Объявление
неинициализированных данных</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-pseudop-incbin">2.2.3. <code class="literal">INCBIN</code>: Включение внешних бинарных
файлов</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-pseudop-equ">2.2.4. <code class="literal">EQU</code>: Определение констант</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-pseudop-times">2.2.5. <code class="literal">TIMES</code>: Повторение инструкций или
данных</a></span></dt>
</dl>
</dd>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-effaddr">2.3. Effective
Addresses</a></span></dt>
<dd>
<dl>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-effaddr-disp64">2.3.1. 64-bit
Displacements</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-effaddr-riprel">2.3.2. <code class="literal">RIP</code> Relative Addressing</a></span></dt>
</dl>
</dd>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-immediate">2.4. Immediate
Operands</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-const">2.5. Constants</a></span></dt>
<dd>
<dl>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-const-num">2.5.1. Numeric
Constants</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-const-char">2.5.2. Character
Constants</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-const-string">2.5.3. String
Constants</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-const-float">2.5.4. Floating-Point
Constants</a></span></dt>
</dl>
</dd>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-expr">2.6. Expressions</a></span></dt>
<dd>
<dl>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-expr-or">2.6.1. <code class="literal">|</code>:
Bitwise OR Operator</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-expr-xor">2.6.2. <code class="literal">^</code>:
Bitwise XOR Operator</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-expr-and">2.6.3. <code class="literal">&amp;</code>: Bitwise AND Operator</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-expr-shift">2.6.4. <code class="literal">&lt;&lt;</code> and <code class="literal">&gt;&gt;</code>: Bit Shift
Operators</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-expr-plusminus">2.6.5. <code class="literal">+</code> and <code class="literal">-</code>: Addition and Subtraction
Operators</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-expr-mul">2.6.6. <code class="literal">*</code>,
<code class="literal">/</code>, <code class="literal">//</code>, <code class="literal">%</code> and <code class="literal">%%</code>: Multiplication and
Division</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-expr-unary">2.6.7. Unary Operators: <code class="literal">+</code>, <code class="literal">-</code>, <code class="literal">~</code> and
<code class="literal">SEG</code></a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-segwrt">2.6.8. <code class="literal">SEG</code>
and <code class="literal">WRT</code></a></span></dt>
</dl>
</dd>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-strict">2.7. <code class="literal">STRICT</code>: Inhibiting Optimization</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-crit">2.8. Critical Expressions</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-local-label">2.9. Local Labels</a></span></dt>
</dl>
</div>
<div class="section" title="2.1. Обзор ассемблерной строки NASM">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="nasm-syntax" id="nasm-syntax"></a>2.1.
Обзор ассемблерной строки NASM</h2>
</div>
</div>
</div>
<p>Как большинство ассемблеров, каждая исходная
строка NASM содержит (если это не макрос,
препроцессорная или ассемблерная директива: см.
<a class="xref" href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-directives" title="Глава 4. NASM Assembler Directives">Глава&nbsp;4</a>), некоторую
комбинацию четырех полей</p>
<pre class="programlisting">метка:  инструкция операнды         ; комментарий
</pre>
<p>Как обычно, большинство этих полей
необязательны; допускается присутствие или
отсутствие любой комбинации метки, инструкции и
комментарий. Конечно, необходимость поля
операндов определяется присутствием и природой
поля инструкций.</p>
<p>В NASM используется наклонная черта влево (\) как
символ продолжения строки; если строка
заканчивается наклонной чертой влево, то
следующая будет рассматриватся как часть строки
законченной наклонной чертой влево.</p>
<p><a class="indexterm" name="idp57446960" id="idp57446960"></a> NASM не
накладывает ограничений на количество пробелов
в строке: метки могут иметь пробелы вначале, а
инструкции могут не иметь никаких пробелов и т.п.
Двоеточие после метки также необязательно (Это
означает, что если вы хотите поместить в строку
инструкцию <code class="literal">lodsb</code>, а введете <code class="literal">lodab</code>, строка останется корректной, но
вместо инструкции будет объявлена метка.
Выявить данные опечатки отчасти можно, введя в
строке запуска NASM ключ <code class="option">-w+<a class="indexterm" name="idp57453616" id="idp57453616"></a>orphan-labels</code> — в этом случае
при обнаружении метки без заключительного
двоеточия будет выдаваться предупреждение).</p>
<p><a class="indexterm" name="idp57454640" id="idp57454640"></a> <a class="indexterm" name="idp57456048" id="idp57456048"></a> Допустимыми символами в
метках являются буквы, цифры, знаки <code class="literal">_</code>, <code class="literal">$</code>, <code class="literal">#</code>,
<code class="literal">@</code>, <code class="literal">~</code>, <code class="literal">.</code> и <code class="literal">?</code>. Допустимые символы
в начале метки (первый символ метки) — только
буквы, точка (<code class="literal">.</code>) (со специальным
значением: см. <a class="xref" href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-local-label" title="2.9. Local Labels">Раздел&nbsp;2.9</a>), знак подчеркивания
(<code class="literal">_</code>) и вопросительный знак (<code class="literal">?</code>). В идентификаторе может также
присутствовать префикс <code class="literal">$</code> для
указания того, что это действительно
идентификатор, а не зарезервированное слово;
таким образом, если некоторый компонуемый вами
модуль описывает символ <code class="literal">eax</code>, вы
можете в коде NASM (для указания того, что это не
регистр) сослаться на него так: <code class="literal">$eax</code>.</p>
<p><a class="indexterm" name="idp57464496" id="idp57464496"></a> Поле
инструкций может содержать любые процессорные
инструкции: поддерживаются инструкции Pentium и P6,
FPU, MMX, а также некоторые недокументированные
инструкции. Перед инструкциями могут
присутствовать префиксы <code class="literal">LOCK</code>,
<code class="literal">REP</code>, <code class="literal">REPE/REPZ</code> или
<code class="literal">REPNE/REPNZ</code>, используемые по их
обычному предназначению. Поддерживаются
префиксы размера адреса и <a class="indexterm" name="idp57467440" id="idp57467440"></a>операнда <code class="literal">A16</code>, <code class="literal">A32</code>, <code class="literal">O16</code> и <code class="literal">O32</code>. В качестве префикса инструкции вы
можете использовать также обозначение
сегментного регистра: код <code class="literal">es mov
[bx],ax</code> эквивалентен коду <code class="literal">mov
[es:bx],ax</code>. Мы рекомендуем использовать
последний синтаксис, т.к. он согласуется с
другими синтаксическими особенностями языка,
однако для инструкций, не имеющих операндов
(например, <code class="literal">LODSB</code>) и требующих в
некоторых случаях <a class="indexterm" name="idp57471920" id="idp57471920"></a>замены сегмента, на данный момент не
существует никакого синтаксического способа
обойти конструкцию <code class="literal">es lodsb</code>.</p>
<p>Инструкции не требуется использовать
префиксы: префиксы, такие как <code class="literal">CS</code>,
<code class="literal">A32</code>, <code class="literal">LOCK</code> или <code class="literal">REPE</code> могут присутствовать в строке
самостоятельно и при этом NASM будет генерировать
соответствующие префикс-байты.</p>
<p>В дополнение к инструкциям процессора, NASM
поддерживает также несколько псевдо-инструкций,
описанных в <a class="xref" href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-pseudop" title="2.2. Псевдо-инструкции">Раздел&nbsp;2.2</a>.</p>
<p><a class="indexterm" name="idp57476656" id="idp57476656"></a>Операнды
инструкций могут принимать несколько форм: они
могут быть регистрами (например, <code class="literal">AX</code>, <code class="literal">BP</code>, <code class="literal">EBX</code>,
<code class="literal">CR0</code>: NASM не использует синтаксис в
стиле <span class="command"><strong>gas</strong></span>, где имена
регистров должны предваряться знаком <code class="literal">%</code>), <a class="indexterm" name="idp58991920" id="idp58991920"></a>эффективными адресами (см. <a class="xref" href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-effaddr" title="2.3. Effective Addresses">Раздел&nbsp;2.3</a>),
константами (<a class="xref" href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-const" title="2.5. Constants">Раздел&nbsp;2.5</a>) или выражениями (<a class="xref" href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-expr" title="2.6. Expressions">Раздел&nbsp;2.6</a>).</p>
<p>Для инструкций <a class="indexterm" name="idp58994096" id="idp58994096"></a>сопроцессора NASM допускает различные
формы синтаксиса: вы можете использовать
двух-операндную форму, поддерживаемую MASMом, а
также чисто NASMовскую одно-операндную форму
Например, вы можете написать:</p>
<pre class="programlisting">        fadd    st1             ; это значит st0 := st0 + st1
        fadd    st0, st1        ; это то же самое

        fadd    st1, st0        ; это значит st1 := st1 + st0
        fadd    to st1          ; это то же самое
</pre>
<p>Почти любая инструкция сопроцессора,
ссылающаяся на содержимое памяти, должна
использовать один из префиксов <a class="indexterm" name="idp58995632" id="idp58995632"></a><code class="literal">DWORD</code>, <a class="indexterm" name="idp58996912" id="idp58996912"></a><code class="literal">QWORD</code>,
<a class="indexterm" name="idp58998320" id="idp58998320"></a><code class="literal">TWORD</code>, <a class="indexterm" name="idp58999600" id="idp58999600"></a><code class="literal">DDQWORD</code>, или <a class="indexterm" name="idp59000880" id="idp59000880"></a><code class="literal">OWORD</code> для
указания на то, операнд какого размера должен
участвовать в команде.</p>
</div>
<div class="section" title="2.2. Псевдо-инструкции">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="nasm-pseudop" id="nasm-pseudop"></a>2.2.
Псевдо-инструкции</h2>
</div>
</div>
</div>
<p>Псевдо-инструкции не являются реальными
инструкциями х86 процессора, но все равно
помещаются в поле инструкций, т.к. это наиболее
подходящее место для них. Текущими <a class="indexterm" name="idp59003440" id="idp59003440"></a>псевдо-инструкциями
являются <code class="literal">DB</code>, <code class="literal">DW</code>,
<code class="literal">DD</code>, <code class="literal">DQ</code>, <code class="literal">DT</code>, <code class="literal">DDQ</code> и <code class="literal">DO</code>,
их копии для работы с неинициализированной
памятью <code class="literal">RESB</code>, <code class="literal">RESW</code>,
<code class="literal">RESD</code>, <code class="literal">RESQ</code>, <code class="literal">REST</code>, <code class="literal">RESDDQ</code> и <code class="literal">RESO</code>, команды <code class="literal">INCBIN</code>, <code class="literal">EQU</code> и префикс <code class="literal">TIMES</code>.</p>
<div class="section" title="2.2.1. DB и ее друзья: Объявление инициализированных данных">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="nasm-pseudop-db" id="nasm-pseudop-db"></a>2.2.1. <code class="literal">DB</code> и ее друзья: Объявление
инициализированных данных</h3>
</div>
</div>
</div>
<p><a class="indexterm" name="idp59014448" id="idp59014448"></a> <a class="indexterm" name="idp59015344" id="idp59015344"></a> <a class="indexterm" name="idp59016240" id="idp59016240"></a> <a class="indexterm" name="idp59017136" id="idp59017136"></a>
<a class="indexterm" name="idp59018032" id="idp59018032"></a><code class="literal">DB</code>, <a class="indexterm" name="idp59019312" id="idp59019312"></a><code class="literal">DW</code>, <a class="indexterm" name="idp59020592" id="idp59020592"></a><code class="literal">DD</code>, <a class="indexterm" name="idp59022000" id="idp59022000"></a><code class="literal">DQ</code>, <a class="indexterm" name="idp59023280" id="idp59023280"></a><code class="literal">DT</code>,
<a class="indexterm" name="idp59024560" id="idp59024560"></a><code class="literal">DDQ</code> и <a class="indexterm" name="idp59025840" id="idp59025840"></a><code class="literal">DO</code> используются для
объявления инициализированных данных в
выходном файле. Они могут использоваться
достаточно многими способами:</p>
<pre class="programlisting">        db      0x55                ; просто байт 0x55
        db      0x55,0x56,0x57      ; последовательно 3 байта
        db      'a',0x55            ; символьная константа
        db      'hello',13,10,'$'   ; это строковая константа
        dw      0x1234              ; 0x34 0x12
        dw      'a'                 ; 0x41 0x00 (это просто число)
        dw      'ab'                ; 0x41 0x42 (символьная константа)
        dw      'abc'               ; 0x41 0x42 0x43 0x00 (строка)
        dd      0x12345678          ; 0x78 0x56 0x34 0x12
        dq      0x1122334455667788  ;0x88 0x77 0x66 0x55 0x44 0x33 0x22 0x11
        ddq      0x112233445566778899aabbccddeeff00
        ; 0x00 0xff 0xee 0xdd 0xcc 0xbb 0xaa 0x99
        ; 0x88 0x77 0x66 0x55 0x44 0x33 0x22 0x11
        do      0x112233445566778899aabbccddeeff00 ;то же самое как предыдущий
        dd      1.234567e20         ; константа с плавающей точкой
        dq      1.234567e20         ; двойной точности
        dt      1.234567e20         ; расширенной точности
</pre>
<p><a class="indexterm" name="idp59027888" id="idp59027888"></a><code class="literal">DT</code> не допускает в качестве операндов
<a class="indexterm" name="idp59029168" id="idp59029168"></a>числовые
константы, а <a class="indexterm" name="idp59029808" id="idp59029808"></a><code class="literal">DDQ</code> - констант с
плавающей запятой. Любой размер больше чем <a class="indexterm" name="idp59031216" id="idp59031216"></a><code class="literal">DD</code> не
допускает строк в качестве операндов.</p>
</div>
<div class="section" title="2.2.2. RESB и ее друзья: Объявление неинициализированных данных">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="nasm-pseudop-resb" id="nasm-pseudop-resb"></a>2.2.2.
<code class="literal">RESB</code> и ее друзья: Объявление
неинициализированных данных</h3>
</div>
</div>
</div>
<p><a class="indexterm" name="idp59034032" id="idp59034032"></a> <a class="indexterm" name="idp59034928" id="idp59034928"></a> <a class="indexterm" name="idp59036080" id="idp59036080"></a> <a class="indexterm" name="idp59036976" id="idp59036976"></a><code class="literal">RESB</code>, <a class="indexterm" name="idp59046576" id="idp59046576"></a><code class="literal">RESW</code>, <a class="indexterm" name="idp59047856" id="idp59047856"></a><code class="literal">RESD</code>,
<a class="indexterm" name="idp59049136" id="idp59049136"></a><code class="literal">RESQ</code>, <a class="indexterm" name="idp59050416" id="idp59050416"></a><code class="literal">REST</code>, <a class="indexterm" name="idp59051696" id="idp59051696"></a><code class="literal">RESDQ</code> и <a class="indexterm" name="idp59052976" id="idp59052976"></a><code class="literal">RESO</code>
разработаны для использования в BSS-секции
модуля: они объявляют <span class="emphasis"><em>неинициализированное</em></span>
пространство для хранения данных. Каждая
принимает один операнд, являющийся числом
резервируемых байт, слов, двойных слов и т.д. NASM
не поддерживает синтаксис резервирования
неинициализированного пространства,
реализованный в MASM/TASM, где можно делать <code class="literal">DW ?</code> или подобные вещи: это заменено
полностью. Операнд псевдо-инструкций класса
<code class="literal">RESB</code> является <span class="command"><strong>критическим выражением</strong></span>: см.
<a class="xref" href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-crit" title="2.8. Critical Expressions">Раздел&nbsp;2.8</a>.</p>
<p>Например:</p>
<pre class="programlisting">buffer:         resb    64      ; резервирование 64 байт
wordvar:        resw    1       ; резервирование слова
realarray       resq    10      ; массив из 10 чисел с плавающей точкой
</pre></div>
<div class="section" title="2.2.3. INCBIN: Включение внешних бинарных файлов">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="nasm-pseudop-incbin" id="nasm-pseudop-incbin"></a>2.2.3.
<code class="literal">INCBIN</code>: Включение внешних бинарных
файлов</h3>
</div>
</div>
</div>
<p><a class="indexterm" name="idp59059120" id="idp59059120"></a> <a class="indexterm" name="idp59060016" id="idp59060016"></a><code class="literal">INCBIN</code>
дословно включает бинарный файл в выходной файл.
Это может быть полезно (например) для включения
<a class="indexterm" name="idp59061296" id="idp59061296"></a>картинок и
<a class="indexterm" name="idp59061936" id="idp59061936"></a>музыки
непосредственно в исполняемый файл игрушки.
Однако, это рекомендуется делать только для
_небольших_ порции данных. Эта псевдо-инструкция
может быть вызвана тремя разными способами:</p>
<pre class="programlisting">        incbin "file.dat"        ; включение файла целиком
        incbin "file.dat",1024   ; пропуск первых 1024 байт
        incbin "file.dat",1024,512 ; пропуск первых 1024 и
                                 ; включение следующих 512 байт
</pre></div>
<div class="section" title="2.2.4. EQU: Определение констант">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="nasm-pseudop-equ" id="nasm-pseudop-equ"></a>2.2.4.
<code class="literal">EQU</code>: Определение констант</h3>
</div>
</div>
</div>
<p><a class="indexterm" name="idp59068848" id="idp59068848"></a><code class="literal">EQU</code> определяет символ для указанного
константного значения: если используется <code class="literal">EQU</code>, в этой строке кода должна
присутствовать метка. Смысл `EQU`— связать имя
метки со значением ее (только) операнда. Данное
определение абсолютно и не может быть позднее
изменено. Например,</p>
<pre class="programlisting">message db 'Привет, фуфел'
msglen  equ $-message
</pre>
<p>определяет <code class="literal">msglen</code> как константу 13.
<code class="literal">msglen</code> не может быть позднее
переопределено. Это не определение <a class="indexterm" name="idp59072688" id="idp59072688"></a>препроцессора: значение
<code class="literal">msglen</code> обрабатывается здесь <span class="emphasis"><em>только один раз</em></span> при помощи
значения <code class="literal">$</code> (что такое <code class="literal">$</code> – см. <a class="xref" href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-expr" title="2.6. Expressions">Раздел&nbsp;2.6</a>) в месте определения,
вместо того, чтобы обрабатыватся везде, где на
это ссылаются, при помощи значения <code class="literal">$</code> в месте ссылки. Имейте в виду, что
операнд <code class="literal">EQU</code> также является <a class="indexterm" name="idp59076784" id="idp59076784"></a>критическим
выражением (<a class="xref" href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-crit" title="2.8. Critical Expressions">Раздел&nbsp;2.8</a>).</p>
</div>
<div class="section" title="2.2.5. TIMES: Повторение инструкций или данных">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="nasm-pseudop-times" id="nasm-pseudop-times"></a>2.2.5.
<code class="literal">TIMES</code>: Повторение инструкций или
данных</h3>
</div>
</div>
</div>
<p><a class="indexterm" name="idp59079472" id="idp59079472"></a> Префикс <a class="indexterm" name="idp59080368" id="idp59080368"></a><code class="literal">TIMES</code>
заставляет инструкцию ассемблироваться
несколько раз. Данная псевдо-инструкция отчасти
представляет NASM-эквивалент синтаксиса <a class="indexterm" name="idp59081648" id="idp59081648"></a><code class="literal">DUP</code>,
поддерживающегося MASM-совместимыми
ассемблерами. Вы можете написать, например</p>
<pre class="programlisting">zerobuf:        times 64 db 0
</pre>
<p>или что-то подобное; однако <code class="literal">TIMES</code>
более разносторонняя инструкция. Аргумент
<code class="literal">TIMES</code> — не просто числовая
константа, а числовое <span class="emphasis"><em>выражение</em></span>, поэтому вы можете
писать следующие вещи:</p>
<pre class="programlisting">buffer: db 'Привет, фуфел'
        times 64-$+buffer db ' '
</pre>
<p>При этом будет резервироваться строго
определенное пространство, чтобы сделать полную
длину <code class="literal">buffer</code> до 64 байт. Наконец,
<code class="literal">TIMES</code> может использоваться в
обычных инструкциях, так что вы можете писать
тривиальные <a class="indexterm" name="idp59087280" id="idp59087280"></a>развернутые циклы:</p>
<pre class="programlisting">        times 100 movsb
</pre>
<p>Заметим, что нет никакой принципиальной
разницы между <code class="literal">times 100 resb 1</code> и <code class="literal">resb 100</code> за исключением того, что последняя
инструкция будет обрабатываться примерно в 100
раз быстрее из-за внутренней структуры
ассемблера.</p>
<p>Операнд псевдо-инструкции <code class="literal">TIMES</code>,
подобно <code class="literal">EQU</code>, <code class="literal">RESB</code> и
ее друзьям, является критическим выражением
(<a class="xref" href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-crit" title="2.8. Critical Expressions">Раздел&nbsp;2.8</a>).</p>
<p>Имейте также в виду, что <code class="literal">TIMES</code> не
применима в <a class="indexterm" name="idp59097264" id="idp59097264"></a>макросах: причиной служит то, что
<code class="literal">TIMES</code> обрабатывается после
макро-фазы, позволяющей аргументу <code class="literal">TIMES</code> содержать выражение, подобное
<code class="literal">64-$+buffer</code>. Для повторения более
одной строки кода или в сложных макросах
используйте директиву препроцессора <a class="indexterm" name="idp59099568" id="idp59099568"></a><code class="literal">%rep</code>.</p>
</div>
</div>
<div class="section" title="2.3. Effective Addresses">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="nasm-effaddr" id="nasm-effaddr"></a>2.3.
Effective Addresses</h2>
</div>
</div>
</div>
<p><a class="indexterm" name="idp59102128" id="idp59102128"></a> An <a class="indexterm" name="idp59103024" id="idp59103024"></a>effective address is any operand to an
instruction which references memory. Effective addresses, in NASM, have a very simple
syntax: they consist of an expression evaluating to the desired address, enclosed in
<a class="indexterm" name="idp59103664" id="idp59103664"></a>square brackets. For
example:</p>
<pre class="programlisting">wordvar dw 123
        mov ax,[wordvar]
        mov ax,[wordvar+1]
        mov ax,[es:wordvar+bx]
</pre>
<p>Anything not conforming to this simple system is not a valid memory reference in NASM,
for example <code class="literal">es:wordvar[bx]</code>.</p>
<p>More complicated effective addresses, such as those involving more than one register,
work in exactly the same way:</p>
<pre class="programlisting">        mov eax,[ebx*2+ecx+offset]
        mov ax,[bp+di+8]
</pre>
<p>NASM is capable of doing <a class="indexterm" name="idp59107248" id="idp59107248"></a>algebra on these effective addresses, so that things which don’t
necessarily <span class="emphasis"><em>look</em></span> legal are perfectly all
right:</p>
<pre class="programlisting">        mov eax,[ebx*5]         ; assembles as [ebx*4+ebx]
        mov eax,[label1*2-label2] ; ie [label1+(label1-label2)]
</pre>
<p>Some forms of effective address have more than one assembled form; in most such cases
NASM will generate the smallest form it can. For example, there are distinct assembled
forms for the 32-bit effective addresses <code class="literal">[eax*2+0]</code> and
<code class="literal">[eax+eax]</code>, and NASM will generally generate the latter on
the grounds that the former requires four bytes to store a zero offset.</p>
<p>NASM has a hinting mechanism which will cause <code class="literal">[eax+ebx]</code>
and <code class="literal">[ebx+eax]</code> to generate different opcodes; this is
occasionally useful because <code class="literal">[esi+ebp]</code> and <code class="literal">[ebp+esi]</code> have different default segment registers.</p>
<p>However, you can force NASM to generate an effective address in a particular form by
the use of the keywords <code class="literal">BYTE</code>, <code class="literal">WORD</code>, <code class="literal">DWORD</code> and <a class="indexterm" name="idp59114800" id="idp59114800"></a><code class="literal">NOSPLIT</code>. If you need
<code class="literal">[eax+3]</code> to be assembled using a double-word offset field
instead of the one byte NASM will normally generate, you can code <code class="literal">[dword eax+3]</code>. Similarly, you can force NASM to use a byte offset for a
small value which it hasn’t seen on the first pass (see <a class="xref" href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-crit" title="2.8. Critical Expressions">Раздел&nbsp;2.8</a> for an example of
such a code fragment) by using <code class="literal">[byte eax+offset]</code>. As special
cases, <code class="literal">[byte eax]</code> will code <code class="literal">[eax+0]</code> with a byte offset of zero, and <code class="literal">[dword
eax]</code> will code it with a double-word offset of zero. The normal form, <code class="literal">[eax]</code>, will be coded with no offset field.</p>
<p>The form described in the previous paragraph is also useful if you are trying to
access data in a 32-bit segment from within 16 bit code. In particular, if you need to
access data with a known offset that is larger than will fit in a 16-bit value, if you
don’t specify that it is a dword offset, NASM will cause the high word of the offset to
be lost.</p>
<p>Similarly, NASM will split <code class="literal">[eax*2]</code> into <code class="literal">[eax+eax]</code> because that allows the offset field to be absent and space to
be saved; in fact, it will also split <code class="literal">[eax*2+offset]</code> into
<code class="literal">[eax+eax+offset]</code>. You can combat this behaviour by the use
of the <code class="literal">NOSPLIT</code> keyword: <code class="literal">[nosplit
eax*2]</code> will force <code class="literal">[eax*2+0]</code> to be generated
literally.</p>
<div class="section" title="2.3.1. 64-bit Displacements">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="nasm-effaddr-disp64" id="nasm-effaddr-disp64"></a>2.3.1.
64-bit Displacements</h3>
</div>
</div>
</div>
<p>In <code class="literal">BITS 64</code> mode, displacements, for the most part, remain
32 bits and are sign extended prior to use. The exception is one restricted form of the
mov instruction: between an <code class="literal">AL</code>, <code class="literal">AX</code>, <code class="literal">EAX</code>, or <code class="literal">RAX</code> register and a 64-bit absolute address (no registers are allowed in
the effective address, and the address cannot be RIP-relative). In NASM syntax, use of
the 64-bit absolute form requires <code class="literal">QWORD</code>. Examples in NASM
syntax:</p>
<pre class="programlisting">        mov eax, [1]    ; 32 bit, with sign extension
        mov al, [rax-1] ; 32 bit, with sign extension
        mov al, [qword 0x1122334455667788] ; 64-bit absolute
        mov al, [0x1122334455667788] ; truncated to 32-bit (warning)
</pre></div>
<div class="section" title="2.3.2. RIP Relative Addressing">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="nasm-effaddr-riprel" id="nasm-effaddr-riprel"></a>2.3.2.
<code class="literal">RIP</code> Relative Addressing</h3>
</div>
</div>
</div>
<p>In 64-bit mode, a new form of effective addressing is available to make it easier to
write position-independent code. Any memory reference may be made <a class="indexterm" name="idp59139248" id="idp59139248"></a><code class="literal">RIP</code> relative
(<code class="literal">RIP</code> is the instruction pointer register, which contains the
address of the location immediately following the current instruction).</p>
<p>In NASM syntax, there are two ways to specify RIP-relative addressing:</p>
<pre class="programlisting">        mov dword [rip+10], 1
</pre>
<p>stores the value 1 ten bytes after the end of the instruction. <code class="literal">10</code> can also be a symbolic constant, and will be treated the same way. On
the other hand,</p>
<pre class="programlisting">        mov dword [symb wrt rip], 1
</pre>
<p>stores the value 1 into the address of symbol <code class="literal">symb</code>. This
is distinctly different than the behavior of:</p>
<pre class="programlisting">        mov dword [symb+rip], 1
</pre>
<p>which takes the address of the end of the instruction, adds the address of
<code class="literal">symb</code> to it, then stores the value 1 there. If <code class="literal">symb</code> is a variable, this will <span class="emphasis"><em>not</em></span>
store the value 1 into the <code class="literal">symb</code> variable!</p>
<p>Yasm also supports the following syntax for RIP-relative addressing. The <a class="indexterm" name="idp59147568" id="idp59147568"></a><code class="literal">REL</code>
keyword makes it produce <code class="literal">RIP</code>-relative addresses, while the
<a class="indexterm" name="idp59149360" id="idp59149360"></a><code class="literal">ABS</code> keyword makes it produce non-<code class="literal">RIP</code>-relative addresses:</p>
<pre class="programlisting">        mov [rel sym], rax  ; RIP-relative
        mov [abs sym], rax  ; not RIP-relative
</pre>
<p>The behavior of <code class="literal">mov [sym], rax</code> depends on a mode set by
the <a class="indexterm" name="idp59152560" id="idp59152560"></a><code class="literal">DEFAULT</code> directive (see <a class="xref" href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-directive-default" title="4.2. DEFAULT: Change the assembler defaults">Раздел&nbsp;4.2</a>), as follows.
The default mode at Yasm start-up is always <code class="literal">ABS</code>, and in
<code class="literal">REL</code> mode, use of registers, a <code class="literal">FS</code> or <code class="literal">GS</code> segment override, or an explicit
<code class="literal">ABS</code> override will result in a non-RIP-relative effective
address.</p>
<pre class="programlisting">default rel
        mov [sym], rbx      ; RIP-relative
        mov [abs sym], rbx  ; not RIP-relative (explicit override)
        mov [rbx+1], rbx    ; not RIP-relative (register use)
        mov [fs:sym], rbx   ; not RIP-relative (fs or gs use)
        mov [ds:sym], rbx   ; RIP-relative (segment, but not fs or gs)
        mov [rel sym], rbx  ; RIP-relative (redundant override)

default abs
        mov [sym], rbx      ; not RIP-relative
        mov [abs sym], rbx  ; not RIP-relative
        mov [rbx+1], rbx    ; not RIP-relative
        mov [fs:sym], rbx   ; not RIP-relative
        mov [ds:sym], rbx   ; not RIP-relative
        mov [rel sym], rbx  ; RIP-relative (explicit override)
</pre></div>
</div>
<div class="section" title="2.4. Immediate Operands">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="nasm-immediate" id="nasm-immediate"></a>2.4. Immediate Operands</h2>
</div>
</div>
</div>
<p><a class="indexterm" name="idp59158832" id="idp59158832"></a> Immediate operands in
NASM may be 8 bits, 16 bits, 32 bits, and even 64 bits in size. The immediate size can be
directly specified through the use of the <code class="literal">BYTE</code>, <code class="literal">WORD</code>, or <code class="literal">DWORD</code> keywords, respectively.</p>
<p>64 bit immediate operands are limited to direct 64-bit register move instructions in
<code class="literal">BITS 64</code> mode. For all other instructions in 64-bit mode,
immediate values remain 32 bits; their value is sign-extended into the upper 32 bits of
the target register prior to being used. The exception is the mov instruction, which can
take a 64-bit immediate when the destination is a 64-bit register.</p>
<p>All unsized immediate values in <code class="literal">BITS 64</code> in Yasm default
to 32-bit size for consistency. In order to get a 64-bit immediate with a label, specify
the size explicitly with the <code class="literal">QWORD</code> keyword. For ease of use,
Yasm will also try to recognize 64-bit values and change the size to 64 bits
automatically for these cases.</p>
<p>Examples in NASM syntax:</p>
<pre class="programlisting">        add rax, 1           ; optimized down to signed 8-bit
        add rax, dword 1     ; force size to 32-bit
        add rax, 0xffffffff  ; sign-extended 32-bit
        add rax, -1          ; same as above
        add rax, 0xffffffffffffffff ; truncated to 32-bit (warning)
        mov eax, 1           ; 5 byte
        mov rax, 1           ; 5 byte (optimized to signed 32-bit)
        mov rax, qword 1     ; 10 byte (forced 64-bit)
        mov rbx, 0x1234567890abcdef ; 10 byte
        mov rcx, 0xffffffff  ; 10 byte (does not fit in signed 32-bit)
        mov ecx, -1          ; 5 byte, equivalent to above
        mov rcx, sym         ; 5 byte, 32-bit size default for symbols
        mov rcx, qword sym   ; 10 byte, override default size
</pre>
<p>A caution for users using both Yasm and NASM 2.x: the handling of mov reg64, unsized
immediate is different between Yasm and NASM 2.x; YASM follows the above behavior, while
NASM 2.x does the following:</p>
<pre class="programlisting">        add rax, 0xffffffff  ; sign-extended 32-bit immediate
        add rax, -1          ; same as above
        add rax, 0xffffffffffffffff ; truncated 32-bit (warning)
        add rax, sym         ; sign-extended 32-bit immediate
        mov eax, 1           ; 5 byte (32-bit immediate)
        mov rax, 1           ; 10 byte (64-bit immediate)
        mov rbx, 0x1234567890abcdef ; 10 byte instruction
        mov rcx, 0xffffffff  ; 10 byte instruction
        mov ecx, -1          ; 5 byte, equivalent to above
        mov ecx, sym         ; 5 byte (32-bit immediate)
        mov rcx, sym         ; 10 byte (64-bit immediate)
        mov rcx, qword sym   ; 10 byte, same as above
</pre></div>
<div class="section" title="2.5. Constants">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="nasm-const" id="nasm-const"></a>2.5.
Constants</h2>
</div>
</div>
</div>
<p><a class="indexterm" name="idp59170736" id="idp59170736"></a> NASM understands four
different types of constant: numeric, character, string and floating-point.</p>
<div class="section" title="2.5.1. Numeric Constants">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="nasm-const-num" id="nasm-const-num"></a>2.5.1. Numeric
Constants</h3>
</div>
</div>
</div>
<p><a class="indexterm" name="idp59172656" id="idp59172656"></a> <a class="indexterm" name="idp59173680" id="idp59173680"></a> <a class="indexterm" name="idp59175088" id="idp59175088"></a> A numeric constant is simply a number. NASM allows you to specify
numbers in a variety of number bases, in a variety of ways: you can suffix <code class="literal">H</code>, <code class="literal">Q</code> or <code class="literal">O</code>, and
<code class="literal">B</code> for <a class="indexterm" name="idp59178032" id="idp59178032"></a>hex, <a class="indexterm" name="idp59178672" id="idp59178672"></a>octal, and <a class="indexterm" name="idp59179312" id="idp59179312"></a>binary, or you can prefix <code class="literal">0x</code> for hex in
the style of C, or you can prefix <code class="literal">$</code> for hex in the style of
Borland Pascal. Note, though, that the <code class="literal">$</code> prefix does double
duty as a prefix on identifiers (see <a class="xref" href="./Yasm User Manual_files/Yasm User Manual.html" title="2.1. Обзор ассемблерной строки NASM">Раздел&nbsp;2.1</a>), so a
hex number prefixed with a <code class="literal">$</code> sign must have a digit after
the <code class="literal">$</code> rather than a letter.</p>
<p>Some examples:</p>
<pre class="programlisting">        mov ax,100              ; decimal
        mov ax,0a2h             ; hex
        mov ax,$0a2             ; hex again: the 0 is required
        mov ax,0xa2             ; hex yet again
        mov ax,777q             ; octal
        mov ax,777o             ; octal again
        mov ax,10010011b        ; binary
</pre></div>
<div class="section" title="2.5.2. Character Constants">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="nasm-const-char" id="nasm-const-char"></a>2.5.2. Character
Constants</h3>
</div>
</div>
</div>
<p><a class="indexterm" name="idp59185200" id="idp59185200"></a></p>
<p>A character constant consists of up to four characters enclosed in either single or
double quotes. The type of quote makes no difference to NASM, except of course that
surrounding the constant with single quotes allows double quotes to appear within it and
vice versa.</p>
<p>A character constant with more than one character will be arranged with <a class="indexterm" name="idp59186736" id="idp59186736"></a>little-endian order in mind: if you
code</p>
<pre class="programlisting">        mov eax,'abcd'
</pre>
<p>then the constant generated is not <code class="literal">0x61626364</code>, but
<code class="literal">0x64636261</code>, so that if you were then to store the value into
memory, it would read <code class="literal">abcd</code> rather than <code class="literal">dcba</code>. This is also the sense of character constants understood by the
Pentium’s <a class="indexterm" name="idp59194544" id="idp59194544"></a><code class="literal">CPUID</code> instruction.</p>
</div>
<div class="section" title="2.5.3. String Constants">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="nasm-const-string" id="nasm-const-string"></a>2.5.3. String
Constants</h3>
</div>
</div>
</div>
<p><a class="indexterm" name="idp59196976" id="idp59196976"></a> <a class="indexterm" name="idp59197872" id="idp59197872"></a> <a class="indexterm" name="idp59199024" id="idp59199024"></a> <a class="indexterm" name="idp59200176" id="idp59200176"></a> String
constants are only acceptable to some pseudo-instructions, namely the <a class="indexterm" name="idp59201328" id="idp59201328"></a><code class="literal">DB</code>
family and <a class="indexterm" name="idp59202736" id="idp59202736"></a><code class="literal">INCBIN</code>.</p>
<p>A string constant looks like a character constant, only longer. It is treated as a
concatenation of maximum-size character constants for the conditions. So the following
are equivalent:</p>
<pre class="programlisting">        db 'hello'              ; string constant
        db 'h','e','l','l','o'  ; equivalent character constants
</pre>
<p>And the following are also equivalent:</p>
<pre class="programlisting">        dd 'ninechars'          ; doubleword string constant
        dd 'nine','char','s'    ; becomes three doublewords
        db 'ninechars',0,0,0    ; and really looks like this
</pre>
<p>Note that when used as an operand to <code class="literal">db</code>, a constant like
<code class="literal">'ab'</code> is treated as a string constant despite being short
enough to be a character constant, because otherwise <code class="literal">db 'ab'</code>
would have the same effect as <code class="literal">db 'a'</code>, which would be silly.
Similarly, three-character or four-character constants are treated as strings when they
are operands to <code class="literal">dw</code>.</p>
</div>
<div class="section" title="2.5.4. Floating-Point Constants">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="nasm-const-float" id="nasm-const-float"></a>2.5.4.
Floating-Point Constants</h3>
</div>
</div>
</div>
<p><a class="indexterm" name="idp59209904" id="idp59209904"></a> <a class="indexterm" name="idp59211184" id="idp59211184"></a> Floating-point constants are acceptable only as
arguments to <a class="indexterm" name="idp59212080" id="idp59212080"></a><code class="literal">DW</code>, <a class="indexterm" name="idp59213360" id="idp59213360"></a><code class="literal">DD</code>, <a class="indexterm" name="idp59214640" id="idp59214640"></a><code class="literal">DQ</code> and <a class="indexterm" name="idp59215920" id="idp59215920"></a><code class="literal">DT</code>. They
are expressed in the traditional form: digits, then a period, then optionally more
digits, then optionally an <code class="literal">E</code> followed by an exponent. The
period is mandatory, so that NASM can distinguish between <code class="literal">dd
1</code>, which declares an integer constant, and <code class="literal">dd 1.0</code>
which declares a floating-point constant.</p>
<p>Some examples:</p>
<pre class="programlisting">        dw -0.5                 ; IEEE half precision
        dd 1.2                  ; an easy one
        dq 1.e10                ; 10,000,000,000
        dq 1.e+10               ; synonymous with 1.e10
        dq 1.e-10               ; 0.000 000 000 1
        dt 3.141592653589793238462 ; pi
</pre>
<p>NASM cannot do compile-time arithmetic on floating-point constants. This is because
NASM is designed to be portable - although it always generates code to run on x86
processors, the assembler itself can run on any system with an ANSI C compiler.
Therefore, the assembler cannot guarantee the presence of a floating-point unit capable
of handling the <a class="indexterm" name="idp59224240" id="idp59224240"></a>Intel number
formats, and so for NASM to be able to do floating arithmetic it would have to include
its own complete set of floating-point routines, which would significantly increase the
size of the assembler for very little benefit.</p>
</div>
</div>
<div class="section" title="2.6. Expressions">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="nasm-expr" id="nasm-expr"></a>2.6.
Expressions</h2>
</div>
</div>
</div>
<p><a class="indexterm" name="idp59226160" id="idp59226160"></a>Expressions in NASM are
similar in syntax to those in C.</p>
<p>NASM does not guarantee the size of the integers used to evaluate expressions at
compile time: since NASM can compile and run on 64-bit systems quite happily, don’t
assume that expressions are evaluated in 32-bit registers and so try to make deliberate
use of ((integer overflow)). It might not always work. The only thing NASM will guarantee
is what’s guaranteed by ANSI C: you always have <span class="emphasis"><em>at
least</em></span> 32 bits to work in.</p>
<p><a class="indexterm" name="idp59227824" id="idp59227824"></a> <a class="indexterm" name="idp59229232" id="idp59229232"></a> NASM supports two special tokens in expressions,
allowing calculations to involve the current assembly position: the <code class="literal">$</code> and <a class="indexterm" name="idp59230640" id="idp59230640"></a><code class="literal">$$</code> tokens. <code class="literal">$</code>
evaluates to the assembly position at the beginning of the line containing the
expression; so you can code an <a class="indexterm" name="idp59236656" id="idp59236656"></a>infinite loop using <code class="literal">JMP $</code>. <code class="literal">$$</code> evaluates to the beginning of the current section; so you can tell
how far into the section you are by using <code class="literal">($-$$)</code>.</p>
<p>The arithmetic <a class="indexterm" name="idp59239216" id="idp59239216"></a>operators
provided by NASM are listed here, in increasing order of <a class="indexterm" name="idp59239856" id="idp59239856"></a>precedence.</p>
<div class="section" title="2.6.1. |: Bitwise OR Operator">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="nasm-expr-or" id="nasm-expr-or"></a>2.6.1. <code class="literal">|</code>: Bitwise OR Operator</h3>
</div>
</div>
</div>
<p>The <a class="indexterm" name="idp59242032" id="idp59242032"></a><code class="literal">|</code> operator gives a <a class="indexterm" name="idp59243568" id="idp59243568"></a>bitwise OR, exactly as performed by the <code class="literal">OR</code>
machine instruction. Bitwise OR is the lowest-priority arithmetic operator supported by
NASM.</p>
</div>
<div class="section" title="2.6.2. ^: Bitwise XOR Operator">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="nasm-expr-xor" id="nasm-expr-xor"></a>2.6.2. <code class="literal">^</code>: Bitwise XOR Operator</h3>
</div>
</div>
</div>
<p><a class="indexterm" name="idp59246256" id="idp59246256"></a> <code class="literal">^</code> provides the <a class="indexterm" name="idp59248048" id="idp59248048"></a>bitwise XOR operation.</p>
</div>
<div class="section" title="2.6.3. &amp;: Bitwise AND Operator">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="nasm-expr-and" id="nasm-expr-and"></a>2.6.3. <code class="literal">&amp;</code>: Bitwise AND Operator</h3>
</div>
</div>
</div>
<p><a class="indexterm" name="idp59250224" id="idp59250224"></a> <code class="literal">&amp;</code> provides the <a class="indexterm" name="idp59268528" id="idp59268528"></a>bitwise AND operation.</p>
</div>
<div class="section" title="2.6.4. &lt;&lt; and &gt;&gt;: Bit Shift Operators">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="nasm-expr-shift" id="nasm-expr-shift"></a>2.6.4. <code class="literal">&lt;&lt;</code> and <code class="literal">&gt;&gt;</code>: Bit Shift
Operators</h3>
</div>
</div>
</div>
<p><a class="indexterm" name="idp59271216" id="idp59271216"></a> <a class="indexterm" name="idp59272496" id="idp59272496"></a> <a class="indexterm" name="idp59273776" id="idp59273776"></a> <code class="literal">&lt;&lt;</code> gives a bit-shift to the left,
just as it does in C. So <code class="literal">5&lt;&lt;3</code> evaluates to 5 times 8,
or 40. <code class="literal">&gt;&gt;</code> gives a bit-shift to the right; in NASM,
such a shift is <span class="emphasis"><em>always</em></span> unsigned, so that the bits
shifted in from the left-hand end are filled with zero rather than a sign-extension of
the previous highest bit.</p>
</div>
<div class="section" title="2.6.5. + and -: Addition and Subtraction Operators">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="nasm-expr-plusminus" id="nasm-expr-plusminus"></a>2.6.5.
<code class="literal">+</code> and <code class="literal">-</code>: Addition and
Subtraction Operators</h3>
</div>
</div>
</div>
<p><a class="indexterm" name="idp59278896" id="idp59278896"></a> <a class="indexterm" name="idp59280432" id="idp59280432"></a> <a class="indexterm" name="idp59281328" id="idp59281328"></a> <a class="indexterm" name="idp59282864" id="idp59282864"></a> The
<code class="literal">+</code> and <code class="literal">-</code> operators do perfectly
ordinary <a class="indexterm" name="idp59284912" id="idp59284912"></a>addition and
<a class="indexterm" name="idp59285552" id="idp59285552"></a>subtraction.</p>
</div>
<div class="section" title="2.6.6. *, /, //, % and %%: Multiplication and Division">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="nasm-expr-mul" id="nasm-expr-mul"></a>2.6.6. <code class="literal">*</code>, <code class="literal">/</code>, <code class="literal">//</code>,
<code class="literal">%</code> and <code class="literal">%%</code>: Multiplication and
Division</h3>
</div>
</div>
</div>
<p><a class="indexterm" name="idp59289776" id="idp59289776"></a> <a class="indexterm" name="idp59291056" id="idp59291056"></a> <a class="indexterm" name="idp59292464" id="idp59292464"></a> <a class="indexterm" name="idp59293744" id="idp59293744"></a>
<a class="indexterm" name="idp59295024" id="idp59295024"></a> <a class="indexterm" name="idp59296304" id="idp59296304"></a> <a class="indexterm" name="idp59297200" id="idp59297200"></a> <code class="literal">*</code> is the <a class="indexterm" name="idp59298608" id="idp59298608"></a>multiplication operator. <code class="literal">/</code> and <code class="literal">//</code> are both <a class="indexterm" name="idp59300272" id="idp59300272"></a>division operators: <code class="literal">/</code> is <a class="indexterm" name="idp59305648" id="idp59305648"></a>unsigned division and <code class="literal">//</code> is <a class="indexterm" name="idp59306800" id="idp59306800"></a>signed division. Similarly,
<code class="literal">%</code> and <code class="literal">%%</code> provide unsigned and
signed <a class="indexterm" name="idp59308464" id="idp59308464"></a>modulo operators
respectively.</p>
<p>NASM, like ANSI C, provides no guarantees about the sensible operation of the signed
modulo operator.</p>
<p>Since the <code class="literal">%</code> character is used extensively by the macro
preprocessor, you should ensure that both the signed and unsigned modulo operators are
followed by white space wherever they appear.</p>
</div>
<div class="section" title="2.6.7. Unary Operators: +, -, ~ and SEG">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="nasm-expr-unary" id="nasm-expr-unary"></a>2.6.7. Unary
Operators: <code class="literal">+</code>, <code class="literal">-</code>, <code class="literal">~</code> and <code class="literal">SEG</code></h3>
</div>
</div>
</div>
<p><a class="indexterm" name="idp59313584" id="idp59313584"></a> <a class="indexterm" name="idp59314480" id="idp59314480"></a> <a class="indexterm" name="idp59316016" id="idp59316016"></a> <a class="indexterm" name="idp59316912" id="idp59316912"></a>
<a class="indexterm" name="idp59318448" id="idp59318448"></a> <a class="indexterm" name="idp59319344" id="idp59319344"></a> The highest-priority operators in NASM’s expression
grammar are those which only apply to one argument. <code class="literal">-</code>
negates its operand, <code class="literal">+</code> does nothing (it’s provided for
symmetry with <code class="literal">-</code>), <code class="literal">~</code> computes
the <a class="indexterm" name="idp59322800" id="idp59322800"></a>one’s complement of
its operand, and <a class="indexterm" name="idp59323440" id="idp59323440"></a><code class="literal">SEG</code> provides the <a class="indexterm" name="idp59324720" id="idp59324720"></a>segment address of its operand (explained in more
detail in <a class="xref" href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-segwrt" title="2.6.8. SEG and WRT">Раздел&nbsp;2.6.8</a>).</p>
</div>
<div class="section" title="2.6.8. SEG and WRT">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="nasm-segwrt" id="nasm-segwrt"></a>2.6.8. <code class="literal">SEG</code> and <code class="literal">WRT</code></h3>
</div>
</div>
</div>
<p><a class="indexterm" name="idp59327792" id="idp59327792"></a> When writing large
16-bit programs, which must be split into multiple <a class="indexterm" name="idp59328688" id="idp59328688"></a>segments, it is often necessary to be able to refer to
the segment part of the address of a symbol. NASM supports the <a class="indexterm" name="idp59333552" id="idp59333552"></a><code class="literal">SEG</code> operator to perform
this function.</p>
<p><a class="indexterm" name="idp59335088" id="idp59335088"></a> The <code class="literal">SEG</code> operator returns the <span class="emphasis"><em>preferred</em></span> segment base of a symbol, defined as the segment
base relative to which the offset of the symbol makes sense. So the code</p>
<pre class="programlisting">        mov ax, seg symbol
        mov es, ax
        mov bx, symbol
</pre>
<p>will load <code class="literal">es:bx</code> with a valid pointer to the symbol
<code class="literal">symbol</code>.</p>
<p><a class="indexterm" name="idp59339056" id="idp59339056"></a> Things can be more
complex than this: since 16-bit segments and <a class="indexterm" name="idp59339952" id="idp59339952"></a>groups may overlap, you might occasionally want to refer to some symbol
using a different segment base from the preferred one. NASM lets you do this, by the use
of the <a class="indexterm" name="idp59340592" id="idp59340592"></a><code class="literal">WRT</code> (With Reference To) keyword. So you can do things like</p>
<pre class="programlisting">        mov ax, weird_seg       ; weird_seg is a segment base
        mov es, ax
        mov bx, symbol wrt weird_seg
</pre>
<p>to load <code class="literal">es:bx</code> with a different, but functionally
equivalent, pointer to the symbol <code class="literal">symbol</code>.</p>
<p>NASM supports far (inter-segment) calls and jumps by means of the syntax <code class="literal">call segment:offset</code>, where <code class="literal">segment</code> and
<code class="literal">offset</code> both represent immediate values. So to call a far
procedure, you could code either of</p>
<pre class="programlisting">        call (seg procedure):procedure
        call weird_seg:(procedure wrt weird_seg)
</pre>
<p>(The parentheses are included for clarity, to show the intended parsing of the above
instructions. They are not necessary in practice.)</p>
<p><a class="indexterm" name="idp59346992" id="idp59346992"></a> NASM supports the syntax
<code class="literal">call far procedure</code> as a synonym for the first of the above
usages. <code class="literal">JMP</code> works identically to <code class="literal">CALL</code> in these examples.</p>
<p>To declare a <a class="indexterm" name="idp59350192" id="idp59350192"></a>far pointer
to a data item in a data segment, you must code</p>
<pre class="programlisting">        dw symbol, seg symbol
</pre>
<p>NASM supports no convenient synonym for this, though you can always invent one using
the macro processor.</p>
</div>
</div>
<div class="section" title="2.7. STRICT: Inhibiting Optimization">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="nasm-strict" id="nasm-strict"></a>2.7.
<code class="literal">STRICT</code>: Inhibiting Optimization</h2>
</div>
</div>
</div>
<p>When assembling with the optimizer set to level 2 or higher, NASM will use size
specifiers (<code class="literal">BYTE</code>, <code class="literal">WORD</code>,
<code class="literal">DWORD</code>, <code class="literal">QWORD</code>, or <code class="literal">TWORD</code>), but will give them the smallest possible size. The keyword
<a class="indexterm" name="idp59356336" id="idp59356336"></a><code class="literal">STRICT</code> can be used to inhibit optimization and force a particular
operand to be emitted in the specified size. For example, with the optimizer on, and in
<code class="literal">BITS 16</code> mode,</p>
<pre class="programlisting">        push dword 33
</pre>
<p>is encoded in three bytes <code class="literal">66 6A 21</code>, whereas</p>
<pre class="programlisting">        push strict dword 33
</pre>
<p>is encoded in six bytes, with a full dword immediate operand <code class="literal">66
68 21 00 00 00</code>.</p>
</div>
<div class="section" title="2.8. Critical Expressions">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="nasm-crit" id="nasm-crit"></a>2.8.
Critical Expressions</h2>
</div>
</div>
</div>
<p><a class="indexterm" name="idp59366448" id="idp59366448"></a> A limitation of NASM is
that it is a <a class="indexterm" name="idp59367344" id="idp59367344"></a>two-pass
assembler; unlike TASM and others, it will always do exactly two <a class="indexterm" name="idp59367984" id="idp59367984"></a>assembly passes. Therefore it is unable to cope
with source files that are complex enough to require three or more <a class="indexterm" name="idp59368624" id="idp59368624"></a>passes.</p>
<p>The first pass is used to determine the size of all the assembled code and data, so
that the second pass, when generating all the code, knows all the symbol addresses the
code refers to. So one thing NASM can’t handle is code whose size depends on the value
of a symbol declared after the code in question. For example,</p>
<pre class="programlisting">        times (label-$) db 0
label:  db 'Where am I?'
</pre>
<p>The argument to <a class="indexterm" name="idp59370672" id="idp59370672"></a><code class="literal">TIMES</code> in this case could equally legally
evaluate to anything at all; NASM will reject this example because it cannot tell the
size of the <code class="literal">TIMES</code> line when it first sees it. It will just
as firmly reject the slightly <a class="indexterm" name="idp59372464" id="idp59372464"></a>paradoxical code</p>
<pre class="programlisting">        times (label-$+1) db 0
label:  db 'NOW where am I?'
</pre>
<p>in which <span class="emphasis"><em>any</em></span> value for the <code class="literal">TIMES</code> argument is by definition wrong!</p>
<p>NASM rejects these examples by means of a concept called a <span class="strong"><strong>critical expression</strong></span>, which is defined to be an
expression whose value is required to be computable in the first pass, and which must
therefore depend only on symbols defined before it. The argument to the <code class="literal">TIMES</code> prefix is a critical expression; for the same reason, the
arguments to the <a class="indexterm" name="idp59376432" id="idp59376432"></a><code class="literal">RESB</code> family of pseudo-instructions are
also critical expressions.</p>
<p>Critical expressions can crop up in other contexts as well: consider the following
code.</p>
<pre class="programlisting">        mov ax, symbol1
symbol1 equ symbol2
symbol2:
</pre>
<p>On the first pass, NASM cannot determine the value of <code class="literal">symbol1</code>, because <code class="literal">symbol1</code> is defined to be
equal to <code class="literal">symbol2</code> which NASM hasn’t seen yet. On the second
pass, therefore, when it encounters the line <code class="literal">mov ax,symbol1</code>,
it is unable to generate the code for it because it still doesn’t know the value of
<code class="literal">symbol1</code>. On the next line, it would see the <a class="indexterm" name="idp59385904" id="idp59385904"></a><code class="literal">EQU</code>
again and be able to determine the value of <code class="literal">symbol1</code>, but by
then it would be too late.</p>
<p>NASM avoids this problem by defining the right-hand side of an <code class="literal">EQU</code> statement to be a critical expression, so the definition of
<code class="literal">symbol1</code> would be rejected in the first pass.</p>
<p>There is a related issue involving <a class="indexterm" name="idp59389488" id="idp59389488"></a>forward references: consider this code fragment.</p>
<pre class="programlisting">        mov eax, [ebx+offset]
offset  equ 10
</pre>
<p>NASM, on pass one, must calculate the size of the instruction <code class="literal">mov eax,[ebx+offset]</code> without knowing the value of <code class="literal">offset</code>. It has no way of knowing that <code class="literal">offset</code> is small enough to fit into a one-byte offset field and that it
could therefore get away with generating a shorter form of the <a class="indexterm" name="idp59392688" id="idp59392688"></a>effective-address encoding; for all it knows, in pass
one, <code class="literal">offset</code> could be a symbol in the code segment, and it
might need the full four-byte form. So it is forced to compute the size of the
instruction to accommodate a four-byte address part. In pass two, having made this
decision, it is now forced to honour it and keep the instruction large, so the code
generated in this case is not as small as it could have been. This problem can be solved
by defining <code class="literal">offset</code> before using it, or by forcing byte size
in the effective address by coding <code class="literal">[byte ebx+offset]</code>.</p>
</div>
<div class="section" title="2.9. Local Labels">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="nasm-local-label" id="nasm-local-label"></a>2.9. Local Labels</h2>
</div>
</div>
</div>
<p><a class="indexterm" name="idp59396144" id="idp59396144"></a> NASM gives special
treatment to symbols beginning with a <a class="indexterm" name="idp59397040" id="idp59397040"></a>period. A label beginning with a single period is treated as a
<span class="emphasis"><em>local</em></span> label, which means that it is associated
with the previous non-local label. So, for example:</p>
<pre class="programlisting">label1  ; some code
.loop   ; some more code
        jne .loop
        ret
label2  ; some code
.loop   ; some more code
        jne .loop
        ret
</pre>
<p>In the above code fragment, each <code class="literal">JNE</code> instruction jumps to
the line immediately before it, because the two definitions of <code class="literal">.loop</code> are kept separate by virtue of each being associated with the
previous non-local label.</p>
<p>NASM goes one step further, in allowing access to local labels from other parts of the
code. This is achieved by means of <span class="emphasis"><em>defining</em></span> a
local label in terms of the previous non-local label: the first definition of
<code class="literal">.loop</code> above is really defining a symbol called <code class="literal">label1.loop</code>, and the second defines a symbol called <code class="literal">label2.loop</code>. So, if you really needed to, you could write</p>
<pre class="programlisting">label3  ; some more code
        ; and some more
        jmp label1.loop
</pre>
<p><a class="indexterm" name="idp59407408" id="idp59407408"></a> <a class="indexterm" name="idp59408304" id="idp59408304"></a> Sometimes it is useful - in a macro, for
instance - to be able to define a label which can be referenced from anywhere but which
doesn’t interfere with the normal local-label mechanism. Such a label can’t be
non-local because it would interfere with subsequent definitions of, and references to,
local labels; and it can’t be local because the macro that defined it wouldn’t know
the label’s full name. NASM therefore introduces a third type of label, which is
probably only useful in macro definitions: if a label begins with the special prefix
<code class="literal">..@</code>, then it does nothing to the local label mechanism. So
you could code</p>
<pre class="programlisting">label1: ; a non-local label
.local: ; this is really label1.local
..@foo: ; this is a special symbol
label2: ; another non-local label
.local: ; this is really label2.local
        jmp ..@foo              ; this will jump three lines up
</pre>
<p>NASM has the capacity to define other special symbols beginning with a double period:
for example, <code class="literal">..start</code> is used to specify the entry point in
the <code class="literal">obj</code> output format.</p>
</div>
</div>
<div class="chapter" title="Глава 3. The NASM Preprocessor">
<div class="titlepage">
<div>
<div>
<h2 class="title"><a name="nasm-preprocessor" id="nasm-preprocessor"></a>Глава 3.
The NASM Preprocessor</h2>
</div>
</div>
</div>
<div class="toc">
<p><b>Содержание</b></p>
<dl>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-single-line-macros">3.1. Single-Line
Macros</a></span></dt>
<dd>
<dl>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-macro-define">3.1.1. The Normal Way:
<code class="literal">%define</code></a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-macro-xdefine">3.1.2. Enhancing %define:
<code class="literal">%xdefine</code></a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-macro-single-concat">3.1.3. Concatenating Single
Line Macro Tokens: <code class="literal">%+</code></a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-macro-undef">3.1.4. Undefining macros:
<code class="literal">%undef</code></a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-macro-assign">3.1.5. Preprocessor Variables:
<code class="literal">%assign</code></a></span></dt>
</dl>
</dd>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-strlen">3.2. String Handling in
Macros</a></span></dt>
<dd>
<dl>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-macro-strlen">3.2.1. String Length: <code class="literal">%strlen</code></a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-macro-substr">3.2.2. Sub-strings: <code class="literal">%substr</code></a></span></dt>
</dl>
</dd>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-multi-line-macros">3.3. Multi-Line
Macros</a></span></dt>
<dd>
<dl>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-macro-overloading">3.3.1. Overloading Multi-Line
Macros</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-macro-local">3.3.2. Macro-Local
Labels</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-macro-greedy">3.3.3. Greedy Macro
Parameters</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-macro-default">3.3.4. Default Macro
Parameters</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-macro-percent0">3.3.5. <code class="literal">%0</code>: Macro Parameter Counter</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-macro-rotate">3.3.6. <code class="literal">%rotate</code>: Rotating Macro Parameters</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-macro-concat">3.3.7. Concatenating Macro
Parameters</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-macro-cc">3.3.8. Condition Codes as Macro
Parameters</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-macro-nolist">3.3.9. Disabling Listing
Expansion</a></span></dt>
</dl>
</dd>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-macro-conditional">3.4. Conditional
Assembly</a></span></dt>
<dd>
<dl>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-macro-ifdef">3.4.1. <code class="literal">%ifdef</code>: Testing Single-Line Macro Existence</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-macro-ifmacro">3.4.2. <code class="literal">%ifmacro</code>: Testing Multi-Line Macro Existence</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-macro-ifctx">3.4.3. <code class="literal">%ifctx</code>: Testing the Context Stack</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-macro-if">3.4.4. <code class="literal">%if</code>: Testing Arbitrary Numeric Expressions</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-macro-ifidn">3.4.5. <code class="literal">%ifidn</code> and <code class="literal">%ifidni</code>: Testing Exact Text
Identity</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-macro-iftyp">3.4.6. <code class="literal">%ifid</code>, <code class="literal">%ifnum</code>, <code class="literal">%ifstr</code>: Testing Token Types</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-macro-error">3.4.7. <code class="literal">%error</code>: Reporting User-Defined Errors</a></span></dt>
</dl>
</dd>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-macro-rep">3.5. Preprocessor
Loops</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-include">3.6. Including Other
Files</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-macro-context-stack">3.7. The Context
Stack</a></span></dt>
<dd>
<dl>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-macro-pushpop">3.7.1. <code class="literal">%push</code> and <code class="literal">%pop</code>: Creating and Removing
Contexts</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-macro-context-local">3.7.2. Context-Local
Labels</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-macro-context-define">3.7.3. Context-Local
Single-Line Macros</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-macro-repl">3.7.4. <code class="literal">%repl</code>: Renaming a Context</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-macro-block-if">3.7.5. Example Use of the
Context Stack: Block IFs</a></span></dt>
</dl>
</dd>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-stdmac">3.8. Standard Macros</a></span></dt>
<dd>
<dl>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-stdmac-version">3.8.1. <code class="literal">__YASM_MAJOR__</code>, etc: Yasm Version</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-stdmac-fileline">3.8.2. <code class="literal">__FILE__</code> and <code class="literal">__LINE__</code>: File Name and Line
Number</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-stdmac-output-format">3.8.3. <code class="literal">__YASM_OBJFMT__</code> and <code class="literal">__OUTPUT_FORMAT__</code>:
Output Object Format Keyword</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-stdmac-struc">3.8.4. <code class="literal">STRUC</code> and <code class="literal">ENDSTRUC</code>: Declaring Structure
Data Types</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-stdmac-istruc">3.8.5. <code class="literal">ISTRUC</code>, <code class="literal">AT</code> and <code class="literal">IEND</code>: Declaring Instances of Structures</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-stdmac-align">3.8.6. <code class="literal">ALIGN</code> and <code class="literal">ALIGNB</code>: Data
Alignment</a></span></dt>
</dl>
</dd>
</dl>
</div>
<p>NASM contains a powerful <a class="indexterm" name="idp59413552" id="idp59413552"></a>macro processor, which supports conditional assembly, multi-level file
inclusion, two forms of macro (single-line and multi-line), and a <span class="quote">«<span class="quote">context stack</span>»</span> mechanism for extra macro
power. Preprocessor directives all begin with a <code class="literal">%</code> sign.</p>
<p>The preprocessor collapses all lines which end with a backslash (\) character into a
single line. Thus:</p>
<pre class="programlisting">%define THIS_VERY_LONG_MACRO_NAME_IS_DEFINED_TO \
          THIS_VALUE
</pre>
<p>will work like a single-line macro without the backslash-newline sequence.</p>
<div class="section" title="3.1. Single-Line Macros">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="nasm-single-line-macros" id="nasm-single-line-macros"></a>3.1. Single-Line Macros</h2>
</div>
</div>
</div>
<div class="section" title="3.1.1. The Normal Way: %define">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="nasm-macro-define" id="nasm-macro-define"></a>3.1.1. The
Normal Way: <code class="literal">%define</code></h3>
</div>
</div>
</div>
<p><a class="indexterm" name="idp59418544" id="idp59418544"></a>Single-line macros are
defined using the <a class="indexterm" name="idp59423408" id="idp59423408"></a><code class="literal">%define</code> preprocessor directive. The
definitions work in a similar way to C; so you can do things like</p>
<pre class="programlisting">%define ctrl    0x1F &amp;
%define param(a,b) ((a)+(a)*(b))

        mov     byte [param(2,ebx)], ctrl 'D'
</pre>
<p>which will expand to</p>
<pre class="programlisting">        mov     byte [(2)+(2)*(ebx)], 0x1F &amp; 'D'
</pre>
<p>When the expansion of a single-line macro contains tokens which invoke another macro,
the expansion is performed at invocation time, not at definition time. Thus the code</p>
<pre class="programlisting">%define a(x)    1+b(x)
%define b(x)    2*x

        mov     ax,a(8)
</pre>
<p>will evaluate in the expected way to <code class="literal">mov ax,1+2*8</code>, even
though the macro <code class="literal">b</code> wasn’t defined at the time of
definition of <code class="literal">a</code>.</p>
<p>Macros defined with <code class="literal">%define</code> are <a class="indexterm" name="idp59429936" id="idp59429936"></a>case sensitive: after <code class="literal">%define foo bar</code>, only <code class="literal">foo</code> will expand to
<code class="literal">bar</code>: <code class="literal">Foo</code> or <code class="literal">FOO</code> will not. By using <a class="indexterm" name="idp59437360" id="idp59437360"></a><code class="literal">%idefine</code> instead of <code class="literal">%define</code> (the <span class="quote">«<span class="quote">i</span>»</span>
stands for <span class="quote">«<span class="quote">insensitive</span>»</span>) you can
define all the case variants of a macro at once, so that <code class="literal">%idefine
foo bar</code> would cause <code class="literal">foo</code>, <code class="literal">Foo</code>, <code class="literal">FOO</code>, <code class="literal">fOO</code>
and so on all to expand to <code class="literal">bar</code>.</p>
<p>There is a mechanism which detects when a macro call has occurred as a result of a
previous expansion of the same macro, to guard against <a class="indexterm" name="idp59443376" id="idp59443376"></a>circular references and infinite loops. If this
happens, the preprocessor will only expand the first occurrence of the macro. Hence, if
you code</p>
<pre class="programlisting">%define a(x)    1+a(x)

        mov     ax,a(3)
</pre>
<p>the macro <code class="literal">a(3)</code> will expand once, becoming <code class="literal">1+a(3)</code>, and will then expand no further. This behaviour can be
useful.</p>
<p><a class="indexterm" name="idp59446320" id="idp59446320"></a> <a class="indexterm" name="idp59447472" id="idp59447472"></a> You can overload single-line macros: if you
write</p>
<pre class="programlisting">%define foo(x)   1+x
%define foo(x,y) 1+x*y
</pre>
<p>the preprocessor will be able to handle both types of macro call, by counting the
parameters you pass; so <code class="literal">foo(3)</code> will become <code class="literal">1+3</code> whereas <code class="literal">foo(ebx,2)</code> will become
<code class="literal">1+ebx*2</code>. However, if you define</p>
<pre class="programlisting">%define foo bar
</pre>
<p>then no other definition of <code class="literal">foo</code> will be accepted: a macro
with no parameters prohibits the definition of the same name as a macro <span class="emphasis"><em>with</em></span> parameters, and vice versa.</p>
<p>This doesn’t prevent single-line macros being <span class="emphasis"><em>redefined</em></span>: you can perfectly well define a macro with</p>
<pre class="programlisting">%define foo bar
</pre>
<p>and then re-define it later in the same source file with</p>
<pre class="programlisting">%define foo baz
</pre>
<p>Then everywhere the macro <code class="literal">foo</code> is invoked, it will be
expanded according to the most recent definition. This is particularly useful when
defining single-line macros with <code class="literal">%assign</code> (see <a class="xref" href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-macro-assign" title="3.1.5. Preprocessor Variables: %assign">Раздел&nbsp;3.1.5</a>).</p>
<p>You can <a class="indexterm" name="idp59474096" id="idp59474096"></a>pre-define
single-line macros using the <span class="quote">«<span class="quote">-D</span>»</span>
option on the Yasm command line: see <a class="xref" href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#yasm-option-d" title="1.3.3.1. -D macro[=value]: Предопределение макроса">Раздел&nbsp;1.3.3.1</a>.</p>
</div>
<div class="section" title="3.1.2. Enhancing %define: %xdefine">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="nasm-macro-xdefine" id="nasm-macro-xdefine"></a>3.1.2.
Enhancing %define: <code class="literal">%xdefine</code></h3>
</div>
</div>
</div>
<p><a class="indexterm" name="idp59481264" id="idp59481264"></a> To have a reference to
an embedded single-line macro resolved at the time that it is embedded, as opposed to
when the calling macro is expanded, you need a different mechanism to the one offered by
<code class="literal">%define</code>. The solution is to use <a class="indexterm" name="idp59482672" id="idp59482672"></a><code class="literal">%xdefine</code>, or its
case-insensitive counterpart <a class="indexterm" name="idp59483952" id="idp59483952"></a><code class="literal">%xidefine</code>.</p>
<p>Suppose you have the following code:</p>
<pre class="programlisting">%define  isTrue  1
%define  isFalse isTrue
%define  isTrue  0

val1:    db      isFalse

%define  isTrue  1

val2:    db      isFalse
</pre>
<p>In this case, <code class="literal">val1</code> is equal to 0, and <code class="literal">val2</code> is equal to 1. This is because, when a single-line macro is defined
using <code class="literal">%define</code>, it is expanded only when it is called. As
<code class="literal">isFalse</code> expands to <code class="literal">isTrue</code>, the
expansion will be the current value of <code class="literal">isTrue</code>. The first
time it is called that is 0, and the second time it is 1.</p>
<p>If you wanted <code class="literal">isFalse</code> to expand to the value assigned to
the embedded macro <code class="literal">isTrue</code> at the time that <code class="literal">isFalse</code> was defined, you need to change the above code to use
<code class="literal">%xdefine</code>.</p>
<pre class="programlisting">%xdefine isTrue  1
%xdefine isFalse isTrue
%xdefine isTrue  0

val1:    db      isFalse

%xdefine isTrue  1

val2:    db      isFalse
</pre>
<p>Now, each time that <code class="literal">isFalse</code> is called, it expands to 1,
as that is what the embedded macro <code class="literal">isTrue</code> expanded to at the
time that <code class="literal">isFalse</code> was defined.</p>
</div>
<div class="section" title="3.1.3. Concatenating Single Line Macro Tokens: %+">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="nasm-macro-single-concat" id="nasm-macro-single-concat"></a>3.1.3. Concatenating Single Line Macro Tokens:
<code class="literal">%+</code></h3>
</div>
</div>
</div>
<p><a class="indexterm" name="idp59496112" id="idp59496112"></a> Individual tokens in
single line macros can be concatenated, to produce longer tokens for later processing.
This can be useful if there are several similar macros that perform similar
functions.</p>
<p>As an example, consider the following:</p>
<pre class="programlisting">%define BDASTART 400h                ; Start of BIOS data area

struc   tBIOSDA                      ; its structure
        .COM1addr       RESW    1
        .COM2addr       RESW    1
        ; ..and so on
endstruc
</pre>
<p>Now, if we need to access the elements of tBIOSDA in different places, we can end up
with:</p>
<pre class="programlisting">        mov     ax,BDASTART + tBIOSDA.COM1addr
        mov     bx,BDASTART + tBIOSDA.COM2addr
</pre>
<p>This will become pretty ugly (and tedious) if used in many places, and can be reduced
in size significantly by using the following macro:</p>
<pre class="programlisting">; Macro to access BIOS variables by their names (from tBDA):

%define BDA(x)  BDASTART + tBIOSDA. %+ x
</pre>
<p>Now the above code can be written as:</p>
<pre class="programlisting">        mov     ax,BDA(COM1addr)
        mov     bx,BDA(COM2addr)
</pre>
<p>Using this feature, we can simplify references to a lot of macros (and, in turn,
reduce typing errors).</p>
</div>
<div class="section" title="3.1.4. Undefining macros: %undef">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="nasm-macro-undef" id="nasm-macro-undef"></a>3.1.4. Undefining
macros: <code class="literal">%undef</code></h3>
</div>
</div>
</div>
<p>Single-line macros can be removed with the <a class="indexterm" name="idp59503024" id="idp59503024"></a><code class="literal">%undef</code> command. For example, the following
sequence:</p>
<pre class="programlisting">%define foo bar
%undef  foo

        mov     eax, foo
</pre>
<p>will expand to the instruction <code class="literal">mov eax, foo</code>, since after
<code class="literal">%undef</code> the macro <code class="literal">foo</code> is no
longer defined.</p>
<p>Macros that would otherwise be pre-defined can be undefined on the command-line using
the <span class="quote">«<span class="quote">-U</span>»</span> option on the Yasm
command line: see <a class="xref" href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#yasm-option-u" title="1.3.3.5. -U macro: Отмена определения макроса">Раздел&nbsp;1.3.3.5</a>.</p>
</div>
<div class="section" title="3.1.5. Preprocessor Variables: %assign">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="nasm-macro-assign" id="nasm-macro-assign"></a>3.1.5.
Preprocessor Variables: <code class="literal">%assign</code></h3>
</div>
</div>
</div>
<p><a class="indexterm" name="idp59509552" id="idp59509552"></a> <a class="indexterm" name="idp59510448" id="idp59510448"></a> An alternative way to define single-line macros
is by means of the <a class="indexterm" name="idp59511344" id="idp59511344"></a><code class="literal">%assign</code> command (and its case-insensitive
counterpart <a class="indexterm" name="idp59512624" id="idp59512624"></a><code class="literal">%iassign</code>, which differs from <code class="literal">%assign</code> in
exactly the same way that <code class="literal">%idefine</code> differs from <code class="literal">%define</code>).</p>
<p><code class="literal">%assign</code> is used to define single-line macros which take
no parameters and have a numeric value. This value can be specified in the form of an
expression, and it will be evaluated once, when the <code class="literal">%assign</code>
directive is processed.</p>
<p>Like <code class="literal">%define</code>, macros defined using <code class="literal">%assign</code> can be re-defined later, so you can do things like</p>
<pre class="programlisting">%assign i i+1
</pre>
<p>to increment the numeric value of a macro.</p>
<p><code class="literal">%assign</code> is useful for controlling the termination of
<code class="literal">%rep</code> preprocessor loops: see <a class="xref" href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-macro-rep" title="3.5. Preprocessor Loops">Раздел&nbsp;3.5</a> for an example of
this.</p>
<p>The expression passed to <code class="literal">%assign</code> is a <a class="indexterm" name="idp59525936" id="idp59525936"></a>critical expression (see <a class="xref" href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-crit" title="2.8. Critical Expressions">Раздел&nbsp;2.8</a>), and
must also evaluate to a pure number (rather than a relocatable reference such as a code
or data address, or anything involving a register).</p>
</div>
</div>
<div class="section" title="3.2. String Handling in Macros">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="nasm-strlen" id="nasm-strlen"></a>3.2.
String Handling in Macros</h2>
</div>
</div>
</div>
<p><a class="indexterm" name="idp59528240" id="idp59528240"></a> It’s often useful to
be able to handle strings in macros. NASM supports two simple string handling macro
operators from which more complex operations can be constructed.</p>
<div class="section" title="3.2.1. String Length: %strlen">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="nasm-macro-strlen" id="nasm-macro-strlen"></a>3.2.1. String
Length: <code class="literal">%strlen</code></h3>
</div>
</div>
</div>
<p><a class="indexterm" name="idp59530544" id="idp59530544"></a> The <a class="indexterm" name="idp59531440" id="idp59531440"></a><code class="literal">%strlen</code> macro is
like <code class="literal">%assign</code> macro in that it creates (or redefines) a
numeric value to a macro. The difference is that with <code class="literal">%strlen</code>, the numeric value is the length of a string. An example of the
use of this would be:</p>
<pre class="programlisting">%strlen charcnt 'my string'
</pre>
<p>In this example, <code class="literal">charcnt</code> would receive the value 8, just
as if an <code class="literal">%assign</code> had been used. In this example,
<code class="literal">'my string'</code> was a literal string but it could also have been
a single-line macro that expands to a string, as in the following example:</p>
<pre class="programlisting">%define sometext 'my string'
%strlen charcnt sometext
</pre>
<p>As in the first case, this would result in <code class="literal">charcnt</code> being
assigned the value of 8.</p>
</div>
<div class="section" title="3.2.2. Sub-strings: %substr">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="nasm-macro-substr" id="nasm-macro-substr"></a>3.2.2.
Sub-strings: <code class="literal">%substr</code></h3>
</div>
</div>
</div>
<p><a class="indexterm" name="idp59539248" id="idp59539248"></a> Individual letters in
strings can be extracted using <a class="indexterm" name="idp59540144" id="idp59540144"></a><code class="literal">%substr</code>. An example of its use is probably
more useful than the description:</p>
<pre class="programlisting">%substr mychar  'xyz' 1         ; equivalent to %define mychar 'x'
%substr mychar  'xyz' 2         ; equivalent to %define mychar 'y'
%substr mychar  'xyz' 3         ; equivalent to %define mychar 'z'
</pre>
<p>In this example, mychar gets the value of <code class="literal">'y'</code>. As with
<code class="literal">%strlen</code> (see <a class="xref" href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-macro-strlen" title="3.2.1. String Length: %strlen">Раздел&nbsp;3.2.1</a>), the first parameter is
the single-line macro to be created and the second is the string. The third parameter
specifies which character is to be selected. Note that the first index is 1, not 0 and
the last index is equal to the value that <code class="literal">%strlen</code> would
assign given the same string. Index values out of range result in an empty string.</p>
</div>
</div>
<div class="section" title="3.3. Multi-Line Macros">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="nasm-multi-line-macros" id="nasm-multi-line-macros"></a>3.3. Multi-Line Macros</h2>
</div>
</div>
</div>
<p><a class="indexterm" name="idp59549744" id="idp59549744"></a> <a class="indexterm" name="idp59550640" id="idp59550640"></a> <a class="indexterm" name="idp59551792" id="idp59551792"></a> Multi-line macros are much more like the type of macro seen in MASM
and TASM: a multi-line macro definition in NASM looks something like this.</p>
<pre class="programlisting">%macro  prologue 1

        push    ebp
        mov     ebp,esp
        sub     esp,%1

%endmacro
</pre>
<p>This defines a C-like function prologue as a macro: so you would invoke the macro with
a call such as</p>
<pre class="programlisting">myfunc:   prologue 12
</pre>
<p>which would expand to the three lines of code</p>
<pre class="programlisting">myfunc: push    ebp
        mov     ebp,esp
        sub     esp,12
</pre>
<p>The number <code class="literal">1</code> after the macro name in the <code class="literal">%macro</code> line defines the number of parameters the macro <code class="literal">prologue</code> expects to receive. The use of <code class="literal">%1</code>
inside the macro definition refers to the first parameter to the macro call. With a macro
taking more than one parameter, subsequent parameters would be referred to as
<code class="literal">%2</code>, <code class="literal">%3</code> and so on.</p>
<p>Multi-line macros, like single-line macros, are <a class="indexterm" name="idp59559216" id="idp59559216"></a>case-sensitive, unless you define them using the
alternative directive <code class="literal">%imacro</code>.</p>
<p><a class="indexterm" name="idp59560624" id="idp59560624"></a> <a class="indexterm" name="idp59561776" id="idp59561776"></a> If you need to pass a comma as <span class="emphasis"><em>part</em></span> of a parameter to a multi-line macro, you can do that by
enclosing the entire parameter in braces. So you could code things like</p>
<pre class="programlisting">%macro  silly 2

    %2: db      %1

%endmacro

        silly 'a', letter_a             ; letter_a:  db 'a'
        silly 'ab', string_ab           ; string_ab: db 'ab'
        silly {13,10}, crlf             ; crlf:      db 13,10
</pre>
<div class="section" title="3.3.1. Overloading Multi-Line Macros">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="nasm-macro-overloading" id="nasm-macro-overloading"></a>3.3.1.
Overloading Multi-Line Macros</h3>
</div>
</div>
</div>
<p><a class="indexterm" name="idp59564720" id="idp59564720"></a> <a class="indexterm" name="idp59565872" id="idp59565872"></a> As with single-line macros, multi-line macros
can be overloaded by defining the same macro name several times with different numbers of
parameters. This time, no exception is made for macros with no parameters at all. So you
could define</p>
<pre class="programlisting">%macro  prologue 0

        push    ebp
        mov     ebp,esp

%endmacro
</pre>
<p>to define an alternative form of the function prologue which allocates no local stack
space.</p>
<p>Sometimes, however, you might want to <span class="quote">«<span class="quote">overload</span>»</span> a machine instruction; for example, you might want to
define</p>
<pre class="programlisting">%macro  push 2

        push    %1
        push    %2

%endmacro
</pre>
<p>so that you could code</p>
<pre class="programlisting">        push    ebx             ; this line is not a macro call
        push    eax,ecx         ; but this one is
</pre>
<p>Ordinarily, NASM will give a warning for the first of the above two lines, since
<code class="literal">push</code> is now defined to be a macro, and is being invoked with
a number of parameters for which no definition has been given. The correct code will
still be generated, but the assembler will give a warning. This warning can be disabled
by the use of the <code class="option">-wno-macro-params</code> command-line option (see
<a class="xref" href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#yasm-warning-options" title="1.3.2. Параметры предупреждения">Раздел&nbsp;1.3.2</a>).</p>
</div>
<div class="section" title="3.3.2. Macro-Local Labels">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="nasm-macro-local" id="nasm-macro-local"></a>3.3.2. Macro-Local
Labels</h3>
</div>
</div>
</div>
<p><a class="indexterm" name="idp59577008" id="idp59577008"></a> NASM allows you to
define labels within a multi-line macro definition in such a way as to make them local to
the macro call: so calling the same macro multiple times will use a different label each
time. You do this by prefixing <a class="indexterm" name="idp59577904" id="idp59577904"></a><code class="literal">%%</code> to the label name. So you can invent an
instruction which executes a <code class="literal">RET</code> if the <code class="literal">Z</code> flag is set by doing this:</p>
<pre class="programlisting">%macro  retz 0

        jnz     %%skip
        ret
    %%skip:

%endmacro
</pre>
<p>You can call this macro as many times as you want, and every time you call it NASM
will make up a different <span class="quote">«<span class="quote">real</span>»</span>
name to substitute for the label <code class="literal">%%skip</code>. The names NASM
invents are of the form <code class="literal">..@2345.skip</code>, where the number 2345
changes with every macro call. The <a class="indexterm" name="idp59582640" id="idp59582640"></a><code class="literal">..@</code> prefix prevents macro-local labels
from interfering with the local label mechanism, as described in <a class="xref" href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-local-label" title="2.9. Local Labels">Раздел&nbsp;2.9</a>. You should avoid
defining your own labels in this form (the <code class="literal">..@</code> prefix, then
a number, then another period) in case they interfere with macro-local labels.</p>
</div>
<div class="section" title="3.3.3. Greedy Macro Parameters">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="nasm-macro-greedy" id="nasm-macro-greedy"></a>3.3.3. Greedy
Macro Parameters</h3>
</div>
</div>
</div>
<p><a class="indexterm" name="idp59586224" id="idp59586224"></a> Occasionally it is
useful to define a macro which lumps its entire command line into one parameter
definition, possibly after extracting one or two smaller parameters from the front. An
example might be a macro to write a text string to a file in MS-DOS, where you might want
to be able to write</p>
<pre class="programlisting">        writefile [filehandle],"hello, world",13,10
</pre>
<p>NASM allows you to define the last parameter of a macro to be <span class="emphasis"><em>greedy</em></span>, meaning that if you invoke the macro with more
parameters than it expects, all the spare parameters get lumped into the last defined one
along with the separating commas. So if you code:</p>
<pre class="programlisting">%macro  writefile 2+

        jmp     %%endstr
  %%str:        db      %2
  %%endstr:
        mov     dx,%%str
        mov     cx,%%endstr-%%str
        mov     bx,%1
        mov     ah,0x40
        int     0x21

%endmacro
</pre>
<p>then the example call to <code class="literal">writefile</code> above will work as
expected: the text before the first comma, <code class="literal">[filehandle]</code>, is
used as the first macro parameter and expanded when <code class="literal">%1</code> is
referred to, and all the subsequent text is lumped into <code class="literal">%2</code>
and placed after the <code class="literal">db</code>.</p>
<p><a class="indexterm" name="idp59596848" id="idp59596848"></a> The greedy nature of the
macro is indicated to NASM by the use of the <code class="literal">+</code> sign after
the parameter count on the <code class="literal">%macro</code> line.</p>
<p>If you define a greedy macro, you are effectively telling NASM how it should expand
the macro given <span class="emphasis"><em>any</em></span> number of parameters from the
actual number specified up to infinity; in this case, for example, NASM now knows what to
do when it sees a call to <code class="literal">writefile</code> with 2, 3, 4 or more
parameters. NASM will take this into account when overloading macros, and will not allow
you to define another form of <code class="literal">writefile</code> taking 4 parameters
(for example).</p>
<p>Of course, the above macro could have been implemented as a non-greedy macro, in which
case the call to it would have had to look like</p>
<pre class="programlisting">        writefile [filehandle], {"hello, world",13,10}
</pre>
<p>NASM provides both mechanisms for putting ((commas in macro parameters)), and you
choose which one you prefer for each macro definition.</p>
<p>See <a class="xref" href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-directive-section-macro" title="4.3.3. The __SECT__ Macro">Раздел&nbsp;4.3.3</a> for a better way to write the above
macro.</p>
</div>
<div class="section" title="3.3.4. Default Macro Parameters">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="nasm-macro-default" id="nasm-macro-default"></a>3.3.4. Default
Macro Parameters</h3>
</div>
</div>
</div>
<p><a class="indexterm" name="idp59624368" id="idp59624368"></a> NASM also allows you to
define a multi-line macro with a <span class="emphasis"><em>range</em></span> of
allowable parameter counts. If you do this, you can specify defaults for <a class="indexterm" name="idp59625648" id="idp59625648"></a>omitted parameters. So, for
example:</p>
<pre class="programlisting">%macro  die 0-1 "Painful program death has occurred."

        writefile 2,%1
        mov     ax,0x4c01
        int     0x21

%endmacro
</pre>
<p>This macro (which makes use of the <code class="literal">writefile</code> macro
defined in <a class="xref" href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-macro-greedy" title="3.3.3. Greedy Macro Parameters">Раздел&nbsp;3.3.3</a>) can be called with an explicit
error message, which it will display on the error output stream before exiting, or it can
be called with no parameters, in which case it will use the default error message
supplied in the macro definition.</p>
<p>In general, you supply a minimum and maximum number of parameters for a macro of this
type; the minimum number of parameters are then required in the macro call, and then you
provide defaults for the optional ones. So if a macro definition began with the line</p>
<pre class="programlisting">%macro foobar 1-3 eax,[ebx+2]
</pre>
<p>then it could be called with between one and three parameters, and <code class="literal">%1</code> would always be taken from the macro call. <code class="literal">%2</code>, if not specified by the macro call, would default to <code class="literal">eax</code>, and <code class="literal">%3</code> if not specified would default
to <code class="literal">[ebx+2]</code>.</p>
<p>You may omit parameter defaults from the macro definition, in which case the parameter
default is taken to be blank. This can be useful for macros which can take a variable
number of parameters, since the <a class="indexterm" name="idp59673392" id="idp59673392"></a><code class="literal">%0</code> token (see <a class="xref" href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-macro-percent0" title="3.3.5. %0: Macro Parameter Counter">Раздел&nbsp;3.3.5</a>) allows you to determine how
many parameters were really passed to the macro call.</p>
<p>This defaulting mechanism can be combined with the greedy-parameter mechanism; so the
<code class="literal">die</code> macro above could be made more powerful, and more
useful, by changing the first line of the definition to</p>
<pre class="programlisting">%macro die 0-1+ "Painful program death has occurred.",13,10
</pre>
<p>The maximum parameter count can be infinite, denoted by <code class="literal">*</code>. In this case, of course, it is impossible to provide a <span class="emphasis"><em>full</em></span> set of default parameters. Examples of this usage are
shown in <a class="xref" href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-macro-rotate" title="3.3.6. %rotate: Rotating Macro Parameters">Раздел&nbsp;3.3.6</a>.</p>
</div>
<div class="section" title="3.3.5. %0: Macro Parameter Counter">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="nasm-macro-percent0" id="nasm-macro-percent0"></a>3.3.5.
<code class="literal">%0</code>: Macro Parameter Counter</h3>
</div>
</div>
</div>
<p><a class="indexterm" name="idp59679792" id="idp59679792"></a> For a macro which can
take a variable number of parameters, the parameter reference <a class="indexterm" name="idp59680688" id="idp59680688"></a><code class="literal">%0</code> will return a numeric
constant giving the number of parameters passed to the macro. This can be used as an
argument to <code class="literal">%rep</code> (see <a class="xref" href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-macro-rep" title="3.5. Preprocessor Loops">Раздел&nbsp;3.5</a>) in order to iterate through all
the parameters of a macro. Examples are given in <a class="xref" href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-macro-rotate" title="3.3.6. %rotate: Rotating Macro Parameters">Раздел&nbsp;3.3.6</a>.</p>
</div>
<div class="section" title="3.3.6. %rotate: Rotating Macro Parameters">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="nasm-macro-rotate" id="nasm-macro-rotate"></a>3.3.6.
<code class="literal">%rotate</code>: Rotating Macro Parameters</h3>
</div>
</div>
</div>
<p><a class="indexterm" name="idp59684912" id="idp59684912"></a> <a class="indexterm" name="idp59685808" id="idp59685808"></a> Unix shell programmers will be familiar with the
<code class="literal">shift</code> shell command, which allows the arguments passed to a
shell script (referenced as <code class="literal">$1</code>, <code class="literal">$2</code> and so on) to be moved left by one place, so that the argument
previously referenced as <code class="literal">$2</code> becomes available as
<code class="literal">$1</code>, and the argument previously referenced as <code class="literal">$1</code> is no longer available at all.</p>
<p>NASM provides a similar mechanism, in the form of <a class="indexterm" name="idp59690288" id="idp59690288"></a><code class="literal">%rotate</code>. As its name
suggests, it differs from the Unix <code class="literal">shift</code> in that no
parameters are lost: parameters rotated off the left end of the argument list reappear on
the right, and vice versa.</p>
<p><code class="literal">%rotate</code> is invoked with a single numeric argument (which
may be an expression). The macro parameters are rotated to the left by that many places.
If the argument to <code class="literal">%rotate</code> is negative, the macro parameters
are rotated to the right.</p>
<p><a class="indexterm" name="idp59693744" id="idp59693744"></a> So a pair of macros to
save and restore a set of registers might work as follows:</p>
<pre class="programlisting">%macro  multipush 1-*

  %rep  %0
        push    %1
  %rotate 1
  %endrep

%endmacro
</pre>
<p>This macro invokes the <code class="literal">PUSH</code> instruction on each of its
arguments in turn, from left to right. It begins by pushing its first argument,
<code class="literal">%1</code>, then invokes <code class="literal">%rotate</code> to
move all the arguments one place to the left, so that the original second argument is now
available as <code class="literal">%1</code>. Repeating this procedure as many times as
there were arguments (achieved by supplying <code class="literal">%0</code> as the
argument to <code class="literal">%rep</code>) causes each argument in turn to be
pushed.</p>
<p>Note also the use of <code class="literal">*</code> as the maximum parameter count,
indicating that there is no upper limit on the number of parameters you may supply to the
<a class="indexterm" name="idp59716016" id="idp59716016"></a><code class="literal">multipush</code> macro.</p>
<p>It would be convenient, when using this macro, to have a <code class="literal">POP</code> equivalent, which <span class="emphasis"><em>didn’t</em></span>
require the arguments to be given in reverse order. Ideally, you would write the
<code class="literal">multipush</code> macro call, then cut-and-paste the line to where
the pop needed to be done, and change the name of the called macro to <code class="literal">multipop</code>, and the macro would take care of popping the registers in the
opposite order from the one in which they were pushed.</p>
<p>This can be done by the following definition:</p>
<pre class="programlisting">%macro  multipop 1-*

  %rep %0
  %rotate -1
        pop     %1
  %endrep

%endmacro
</pre>
<p>This macro begins by rotating its arguments one place to the <span class="emphasis"><em>right</em></span>, so that the original <span class="emphasis"><em>last</em></span> argument appears as <code class="literal">%1</code>. This
is then popped, and the arguments are rotated right again, so the second-to-last argument
becomes <code class="literal">%1</code>. Thus the arguments are iterated through in
reverse order.</p>
</div>
<div class="section" title="3.3.7. Concatenating Macro Parameters">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="nasm-macro-concat" id="nasm-macro-concat"></a>3.3.7.
Concatenating Macro Parameters</h3>
</div>
</div>
</div>
<p><a class="indexterm" name="idp59724080" id="idp59724080"></a> NASM can concatenate
macro parameters on to other text surrounding them. This allows you to declare a family
of symbols, for example, in a macro definition. If, for example, you wanted to generate a
table of key codes along with offsets into the table, you could code something like</p>
<pre class="programlisting">%macro keytab_entry 2

    keypos%1    equ     $-keytab
                db      %2

%endmacro

keytab:
          keytab_entry F1,128+1
          keytab_entry F2,128+2
          keytab_entry Return,13
</pre>
<p>which would expand to</p>
<pre class="programlisting">keytab:
keyposF1        equ     $-keytab
                db     128+1
keyposF2        equ     $-keytab
                db      128+2
keyposReturn    equ     $-keytab
                db      13
</pre>
<p>You can just as easily concatenate text on to the other end of a macro parameter, by
writing <code class="literal">%1foo</code>.</p>
<p><a class="indexterm" name="idp59727536" id="idp59727536"></a> <a class="indexterm" name="idp59728688" id="idp59728688"></a> If you need to append a <span class="emphasis"><em>digit</em></span> to a macro parameter, for example defining labels
<code class="literal">foo1</code> and <code class="literal">foo2</code> when passed the
parameter <code class="literal">foo</code>, you can’t code <code class="literal">%11</code> because that would be taken as the eleventh macro parameter.
Instead, you must code <code class="literal">%{1}1</code>, which will separate the first
<code class="literal">1</code> (giving the number of the macro parameter) from the second
(literal text to be concatenated to the parameter).</p>
<p>This concatenation can also be applied to other preprocessor in-line objects, such as
macro-local labels (<a class="xref" href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-macro-local" title="3.3.2. Macro-Local Labels">Раздел&nbsp;3.3.2</a>) and context-local labels (<a class="xref" href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-macro-context-local" title="3.7.2. Context-Local Labels">Раздел&nbsp;3.7.2</a>). In all cases, ambiguities in
syntax can be resolved by enclosing everything after the <code class="literal">%</code>
sign and before the literal text in braces: so <code class="literal">%{%foo}bar</code>
concatenates the text <code class="literal">bar</code> to the end of the real name of the
macro-local label <code class="literal">%%foo</code>. (This is unnecessary, since the
form NASM uses for the real names of macro-local labels means that the two usages
<code class="literal">%{%foo}bar</code> and <code class="literal">%%foobar</code> would
both expand to the same thing anyway; nevertheless, the capability is there.)</p>
</div>
<div class="section" title="3.3.8. Condition Codes as Macro Parameters">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="nasm-macro-cc" id="nasm-macro-cc"></a>3.3.8. Condition Codes
as Macro Parameters</h3>
</div>
</div>
</div>
<p><a class="indexterm" name="idp59738544" id="idp59738544"></a></p>
<p>NASM can give special treatment to a macro parameter which contains a condition code.
For a start, you can refer to the macro parameter <code class="literal">%1</code> by
means of the alternative syntax <a class="indexterm" name="idp59744432" id="idp59744432"></a><code class="literal">%+1</code>, which informs NASM that this macro
parameter is supposed to contain a condition code, and will cause the preprocessor to
report an error message if the macro is called with a parameter which is <span class="emphasis"><em>not</em></span> a valid condition code.</p>
<p>Far more usefully, though, you can refer to the macro parameter by means of <a class="indexterm" name="idp59746480" id="idp59746480"></a><code class="literal">%-1</code>,
which NASM will expand as the <span class="emphasis"><em>inverse</em></span> condition
code. So the <code class="literal">retz</code> macro defined in <a class="xref" href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-macro-local" title="3.3.2. Macro-Local Labels">Раздел&nbsp;3.3.2</a> can be
replaced by a general <a class="indexterm" name="idp59749040" id="idp59749040"></a>conditional-return macro like this:</p>
<pre class="programlisting">%macro  retc 1

        j%-1    %%skip
        ret
  %%skip:

%endmacro
</pre>
<p>This macro can now be invoked using calls like <code class="literal">retc ne</code>,
which will cause the conditional-jump instruction in the macro expansion to come out as
<code class="literal">JE</code>, or <code class="literal">retc po</code> which will make
the jump a <code class="literal">JPE</code>.</p>
<p>The <code class="literal">%+1</code> macro-parameter reference is quite happy to
interpret the arguments <code class="literal">CXZ</code> and <code class="literal">ECXZ</code> as valid condition codes; however, <code class="literal">%-1</code>
will report an error if passed either of these, because no inverse condition code
exists.</p>
</div>
<div class="section" title="3.3.9. Disabling Listing Expansion">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="nasm-macro-nolist" id="nasm-macro-nolist"></a>3.3.9. Disabling
Listing Expansion</h3>
</div>
</div>
</div>
<p><a class="indexterm" name="idp59760432" id="idp59760432"></a> When NASM is generating
a listing file from your program, it will generally expand multi-line macros by means of
writing the macro call and then listing each line of the expansion. This allows you to
see which instructions in the macro expansion are generating what code; however, for some
macros this clutters the listing up unnecessarily.</p>
<p>NASM therefore provides the <a class="indexterm" name="idp59761712" id="idp59761712"></a><code class="literal">.nolist</code> qualifier, which you can include
in a macro definition to inhibit the expansion of the macro in the listing file. The
<code class="literal">.nolist</code> qualifier comes directly after the number of
parameters, like this:</p>
<pre class="programlisting">%macro foo 1.nolist
</pre>
<p>Or like this:</p>
<pre class="programlisting">%macro bar 1-5+.nolist a,b,c,d,e,f,g,h
</pre></div>
</div>
<div class="section" title="3.4. Conditional Assembly">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="nasm-macro-conditional" id="nasm-macro-conditional"></a>3.4. Conditional Assembly</h2>
</div>
</div>
</div>
<p><a class="indexterm" name="idp59766320" id="idp59766320"></a> <a class="indexterm" name="idp59767216" id="idp59767216"></a> Similarly to the C preprocessor, NASM allows
sections of a source file to be assembled only if certain conditions are met. The general
syntax of this feature looks like this:</p>
<pre class="programlisting">%if&lt;condition&gt;
    ; some code which only appears if &lt;condition&gt; is met
%elif&lt;condition2&gt;
    ; only appears if &lt;condition&gt; is not met but &lt;condition2&gt; is
%else
    ; this appears if neither &lt;condition&gt; nor &lt;condition2&gt; was met
%endif
</pre>
<p>The <a class="indexterm" name="idp59769264" id="idp59769264"></a><code class="literal">%else</code> clause is optional, as is the <a class="indexterm" name="idp59770544" id="idp59770544"></a><code class="literal">%elif</code> clause. You can
have more than one <code class="literal">%elif</code> clause as well.</p>
<div class="section" title="3.4.1. %ifdef: Testing Single-Line Macro Existence">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="nasm-macro-ifdef" id="nasm-macro-ifdef"></a>3.4.1.
<code class="literal">%ifdef</code>: Testing Single-Line Macro Existence</h3>
</div>
</div>
</div>
<p><a class="indexterm" name="idp59773872" id="idp59773872"></a> <a class="indexterm" name="idp59775024" id="idp59775024"></a> <a class="indexterm" name="idp59776176" id="idp59776176"></a> Beginning a conditional-assembly block with the line <code class="literal">%ifdef MACRO</code> will assemble the subsequent code if, and only if, a
single-line macro called <code class="literal">MACRO</code> is defined. If not, then the
<code class="literal">%elif</code> and <code class="literal">%else</code> blocks (if any)
will be processed instead.</p>
<p>For example, when debugging a program, you might want to write code such as</p>
<pre class="programlisting">          ; perform some function
%ifdef DEBUG
          writefile 2,"Function performed successfully",13,10
%endif
          ; go and do something else
</pre>
<p>Then you could use the command-line option <code class="literal">-D DEBUG</code> to
create a version of the program which produced debugging messages, and remove the option
to generate the final release version of the program.</p>
<p>You can test for a macro <span class="emphasis"><em>not</em></span> being defined by
using <a class="indexterm" name="idp59785904" id="idp59785904"></a><code class="literal">%ifndef</code> instead of <code class="literal">%ifdef</code>. You can also
test for macro definitions in <code class="literal">%elif</code> blocks by using
<a class="indexterm" name="idp59788208" id="idp59788208"></a><code class="literal">%elifdef</code> and <a class="indexterm" name="idp59789488" id="idp59789488"></a><code class="literal">%elifndef</code>.</p>
</div>
<div class="section" title="3.4.2. %ifmacro: Testing Multi-Line Macro Existence">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="nasm-macro-ifmacro" id="nasm-macro-ifmacro"></a>3.4.2.
<code class="literal">%ifmacro</code>: Testing Multi-Line Macro Existence</h3>
</div>
</div>
</div>
<p><a class="indexterm" name="idp59792432" id="idp59792432"></a> <a class="indexterm" name="idp59793584" id="idp59793584"></a> The <a class="indexterm" name="idp59794480" id="idp59794480"></a><code class="literal">%ifmacro</code> directive operates in the same
way as the <code class="literal">%ifdef</code> directive, except that it checks for the
existence of a multi-line macro.</p>
<p>For example, you may be working with a large project and not have control over the
macros in a library. You may want to create a macro with one name if it doesn’t already
exist, and another name if one with that name does exist.</p>
<p>The <code class="literal">%ifmacro</code> is considered true if defining a macro with
the given name and number of arguments would cause a definitions conflict. For
example:</p>
<pre class="programlisting">%ifmacro MyMacro 1-3

     %error "MyMacro 1-3" causes a conflict with an existing macro.

%else

     %macro MyMacro 1-3

             ; insert code to define the macro

     %endmacro

%endif
</pre>
<p>This will create the macro <code class="literal">MyMacro 1-3</code> if no macro
already exists which would conflict with it, and emits a warning if there would be a
definition conflict.</p>
<p>You can test for the macro not existing by using the <a class="indexterm" name="idp59799344" id="idp59799344"></a><code class="literal">%ifnmacro</code> instead of
<code class="literal">%ifmacro</code>. Additional tests can be performed in <code class="literal">%elif</code> blocks by using <a class="indexterm" name="idp59801776" id="idp59801776"></a><code class="literal">%elifmacro</code> and <a class="indexterm" name="idp59803056" id="idp59803056"></a><code class="literal">%elifnmacro</code>.</p>
</div>
<div class="section" title="3.4.3. %ifctx: Testing the Context Stack">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="nasm-macro-ifctx" id="nasm-macro-ifctx"></a>3.4.3.
<code class="literal">%ifctx</code>: Testing the Context Stack</h3>
</div>
</div>
</div>
<p><a class="indexterm" name="idp59805872" id="idp59805872"></a> <a class="indexterm" name="idp59807024" id="idp59807024"></a> <a class="indexterm" name="idp59808176" id="idp59808176"></a> The conditional-assembly construct <code class="literal">%ifctx
ctxname</code> will cause the subsequent code to be assembled if and only if the top
context on the preprocessor’s context stack has the name <code class="literal">ctxname</code>. As with <code class="literal">%ifdef</code>, the inverse and
<code class="literal">%elif</code> forms <a class="indexterm" name="idp59823536" id="idp59823536"></a><code class="literal">%ifnctx</code>, <a class="indexterm" name="idp59824816" id="idp59824816"></a><code class="literal">%elifctx</code> and <a class="indexterm" name="idp59826096" id="idp59826096"></a><code class="literal">%elifnctx</code> are also supported.</p>
<p>For more details of the context stack, see <a class="xref" href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-macro-context-stack" title="3.7. The Context Stack">Раздел&nbsp;3.7</a>. For a
sample use of <code class="literal">%ifctx</code>, see <a class="xref" href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-macro-block-if" title="3.7.5. Example Use of the Context Stack: Block IFs">Раздел&nbsp;3.7.5</a>.</p>
</div>
<div class="section" title="3.4.4. %if: Testing Arbitrary Numeric Expressions">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="nasm-macro-if" id="nasm-macro-if"></a>3.4.4. <code class="literal">%if</code>: Testing Arbitrary Numeric Expressions</h3>
</div>
</div>
</div>
<p><a class="indexterm" name="idp59834800" id="idp59834800"></a> <a class="indexterm" name="idp59835952" id="idp59835952"></a> <a class="indexterm" name="idp59837104" id="idp59837104"></a> The conditional-assembly construct <code class="literal">%if
expr</code> will cause the subsequent code to be assembled if and only if the value of
the numeric expression <code class="literal">expr</code> is non-zero. An example of the
use of this feature is in deciding when to break out of a <code class="literal">%rep</code> preprocessor loop: see <a class="xref" href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-macro-rep" title="3.5. Preprocessor Loops">Раздел&nbsp;3.5</a> for a detailed example.</p>
<p>The expression given to <code class="literal">%if</code>, and its counterpart
<a class="indexterm" name="idp59840816" id="idp59840816"></a><code class="literal">%elif</code>, is a critical expression (see <a class="xref" href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-crit" title="2.8. Critical Expressions">Раздел&nbsp;2.8</a>).</p>
<p><code class="literal">%if</code> extends the normal NASM expression syntax, by
providing a set of <a class="indexterm" name="idp59843376" id="idp59843376"></a>relational operators which are not normally available in expressions.
The operators <a class="indexterm" name="idp59844016" id="idp59844016"></a><code class="literal">=</code>, <a class="indexterm" name="idp59845296" id="idp59845296"></a><code class="literal">&lt;</code>, <a class="indexterm" name="idp59846576" id="idp59846576"></a><code class="literal">&gt;</code>, <a class="indexterm" name="idp59847856" id="idp59847856"></a><code class="literal">&lt;=</code>,
<a class="indexterm" name="idp59849136" id="idp59849136"></a><code class="literal">&gt;=</code> and <a class="indexterm" name="idp59854640" id="idp59854640"></a><code class="literal">&lt;&gt;</code> test equality, less-than,
greater-than, less-or-equal, greater-or-equal and not-equal respectively. The C-like
forms <a class="indexterm" name="idp59855920" id="idp59855920"></a><code class="literal">==</code> and <a class="indexterm" name="idp59857200" id="idp59857200"></a><code class="literal">!=</code> are supported as alternative forms of
<code class="literal">=</code> and <code class="literal">&lt;&gt;</code>. In addition,
low-priority logical operators <a class="indexterm" name="idp59859504" id="idp59859504"></a><code class="literal">&amp;&amp;</code>, <a class="indexterm" name="idp59860784" id="idp59860784"></a><code class="literal">^^</code> and <a class="indexterm" name="idp59862192" id="idp59862192"></a><code class="literal">||</code> are
provided, supplying <a class="indexterm" name="idp59863472" id="idp59863472"></a>logical
AND, <a class="indexterm" name="idp59864112" id="idp59864112"></a>logical XOR and
<a class="indexterm" name="idp59864752" id="idp59864752"></a>logical OR. These work like
the C logical operators (although C has no logical XOR), in that they always return
either 0 or 1, and treat any non-zero input as 1 (so that <code class="literal">^^</code>, for example, returns 1 if exactly one of its inputs is zero, and 0
otherwise). The relational operators also return 1 for true and 0 for false.</p>
</div>
<div class="section" title="3.4.5. %ifidn and %ifidni: Testing Exact Text Identity">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="nasm-macro-ifidn" id="nasm-macro-ifidn"></a>3.4.5.
<code class="literal">%ifidn</code> and <code class="literal">%ifidni</code>: Testing
Exact Text Identity</h3>
</div>
</div>
</div>
<p><a class="indexterm" name="idp59867952" id="idp59867952"></a> <a class="indexterm" name="idp59869104" id="idp59869104"></a> <a class="indexterm" name="idp59870384" id="idp59870384"></a> The construct <code class="literal">%ifidn text1,text2</code> will
cause the subsequent code to be assembled if and only if <code class="literal">text1</code> and <code class="literal">text2</code>, after expanding
single-line macros, are identical pieces of text. Differences in white space are not
counted.</p>
<p><a class="indexterm" name="idp59873200" id="idp59873200"></a> <a class="indexterm" name="idp59874096" id="idp59874096"></a><code class="literal">%ifidni</code> is similar
to <code class="literal">%ifidn</code>, but is <a class="indexterm" name="idp59875888" id="idp59875888"></a>case-insensitive.</p>
<p>For example, the following macro pushes a register or number on the stack, and allows
you to treat <code class="literal">IP</code> as a real register:</p>
<pre class="programlisting">%macro  pushparam 1

  %ifidni %1,ip
        call    %%label
  %%label:
  %else
        push    %1
  %endif

%endmacro
</pre>
<p>Like most other <code class="literal">%if</code> constructs, <code class="literal">%ifidn</code> has a counterpart <a class="indexterm" name="idp59883568" id="idp59883568"></a><code class="literal">%elifidn</code>, and negative forms <a class="indexterm" name="idp59884848" id="idp59884848"></a><code class="literal">%ifnidn</code>
and <a class="indexterm" name="idp59886128" id="idp59886128"></a><code class="literal">%elifnidn</code>. Similarly, <code class="literal">%ifidni</code> has
counterparts <a class="indexterm" name="idp59887920" id="idp59887920"></a><code class="literal">%elifidni</code>, <a class="indexterm" name="idp59889200" id="idp59889200"></a><code class="literal">%ifnidni</code> and <a class="indexterm" name="idp59890608" id="idp59890608"></a><code class="literal">%elifnidni</code>.</p>
</div>
<div class="section" title="3.4.6. %ifid, %ifnum, %ifstr: Testing Token Types">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="nasm-macro-iftyp" id="nasm-macro-iftyp"></a>3.4.6.
<code class="literal">%ifid</code>, <code class="literal">%ifnum</code>, <code class="literal">%ifstr</code>: Testing Token Types</h3>
</div>
</div>
</div>
<p><a class="indexterm" name="idp59894448" id="idp59894448"></a> <a class="indexterm" name="idp59895600" id="idp59895600"></a> Some macros will want to perform different tasks
depending on whether they are passed a number, a string, or an identifier. For example, a
string output macro might want to be able to cope with being passed either a string
constant or a pointer to an existing string.</p>
<p>The conditional assembly construct <a class="indexterm" name="idp59896880" id="idp59896880"></a><code class="literal">%ifid</code>, taking one parameter (which may be
blank), assembles the subsequent code if and only if the first token in the parameter
exists and is an identifier. <a class="indexterm" name="idp59898160" id="idp59898160"></a><code class="literal">%ifnum</code> works similarly, but tests for the
token being a numeric constant; <a class="indexterm" name="idp59899568" id="idp59899568"></a><code class="literal">%ifstr</code> tests for it being a string.</p>
<p>For example, the <code class="literal">writefile</code> macro defined in <a class="xref" href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-macro-greedy" title="3.3.3. Greedy Macro Parameters">Раздел&nbsp;3.3.3</a> can be extended to take
advantage of <code class="literal">%ifstr</code> in the following fashion:</p>
<pre class="programlisting">%macro writefile 2-3+

  %ifstr %2
        jmp     %%endstr
    %if %0 = 3
      %%str:    db      %2,%3
    %else
      %%str:    db      %2
    %endif
      %%endstr: mov     dx,%%str
                mov     cx,%%endstr-%%str
  %else
                mov     dx,%2
                mov     cx,%3
  %endif
                mov     bx,%1
                mov     ah,0x40
                int     0x21

%endmacro
</pre>
<p>Then the <code class="literal">writefile</code> macro can cope with being called in
either of the following two ways:</p>
<pre class="programlisting">        writefile [file], strpointer, length
        writefile [file], "hello", 13, 10
</pre>
<p>In the first, <code class="literal">strpointer</code> is used as the address of an
already-declared string, and <code class="literal">length</code> is used as its length;
in the second, a string is given to the macro, which therefore declares it itself and
works out the address and length for itself.</p>
<p>Note the use of <code class="literal">%if</code> inside the <code class="literal">%ifstr</code>: this is to detect whether the macro was passed two arguments (so
the string would be a single string constant, and <code class="literal">db %2</code>
would be adequate) or more (in which case, all but the first two would be lumped together
into <code class="literal">%3</code>, and <code class="literal">db %2,%3</code> would be
required).</p>
<p><a class="indexterm" name="idp59946288" id="idp59946288"></a> <a class="indexterm" name="idp59947440" id="idp59947440"></a> <a class="indexterm" name="idp59948592" id="idp59948592"></a> <a class="indexterm" name="idp59949744" id="idp59949744"></a>
<a class="indexterm" name="idp59950896" id="idp59950896"></a> <a class="indexterm" name="idp59952176" id="idp59952176"></a> <a class="indexterm" name="idp59953328" id="idp59953328"></a> <a class="indexterm" name="idp59954480" id="idp59954480"></a>
<a class="indexterm" name="idp59955632" id="idp59955632"></a> The usual <code class="literal">%elifXXX</code>, <code class="literal">%ifnXXX</code> and <code class="literal">%elifnXXX</code> versions exist for each of <code class="literal">%ifid</code>,
<code class="literal">%ifnum</code> and <code class="literal">%ifstr</code>.</p>
</div>
<div class="section" title="3.4.7. %error: Reporting User-Defined Errors">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="nasm-macro-error" id="nasm-macro-error"></a>3.4.7.
<code class="literal">%error</code>: Reporting User-Defined Errors</h3>
</div>
</div>
</div>
<p><a class="indexterm" name="idp59961520" id="idp59961520"></a> The preprocessor
directive <a class="indexterm" name="idp59962416" id="idp59962416"></a><code class="literal">%error</code> will cause NASM to report an error if it occurs in assembled
code. So if other users are going to try to assemble your source files, you can ensure
that they define the right macros by means of code like this:</p>
<pre class="programlisting">%ifdef SOME_MACRO
    ; do some setup
%elifdef SOME_OTHER_MACRO
    ; do some different setup
%else
    %error Neither SOME_MACRO nor SOME_OTHER_MACRO was defined.
%endif
</pre>
<p>Then any user who fails to understand the way your code is supposed to be assembled
will be quickly warned of their mistake, rather than having to wait until the program
crashes on being run and then not knowing what went wrong.</p>
</div>
</div>
<div class="section" title="3.5. Preprocessor Loops">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="nasm-macro-rep" id="nasm-macro-rep"></a>3.5. Preprocessor Loops</h2>
</div>
</div>
</div>
<p><a class="indexterm" name="idp59965872" id="idp59965872"></a> <a class="indexterm" name="idp59966768" id="idp59966768"></a> NASM’s <code class="literal">TIMES</code>
prefix, though useful, cannot be used to invoke a multi-line macro multiple times,
because it is processed by NASM after macros have already been expanded. Therefore NASM
provides another form of loop, this time at the preprocessor level: <a class="indexterm" name="idp59968304" id="idp59968304"></a><code class="literal">%rep</code>.</p>
<p>The directives <code class="literal">%rep</code> and <a class="indexterm" name="idp59970480" id="idp59970480"></a><code class="literal">%endrep</code> (<code class="literal">%rep</code> takes a numeric argument, which can be an expression; <code class="literal">%endrep</code> takes no arguments) can be used to enclose a chunk of code,
which is then replicated as many times as specified by the preprocessor:</p>
<pre class="programlisting">%assign i 0
%rep    64
        inc     word [table+2*i]
%assign i i+1
%endrep
</pre>
<p>This will generate a sequence of 64 <code class="literal">INC</code> instructions,
incrementing every word of memory from <code class="literal">[table]</code> to
<code class="literal">[table+126]</code>.</p>
<p>For more complex termination conditions, or to break out of a repeat loop part way
along, you can use the <a class="indexterm" name="idp59975600" id="idp59975600"></a><code class="literal">%exitrep</code> directive to terminate the loop,
like this:</p>
<pre class="programlisting">fibonacci:
%assign i 0
%assign j 1
%rep 100
%if j &gt; 65535
    %exitrep
%endif
        dw j
%assign k j+i
%assign i j
%assign j k
%endrep

fib_number equ ($-fibonacci)/2
</pre>
<p>This produces a list of all the Fibonacci numbers that will fit in 16 bits. Note that
a maximum repeat count must still be given to <code class="literal">%rep</code>. This is
to prevent the possibility of NASM getting into an infinite loop in the preprocessor,
which (on multitasking or multi-user systems) would typically cause all the system memory
to be gradually used up and other applications to start crashing.</p>
</div>
<div class="section" title="3.6. Including Other Files">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="nasm-include" id="nasm-include"></a>3.6.
Including Other Files</h2>
</div>
</div>
</div>
<p><a class="indexterm" name="idp59979568" id="idp59979568"></a> Using, once again, a
very similar syntax to the C preprocessor, the NASM preprocessor lets you include other
source files into your code. This is done by the use of the <a class="indexterm" name="idp59980464" id="idp59980464"></a><code class="literal">%include</code> directive:</p>
<pre class="programlisting">%include "macros.mac"
</pre>
<p>will include the contents of the file <code class="literal">macros.mac</code> into the
source file containing the <code class="literal">%include</code> directive.</p>
<p><a class="indexterm" name="idp59983920" id="idp59983920"></a> Include files are first
searched for relative to the directory containing the source file that is performing the
inclusion, and then relative to any directories specified on the Yasm command line using
the <code class="literal">-I</code> option (see <a class="xref" href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#yasm-option-i" title="1.3.3.3. -I путь: Добавление пути включаемых файлов">Раздел&nbsp;1.3.3.3</a>),
in the order given on the command line (any relative paths on the Yasm command line are
relative to the current working directory, e.g. where Yasm is being run from). While this
search strategy does not match traditional NASM behavior, it does match the behavior of
most C compilers and better handles relative pathnames.</p>
<p>The standard C idiom for preventing a file being included more than once is just as
applicable in the NASM preprocessor: if the file <code class="literal">macros.mac</code>
has the form</p>
<pre class="programlisting">%ifndef MACROS_MAC
    %define MACROS_MAC
    ; now define some macros
%endif
</pre>
<p>then including the file more than once will not cause errors, because the second time
the file is included nothing will happen because the macro <code class="literal">MACROS_MAC</code> will already be defined.</p>
<p>You can force a file to be included even if there is no <code class="literal">%include</code> directive that explicitly includes it, by using the <a class="indexterm" name="idp59989040" id="idp59989040"></a><code class="literal">-P</code>
option on the Yasm command line (see <a class="xref" href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#yasm-option-p" title="1.3.3.4. -P filename: Предварительное включение файла">Раздел&nbsp;1.3.3.4</a>).</p>
</div>
<div class="section" title="3.7. The Context Stack">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="nasm-macro-context-stack" id="nasm-macro-context-stack"></a>3.7. The Context Stack</h2>
</div>
</div>
</div>
<p><a class="indexterm" name="idp59991856" id="idp59991856"></a> Having labels that are
local to a macro definition is sometimes not quite powerful enough: sometimes you want to
be able to share labels between several macro calls. An example might be a <code class="literal">REPEAT</code> … <code class="literal">UNTIL</code> loop, in which the
expansion of the <code class="literal">REPEAT</code> macro would need to be able to refer
to a label which the <code class="literal">UNTIL</code> macro had defined. However, for
such a macro you would also want to be able to nest these loops.</p>
<p>The NASM preprocessor provides this level of power by means of a <span class="emphasis"><em>context stack</em></span>. The preprocessor maintains a stack of
<span class="emphasis"><em>contexts</em></span>, each of which is characterised by a
name. You add a new context to the stack using the <a class="indexterm" name="idp60000304" id="idp60000304"></a><code class="literal">%push</code> directive, and
remove one using <a class="indexterm" name="idp60001584" id="idp60001584"></a><code class="literal">%pop</code>. You can define labels that are local
to a particular context on the stack.</p>
<div class="section" title="3.7.1. %push and %pop: Creating and Removing Contexts">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="nasm-macro-pushpop" id="nasm-macro-pushpop"></a>3.7.1.
<code class="literal">%push</code> and <code class="literal">%pop</code>: Creating and
Removing Contexts</h3>
</div>
</div>
</div>
<p><a class="indexterm" name="idp60004784" id="idp60004784"></a> The <a class="indexterm" name="idp60005808" id="idp60005808"></a><code class="literal">%push</code> directive is
used to create a new context and place it on the top of the context stack. <code class="literal">%push</code> requires one argument, which is the name of the context. For
example:</p>
<pre class="programlisting">%push    foobar
</pre>
<p>This pushes a new context called <code class="literal">foobar</code> on the stack. You
can have several contexts on the stack with the same name: they can still be
distinguished.</p>
<p><a class="indexterm" name="idp60009264" id="idp60009264"></a> The directive <a class="indexterm" name="idp60010160" id="idp60010160"></a><code class="literal">%pop</code>,
requiring no arguments, removes the top context from the context stack and destroys it,
along with any labels associated with it.</p>
</div>
<div class="section" title="3.7.2. Context-Local Labels">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="nasm-macro-context-local" id="nasm-macro-context-local"></a>3.7.2. Context-Local Labels</h3>
</div>
</div>
</div>
<p><a class="indexterm" name="idp60012592" id="idp60012592"></a></p>
<p><a class="indexterm" name="idp60013744" id="idp60013744"></a> Just as the usage
<code class="literal">%%foo</code> defines a label which is local to the particular macro
call in which it is used, the usage <code class="literal">%$foo</code> is used to define
a label which is local to the context on the top of the context stack. So the
<code class="literal">REPEAT</code> and <code class="literal">UNTIL</code> example given
above could be implemented by means of:</p>
<pre class="programlisting">%macro repeat 0

    %push   repeat
    %$begin:

%endmacro

%macro until 1

        j%-1    %$begin
    %pop

%endmacro
</pre>
<p>and invoked by means of, for example,</p>
<pre class="programlisting">        mov     cx,string
        repeat
        add     cx,3
        scasb
        until   e
</pre>
<p>which would scan every fourth byte of a string in search of the byte in <code class="literal">AL</code>.</p>
<p><a class="indexterm" name="idp60019504" id="idp60019504"></a> If you need to define,
or access, labels local to the context <span class="emphasis"><em>below</em></span> the
top one on the stack, you can use <code class="literal">%$$foo</code>, or <code class="literal">%$$$foo</code> for the context below that, and so on.</p>
</div>
<div class="section" title="3.7.3. Context-Local Single-Line Macros">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="nasm-macro-context-define" id="nasm-macro-context-define"></a>3.7.3. Context-Local Single-Line Macros</h3>
</div>
</div>
</div>
<p><a class="indexterm" name="idp60027440" id="idp60027440"></a> The NASM preprocessor
also allows you to define single-line macros which are local to a particular context, in
just the same way:</p>
<pre class="programlisting">%define %$localmac 3
</pre>
<p>will define the single-line macro <code class="literal">%$localmac</code> to be local
to the top context on the stack. Of course, after a subsequent <code class="literal">%push</code>, it can then still be accessed by the name <code class="literal">%$$localmac</code>.</p>
</div>
<div class="section" title="3.7.4. %repl: Renaming a Context">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="nasm-macro-repl" id="nasm-macro-repl"></a>3.7.4. <code class="literal">%repl</code>: Renaming a Context</h3>
</div>
</div>
</div>
<p><a class="indexterm" name="idp60032304" id="idp60032304"></a> If you need to change
the name of the top context on the stack (in order, for example, to have it respond
differently to <code class="literal">%ifctx</code>), you can execute a <code class="literal">%pop</code> followed by a <code class="literal">%push</code>; but this will
have the side effect of destroying all context-local labels and macros associated with
the context that was just popped.</p>
<p>The NASM preprocessor provides the directive <a class="indexterm" name="idp60035248" id="idp60035248"></a><code class="literal">%repl</code>, which <span class="emphasis"><em>replaces</em></span> a context with a different name, without touching the
associated macros and labels. So you could replace the destructive code</p>
<pre class="programlisting">%pop
%push   newname
</pre>
<p>with the non-destructive version <code class="literal">%repl newname</code>.</p>
</div>
<div class="section" title="3.7.5. Example Use of the Context Stack: Block IFs">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="nasm-macro-block-if" id="nasm-macro-block-if"></a>3.7.5.
Example Use of the Context Stack: Block IFs</h3>
</div>
</div>
</div>
<p><a class="indexterm" name="idp60039472" id="idp60039472"></a> <a class="indexterm" name="idp60040368" id="idp60040368"></a> This example makes use of almost all the
context-stack features, including the conditional-assembly construct <a class="indexterm" name="idp60041264" id="idp60041264"></a><code class="literal">%ifctx</code>, to implement
a block IF statement as a set of macros.</p>
<pre class="programlisting">%macro if 1

    %push if
    j%-1  %$ifnot

%endmacro

%macro else 0

  %ifctx if
        %repl   else
        jmp     %$ifend
        %$ifnot:
  %else
        %error  "expected `if' before `else'"
  %endif

%endmacro

%macro endif 0

  %ifctx if
        %$ifnot:
        %pop
  %elifctx      else
        %$ifend:
        %pop
  %else
        %error  "expected `if' or `else' before `endif'"
  %endif

%endmacro
</pre>
<p>This code is more robust than the <code class="literal">REPEAT</code> and <code class="literal">UNTIL</code> macros given in <a class="xref" href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-macro-context-local" title="3.7.2. Context-Local Labels">Раздел&nbsp;3.7.2</a>, because it uses conditional
assembly to check that the macros are issued in the right order (for example, not calling
<code class="literal">endif</code> before <code class="literal">if</code>) and issues a
<code class="literal">%error</code> if they’re not.</p>
<p>In addition, the <code class="literal">endif</code> macro has to be able to cope with
the two distinct cases of either directly following an <code class="literal">if</code>,
or following an <code class="literal">else</code>. It achieves this, again, by using
conditional assembly to do different things depending on whether the context on top of
the stack is <code class="literal">if</code> or <code class="literal">else</code>.</p>
<p>The <code class="literal">else</code> macro has to preserve the context on the stack,
in order to have the <code class="literal">%$ifnot</code> referred to by the <code class="literal">if</code> macro be the same as the one defined by the <code class="literal">endif</code> macro, but has to change the context’s name so that <code class="literal">endif</code> will know there was an intervening <code class="literal">else</code>. It does this by the use of <code class="literal">%repl</code>.</p>
<p>A sample usage of these macros might look like:</p>
<pre class="programlisting">        cmp     ax,bx

        if ae
               cmp     bx,cx

               if ae
                       mov     ax,cx
               else
                       mov     ax,bx
               endif

        else
               cmp     ax,cx

               if ae
                       mov     ax,cx
               endif

        endif
</pre>
<p>The block-<code class="literal">IF</code> macros handle nesting quite happily, by
means of pushing another context, describing the inner <code class="literal">if</code>,
on top of the one describing the outer <code class="literal">if</code>; thus <code class="literal">else</code> and <code class="literal">endif</code> always refer to the last
unmatched <code class="literal">if</code> or <code class="literal">else</code>.</p>
</div>
</div>
<div class="section" title="3.8. Standard Macros">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="nasm-stdmac" id="nasm-stdmac"></a>3.8.
Standard Macros</h2>
</div>
</div>
</div>
<p><a class="indexterm" name="idp60063920" id="idp60063920"></a> Yasm defines a set of
standard macros in the NASM preprocessor which are already defined when it starts to
process any source file. If you really need a program to be assembled with no pre-defined
macros, you can use the <a class="indexterm" name="idp60064816" id="idp60064816"></a><code class="literal">%clear</code> directive to empty the preprocessor
of everything.</p>
<p><a class="indexterm" name="idp60066352" id="idp60066352"></a> Most user-level NASM
syntax directives (see <a class="xref" href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-directives" title="Глава 4. NASM Assembler Directives">Глава&nbsp;4</a>) are implemented as macros
which invoke primitive directives; these are described in <a class="xref" href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-directives" title="Глава 4. NASM Assembler Directives">Глава&nbsp;4</a>. The
rest of the standard macro set is described here.</p>
<div class="section" title="3.8.1. __YASM_MAJOR__, etc: Yasm Version">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="nasm-stdmac-version" id="nasm-stdmac-version"></a>3.8.1.
<code class="literal">__YASM_MAJOR__</code>, etc: Yasm Version</h3>
</div>
</div>
</div>
<p><a class="indexterm" name="idp60069552" id="idp60069552"></a> The single-line macros
<a class="indexterm" name="idp60070576" id="idp60070576"></a><code class="literal">__YASM_MAJOR__</code>, <a class="indexterm" name="idp60071856" id="idp60071856"></a><code class="literal">__YASM_MINOR__</code>, and <a class="indexterm" name="idp60073136" id="idp60073136"></a><code class="literal">__YASM_SUBMINOR__</code>
expand to the major, minor, and subminor parts of the <a class="indexterm" name="idp60074416" id="idp60074416"></a>version number of Yasm being used. In addition,
<a class="indexterm" name="idp60075056" id="idp60075056"></a><code class="literal">__YASM_VER__</code> expands to a string representation of the Yasm version and
<a class="indexterm" name="idp60076464" id="idp60076464"></a><code class="literal">__YASM_VERSION_ID__</code> expands to a 32-bit BCD-encoded representation of
the Yasm version, with the major version in the most significant 8 bits, followed by the
8-bit minor version and 8-bit subminor version, and 0 in the least significant 8 bits.
For example, under Yasm 0.5.1, <code class="literal">__YASM_MAJOR__</code> would be
defined to be 0, <code class="literal">__YASM_MINOR__</code> would be defined as 5,
<code class="literal">__YASM_SUBMINOR__</code> would be defined as 1, <code class="literal">__YASM_VER__</code> would be defined as <code class="literal">"0.5.1"</code>,
and <code class="literal">__YASM_VERSION_ID__</code> would be defined as <code class="literal">000050100h</code>.</p>
<p>In addition, the single line macro <a class="indexterm" name="idp60085936" id="idp60085936"></a><code class="literal">__YASM_BUILD__</code> expands to the Yasm
<span class="quote">«<span class="quote">build</span>»</span> number, typically the
Subversion changeset number. It should be seen as less significant than the subminor
version, and is generally only useful in discriminating between Yasm nightly snapshots or
pre-release (e.g. release candidate) Yasm versions.</p>
</div>
<div class="section" title="3.8.2. __FILE__ and __LINE__: File Name and Line Number">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="nasm-stdmac-fileline" id="nasm-stdmac-fileline"></a>3.8.2.
<code class="literal">__FILE__</code> and <code class="literal">__LINE__</code>: File
Name and Line Number</h3>
</div>
</div>
</div>
<p>Like the C preprocessor, the NASM preprocessor allows the user to find out the file
name and line number containing the current instruction. The macro <a class="indexterm" name="idp60089776" id="idp60089776"></a><code class="literal">__FILE__</code> expands to
a string constant giving the name of the current input file (which may change through the
course of assembly if <code class="literal">%include</code> directives are used), and
<a class="indexterm" name="idp60091696" id="idp60091696"></a><code class="literal">__LINE__</code> expands to a numeric constant giving the current line number in
the input file.</p>
<p>These macros could be used, for example, to communicate debugging information to a
macro, since invoking <code class="literal">__LINE__</code> inside a macro definition
(either single-line or multi-line) will return the line number of the macro <span class="emphasis"><em>call</em></span>, rather than <span class="emphasis"><em>definition</em></span>. So to determine where in a piece of code a crash
is occurring, for example, one could write a routine <code class="literal">stillhere</code>, which is passed a line number in <code class="literal">EAX</code> and outputs something like <span class="quote">«<span class="quote">line 155: still here</span>»</span>. You could then write a macro</p>
<pre class="programlisting">%macro notdeadyet 0
        push    eax
        mov     eax, __LINE__
        call    stillhere
        pop     eax
%endmacro
</pre>
<p>and then pepper your code with calls to <code class="literal">notdeadyet</code> until
you find the crash point.</p>
</div>
<div class="section" title="3.8.3. __YASM_OBJFMT__ and __OUTPUT_FORMAT__: Output Object Format Keyword">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="nasm-stdmac-output-format" id="nasm-stdmac-output-format"></a>3.8.3. <code class="literal">__YASM_OBJFMT__</code> and
<code class="literal">__OUTPUT_FORMAT__</code>: Output Object Format Keyword</h3>
</div>
</div>
</div>
<p><a class="indexterm" name="idp60103728" id="idp60103728"></a> <a class="indexterm" name="idp60104752" id="idp60104752"></a><code class="literal">__YASM_OBJFMT__</code>, and
its NASM-compatible alias <a class="indexterm" name="idp60106032" id="idp60106032"></a><code class="literal">__OUTPUT_FORMAT__</code>, expand to the object
format <em class="replaceable"><code>keyword</code></em> specified on the command line
with <code class="option">-f <em class="replaceable"><code>keyword</code></em></code>
(see <a class="xref" href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#yasm-option-oformat" title="1.3.1.2. -f format или --oformat=format: Выбор формата объекта">Раздел&nbsp;1.3.1.2</a>).
For example, if <span class="command"><strong>yasm</strong></span> is invoked with
<code class="option">-f elf</code>, <code class="literal">__YASM_OBJFMT__</code> expands
to <code class="literal">elf</code>.</p>
<p>These expansions match the option given on the command line exactly, even when the
object formats are equivalent. For example, <code class="option">-f elf</code> and
<code class="option">-f elf32</code> are equivalent specifiers for the 32-bit ELF format,
and <code class="option">-f elf -m amd64</code> and <code class="option">-f elf64</code>
are equivalent specifiers for the 64-bit ELF format, but <code class="literal">__YASM_OBJFMT__</code> would expand to <code class="literal">elf</code> and
<code class="literal">elf32</code> for the first two cases, and <code class="literal">elf</code> and <code class="literal">elf64</code> for the second two cases.</p>
</div>
<div class="section" title="3.8.4. STRUC and ENDSTRUC: Declaring Structure Data Types">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="nasm-stdmac-struc" id="nasm-stdmac-struc"></a>3.8.4.
<code class="literal">STRUC</code> and <code class="literal">ENDSTRUC</code>: Declaring
Structure Data Types</h3>
</div>
</div>
</div>
<p><a class="indexterm" name="idp60117552" id="idp60117552"></a> The NASM preprocessor is
sufficiently powerful that data structures can be implemented as a set of macros. The
macros <a class="indexterm" name="idp60118448" id="idp60118448"></a><code class="literal">STRUC</code> and <a class="indexterm" name="idp60128048" id="idp60128048"></a><code class="literal">ENDSTRUC</code> are used to define a structure
data type.</p>
<p><code class="literal">STRUC</code> takes one parameter, which is the name of the data
type. This name is defined as a symbol with the value zero, and also has the suffix
<code class="literal">_size</code> appended to it and is then defined as an <code class="literal">EQU</code> giving the size of the structure. Once <code class="literal">STRUC</code> has been issued, you are defining the structure, and should define
fields using the <code class="literal">RESB</code> family of pseudo-instructions, and
then invoke <code class="literal">ENDSTRUC</code> to finish the definition.</p>
<p>For example, to define a structure called <code class="literal">mytype</code>
containing a longword, a word, a byte and a string of bytes, you might code</p>
<pre class="programlisting">        struc   mytype
mt_long:        resd 1
mt_word:        resw 1
mt_byte:        resb 1
mt_str:         resb 32
        endstruc
</pre>
<p>The above code defines six symbols: <code class="literal">mt_long</code> as 0 (the
offset from the beginning of a <code class="literal">mytype</code> structure to the
longword field), <code class="literal">mt_word</code> as 4, <code class="literal">mt_byte</code> as 6, <code class="literal">mt_str</code> as 7, <code class="literal">mytype_size</code> as 39, and <code class="literal">mytype</code> itself as
zero.</p>
<p>The reason why the structure type name is defined at zero is a side effect of allowing
structures to work with the local label mechanism: if your structure members tend to have
the same names in more than one structure, you can define the above structure like
this:</p>
<pre class="programlisting">        struc   mytype
.long:  resd 1
.word:  resw 1
.byte:  resb 1
.str:   resb 32
        endstruc
</pre>
<p>This defines the offsets to the structure fields as <code class="literal">mytype.long</code>, <code class="literal">mytype.word</code>, <code class="literal">mytype.byte</code> and <code class="literal">mytype.str</code>.</p>
<p>Since NASM syntax has no <span class="emphasis"><em>intrinsic</em></span> structure
support, does not support any form of period notation to refer to the elements of a
structure once you have one (except the above local-label notation), so code such as
<code class="literal">mov ax,[mystruc.mt_word]</code> is not valid. <code class="literal">mt_word</code> is a constant just like any other constant, so the correct
syntax is <code class="literal">mov ax,[mystruc+mt_word]</code> or <code class="literal">mov ax,[mystruc+mytype.word]</code>.</p>
</div>
<div class="section" title="3.8.5. ISTRUC, AT and IEND: Declaring Instances of Structures">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="nasm-stdmac-istruc" id="nasm-stdmac-istruc"></a>3.8.5.
<code class="literal">ISTRUC</code>, <code class="literal">AT</code> and <code class="literal">IEND</code>: Declaring Instances of Structures</h3>
</div>
</div>
</div>
<p><a class="indexterm" name="idp60146992" id="idp60146992"></a> <a class="indexterm" name="idp60147888" id="idp60147888"></a> Having defined a structure type, the next thing
you typically want to do is to declare instances of that structure in your data segment.
The NASM preprocessor provides an easy way to do this in the <a class="indexterm" name="idp60149040" id="idp60149040"></a><code class="literal">ISTRUC</code> mechanism. To
declare a structure of type <code class="literal">mytype</code> in a program, you code
something like this:</p>
<pre class="programlisting">mystruc:        istruc  mytype
        at mt_long, dd 123456
        at mt_word, dw 1024
        at mt_byte, db 'x'
        at mt_str,  db 'hello, world', 13, 10, 0
                iend
</pre>
<p>The function of the <a class="indexterm" name="idp60151728" id="idp60151728"></a><code class="literal">AT</code> macro is to make use of the
<code class="literal">TIMES</code> prefix to advance the assembly position to the correct
point for the specified structure field, and then to declare the specified data.
Therefore the structure fields must be declared in the same order as they were specified
in the structure definition.</p>
<p>If the data to go in a structure field requires more than one source line to specify,
the remaining source lines can easily come after the <code class="literal">AT</code>
line. For example:</p>
<pre class="programlisting">        at mt_str, db 123,134,145,156,167,178,189
        db 190,100,0
</pre>
<p>Depending on personal taste, you can also omit the code part of the <code class="literal">AT</code> line completely, and start the structure field on the next line:</p>
<pre class="programlisting">        at mt_str
        db 'hello, world'
        db 13,10,0
</pre></div>
<div class="section" title="3.8.6. ALIGN and ALIGNB: Data Alignment">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="nasm-stdmac-align" id="nasm-stdmac-align"></a>3.8.6.
<code class="literal">ALIGN</code> and <code class="literal">ALIGNB</code>: Data
Alignment</h3>
</div>
</div>
</div>
<p>The <a class="indexterm" name="idp60162736" id="idp60162736"></a><code class="literal">ALIGN</code> and <a class="indexterm" name="idp60164016" id="idp60164016"></a><code class="literal">ALIGNB</code> macros provide a convenient way to
align code or data on a word, longword, paragraph or other boundary. The syntax of the
<code class="literal">ALIGN</code> and <code class="literal">ALIGNB</code> macros is</p>
<pre class="programlisting">        align 4                 ; align on 4-byte boundary
        align 16                ; align on 16-byte boundary
        align 16,nop            ; equivalent to previous line
        align 8,db 0            ; pad with 0s rather than NOPs
        align 4,resb 1          ; align to 4 in the BSS
        alignb 4                ; equivalent to previous line
</pre>
<p>Both macros require their first argument to be a power of two; they both compute the
number of additional bytes required to bring the length of the current section up to a
multiple of that power of two, and output either NOP fill or apply the <code class="literal">TIMES</code> prefix to their second argument to perform the alignment.</p>
<p>If the second argument is not specified, the default for <code class="literal">ALIGN</code> is <code class="literal">NOP</code>, and the default for
<code class="literal">ALIGNB</code> is <code class="literal">RESB 1</code>. <code class="literal">ALIGN</code> treats a <code class="literal">NOP</code> argument specially by
generating maximal NOP fill instructions (not necessarily NOP opcodes) for the current
<code class="literal">BITS</code> setting, whereas <code class="literal">ALIGNB</code>
takes its second argument literally. Otherwise, the two macros are equivalent when a
second argument is specified. Normally, you can just use <code class="literal">ALIGN</code> in code and data sections and <code class="literal">ALIGNB</code>
in BSS sections, and never need the second argument except for special purposes.</p>
<p><code class="literal">ALIGN</code> and <code class="literal">ALIGNB</code>, being
simple macros, perform no error checking: they cannot warn you if their first argument
fails to be a power of two, or if their second argument generates more than one byte of
code. In each of these cases they will silently do the wrong thing.</p>
<p><code class="literal">ALIGNB</code> (or <code class="literal">ALIGN</code> with a
second argument of <code class="literal">RESB 1</code>) can be used within structure
definitions:</p>
<pre class="programlisting">        struc   mytype2
mt_byte:        resb 1
                alignb 2
mt_word:        resw 1
                alignb 4
mt_long:        resd 1
mt_str:         resb 32
        endstruc
</pre>
<p>This will ensure that the structure members are sensibly aligned relative to the base
of the structure.</p>
<p>A final caveat: <code class="literal">ALIGNB</code> works relative to the beginning of
the <span class="emphasis"><em>section</em></span>, not the beginning of the address
space in the final executable. Aligning to a 16-byte boundary when the section you’re
in is only guaranteed to be aligned to a 4-byte boundary, for example, is a waste of
effort. Again, Yasm does not check that the section’s alignment characteristics are
sensible for the use of <code class="literal">ALIGNB</code>. <code class="literal">ALIGN</code> is more intelligent and <span class="emphasis"><em>does</em></span> adjust the section alignment to be the maximum specified
alignment.</p>
</div>
</div>
</div>
<div class="chapter" title="Глава 4. NASM Assembler Directives">
<div class="titlepage">
<div>
<div>
<h2 class="title"><a name="nasm-directives" id="nasm-directives"></a>Глава 4. NASM
Assembler Directives</h2>
</div>
</div>
</div>
<div class="toc">
<p><b>Содержание</b></p>
<dl>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-directive-bits-top">4.1. Specifying Target
Processor Mode</a></span></dt>
<dd>
<dl>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-directive-bits">4.1.1. <code class="literal">BITS</code></a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-directive-use16use32use64">4.1.2. <code class="literal">USE16</code>, <code class="literal">USE32</code>, and <code class="literal">USE64</code></a></span></dt>
</dl>
</dd>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-directive-default">4.2. <code class="literal">DEFAULT</code>: Change the assembler defaults</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-directive-section-top">4.3. Changing and
Defining Sections</a></span></dt>
<dd>
<dl>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-directive-section">4.3.1. <code class="literal">SECTION</code> and <code class="literal">SEGMENT</code></a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-directive-section-standard-name">4.3.2.
Standardized Section Names</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-directive-section-macro">4.3.3. The <code class="literal">__SECT__</code> Macro</a></span></dt>
</dl>
</dd>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-directive-absolute">4.4. <code class="literal">ABSOLUTE</code>: Defining Absolute Labels</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-directive-extern">4.5. <code class="literal">EXTERN</code>: Importing Symbols</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-directive-global">4.6. <code class="literal">GLOBAL</code>: Exporting Symbols</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-directive-common">4.7. <code class="literal">COMMON</code>: Defining Common Data Areas</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-directive-cpu">4.8. <code class="literal">CPU</code>: Defining CPU Dependencies</a></span></dt>
</dl>
</div>
<p><a class="indexterm" name="idp60185904" id="idp60185904"></a> NASM, though it attempts
to avoid the bureaucracy of assemblers like MASM and TASM, is nevertheless forced to
support a <span class="emphasis"><em>few</em></span> directives. These are described in
this chapter.</p>
<p><a class="indexterm" name="idp60187440" id="idp60187440"></a> <a class="indexterm" name="idp60188336" id="idp60188336"></a> NASM’s directives come in two types:
<span class="emphasis"><em>user-level</em></span> directives and <span class="emphasis"><em>primitive</em></span> directives. Typically, each directive has a
user-level form and a primitive form. In almost all cases, we recommend that users use
the user-level forms of the directives, which are implemented as macros which call the
primitive forms.</p>
<p>Primitive directives are enclosed in square brackets; user-level directives are
not.</p>
<p><a class="indexterm" name="idp60190640" id="idp60190640"></a> In addition to the
universal directives described in this chapter, each object file format can optionally
supply extra directives in order to control particular features of that file format.
These <span class="emphasis"><em>format-specific</em></span> directives are documented
along with the formats that implement them, in <a class="xref" href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#objfmts" title="Часть V. Object Formats">Часть&nbsp;V</a>.</p>
<div class="section" title="4.1. Specifying Target Processor Mode">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="nasm-directive-bits-top" id="nasm-directive-bits-top"></a>4.1. Specifying Target Processor Mode</h2>
</div>
</div>
</div>
<p><a class="indexterm" name="idp60201648" id="idp60201648"></a></p>
<div class="section" title="4.1.1. BITS">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="nasm-directive-bits" id="nasm-directive-bits"></a>4.1.1.
<code class="literal">BITS</code></h3>
</div>
</div>
</div>
<p><a class="indexterm" name="idp60203696" id="idp60203696"></a> <a class="indexterm" name="idp60204848" id="idp60204848"></a> <a class="indexterm" name="idp60205744" id="idp60205744"></a> <a class="indexterm" name="idp60206896" id="idp60206896"></a>
<a class="indexterm" name="idp60207792" id="idp60207792"></a> The <a class="indexterm" name="idp60208688" id="idp60208688"></a><code class="literal">BITS</code> directive
specifies whether Yasm should generate code designed to run on a processor operating in
16-bit mode, 32-bit mode, or 64-bit mode. The syntax is <code class="literal">BITS
16</code>, <code class="literal">BITS 32</code>, or <code class="literal">BITS
64</code>.</p>
<p>In most cases, you should not need to use <code class="literal">BITS</code>
explicitly. The <code class="literal">coff</code>, <code class="literal">elf32</code>,
<code class="literal">macho32</code>, and <code class="literal">win32</code> object
formats, which are designed for use in 32-bit operating systems, all cause Yasm to select
32-bit mode by default. The <code class="literal">elf64</code>, <code class="literal">macho64</code>, and <code class="literal">win64</code> object formats, which
are designed for use in 64-bit operating systems, both cause Yasm to select 64-bit mode
by default. The <code class="literal">xdf</code> object format allows you to specify each
segment you define as <code class="literal">USE16</code>, <code class="literal">USE32</code>, or <code class="literal">USE64</code>, and Yasm will set its
operating mode accordingly, so the use of the <code class="literal">BITS</code> directive
is once again unnecessary.</p>
<p>The most likely reason for using the <code class="literal">BITS</code> directive is to
write 32-bit or 64-bit code in a flat binary file; this is because the <code class="literal">bin</code> object format defaults to 16-bit mode in anticipation of it being
used most frequently to write DOS <code class="literal">.COM</code> programs, DOS
<code class="literal">.SYS</code> device drivers and boot loader software.</p>
<p>You do <span class="emphasis"><em>not</em></span> need to specify <code class="literal">BITS 32</code> merely in order to use 32-bit instructions in a 16-bit DOS
program; if you do, the assembler will generate incorrect code because it will be writing
code targeted at a 32-bit platform, to be run on a 16-bit one. However, it <span class="emphasis"><em>is</em></span> necessary to specify <code class="literal">BITS 64</code>
to use 64-bit instructions and registers; this is done to allow use of those instruction
and register names in 32-bit or 16-bit programs, although such use will generate a
warning.</p>
<p>When Yasm is in <code class="literal">BITS 16</code> mode, instructions which use
32-bit data are prefixed with an 0x66 byte, and those referring to 32-bit addresses have
an 0x67 prefix. In <code class="literal">BITS 32</code> mode, the reverse is true: 32-bit
instructions require no prefixes, whereas instructions using 16-bit data need an 0x66 and
those working in 16-bit addresses need an 0x67.</p>
<p>When Yasm is in <code class="literal">BITS 64</code> mode, 32-bit instructions usually
require no prefixes, and most uses of 64-bit registers or data size requires a REX
prefix. Yasm automatically inserts REX prefixes where necessary. There are also 8 more
general and SSE registers, and 16-bit addressing is no longer supported. The default
address size is 64 bits; 32-bit addressing can be selected with the 0x67 prefix. The
default operand size is still 32 bits, however, and the 0x66 prefix selects 16-bit
operand size. The REX prefix is used both to select 64-bit operand size, and to access
the new registers. A few instructions have a default 64-bit operand size.</p>
<p>When the REX prefix is used, the processor does not know how to address the
<code class="literal">AH</code>, <code class="literal">BH</code>, <code class="literal">CH</code> or <code class="literal">DH</code> (high 8-bit legacy) registers.
Instead, it is possible to access the the low 8-bits of the <code class="literal">SP</code>, <code class="literal">BP</code> <code class="literal">SI</code>, and
<code class="literal">DI</code> registers as <code class="literal">SPL</code>,
<code class="literal">BPL</code>, <code class="literal">SIL</code>, and <code class="literal">DIL</code>, respectively; but only when the REX prefix is used.</p>
<p>The <code class="literal">BITS</code> directive has an exactly equivalent primitive
form, <code class="literal">[BITS 16]</code>, <code class="literal">[BITS 32]</code>, and
<code class="literal">[BITS 64]</code>. The user-level form is a macro which has no
function other than to call the primitive form.</p>
</div>
<div class="section" title="4.1.2. USE16, USE32, and USE64">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="nasm-directive-use16use32use64" id="nasm-directive-use16use32use64"></a>4.1.2. <code class="literal">USE16</code>,
<code class="literal">USE32</code>, and <code class="literal">USE64</code></h3>
</div>
</div>
</div>
<p>The <a class="indexterm" name="idp60270256" id="idp60270256"></a><code class="literal">USE16</code>, <a class="indexterm" name="idp60271536" id="idp60271536"></a><code class="literal">USE32</code>, and <a class="indexterm" name="idp60272816" id="idp60272816"></a><code class="literal">USE64</code> directives can be
used in place of <code class="literal">BITS 16</code>, <code class="literal">BITS
32</code>, and <code class="literal">BITS 64</code> respectively for compatibility with
other assemblers.</p>
</div>
</div>
<div class="section" title="4.2. DEFAULT: Change the assembler defaults">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="nasm-directive-default" id="nasm-directive-default"></a>4.2. <code class="literal">DEFAULT</code>: Change the
assembler defaults</h2>
</div>
</div>
</div>
<p>The <a class="indexterm" name="idp60281648" id="idp60281648"></a><code class="literal">DEFAULT</code> directive changes the assembler defaults. Normally, Yasm
defaults to a mode where the programmer is expected to explicitly specify most features
directly. However, sometimes this is not desirable if a certain behavior is very
commmonly used.</p>
<p>Currently, the only <code class="literal">DEFAULT</code> that is settable is whether
or not registerless effective addresses in 64-bit mode are <code class="literal">RIP</code>-relative or not. By default, they are absolute unless overridden
with the <a class="indexterm" name="idp60284336" id="idp60284336"></a><code class="literal">REL</code> specifier (see <a class="xref" href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-effaddr" title="2.3. Effective Addresses">Раздел&nbsp;2.3</a>). However, if <code class="literal">DEFAULT REL</code> is specified, <code class="literal">REL</code> is default,
unless overridden with the <a class="indexterm" name="idp60287024" id="idp60287024"></a><code class="literal">ABS</code> specifier, a <code class="literal">FS</code> or <code class="literal">GS</code> segment override is used, or
another register is part of the effective address.</p>
<p>The special handling of <code class="literal">FS</code> and <code class="literal">GS</code> overrides are due to the fact that these segments are the only
segments which can have non-0 base addresses in 64-bit mode, and thus are generally used
as thread pointers or other special functions. With a non-zero base address, generating
<code class="literal">RIP</code>-relative addresses for these forms would be extremely
confusing. Other segment registers such as <code class="literal">DS</code> always have a
base address of 0, so RIP-relative access still makes sense.</p>
<p><code class="literal">DEFAULT REL</code> is disabled with <code class="literal">DEFAULT ABS</code>. The default mode of the assembler at start-up is
<code class="literal">DEFAULT ABS</code>.</p>
</div>
<div class="section" title="4.3. Changing and Defining Sections">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="nasm-directive-section-top" id="nasm-directive-section-top"></a>4.3. Changing and Defining Sections</h2>
</div>
</div>
</div>
<p><a class="indexterm" name="idp60294832" id="idp60294832"></a> <a class="indexterm" name="idp60295856" id="idp60295856"></a> <a class="indexterm" name="idp60296752" id="idp60296752"></a></p>
<div class="section" title="4.3.1. SECTION and SEGMENT">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="nasm-directive-section" id="nasm-directive-section"></a>4.3.1.
<code class="literal">SECTION</code> and <code class="literal">SEGMENT</code></h3>
</div>
</div>
</div>
<p>The <a class="indexterm" name="idp60299440" id="idp60299440"></a><code class="literal">SECTION</code> directive (((<code class="literal">SEGMENT</code>)) is an
exactly equivalent synonym) changes which section of the output file the code you write
will be assembled into. In some object file formats, the number and names of sections are
fixed; in others, the user may make up as many as they wish. Hence <code class="literal">SECTION</code> may sometimes give an error message, or may define a new
section, if you try to switch to a section that does not (yet) exist.</p>
</div>
<div class="section" title="4.3.2. Standardized Section Names">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="nasm-directive-section-standard-name" id="nasm-directive-section-standard-name"></a>4.3.2. Standardized Section Names</h3>
</div>
</div>
</div>
<p>The Unix object formats, and the <code class="literal">bin</code> object format, all
support the <a class="indexterm" name="idp60303536" id="idp60303536"></a>standardised
section names <code class="literal">.text</code>, <code class="literal">.data</code> and
<code class="literal">.bss</code> for the code, data and uninitialised-data sections. The
<code class="literal">obj</code> format, by contrast, does not recognise these section
names as being special, and indeed will strip off the leading period of any section name
that has one.</p>
</div>
<div class="section" title="4.3.3. The __SECT__ Macro">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="nasm-directive-section-macro" id="nasm-directive-section-macro"></a>4.3.3. The <code class="literal">__SECT__</code>
Macro</h3>
</div>
</div>
</div>
<p>The <code class="literal">SECTION</code> directive is unusual in that its user-level
form functions differently from its primitive form. The primitive form, <code class="literal">[SECTION xyz]</code>, simply switches the current target section to the one
given. The user-level form, <code class="literal">SECTION xyz</code>, however, first
defines the single-line macro <a class="indexterm" name="idp60313904" id="idp60313904"></a><code class="literal">__SECT__</code> to be the primitive <code class="literal">[SECTION]</code> directive which it is about to issue, and then issues it. So
the user-level directive</p>
<pre class="programlisting">        SECTION .text
</pre>
<p>expands to the two lines</p>
<pre class="programlisting">%define __SECT__ [SECTION .text]
        [SECTION .text]
</pre>
<p>Users may find it useful to make use of this in their own macros. For example, the
<code class="literal">writefile</code> macro defined in the NASM Manual can be usefully
rewritten in the following more sophisticated form:</p>
<pre class="programlisting">%macro writefile 2+
        [section .data]
%%str:  db %2
%%endstr:
        __SECT__
        mov dx,%%str
        mov cx,%%endstr-%%str
        mov bx,%1
        mov ah,0x40
        int 0x21
%endmacro
</pre>
<p>This form of the macro, once passed a string to output, first switches temporarily to
the data section of the file, using the primitive form of the <code class="literal">SECTION</code> directive so as not to modify <code class="literal">__SECT__</code>. It then declares its string in the data section, and then
invokes <code class="literal">__SECT__</code> to switch back to <span class="emphasis"><em>whichever</em></span> section the user was previously working in. It thus
avoids the need, in the previous version of the macro, to include a <code class="literal">JMP</code> instruction to jump over the data, and also does not fail if, in a
complicated <code class="literal">OBJ</code> format module, the user could potentially be
assembling the code in any of several separate code sections.</p>
</div>
</div>
<div class="section" title="4.4. ABSOLUTE: Defining Absolute Labels">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="nasm-directive-absolute" id="nasm-directive-absolute"></a>4.4. <code class="literal">ABSOLUTE</code>: Defining
Absolute Labels</h2>
</div>
</div>
</div>
<p>The <a class="indexterm" name="idp60323888" id="idp60323888"></a><code class="literal">ABSOLUTE</code> directive can be thought of as an alternative form of
<code class="literal">SECTION</code>: it causes the subsequent code to be directed at no
physical section, but at the hypothetical section starting at the given absolute address.
The only instructions you can use in this mode are the <code class="literal">RESB</code>
family.</p>
<p><code class="literal">ABSOLUTE</code> is used as follows:</p>
<pre class="programlisting">        ABSOLUTE 0x1A
kbuf_chr        resw 1
kbuf_free       resw 1
kbuf            resw 16
</pre>
<p>This example describes a section of the PC BIOS data area, at segment address 0x40:
the above code defines <code class="literal">kbuf_chr</code> to be 0x1A, <code class="literal">kbuf_free</code> to be 0x1C, and <code class="literal">kbuf</code> to be
0x1E.</p>
<p>The user-level form of <code class="literal">ABSOLUTE</code>, like that of
<code class="literal">SECTION</code>, redefines the <a class="indexterm" name="idp60330928" id="idp60330928"></a><code class="literal">__SECT__</code> macro when it is
invoked.</p>
<p><a class="indexterm" name="idp60332464" id="idp60332464"></a><code class="literal">STRUC</code> and <a class="indexterm" name="idp60337968" id="idp60337968"></a><code class="literal">ENDSTRUC</code> are defined as macros which use
<code class="literal">ABSOLUTE</code> (and also <code class="literal">__SECT__</code>).</p>
<p><code class="literal">ABSOLUTE</code> doesn’t have to take an absolute constant as
an argument: it can take an expression (actually, a <a class="indexterm" name="idp60341040" id="idp60341040"></a>critical expression: see <a class="xref" href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-crit" title="2.8. Critical Expressions">Раздел&nbsp;2.8</a>) and it can be a
value in a segment. For example, a TSR can re-use its setup code as run-time BSS like
this:</p>
<pre class="programlisting">        org 100h                ; it's a .COM program
        jmp setup               ; setup code comes last
        ; the resident part of the TSR goes here
setup:  ; now write the code that installs the TSR here
        absolute setup
runtimevar1 resw 1
runtimevar2 resd 20
tsr_end:
</pre>
<p>This defines some variables <span class="quote">«<span class="quote">on top
of</span>»</span> the setup code, so that after the setup has finished running, the
space it took up can be re-used as data storage for the running TSR. The symbol
<span class="quote">«<span class="quote">tsr_end</span>»</span> can be used to
calculate the total size of the part of the TSR that needs to be made resident.</p>
</div>
<div class="section" title="4.5. EXTERN: Importing Symbols">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="nasm-directive-extern" id="nasm-directive-extern"></a>4.5. <code class="literal">EXTERN</code>: Importing
Symbols</h2>
</div>
</div>
</div>
<p><a class="indexterm" name="idp60345392" id="idp60345392"></a> <a class="indexterm" name="idp60346288" id="idp60346288"></a><code class="literal">EXTERN</code> is similar to
the MASM directive <code class="literal">EXTRN</code> and the C keyword <code class="literal">extern</code>: it is used to declare a symbol which is not defined anywhere in
the module being assembled, but is assumed to be defined in some other module and needs
to be referred to by this one. Not every object-file format can support external
variables: the <code class="literal">bin</code> format cannot.</p>
<p>The <code class="literal">EXTERN</code> directive takes as many arguments as you like.
Each argument is the name of a symbol:</p>
<pre class="programlisting">        extern _printf
        extern _sscanf, _fscanf
</pre>
<p>Some object-file formats provide extra features to the <code class="literal">EXTERN</code> directive. In all cases, the extra features are used by suffixing
a colon to the symbol name followed by object-format specific text. For example, the
<code class="literal">obj</code> format allows you to declare that the default segment
base of an external should be the group <code class="literal">dgroup</code> by means of
the directive</p>
<pre class="programlisting">        extern _variable:wrt dgroup
</pre>
<p>The primitive form of <code class="literal">EXTERN</code> differs from the user-level
form only in that it can take only one argument at a time: the support for multiple
arguments is implemented at the preprocessor level.</p>
<p>You can declare the same variable as <code class="literal">EXTERN</code> more than
once: NASM will quietly ignore the second and later redeclarations. You can’t declare a
variable as <code class="literal">EXTERN</code> as well as something else, though.</p>
</div>
<div class="section" title="4.6. GLOBAL: Exporting Symbols">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="nasm-directive-global" id="nasm-directive-global"></a>4.6. <code class="literal">GLOBAL</code>: Exporting
Symbols</h2>
</div>
</div>
</div>
<p><a class="indexterm" name="idp60356912" id="idp60356912"></a> <a class="indexterm" name="idp60357808" id="idp60357808"></a><code class="literal">GLOBAL</code> is the other
end of <code class="literal">EXTERN</code>: if one module declares a symbol as
<code class="literal">EXTERN</code> and refers to it, then in order to prevent linker
errors, some other module must actually <span class="emphasis"><em>define</em></span> the
symbol and declare it as <code class="literal">GLOBAL</code>. Some assemblers use the
name <a class="indexterm" name="idp60361008" id="idp60361008"></a><code class="literal">PUBLIC</code> for this purpose.</p>
<p>The <code class="literal">GLOBAL</code> directive applying to a symbol must appear
<span class="emphasis"><em>before</em></span> the definition of the symbol.</p>
<p><code class="literal">GLOBAL</code> uses the same syntax as <code class="literal">EXTERN</code>, except that it must refer to symbols which <span class="emphasis"><em>are</em></span> defined in the same module as the <code class="literal">GLOBAL</code> directive. For example:</p>
<pre class="programlisting">        global _main
_main:  ; some code
</pre>
<p><code class="literal">GLOBAL</code>, like <code class="literal">EXTERN</code>, allows
object formats to define private extensions by means of a colon. The <code class="literal">elf</code> object format, for example, lets you specify whether global data
items are functions or data:</p>
<pre class="programlisting">        global hashlookup:function, hashtable:data
</pre>
<p>Like <code class="literal">EXTERN</code>, the primitive form of <code class="literal">GLOBAL</code> differs from the user-level form only in that it can take only
one argument at a time.</p>
</div>
<div class="section" title="4.7. COMMON: Defining Common Data Areas">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="nasm-directive-common" id="nasm-directive-common"></a>4.7. <code class="literal">COMMON</code>: Defining Common
Data Areas</h2>
</div>
</div>
</div>
<p><a class="indexterm" name="idp60379952" id="idp60379952"></a> The <a class="indexterm" name="idp60380848" id="idp60380848"></a><code class="literal">COMMON</code> directive is
used to declare <span class="emphasis"><em>common variables</em></span>. A common
variable is much like a global variable declared in the uninitialised data section, so
that</p>
<pre class="programlisting">        common intvar 4
</pre>
<p>is similar in function to</p>
<pre class="programlisting">        global intvar
        section .bss
intvar  resd 1
</pre>
<p>The difference is that if more than one module defines the same common variable, then
at link time those variables will be <span class="emphasis"><em>merged</em></span>, and
references to <code class="literal">intvar</code> in all modules will point at the same
piece of memory.</p>
<p>Like <code class="literal">GLOBAL</code> and <code class="literal">EXTERN</code>,
<code class="literal">COMMON</code> supports object-format specific extensions. For
example, the <code class="literal">obj</code> format allows common variables to be NEAR
or FAR, and the <code class="literal">elf</code> format allows you to specify the
alignment requirements of a common variable:</p>
<pre class="programlisting">        common commvar 4:near   ; works in OBJ
        common intarray 100:4   ; works in ELF: 4 byte aligned
</pre>
<p>Once again, like <code class="literal">EXTERN</code> and <code class="literal">GLOBAL</code>, the primitive form of <code class="literal">COMMON</code>
differs from the user-level form only in that it can take only one argument at a
time.</p>
</div>
<div class="section" title="4.8. CPU: Defining CPU Dependencies">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="nasm-directive-cpu" id="nasm-directive-cpu"></a>4.8. <code class="literal">CPU</code>: Defining CPU
Dependencies</h2>
</div>
</div>
</div>
<p>The <a class="indexterm" name="idp60392624" id="idp60392624"></a><code class="literal">CPU</code> directive restricts assembly to those instructions which are
available on the specified CPU. See <a class="xref" href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#architectures" title="Часть VII. Architectures">Часть&nbsp;VII</a> for <code class="literal">CPU</code> options for various architectures.</p>
<p>All options are case insensitive. Instructions will be enabled only if they apply to
the selected cpu or lower.</p>
</div>
</div>
</div>
<div class="part" title="Часть IV. GAS Syntax">
<div class="titlepage">
<div>
<div>
<h1 class="title"><a name="gas" id="gas"></a>Часть&nbsp;IV.&nbsp;GAS Syntax</h1>
</div>
</div>
</div>
<div class="partintro" title="GAS Syntax">
<p>The chapters in this part of the book document the GNU AS-compatible syntax accepted
by the Yasm <span class="quote">«<span class="quote">gas</span>»</span> parser.</p>
<div class="toc">
<p><b>Содержание</b></p>
<dl>
<dt><span class="chapter"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#_tbd">5. TBD</a></span></dt>
</dl>
</div>
</div>
<div class="chapter" title="Глава 5. TBD">
<div class="titlepage">
<div>
<div>
<h2 class="title"><a name="_tbd"></a>Глава 5. TBD</h2>
</div>
</div>
</div>
<p>To be written.</p>
</div>
</div>
<div class="part" title="Часть V. Object Formats">
<div class="titlepage">
<div>
<div>
<h1 class="title"><a name="objfmts" id="objfmts"></a>Часть&nbsp;V.&nbsp;Object Formats</h1>
</div>
</div>
</div>
<div class="partintro" title="Object Formats">
<p>The chapters in this part of the book document Yasm’s support for various object
file formats.</p>
<div class="toc">
<p><b>Содержание</b></p>
<dl>
<dt><span class="chapter"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#objfmt-bin">6. <code class="literal">bin</code>:
Flat-Form Binary Output</a></span></dt>
<dd>
<dl>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#objfmt-bin-org">6.1. <code class="literal">ORG</code>: Binary Origin</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#objfmt-bin-section">6.2. <code class="literal">bin</code> Extensions to the <code class="literal">SECTION</code>
Directive</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#objfmt-bin-ssym">6.3. <code class="literal">bin</code> Special Symbols</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#objfmt-bin-map">6.4. Map Files</a></span></dt>
</dl>
</dd>
<dt><span class="chapter"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#objfmt-coff">7. <code class="literal">coff</code>:
Common Object File Format</a></span></dt>
<dt><span class="chapter"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#objfmt-elf32">8. <code class="literal">elf32</code>:
Executable and Linkable Format 32-bit Object Files</a></span></dt>
<dd>
<dl>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#objfmt-elf-dbgfmts">8.1. Debugging Format
Support</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#objfmt-elf-section">8.2. ELF Sections</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#objfmt-elf-directives">8.3. ELF
Directives</a></span></dt>
<dd>
<dl>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#objfmt-elf-dir-ident">8.3.1. <code class="literal">IDENT</code>: Add file identification</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#objfmt-elf-dir-size">8.3.2. <code class="literal">SIZE</code>: Set symbol size</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#objfmt-elf-dir-type">8.3.3. <code class="literal">TYPE</code>: Set symbol type</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#objfmt-elf-dir-weak">8.3.4. <code class="literal">WEAK</code>: Create weak symbol</a></span></dt>
</dl>
</dd>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#objfmt-elf-dir-global">8.4. ELF Extensions to the
<code class="literal">GLOBAL</code> Directive</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#objfmt-elf-dir-common">8.5. ELF Extensions to the
<code class="literal">COMMON</code> Directive</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#objfmt-elf32-wrt">8.6. <code class="literal">elf32</code> Special Symbols and <code class="literal">WRT</code></a></span></dt>
</dl>
</dd>
<dt><span class="chapter"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#objfmt-elf64">9. <code class="literal">elf64</code>:
Executable and Linkable Format 64-bit Object Files</a></span></dt>
<dd>
<dl>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#objfmt-elf64-wrt">9.1. <code class="literal">elf64</code> Special Symbols and <code class="literal">WRT</code></a></span></dt>
</dl>
</dd>
<dt><span class="chapter"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#objfmt-macho32">10. <code class="literal">macho32</code>: Mach 32-bit Object File Format</a></span></dt>
<dt><span class="chapter"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#objfmt-macho64">11. <code class="literal">macho64</code>: Mach 64-bit Object File Format</a></span></dt>
<dt><span class="chapter"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#objfmt-rdf">12. <code class="literal">rdf</code>:
Relocatable Dynamic Object File Format</a></span></dt>
<dt><span class="chapter"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#objfmt-win32">13. <code class="literal">win32</code>:
Microsoft Win32 Object Files</a></span></dt>
<dt><span class="chapter"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#objfmt-win64">14. <code class="literal">win64</code>:
PE32+ (Microsoft Win64) Object Files</a></span></dt>
<dd>
<dl>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#objfmt-win64-section">14.1. <code class="literal">win64</code> Extensions to the <code class="literal">SECTION</code>
Directive</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#objfmt-win64-exception">14.2. <code class="literal">win64</code> Structured Exception Handling</a></span></dt>
<dd>
<dl>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#objfmt-win64-calling-convention">14.2.1. x64 Stack,
Register and Function Parameter Conventions</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#objfmt-win64-function-types">14.2.2. Types of
Functions</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#objfmt-win64-function-structure">14.2.3. Frame
Function Structure</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#objfmt-win64-frame-details">14.2.4. Stack Frame
Details</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#objfmt-win64-unwind-primitives">14.2.5. Yasm
Primitives for Unwind Operations</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#objfmt-win64-unwind-macros">14.2.6. Yasm Macros for
Formal Stack Operations</a></span></dt>
</dl>
</dd>
</dl>
</dd>
<dt><span class="chapter"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#objfmt-xdf">15. <code class="literal">xdf</code>:
Extended Dynamic Object Format</a></span></dt>
</dl>
</div>
</div>
<div class="chapter" title="Глава 6. bin: Flat-Form Binary Output">
<div class="titlepage">
<div>
<div>
<h2 class="title"><a name="objfmt-bin" id="objfmt-bin"></a>Глава 6. <code class="literal">bin</code>: Flat-Form Binary Output</h2>
</div>
</div>
</div>
<div class="toc">
<p><b>Содержание</b></p>
<dl>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#objfmt-bin-org">6.1. <code class="literal">ORG</code>: Binary Origin</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#objfmt-bin-section">6.2. <code class="literal">bin</code> Extensions to the <code class="literal">SECTION</code>
Directive</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#objfmt-bin-ssym">6.3. <code class="literal">bin</code> Special Symbols</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#objfmt-bin-map">6.4. Map Files</a></span></dt>
</dl>
</div>
<p><a class="indexterm" name="idp60410544" id="idp60410544"></a> <a class="indexterm" name="idp60411440" id="idp60411440"></a> The <a class="indexterm" name="idp60412336" id="idp60412336"></a><code class="literal">bin</code> <span class="quote">«<span class="quote">object format</span>»</span> does not produce object files: the output file
produced contains only the section data; no headers or relocations are generated. The
output can be considered <span class="quote">«<span class="quote">plain
binary</span>»</span>, and is useful for operating system and boot loader development,
generating MS-DOS <a class="indexterm" name="idp60414384" id="idp60414384"></a><code class="literal">.COM</code> executables and <a class="indexterm" name="idp60415664" id="idp60415664"></a><code class="literal">.SYS</code> device drivers,
and creating images for embedded target environments (e.g. <a class="indexterm" name="idp60416944" id="idp60416944"></a>Flash ROM).</p>
<p>The <code class="literal">bin</code> object format supports an unlimited number of
named sections. See <a class="xref" href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#objfmt-bin-section" title="6.2. bin Extensions to the SECTION Directive">Раздел&nbsp;6.2</a> for details. The
only restriction on these sections is that their storage locations in the output file
cannot overlap.</p>
<p>When used with the x86 architecture, the <code class="literal">bin</code> object
format starts Yasm in 16-bit mode. In order to write native 32-bit or 64-bit code, an
explicit <code class="literal">BITS 32</code> or <code class="literal">BITS 64</code>
directive is required respectively.</p>
<p><code class="literal">bin</code> produces an output file with no extension by default;
it simply strips the extension from the input file name. Thus the default output filename
for the input file <code class="literal">foo.asm</code> is simply <code class="literal">foo</code>.</p>
<div class="section" title="6.1. ORG: Binary Origin">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="objfmt-bin-org" id="objfmt-bin-org"></a>6.1. <code class="literal">ORG</code>: Binary Origin</h2>
</div>
</div>
</div>
<p><a class="indexterm" name="idp60424112" id="idp60424112"></a> <a class="indexterm" name="idp60425008" id="idp60425008"></a> <code class="literal">bin</code> provides the
<a class="indexterm" name="idp60426416" id="idp60426416"></a><code class="literal">ORG</code> directive in NASM syntax to allow setting of the memory address at
which the output file is initially loaded. The <code class="literal">ORG</code> directive
may only be used once (as the output file can only be initially loaded into a single
location). If <code class="literal">ORG</code> is not specified, <code class="literal">ORG 0</code> is used by default.</p>
<p>This makes the operation of NASM-syntax <code class="literal">ORG</code> very
different from the operation of <code class="literal">ORG</code> in other assemblers,
which typically simply move the assembly location to the value given. <code class="literal">bin</code> provides a more powerful alternative in the form of extensions to
the <code class="literal">SECTION</code> directive; see <a class="xref" href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#objfmt-bin-section" title="6.2. bin Extensions to the SECTION Directive">Раздел&nbsp;6.2</a> for details.</p>
<p>When combined with multiple sections, <code class="literal">ORG</code> also has the
effect of defaulting the LMA of the first section to the <code class="literal">ORG</code>
value to make the output file as small as possible. If this is not the desired behavior,
explicitly specify a LMA for all sections via either <code class="literal">START</code>
or <code class="literal">FOLLOWS</code> qualifiers in the <code class="literal">SECTION</code> directive.</p>
</div>
<div class="section" title="6.2. bin Extensions to the SECTION Directive">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="objfmt-bin-section" id="objfmt-bin-section"></a>6.2. <code class="literal">bin</code> Extensions to the
<code class="literal">SECTION</code> Directive</h2>
</div>
</div>
</div>
<p><a class="indexterm" name="idp60445488" id="idp60445488"></a> <a class="indexterm" name="idp60446640" id="idp60446640"></a> <a class="indexterm" name="idp60447792" id="idp60447792"></a> <a class="indexterm" name="idp60448944" id="idp60448944"></a>
<a class="indexterm" name="idp60450096" id="idp60450096"></a> The <code class="literal">bin</code> object format allows the use of multiple sections of arbitrary
names. It also extends the <code class="literal">SECTION</code> (or <code class="literal">SEGMENT</code>) directive to allow complex ordering of the segments both in the
output file or initial load address (also known as LMA) and at the ultimate execution
address (the virtual address or VMA).</p>
<p>The <a class="indexterm" name="idp60453040" id="idp60453040"></a>VMA is the execution
address. Yasm calculates absolute memory references within a section assuming that the
program code is at the VMA while being executed. The LMA, on the other hand, specifies
where a section is <span class="emphasis"><em>initially</em></span> loaded, as well as
its location in the output file.</p>
<p>Often, VMA will be the same as LMA. However, they may be different if the program or
another piece of code copies (relocates) a section prior to execution. A typical example
of this in an embedded system would be a piece of code stored in ROM, but is copied to
faster RAM prior to execution. Another example would be overlays: sections loaded on
demand from different file locations to the same execution location.</p>
<p>The <code class="literal">bin</code> extensions to the <code class="literal">SECTION</code> directive allow flexible specification of both VMA and LMA,
including alignment constraints. As with other object formats, additional attributes may
be added after the section name. The available attributes are listed in <a class="xref" href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#bin-section-attributes" title="Таблица 6.1. bin Section Attributes">Таблица&nbsp;6.1</a>.</p>
<div class="table"><a name="bin-section-attributes" id="bin-section-attributes"></a>
<p class="title"><b>Таблица 6.1. <code class="literal">bin</code> Section
Attributes</b></p>
<div class="table-contents">
<table summary="bin Section Attributes" border="1">
<colgroup>
<col class="col_1">
<col class="col_2"></colgroup>
<thead>
<tr>
<th align="center" valign="top">Attribute</th>
<th align="left" valign="top">Indicates the section</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center" valign="top">
<p><code class="literal">progbits</code></p>
</td>
<td align="left" valign="top">
<p>is stored in the disk image, as opposed to allocated and initialized at load.</p>
</td>
</tr>
<tr>
<td align="center" valign="top">
<p><code class="literal">nobits</code></p>
</td>
<td align="left" valign="top">
<p>is allocated and initialized at load (the opposite of <code class="literal">progbits</code>). Only one of <code class="literal">progbits</code> or
<code class="literal">nobits</code> may be specified; they are mutually exclusive
attributes.</p>
</td>
</tr>
<tr>
<td align="center" valign="top">
<p><code class="literal">start=<em class="replaceable"><code>address</code></em></code></p>
</td>
<td align="left" valign="top">
<p>has an LMA starting at <em class="replaceable"><code>address</code></em>. If a LMA
alignment constraint is given, it is checked against the provided address and a warning
is issued if <em class="replaceable"><code>address</code></em> does not meet the
alignment constraint.</p>
</td>
</tr>
<tr>
<td align="center" valign="top">
<p><code class="literal">follows=<em class="replaceable"><code>sectname</code></em></code></p>
</td>
<td align="left" valign="top">
<p>should follow the section named <em class="replaceable"><code>sectname</code></em> in
the output file (LMA). If a LMA alignment constraint is given, it is respected and a gap
is inserted such that the section meets its alignment requirement. Note that as LMA
overlap is not allowed, typically only one section may follow another.</p>
</td>
</tr>
<tr>
<td align="center" valign="top">
<p><code class="literal">align=<em class="replaceable"><code>n</code></em></code></p>
</td>
<td align="left" valign="top">
<p>requires a LMA alignment of <em class="replaceable"><code>n</code></em> bytes. The
value <em class="replaceable"><code>n</code></em> must always be a power of 2. LMA
alignment defaults to 4 if not specified.</p>
</td>
</tr>
<tr>
<td align="center" valign="top">
<p><code class="literal">vstart=<em class="replaceable"><code>address</code></em></code></p>
</td>
<td align="left" valign="top">
<p>has an VMA starting at <em class="replaceable"><code>address</code></em>. If a VMA
alignment constraint is given, it is checked against the provided address and a warning
is issued if <em class="replaceable"><code>address</code></em> does not meet the
alignment constraint.</p>
</td>
</tr>
<tr>
<td align="center" valign="top">
<p><code class="literal">vfollows=<em class="replaceable"><code>sectname</code></em></code></p>
</td>
<td align="left" valign="top">
<p>should follow the section named <em class="replaceable"><code>sectname</code></em> in
the output file (VMA). If a VMA alignment constraint is given, it is respected and a gap
is inserted such that the section meets its alignment requirement. VMA overlap is
allowed, so more than one section may follow another (possibly useful in the case of
overlays).</p>
</td>
</tr>
<tr>
<td align="center" valign="top">
<p><code class="literal">valign=<em class="replaceable"><code>n</code></em></code></p>
</td>
<td align="left" valign="top">
<p>requires a VMA alignment of <em class="replaceable"><code>n</code></em> bytes. The
value <em class="replaceable"><code>n</code></em> must always be a power of 2. VMA
alignment defaults to the LMA alignment if not specified.</p>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<br class="table-break">
<p>Only one of <code class="literal">start</code> or <code class="literal">follows</code>
may be specified for a section; the same restriction applies to <code class="literal">vstart</code> and <code class="literal">vfollows</code>.</p>
<p>Unless otherwise specified via the use of <code class="literal">follows</code> or
<code class="literal">start</code>, Yasm by default assumes the implicit ordering given
by the order of the sections in the input file. A section named <code class="literal">.text</code> is always the first section. Any code which comes before an
explicit <code class="literal">SECTION</code> directive goes into the <code class="literal">.text</code> section. The <code class="literal">.text</code> section attributes
may be overridden by giving an explicit <code class="literal">SECTION .text</code>
directive with attributes.</p>
<p>Also, unless otherwise specified, Yasm defaults to setting VMA=LMA. If just
<span class="quote">«<span class="quote">valign` is specified, Yasm just takes the LMA
and aligns it to the required alignment. This may have the effect of pushing following
sections</span>»</span> VMAs to non-LMA addresses as well, to avoid VMA overlap.</p>
<p>Yasm treats <code class="literal">nobits</code> sections in a special way in order to
minimize the size of the output file. As <code class="literal">nobits</code> sections can
be 0-sized in the LMA realm, but cannot be if located between two other sections (due to
the VMA=LMA default), Yasm moves all <code class="literal">nobits</code> sections with
unspecified LMA to the end of the output file, where they can savely have 0 LMA size and
thus not take up any space in the output file. If this behavior is not desired, a
<code class="literal">nobits</code> section LMA (just like a <code class="literal">progbits</code> section) may be specified using either the <code class="literal">follows</code> or <code class="literal">start</code> section attribute.</p>
</div>
<div class="section" title="6.3. bin Special Symbols">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="objfmt-bin-ssym" id="objfmt-bin-ssym"></a>6.3. <code class="literal">bin</code> Special Symbols</h2>
</div>
</div>
</div>
<p><a class="indexterm" name="idp60508080" id="idp60508080"></a> <a class="indexterm" name="idp60509360" id="idp60509360"></a> <a class="indexterm" name="idp60510512" id="idp60510512"></a> To facilitate writing code that copies itself from one location to
another (e.g. from its LMA to its VMA during execution), the <code class="literal">bin</code> object format provides several special symbols for every defined
section. Each special symbol begins with <code class="literal">section.</code> followed
by the section name. The supported special <code class="literal">bin</code> symbols
are:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="literal">section.<em class="replaceable"><code>sectname</code></em>.start</code></span></dt>
<dd>Set to the LMA address of the section named <em class="replaceable"><code>sectname</code></em>.</dd>
<dt><span class="term"><code class="literal">section.<em class="replaceable"><code>sectname</code></em>.vstart</code></span></dt>
<dd>Set to the VMA address of the section named <em class="replaceable"><code>sectname</code></em>.</dd>
<dt><span class="term"><code class="literal">section.<em class="replaceable"><code>sectname</code></em>.length</code></span></dt>
<dd>Set to the length of the section named <em class="replaceable"><code>sectname</code></em>. The length is considered the runtime length, so
<span class="quote">«<span class="quote">nobits` sections</span>»</span> length is
their runtime length, not 0.</dd>
</dl>
</div>
</div>
<div class="section" title="6.4. Map Files">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="objfmt-bin-map" id="objfmt-bin-map"></a>6.4. Map Files</h2>
</div>
</div>
</div>
<p><a class="indexterm" name="idp60523696" id="idp60523696"></a> <a class="indexterm" name="idp60524720" id="idp60524720"></a>Map files may be generated in <code class="literal">bin</code> via the use of the <a class="indexterm" name="idp60526000" id="idp60526000"></a><code class="literal">[MAP]</code> directive. The map filename may be
specified either with a command line option (<code class="option">--mapfile=<em class="replaceable"><code>filename</code></em></code>) or in the <code class="literal">[MAP]</code> directive. If a map is requested but no output filename is given,
the map output goes to standard output by default.</p>
<p>If no <code class="literal">[MAP]</code> directive is given in the input file, no map
output is generated. If <code class="literal">[MAP]</code> is given with no options, a
brief map is generated. The <code class="literal">[MAP]</code> directive accepts the
following options to control what is included in the map file. More than one option may
be specified. Any option other than the ones below is interpreted as the output
filename.</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="literal">brief</code></span></dt>
<dd>Includes the input and output filenames, origin (<code class="literal">ORG</code>
value), and a brief section summary listing the VMA and LMA start and stop addresses and
the section length of every section.</dd>
<dt><span class="term"><code class="literal">sections</code> ,</span> <span class="term"><code class="literal">segments</code></span></dt>
<dd>Includes a detailed list of sections, including the VMA and LMA alignment, any
<span class="quote">«<span class="quote">follows</span>»</span> settings, as well as
the VMA and LMA start addresses and the section length.</dd>
<dt><span class="term"><code class="literal">symbols</code></span></dt>
<dd>Includes a detailed list of all EQU values and VMA and LMA symbol locations, grouped
by section.</dd>
<dt><span class="term"><code class="literal">all</code></span></dt>
<dd>All of the above.</dd>
</dl>
</div>
</div>
</div>
<div class="chapter" title="Глава 7. coff: Common Object File Format">
<div class="titlepage">
<div>
<div>
<h2 class="title"><a name="objfmt-coff" id="objfmt-coff"></a>Глава 7. <code class="literal">coff</code>: Common Object File Format</h2>
</div>
</div>
</div>
<p><a class="indexterm" name="idp60546864" id="idp60546864"></a> <a class="indexterm" name="idp60548016" id="idp60548016"></a></p>
</div>
<div class="chapter" title="Глава 8. elf32: Executable and Linkable Format 32-bit Object Files">
<div class="titlepage">
<div>
<div>
<h2 class="title"><a name="objfmt-elf32" id="objfmt-elf32"></a>Глава 8. <code class="literal">elf32</code>: Executable and Linkable Format 32-bit Object Files</h2>
</div>
</div>
</div>
<div class="toc">
<p><b>Содержание</b></p>
<dl>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#objfmt-elf-dbgfmts">8.1. Debugging Format
Support</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#objfmt-elf-section">8.2. ELF Sections</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#objfmt-elf-directives">8.3. ELF
Directives</a></span></dt>
<dd>
<dl>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#objfmt-elf-dir-ident">8.3.1. <code class="literal">IDENT</code>: Add file identification</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#objfmt-elf-dir-size">8.3.2. <code class="literal">SIZE</code>: Set symbol size</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#objfmt-elf-dir-type">8.3.3. <code class="literal">TYPE</code>: Set symbol type</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#objfmt-elf-dir-weak">8.3.4. <code class="literal">WEAK</code>: Create weak symbol</a></span></dt>
</dl>
</dd>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#objfmt-elf-dir-global">8.4. ELF Extensions to the
<code class="literal">GLOBAL</code> Directive</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#objfmt-elf-dir-common">8.5. ELF Extensions to the
<code class="literal">COMMON</code> Directive</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#objfmt-elf32-wrt">8.6. <code class="literal">elf32</code> Special Symbols and <code class="literal">WRT</code></a></span></dt>
</dl>
</div>
<p><a class="indexterm" name="idp60550320" id="idp60550320"></a> <a class="indexterm" name="idp60551984" id="idp60551984"></a> <a class="indexterm" name="idp60553136" id="idp60553136"></a> <a class="indexterm" name="idp60554928" id="idp60554928"></a>
<a class="indexterm" name="idp60556080" id="idp60556080"></a> <a class="indexterm" name="idp60556976" id="idp60556976"></a> <a class="indexterm" name="idp60557872" id="idp60557872"></a> The Executable and Linkable Object Format is the primary object format
for many operating systems including <a class="indexterm" name="idp60558768" id="idp60558768"></a>FreeBSD or GNU/Linux. It appears in three forms:</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">Shared object files (.so)</li>
<li class="listitem">Relocatable object files (.o)</li>
<li class="listitem">Executable files (no convention)</li>
</ul>
</div>
<p>Yasm only directly supports relocatable object files. Other tools, such as the GNU
Linker <span class="command"><strong>ld</strong></span>, help turn relocatable object
files into the other formats. Yasm supports generation of both 32-bit and 64-bit ELF
files, called <code class="literal">elf32</code> and <code class="literal">elf64</code>.
A generic interface to both is also provided, <code class="literal">elf</code>, which
selects between <code class="literal">elf32</code> and <code class="literal">elf64</code>
based on the target machine architecture (see <a class="xref" href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#yasm-option-machine" title="1.3.1.7. -m machine или --machine=machine: Выбор целевой машины данной архитектуры">
Раздел&nbsp;1.3.1.7</a>).</p>
<p>Yasm defaults to <code class="literal">BITS 32</code> mode when outputting to the
<code class="literal">elf32</code> object format.</p>
<div class="section" title="8.1. Debugging Format Support">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="objfmt-elf-dbgfmts" id="objfmt-elf-dbgfmts"></a>8.1. Debugging Format Support</h2>
</div>
</div>
</div>
<p>ELF supports two debugging formats: <code class="literal">stabs</code> (see <a class="xref" href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#dbgfmt-stabs" title="Глава 18. stabs: Stabs Debugging Format">Глава&nbsp;18</a>) and <code class="literal">dwarf2</code> (see <a class="xref" href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#dbgfmt-dwarf2" title="Глава 17. dwarf2: DWARF2 Debugging Format">Глава&nbsp;17</a>). Different debuggers
understand these different formats; the newer debug format is <code class="literal">dwarf2</code>, so try that first.</p>
</div>
<div class="section" title="8.2. ELF Sections">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="objfmt-elf-section" id="objfmt-elf-section"></a>8.2. ELF Sections</h2>
</div>
</div>
</div>
<p><a class="indexterm" name="idp60572208" id="idp60572208"></a> <a class="indexterm" name="idp60573616" id="idp60573616"></a> ELF’s section-based output supports attributes
on a per-section basis. These attributes include <code class="literal">alloc</code>,
<code class="literal">exec</code>, <code class="literal">write</code>, <code class="literal">progbits</code>, and <code class="literal">align</code>. Except for align, they
can each be negated in NASM syntax by prepending <span class="quote">«<span class="quote">no</span>»</span>, e.g., <span class="quote">«<span class="quote">noexec</span>»</span>. The attributes are later read by the operating system to
select the proper behavior for each section, with the meanings shown in <a class="xref" href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#elf-section-attributes" title="Таблица 8.1. ELF Section Attributes">Таблица&nbsp;8.1</a>.</p>
<div class="table"><a name="elf-section-attributes" id="elf-section-attributes"></a>
<p class="title"><b>Таблица 8.1. ELF Section Attributes</b></p>
<div class="table-contents">
<table summary="ELF Section Attributes" border="1">
<colgroup>
<col class="col_1">
<col class="col_2"></colgroup>
<thead>
<tr>
<th align="center" valign="top">Attribute</th>
<th align="left" valign="top">Indicates the section</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center" valign="top">
<p><code class="literal">alloc</code></p>
</td>
<td align="left" valign="top">
<p>is loaded into memory at runtime. This is true for code and data sections, and false
for metadata sections.</p>
</td>
</tr>
<tr>
<td align="center" valign="top">
<p><code class="literal">exec</code></p>
</td>
<td align="left" valign="top">
<p>has permission to be run as executable code.</p>
</td>
</tr>
<tr>
<td align="center" valign="top">
<p><code class="literal">write</code></p>
</td>
<td align="left" valign="top">
<p>is writable at runtime.</p>
</td>
</tr>
<tr>
<td align="center" valign="top">
<p><code class="literal">progbits</code></p>
</td>
<td align="left" valign="top">
<p>is stored in the disk image, as opposed to allocated and initialized at load.</p>
</td>
</tr>
<tr>
<td align="center" valign="top">
<p><code class="literal">align=<em class="replaceable"><code>n</code></em></code></p>
</td>
<td align="left" valign="top">
<p>requires a memory alignment of <em class="replaceable"><code>n</code></em> bytes. The
value <em class="replaceable"><code>n</code></em> must always be a power of 2.</p>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<br class="table-break">
<p>In NASM syntax, the attribute <code class="literal">nobits</code> is provided as an
alias for <code class="literal">noprogbits</code>.</p>
<p>The standard primary sections have attribute defaults according their expected use,
and any unknown section gets its own defaults, as shown in <a class="xref" href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#elf-standard-sections" title="Таблица 8.2. ELF Standard Sections">Таблица&nbsp;8.2</a>.</p>
<div class="table"><a name="elf-standard-sections" id="elf-standard-sections"></a>
<p class="title"><b>Таблица 8.2. ELF Standard Sections</b></p>
<div class="table-contents">
<table summary="ELF Standard Sections" border="1">
<colgroup>
<col class="col_1">
<col class="col_2">
<col class="col_3">
<col class="col_4">
<col class="col_5">
<col class="col_6"></colgroup>
<thead>
<tr>
<th align="left" valign="top">Section</th>
<th align="center" valign="top"><code class="literal">alloc</code></th>
<th align="center" valign="top"><code class="literal">exec</code></th>
<th align="center" valign="top"><code class="literal">write</code></th>
<th align="center" valign="top"><code class="literal">progbits</code></th>
<th align="center" valign="top"><code class="literal">align</code></th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top">
<p><code class="literal">.bss</code></p>
</td>
<td align="center" valign="top">
<p>alloc</p>
</td>
<td align="center" valign="top"></td>
<td align="center" valign="top">
<p>write</p>
</td>
<td align="center" valign="top"></td>
<td align="center" valign="top">
<p>4</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><code class="literal">.data</code></p>
</td>
<td align="center" valign="top">
<p>alloc</p>
</td>
<td align="center" valign="top"></td>
<td align="center" valign="top">
<p>write</p>
</td>
<td align="center" valign="top">
<p>progbits</p>
</td>
<td align="center" valign="top">
<p>4</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><code class="literal">.rodata</code></p>
</td>
<td align="center" valign="top">
<p>alloc</p>
</td>
<td align="center" valign="top"></td>
<td align="center" valign="top"></td>
<td align="center" valign="top">
<p>progbits</p>
</td>
<td align="center" valign="top">
<p>4</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><code class="literal">.text</code></p>
</td>
<td align="center" valign="top">
<p>alloc</p>
</td>
<td align="center" valign="top">
<p>exec</p>
</td>
<td align="center" valign="top"></td>
<td align="center" valign="top">
<p>progbits</p>
</td>
<td align="center" valign="top">
<p>16</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><code class="literal">.comment</code></p>
</td>
<td align="center" valign="top"></td>
<td align="center" valign="top"></td>
<td align="center" valign="top"></td>
<td align="center" valign="top">
<p>progbits</p>
</td>
<td align="center" valign="top">
<p>0</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p>unknown</p>
</td>
<td align="center" valign="top">
<p>alloc</p>
</td>
<td align="center" valign="top"></td>
<td align="center" valign="top"></td>
<td align="center" valign="top">
<p>progbits</p>
</td>
<td align="center" valign="top">
<p>1</p>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<br class="table-break"></div>
<div class="section" title="8.3. ELF Directives">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="objfmt-elf-directives" id="objfmt-elf-directives"></a>8.3. ELF Directives</h2>
</div>
</div>
</div>
<p><a class="indexterm" name="idp60661168" id="idp60661168"></a> <a class="indexterm" name="idp60662576" id="idp60662576"></a> ELF adds additional assembler directives to
define weak symbols (<code class="literal">WEAK</code>), set symbol size (<code class="literal">SIZE</code>), and indicate whether a symbol is specifically a function or an
object (<code class="literal">TYPE</code>). ELF also adds a directive to assist in
identifying the source file or version, <code class="literal">IDENT</code>.</p>
<div class="section" title="8.3.1. IDENT: Add file identification">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="objfmt-elf-dir-ident" id="objfmt-elf-dir-ident"></a>8.3.1.
<code class="literal">IDENT</code>: Add file identification</h3>
</div>
</div>
</div>
<p>The <a class="indexterm" name="idp60667184" id="idp60667184"></a><code class="literal">IDENT</code> directive allows adding arbitrary string data to an ELF object
file that will be saved in the object and executable file, but will not be loaded into
memory like data in the <code class="literal">.data</code> section. It is often used for
saving <a class="indexterm" name="idp60668976" id="idp60668976"></a>version control
keyword information from tools such as <span class="command"><strong>cvs</strong></span>
or <span class="command"><strong>svn</strong></span> into files so that the source
revision the object was created with can be read using the <span class="command"><strong>ident</strong></span> command found on most Unix systems.</p>
<p>The directive takes one or more string parameters. Each parameter is saved in sequence
as a 0-terminated string in the <a class="indexterm" name="idp60671536" id="idp60671536"></a><code class="literal">.comment</code> section of the object file.
Multiple uses of the <code class="literal">IDENT</code> directive are legal, and the
strings will be saved into the <code class="literal">.comment</code> section in the order
given in the source file.</p>
<p>In NASM syntax, no wrapper macro is provided for <code class="literal">IDENT</code>,
so it must be wrapped in square brackets. Example use in NASM syntax:</p>
<pre class="programlisting">[ident "$Id$"]
</pre></div>
<div class="section" title="8.3.2. SIZE: Set symbol size">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="objfmt-elf-dir-size" id="objfmt-elf-dir-size"></a>8.3.2.
<code class="literal">SIZE</code>: Set symbol size</h3>
</div>
</div>
</div>
<p><a class="indexterm" name="idp60693424" id="idp60693424"></a> <a class="indexterm" name="idp60694832" id="idp60694832"></a> <a class="indexterm" name="idp60695728" id="idp60695728"></a> <a class="indexterm" name="idp60696880" id="idp60696880"></a>
<a class="indexterm" name="idp60697904" id="idp60697904"></a> <a class="indexterm" name="idp60699056" id="idp60699056"></a> ELF’s symbol table has the capability of storing a
size for a symbol. This is commonly used for functions or data objects. While the size
can be specificed directly for <code class="literal">COMMON</code> symbols, the <a class="indexterm" name="idp60700464" id="idp60700464"></a><code class="literal">SIZE</code>
directive allows for specifying the size of any symbol, including local symbols.</p>
<p>The directive takes two parameters; the first parameter is the symbol name, and the
second is the size. The size may be a constant or an expression. Example:</p>
<pre class="programlisting">func:
        ret
.end:
size func func.end-func
</pre></div>
<div class="section" title="8.3.3. TYPE: Set symbol type">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="objfmt-elf-dir-type" id="objfmt-elf-dir-type"></a>8.3.3.
<code class="literal">TYPE</code>: Set symbol type</h3>
</div>
</div>
</div>
<p><a class="indexterm" name="idp60704304" id="idp60704304"></a> <a class="indexterm" name="idp60705840" id="idp60705840"></a> <a class="indexterm" name="idp60706736" id="idp60706736"></a> <a class="indexterm" name="idp60707888" id="idp60707888"></a>
<a class="indexterm" name="idp60708784" id="idp60708784"></a> <a class="indexterm" name="idp60709936" id="idp60709936"></a> ELF’s symbol table has the capability of indicating
whether a symbol is a function or data. While this can be specified directly in the
<code class="literal">GLOBAL</code> directive (see <a class="xref" href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#objfmt-elf-dir-global" title="8.4. ELF Extensions to the GLOBAL Directive">Раздел&nbsp;8.4</a>), the <a class="indexterm" name="idp60711728" id="idp60711728"></a><code class="literal">TYPE</code>
directive allows specifying the symbol type for any symbol, including local symbols.</p>
<p>The directive takes two parameters; the first parameter is the symbol name, and the
second is the symbol type. The symbol type must be either <a class="indexterm" name="idp60713392" id="idp60713392"></a><code class="literal">function</code> or <a class="indexterm" name="idp60718896" id="idp60718896"></a><code class="literal">object</code>.
An unrecognized type will cause a warning to be generated. Example of use:</p>
<pre class="programlisting">func:
        ret
type func function
section .data
var dd 4
type var object
</pre></div>
<div class="section" title="8.3.4. WEAK: Create weak symbol">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="objfmt-elf-dir-weak" id="objfmt-elf-dir-weak"></a>8.3.4.
<code class="literal">WEAK</code>: Create weak symbol</h3>
</div>
</div>
</div>
<p><a class="indexterm" name="idp60722224" id="idp60722224"></a> <a class="indexterm" name="idp60723376" id="idp60723376"></a> <a class="indexterm" name="idp60724784" id="idp60724784"></a> <a class="indexterm" name="idp60725680" id="idp60725680"></a>
<a class="indexterm" name="idp60726704" id="idp60726704"></a> ELF allows defining certain
symbols as <span class="quote">«<span class="quote">weak</span>»</span>. Weak symbols
are similar to global symbols, except during linking, weak symbols are only chosen after
global and local symbols during symbol resolution. Unlike global symbols, multiple object
files may declare the same weak symbol, and references to a symbol get resolved against a
weak symbol only if no global or local symbols have the same name.</p>
<p>This functionality is primarily useful for libraries that want to provide common
functions but not come into conflict with user programs. For example, libc has a syscall
(function) called <span class="quote">«<span class="quote">read</span>»</span>.
However, to implement a threaded process using POSIX threads in user-space, libpthread
needs to supply a function also called <span class="quote">«<span class="quote">read</span>»</span> that provides a blocking interface to the programmer, but
actually does non-blocking calls to the kernel. To allow an application to be linked to
both libc and libpthread (to share common code), libc needs to have its version of the
syscall with a non-weak name like <span class="quote">«<span class="quote">_sys_read</span>»</span> with a weak symbol called <span class="quote">«<span class="quote">read</span>»</span>. If an application is linked against
libc only, the linker won’t find a non-weak symbol for <span class="quote">«<span class="quote">read</span>»</span>, so it will use the weak one. If the
same application is linked against libc <span class="emphasis"><em>and</em></span>
libpthread, then the linker will link <span class="quote">«<span class="quote">read</span>»</span> calls to the symbol in libpthread, ignoring the weak one in
libc, regardless of library link order. If libc used a non-weak name, which <span class="quote">«<span class="quote">read</span>»</span> function the program ended up with
might depend on a variety of factors; a weak symbol is a way to tell the linker that a
symbol is less important resolution-wise.</p>
<p>The <code class="literal">WEAK</code> directive takes a single parameter, the symbol
name to declare weak. Example:</p>
<pre class="programlisting">weakfunc:
strongfunc:
        ret
weak weakfunc
global strongfunc
</pre></div>
</div>
<div class="section" title="8.4. ELF Extensions to the GLOBAL Directive">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="objfmt-elf-dir-global" id="objfmt-elf-dir-global"></a>8.4. ELF Extensions to the <code class="literal">GLOBAL</code> Directive</h2>
</div>
</div>
</div>
<p><a class="indexterm" name="idp60734896" id="idp60734896"></a> <a class="indexterm" name="idp60736048" id="idp60736048"></a> <a class="indexterm" name="idp60736944" id="idp60736944"></a> <a class="indexterm" name="idp60738096" id="idp60738096"></a>
<a class="indexterm" name="idp60738992" id="idp60738992"></a> <a class="indexterm" name="idp60740144" id="idp60740144"></a> <a class="indexterm" name="idp60741040" id="idp60741040"></a> <a class="indexterm" name="idp60742320" id="idp60742320"></a> ELF
object files can contain more information about a global symbol than just its address:
they can contain the size of the symbol and its type as well. These are not merely
debugger conveniences, but are actually necessary when the program being written is a
((shared library)). Yasm therefore supports some extensions to the NASM syntax <a class="indexterm" name="idp60743216" id="idp60743216"></a><code class="literal">GLOBAL</code>
directive (see <a class="xref" href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-directive-global" title="4.6. GLOBAL: Exporting Symbols">Раздел&nbsp;4.6</a>), allowing you to specify these
features. Yasm also provides the ELF-specific directives in <a class="xref" href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#objfmt-elf-directives" title="8.3. ELF Directives">Раздел&nbsp;8.3</a> to allow
specifying this information for non-global symbols.</p>
<p>You can specify whether a global variable is a function or a data object by suffixing
the name with a colon and the word <a class="indexterm" name="idp60745776" id="idp60745776"></a><code class="literal">function</code> or <a class="indexterm" name="idp60747056" id="idp60747056"></a><code class="literal">data</code>. (((<code class="literal">object</code>)) is a synonym for <code class="literal">data</code>.) For
example:</p>
<pre class="programlisting">global   hashlookup:function, hashtable:data
</pre>
<p>exports the global symbol <code class="literal">hashlookup</code> as a function and
<code class="literal">hashtable</code> as a data object.</p>
<p>Optionally, you can control the ELF visibility of the symbol. Just add one of the
visibility keywords: <a class="indexterm" name="idp60755888" id="idp60755888"></a><code class="literal">default</code>, <a class="indexterm" name="idp60757168" id="idp60757168"></a><code class="literal">internal</code>, <a class="indexterm" name="idp60758448" id="idp60758448"></a><code class="literal">hidden</code>,
or <a class="indexterm" name="idp60759728" id="idp60759728"></a><code class="literal">protected</code>. The default is <code class="literal">default</code>, of
course. For example, to make <code class="literal">hashlookup</code> hidden:</p>
<pre class="programlisting">global   hashlookup:function hidden
</pre>
<p>You can also specify the size of the data associated with the symbol, as a numeric
expression (which may involve labels, and even forward references) after the type
specifier. Like this:</p>
<pre class="programlisting">global  hashtable:data (hashtable.end - hashtable)

hashtable:
        db this,that,theother  ; some data here
.end:
</pre>
<p>This makes Yasm automatically calculate the length of the table and place that
information into the ELF symbol table. The same information can be given more verbosely
using the <code class="literal">TYPE</code> (see <a class="xref" href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#objfmt-elf-dir-type" title="8.3.3. TYPE: Set symbol type">Раздел&nbsp;8.3.3</a>) and
<code class="literal">SIZE</code> (see <a class="xref" href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#objfmt-elf-dir-size" title="8.3.2. SIZE: Set symbol size">Раздел&nbsp;8.3.2</a>) directives as follows:</p>
<pre class="programlisting">global  hashtable
type hashtable object
size hashtable hashtable.end - hashtable

hashtable:
        db this,that,theother  ; some data here
.end:
</pre>
<p>Declaring the type and size of global symbols is necessary when writing shared library
code.</p>
</div>
<div class="section" title="8.5. ELF Extensions to the COMMON Directive">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="objfmt-elf-dir-common" id="objfmt-elf-dir-common"></a>8.5. ELF Extensions to the <code class="literal">COMMON</code> Directive</h2>
</div>
</div>
</div>
<p><a class="indexterm" name="idp60772400" id="idp60772400"></a> <a class="indexterm" name="idp60773552" id="idp60773552"></a> <a class="indexterm" name="idp60774448" id="idp60774448"></a> <a class="indexterm" name="idp60775728" id="idp60775728"></a> ELF also
allows you to specify alignment requirements on common variables. This is done by putting
a number (which must be a power of two) after the name and size of the common variable,
separated (as usual) by a colon. For example, an array of doublewords would benefit from
4-byte alignment:</p>
<pre class="programlisting">common  dwordarray 128:4
</pre>
<p>This declares the total size of the array to be 128 bytes, and requires that it be
aligned on a 4-byte boundary.</p>
</div>
<div class="section" title="8.6. elf32 Special Symbols and WRT">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="objfmt-elf32-wrt" id="objfmt-elf32-wrt"></a>8.6. <code class="literal">elf32</code> Special Symbols and
<code class="literal">WRT</code></h2>
</div>
</div>
</div>
<p><a class="indexterm" name="idp60779440" id="idp60779440"></a> <a class="indexterm" name="idp60780336" id="idp60780336"></a> <a class="indexterm" name="idp60781488" id="idp60781488"></a> <a class="indexterm" name="idp60782384" id="idp60782384"></a>
<a class="indexterm" name="idp60783664" id="idp60783664"></a> The ELF specification
contains enough features to allow position-independent code (PIC) to be written, which
makes ELF shared libraries very flexible. However, it also means Yasm has to be able to
generate a variety of strange relocation types in ELF object files, if it is to be an
assembler which can write <a class="indexterm" name="idp60784560" id="idp60784560"></a>PIC.</p>
<p>Since ELF does not support segment-base references, the <a class="indexterm" name="idp60785584" id="idp60785584"></a><code class="literal">WRT</code> operator is not used
for its normal purpose; therefore Yasm’s <code class="literal">elf32</code> output
format makes use of <code class="literal">WRT</code> for a different purpose, namely the
PIC-specific relocation types.</p>
<p><code class="literal">elf32</code> defines five special symbols which you can use as
the right-hand side of the <code class="literal">WRT</code> operator to obtain PIC
relocation types. They are <a class="indexterm" name="idp60789296" id="idp60789296"></a><code class="literal">..gotpc</code>, <a class="indexterm" name="idp60790576" id="idp60790576"></a><code class="literal">..gotoff</code>, <a class="indexterm" name="idp60796080" id="idp60796080"></a><code class="literal">..got</code>,
<a class="indexterm" name="idp60797360" id="idp60797360"></a><code class="literal">..plt</code> and <a class="indexterm" name="idp60798640" id="idp60798640"></a><code class="literal">..sym</code>. Their functions are summarized
here:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="literal">..gotpc</code></span></dt>
<dd>Referring to the symbol marking the <a class="indexterm" name="idp60801968" id="idp60801968"></a>global offset table base using <code class="literal">wrt ..gotpc</code>
will end up giving the distance from the beginning of the current section to the global
offset table. (((<code class="literal">_GLOBAL_OFFSET_TABLE_</code>)) is the standard
symbol name used to refer to the <a class="indexterm" name="idp60803760" id="idp60803760"></a>GOT.) So you would then need to add <a class="indexterm" name="idp60804400" id="idp60804400"></a><code class="literal">$$</code> to the result to get
the real address of the GOT.</dd>
<dt><span class="term"><code class="literal">..gotoff</code></span></dt>
<dd>Referring to a location in one of your own sections using <code class="literal">wrt
..gotoff</code> will give the distance from the beginning of the GOT to the specified
location, so that adding on the address of the GOT would give the real address of the
location you wanted.</dd>
<dt><span class="term"><code class="literal">..got</code></span></dt>
<dd>Referring to an external or global symbol using <code class="literal">wrt
..got</code> causes the linker to build an entry <span class="emphasis"><em>in</em></span> the GOT containing the address of the symbol, and the
reference gives the distance from the beginning of the GOT to the entry; so you can add
on the address of the GOT, load from the resulting address, and end up with the address
of the symbol.</dd>
<dt><span class="term"><code class="literal">..plt</code></span></dt>
<dd>Referring to a procedure name using <code class="literal">wrt ..plt</code> causes the
linker to build a <a class="indexterm" name="idp60813872" id="idp60813872"></a>procedure
linkage table entry for the symbol, and the reference gives the address of the <a class="indexterm" name="idp60814512" id="idp60814512"></a>PLT entry. You can only use this in
contexts which would generate a PC-relative relocation normally (i.e. as the destination
for <code class="literal">CALL</code> or <code class="literal">JMP</code>), since ELF
contains no relocation type to refer to PLT entries absolutely.</dd>
<dt><span class="term"><code class="literal">..sym</code></span></dt>
<dd>Referring to a symbol name using <code class="literal">wrt ..sym</code> causes Yasm
to write an ordinary relocation, but instead of making the relocation relative to the
start of the section and then adding on the offset to the symbol, it will write a
relocation record aimed directly at the symbol in question. The distinction is a
necessary one due to a peculiarity of the dynamic linker.</dd>
</dl>
</div>
</div>
</div>
<div class="chapter" title="Глава 9. elf64: Executable and Linkable Format 64-bit Object Files">
<div class="titlepage">
<div>
<div>
<h2 class="title"><a name="objfmt-elf64" id="objfmt-elf64"></a>Глава 9. <code class="literal">elf64</code>: Executable and Linkable Format 64-bit Object Files</h2>
</div>
</div>
</div>
<div class="toc">
<p><b>Содержание</b></p>
<dl>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#objfmt-elf64-wrt">9.1. <code class="literal">elf64</code> Special Symbols and <code class="literal">WRT</code></a></span></dt>
</dl>
</div>
<p><a class="indexterm" name="idp60825008" id="idp60825008"></a> <a class="indexterm" name="idp60826672" id="idp60826672"></a> <a class="indexterm" name="idp60827824" id="idp60827824"></a> <a class="indexterm" name="idp60829488" id="idp60829488"></a>
<a class="indexterm" name="idp60830640" id="idp60830640"></a> <a class="indexterm" name="idp60831792" id="idp60831792"></a> <a class="indexterm" name="idp60832816" id="idp60832816"></a> <a class="indexterm" name="idp60833712" id="idp60833712"></a></p>
<p>The <code class="literal">elf64</code> object format is the 64-bit version of the
Executable and Linkable Object Format. As it shares many similarities with <code class="literal">elf32</code>, only differences between <code class="literal">elf32</code> and
<code class="literal">elf64</code> will be described in this chapter. For details on
<code class="literal">elf32</code>, see <a class="xref" href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#objfmt-elf32" title="Глава 8. elf32: Executable and Linkable Format 32-bit Object Files">Глава&nbsp;8</a>.</p>
<p>Yasm defaults to <code class="literal">BITS 64</code> mode when outputting to the
<code class="literal">elf64</code> object format.</p>
<p><code class="literal">elf64</code> supports the same debug formats as <code class="literal">elf32</code>, however, the <code class="literal">stabs</code> debug format is
limited to 32-bit addresses, so <code class="literal">dwarf2</code> (see <a class="xref" href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#dbgfmt-dwarf2" title="Глава 17. dwarf2: DWARF2 Debugging Format">Глава&nbsp;17</a>) is the recommended
debugging format.</p>
<p><code class="literal">elf64</code> also supports the exact same sections, section
attributes, and directives as <code class="literal">elf32</code>. See <a class="xref" href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#objfmt-elf-section" title="8.2. ELF Sections">Раздел&nbsp;8.2</a> for more
details on section attributes, and <a class="xref" href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#objfmt-elf-directives" title="8.3. ELF Directives">Раздел&nbsp;8.3</a> for details on the additional directives ELF
provides.</p>
<div class="section" title="9.1. elf64 Special Symbols and WRT">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="objfmt-elf64-wrt" id="objfmt-elf64-wrt"></a>9.1. <code class="literal">elf64</code> Special Symbols and
<code class="literal">WRT</code></h2>
</div>
</div>
</div>
<p><a class="indexterm" name="idp60845872" id="idp60845872"></a> <a class="indexterm" name="idp60846768" id="idp60846768"></a> <a class="indexterm" name="idp60847920" id="idp60847920"></a> <a class="indexterm" name="idp60848944" id="idp60848944"></a>
<a class="indexterm" name="idp60850096" id="idp60850096"></a> The primary difference
between <code class="literal">elf32</code> and <code class="literal">elf64</code> (other
than 64-bit support in general) is the differences in shared library handling and
position-independent code. As <code class="literal">BITS 64</code> enables the use of
<code class="literal">RIP</code>-relative addressing, most variable accesses can be
relative to RIP, allowing easy relocation of the shared library to a different memory
address.</p>
<p>While RIP-relative addressing is available, it does not handle all possible variable
access modes, so special symbols are still required, as in <code class="literal">elf32</code>. And as with <code class="literal">elf32</code>, the <code class="literal">elf64</code> output format makes use of <a class="indexterm" name="idp60854960" id="idp60854960"></a><code class="literal">WRT</code> for utilizing the <a class="indexterm" name="idp60856240" id="idp60856240"></a>PIC-specific relocation types.</p>
<p><code class="literal">elf64</code> defines four special symbols which you can use as
the right-hand side of the <code class="literal">WRT</code> operator to obtain PIC
relocation types. They are <a class="indexterm" name="idp60862384" id="idp60862384"></a><code class="literal">..gotpcrel</code>, <a class="indexterm" name="idp60863664" id="idp60863664"></a><code class="literal">..got</code>, <a class="indexterm" name="idp60864944" id="idp60864944"></a><code class="literal">..plt</code>
and <a class="indexterm" name="idp60866224" id="idp60866224"></a><code class="literal">..sym</code>. Their functions are summarized here:</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="literal">..gotpcrel</code></span></dt>
<dd>While RIP-relative addressing allows you to encode an instruction pointer relative
data reference to <code class="literal">foo</code> with <code class="literal">[rel
foo]</code>, it’s sometimes necessary to encode a RIP-relative reference to a
linker-generated symbol pointer for symbol foo; this is done using <code class="literal">wrt ..gotpcrel</code>, e.g. <code class="literal">[rel foo wrt
..gotpcrel]</code>. Unlike in <code class="literal">elf32</code>, this relocation,
combined with RIP-relative addressing, makes it possible to load an address from the
((global offset table)) using a single instruction. Note that since RIP-relative
references are limited to a signed 32-bit displacement, the <a class="indexterm" name="idp60876336" id="idp60876336"></a>GOT size accessible through this method is limited to
2 GB.</dd>
<dt><span class="term"><code class="literal">..got</code></span></dt>
<dd>As in <code class="literal">elf32</code>, referring to an external or global symbol
using <code class="literal">wrt ..got</code> causes the linker to build an entry
<span class="emphasis"><em>in</em></span> the GOT containing the address of the symbol,
and the reference gives the distance from the beginning of the GOT to the entry; so you
can add on the address of the GOT, load from the resulting address, and end up with the
address of the symbol.</dd>
<dt><span class="term"><code class="literal">..plt</code></span></dt>
<dd>As in <code class="literal">elf32</code>, referring to a procedure name using
<code class="literal">wrt ..plt</code> causes the linker to build a <a class="indexterm" name="idp60883760" id="idp60883760"></a>procedure linkage table entry for the symbol, and
the reference gives the address of the <a class="indexterm" name="idp60884400" id="idp60884400"></a>PLT entry. You can only use this in contexts which would generate a
PC-relative relocation normally (i.e. as the destination for <code class="literal">CALL</code> or <code class="literal">JMP</code>), since ELF contains no
relocation type to refer to PLT entries absolutely.</dd>
<dt><span class="term"><code class="literal">..sym</code></span></dt>
<dd>As in <code class="literal">elf32</code>, referring to a symbol name using
<code class="literal">wrt ..sym</code> causes Yasm to write an ordinary relocation, but
instead of making the relocation relative to the start of the section and then adding on
the offset to the symbol, it will write a relocation record aimed directly at the symbol
in question. The distinction is a necessary one due to a peculiarity of the dynamic
linker.</dd>
</dl>
</div>
</div>
</div>
<div class="chapter" title="Глава 10. macho32: Mach 32-bit Object File Format">
<div class="titlepage">
<div>
<div>
<h2 class="title"><a name="objfmt-macho32" id="objfmt-macho32"></a>Глава 10.
<code class="literal">macho32</code>: Mach 32-bit Object File Format</h2>
</div>
</div>
</div>
<p><a class="indexterm" name="idp60895408" id="idp60895408"></a> <a class="indexterm" name="idp60897072" id="idp60897072"></a> <a class="indexterm" name="idp60898224" id="idp60898224"></a> <a class="indexterm" name="idp60899120" id="idp60899120"></a></p>
</div>
<div class="chapter" title="Глава 11. macho64: Mach 64-bit Object File Format">
<div class="titlepage">
<div>
<div>
<h2 class="title"><a name="objfmt-macho64" id="objfmt-macho64"></a>Глава 11.
<code class="literal">macho64</code>: Mach 64-bit Object File Format</h2>
</div>
</div>
</div>
<p><a class="indexterm" name="idp60901424" id="idp60901424"></a> <a class="indexterm" name="idp60903216" id="idp60903216"></a> <a class="indexterm" name="idp60904368" id="idp60904368"></a> <a class="indexterm" name="idp60905264" id="idp60905264"></a></p>
</div>
<div class="chapter" title="Глава 12. rdf: Relocatable Dynamic Object File Format">
<div class="titlepage">
<div>
<div>
<h2 class="title"><a name="objfmt-rdf" id="objfmt-rdf"></a>Глава 12. <code class="literal">rdf</code>: Relocatable Dynamic Object File Format</h2>
</div>
</div>
</div>
<p><a class="indexterm" name="idp60907568" id="idp60907568"></a> <a class="indexterm" name="idp60908720" id="idp60908720"></a> <a class="indexterm" name="idp60909616" id="idp60909616"></a></p>
</div>
<div class="chapter" title="Глава 13. win32: Microsoft Win32 Object Files">
<div class="titlepage">
<div>
<div>
<h2 class="title"><a name="objfmt-win32" id="objfmt-win32"></a>Глава 13.
<code class="literal">win32</code>: Microsoft Win32 Object Files</h2>
</div>
</div>
</div>
<p><a class="indexterm" name="idp60912048" id="idp60912048"></a> <a class="indexterm" name="idp60913200" id="idp60913200"></a> <a class="indexterm" name="idp60914096" id="idp60914096"></a> The <a class="indexterm" name="idp60914992" id="idp60914992"></a><code class="literal">win32</code> object format generates Microsoft
<a class="indexterm" name="idp60916272" id="idp60916272"></a>Win32 object files for use
on the 32-bit native <a class="indexterm" name="idp60916912" id="idp60916912"></a>Windows
XP (and Vista) platforms. Object files produced using this object format may be linked
with 32-bit Microsoft linkers such as <a class="indexterm" name="idp60917552" id="idp60917552"></a>Visual Studio in order to produce 32-bit <a class="indexterm" name="idp60918192" id="idp60918192"></a>PE executables.</p>
</div>
<div class="chapter" title="Глава 14. win64: PE32+ (Microsoft Win64) Object Files">
<div class="titlepage">
<div>
<div>
<h2 class="title"><a name="objfmt-win64" id="objfmt-win64"></a>Глава 14.
<code class="literal">win64</code>: PE32+ (Microsoft Win64) Object Files</h2>
</div>
</div>
</div>
<div class="toc">
<p><b>Содержание</b></p>
<dl>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#objfmt-win64-section">14.1. <code class="literal">win64</code> Extensions to the <code class="literal">SECTION</code>
Directive</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#objfmt-win64-exception">14.2. <code class="literal">win64</code> Structured Exception Handling</a></span></dt>
<dd>
<dl>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#objfmt-win64-calling-convention">14.2.1. x64 Stack,
Register and Function Parameter Conventions</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#objfmt-win64-function-types">14.2.2. Types of
Functions</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#objfmt-win64-function-structure">14.2.3. Frame
Function Structure</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#objfmt-win64-frame-details">14.2.4. Stack Frame
Details</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#objfmt-win64-unwind-primitives">14.2.5. Yasm
Primitives for Unwind Operations</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#objfmt-win64-unwind-macros">14.2.6. Yasm Macros for
Formal Stack Operations</a></span></dt>
</dl>
</dd>
</dl>
</div>
<p><a class="indexterm" name="idp60920496" id="idp60920496"></a> <a class="indexterm" name="idp60921648" id="idp60921648"></a> <a class="indexterm" name="idp60922544" id="idp60922544"></a> The <a class="indexterm" name="idp60923440" id="idp60923440"></a><code class="literal">win64</code> or <a class="indexterm" name="idp60924720" id="idp60924720"></a><code class="literal">x64</code> object format
generates Microsoft <a class="indexterm" name="idp60926000" id="idp60926000"></a>Win64
object files for use on the 64-bit native <a class="indexterm" name="idp60930864" id="idp60930864"></a>Windows XP x64 (and Vista x64) platforms. Object files produced using
this object format may be linked with 64-bit Microsoft linkers such as that in <a class="indexterm" name="idp60931504" id="idp60931504"></a>Visual Studio 2005 and 2008 in order
to produce 64-bit <a class="indexterm" name="idp60932144" id="idp60932144"></a>PE32+
executables.</p>
<p><code class="literal">win64</code> provides a default output filename extension of
<code class="literal">.obj</code>.</p>
<div class="section" title="14.1. win64 Extensions to the SECTION Directive">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="objfmt-win64-section" id="objfmt-win64-section"></a>14.1. <code class="literal">win64</code> Extensions to the
<code class="literal">SECTION</code> Directive</h2>
</div>
</div>
</div>
<p>Like the <code class="literal">win32</code> format, <code class="literal">win64</code>
allows you to specify additional information on the <code class="literal">SECTION</code>
directive line, to control the type and properties of sections you declare.</p>
</div>
<div class="section" title="14.2. win64 Structured Exception Handling">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="objfmt-win64-exception" id="objfmt-win64-exception"></a>14.2. <code class="literal">win64</code> Structured
Exception Handling</h2>
</div>
</div>
</div>
<p><a class="indexterm" name="idp60943408" id="idp60943408"></a> <a class="indexterm" name="idp60944560" id="idp60944560"></a> <a class="indexterm" name="idp60945712" id="idp60945712"></a> <a class="indexterm" name="idp60947120" id="idp60947120"></a> Most
functions that make use of the stack in 64-bit versions of Windows must support exception
handling even if they make no internal use of such facilities. This is because these
operating systems locate exception handlers by using a process called <span class="quote">«<span class="quote">stack unwinding</span>»</span> that depends on functions
providing data that describes how they use the stack.</p>
<p>When an exception occurs the stack is <span class="quote">«<span class="quote">unwound</span>»</span> by working backwards through the chain of function calls
prior to the exception event to determine whether functions have appropriate exception
handlers or whether they have saved non-volatile registers whose value needs to be
restored in order to reconstruct the execution context of the next higher function in the
chain. This process depends on compilers and assemblers providing <span class="quote">«<span class="quote"><a class="indexterm" name="idp60949296" id="idp60949296"></a>unwind data</span>»</span> for functions.</p>
<p>The following sections give details of the mechanisms that are available in Yasm to
meet these needs and thereby allow functions written in assembler to comply with the
coding conventions used in 64-bit versions of Windows. These Yasm facilities follow those
provided in MASM.</p>
<div class="section" title="14.2.1. x64 Stack, Register and Function Parameter Conventions">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="objfmt-win64-calling-convention" id="objfmt-win64-calling-convention"></a>14.2.1. x64 Stack, Register and Function Parameter
Conventions</h3>
</div>
</div>
</div>
<p><a class="xref" href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#win64-calling-convention" title="Рисунок 14.1. x64 Calling Convention">Рисунок&nbsp;14.1</a> shows how the
stack is typically used in function calls. When a function is called, an 8 byte return
address is automatically pushed onto the stack and the function then saves any
non-volatile registers that it will use. Additional space can also be allocated for local
variables and a frame pointer register can be assigned if needed.</p>
<div class="figure"><a name="win64-calling-convention" id="win64-calling-convention"></a>
<p class="title"><b>Рисунок 14.1. x64 Calling Convention</b></p>
<div class="figure-contents">
<div class="mediaobject"><img src="./Yasm User Manual_files/calling-convention.png" alt="x64 Calling Convention"></div>
</div>
</div>
<br class="figure-break">
<p>The first four integer function parameters are passed (in left to right order) in the
registers RCX, RDX, R8 and R9. Further integer parameters are passed on the stack by
pushing them in right to left order (parameters to the left at lower addresses). Stack
space is allocated for the four register parameters (<span class="quote">«<span class="quote">shadow space</span>»</span>) but their values are not stored by the calling
function so the called function must do this if necessary. The called function
effectively owns this space and can use it for any purpose, so the calling function
cannot rely on its contents on return. Register parameters occupy the least significant
ends of registers and shadow space must be allocated for four register parameters even if
the called function doesn’t have this many parameters.</p>
<p>The first four floating point parameters are passed in XMM0 to XMM3. When integer and
floating point parameters are mixed, the correspondence between parameters and registers
is not changed. Hence an integer parameter after two floating point ones will be in R8
with RCX and RDX unused.</p>
<p>When they are passed by value, structures and unions whose sizes are 8, 16, 32 or 64
bits are passed as if they are integers of the same size. Arrays and larger structures
and unions are passed as pointers to memory allocated and assigned by the calling
function.</p>
<p>The registers RAX, RCX, RDX, R8, R9, R10, R11 are volatile and can be freely used by a
called function without preserving their values (note, however, that some may be used to
pass parameters). In consequence functions cannot expect these registers to be preserved
across calls to other functions.</p>
<p>The registers RBX, RBP, RSI, RDI, R12, R13, R14, R15, and XMM6 to XMM15 are
non-volatile and must be saved and restored by functions that use them.</p>
<p>Except for floating point values, which are returned in XMM0, function return values
that fit in 64 bits are returned in RAX. Some 128-bit values are also passed in XMM0 but
larger values are returned in memory assigned by the calling program and pointed to by an
additional <span class="quote">«<span class="quote">hidden</span>»</span> function
parameter that becomes the first parameter and pushes other parameters to the right. This
pointer value must also be passed back to the calling program in RAX when the called
program returns.</p>
</div>
<div class="section" title="14.2.2. Types of Functions">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="objfmt-win64-function-types" id="objfmt-win64-function-types"></a>14.2.2. Types of Functions</h3>
</div>
</div>
</div>
<p>Functions that allocate stack space, call other functions, save non-volatile registers
or use exception handling are called <span class="quote">«<span class="quote">frame
functions</span>»</span>; other functions are called <span class="quote">«<span class="quote">leaf functions</span>»</span>.</p>
<p>Frame functions use an area on the stack called a <span class="quote">«<span class="quote">stack frame</span>»</span> and have a defined prologue in which this is set up.
Typically they save register parameters in their shadow locations (if needed), save any
non-volatile registers that they use, allocate stack space for local variables, and
establish a register as a stack frame pointer. They must also have one or more defined
epilogues that free any allocated stack space and restore non-volatile registers before
returning to the calling function.</p>
<p>Unless stack space is allocated dynamically, a frame function must maintain the 16
byte alignment of the stack pointer whilst outside its prologue and epilogue code (except
during calls to other functions). A frame function that dynamically allocates stack space
must first allocate any fixed stack space that it needs and then allocate and set up a
register for indexed access to this area. The lower base address of this area must be 16
byte aligned and the register must be provided irrespective of whether the function
itself makes explicit use of it. The function is then free to leave the stack unaligned
during execution although it must re-establish the 16 byte alignment if or when it calls
other functions.</p>
<p>Leaf functions do not require defined prologues or epilogues but they must not call
other functions; nor can they change any non-volatile register or the stack pointer
(which means that they do not maintain 16 byte stack alignment during execution). They
can, however, exit with a jump to the entry point of another frame or leaf function
provided that the respective stacked parameters are compatible.</p>
<p>These rules are summarized in <a class="xref" href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#objfmt-win64-function-types-table" title="Таблица 14.1. Function Structured Exception Handling Rules">Таблица&nbsp;14.1</a>
(function code that is not part of a prologue or an epilogue are referred to in the table
as the function’s body).</p>
<div class="table"><a name="objfmt-win64-function-types-table" id="objfmt-win64-function-types-table"></a>
<p class="title"><b>Таблица 14.1. Function Structured Exception Handling
Rules</b></p>
<div class="table-contents">
<table summary="Function Structured Exception Handling Rules" border="1">
<colgroup>
<col class="col_1">
<col class="col_2">
<col class="col_3">
<col class="col_4"></colgroup>
<thead>
<tr>
<th align="left" valign="top">Function needs or can:</th>
<th align="center" valign="top">Frame Function with Frame Pointer Register</th>
<th align="center" valign="top">Frame Function without Frame Pointer Register</th>
<th align="center" valign="top">Leaf Function</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top">
<p>prologue and epilogue(s)</p>
</td>
<td align="center" valign="top">
<p>yes</p>
</td>
<td align="center" valign="top">
<p>yes</p>
</td>
<td align="center" valign="top">
<p>no</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p>use exception handling</p>
</td>
<td align="center" valign="top">
<p>yes</p>
</td>
<td align="center" valign="top">
<p>yes</p>
</td>
<td align="center" valign="top">
<p>no</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p>allocate space on the stack</p>
</td>
<td align="center" valign="top">
<p>yes</p>
</td>
<td align="center" valign="top">
<p>yes</p>
</td>
<td align="center" valign="top">
<p>no</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p>save or push registers onto the stack</p>
</td>
<td align="center" valign="top">
<p>yes</p>
</td>
<td align="center" valign="top">
<p>yes</p>
</td>
<td align="center" valign="top">
<p>no</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p>use non-volatile registers (after saving)</p>
</td>
<td align="center" valign="top">
<p>yes</p>
</td>
<td align="center" valign="top">
<p>yes</p>
</td>
<td align="center" valign="top">
<p>no</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p>use dynamic stack allocation</p>
</td>
<td align="center" valign="top">
<p>yes</p>
</td>
<td align="center" valign="top">
<p>no</p>
</td>
<td align="center" valign="top">
<p>no</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p>change stack pointer in function body</p>
</td>
<td align="center" valign="top">
<p>yes <sup>[<a name="objfmt-win64-fn1" href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#ftn.objfmt-win64-fn1" class="footnote" id="objfmt-win64-fn1">a</a>]</sup></p>
</td>
<td align="center" valign="top">
<p>no</p>
</td>
<td align="center" valign="top">
<p>no</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p>unaligned stack pointer in function body</p>
</td>
<td align="center" valign="top">
<p>yes <sup>[<a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#ftn.objfmt-win64-fn1" class="footnoteref">a</a>]</sup></p>
</td>
<td align="center" valign="top">
<p>no</p>
</td>
<td align="center" valign="top">
<p>yes</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p>make calls to other functions</p>
</td>
<td align="center" valign="top">
<p>yes</p>
</td>
<td align="center" valign="top">
<p>yes</p>
</td>
<td align="center" valign="top">
<p>no</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p>make jumps to other functions</p>
</td>
<td align="center" valign="top">
<p>no</p>
</td>
<td align="center" valign="top">
<p>no</p>
</td>
<td align="center" valign="top">
<p>yes <sup>[<a name="idp61018160" href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#ftn.idp61018160" class="footnote" id="idp61018160">b</a>]</sup></p>
</td>
</tr>
</tbody>
<tbody class="footnotes">
<tr>
<td colspan="4">
<div class="footnote">
<p><sup>[<a id="ftn.objfmt-win64-fn1" href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#objfmt-win64-fn1" class="simpara" name="ftn.objfmt-win64-fn1">a</a>]</sup> but 16 byte stack alignment must be re-established
when any functions are called.</p>
</div>
<div class="footnote">
<p><sup>[<a id="ftn.idp61018160" href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#idp61018160" class="simpara" name="ftn.idp61018160">b</a>]</sup> but the function parameters in registers and on the stack
must be compatible.</p>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<br class="table-break"></div>
<div class="section" title="14.2.3. Frame Function Structure">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="objfmt-win64-function-structure" id="objfmt-win64-function-structure"></a>14.2.3. Frame Function Structure</h3>
</div>
</div>
</div>
<p>As already indicated, frame functions must have a well defined structure including a
prologue and one or more epilogues, each of a specific form. The code in a function that
is not part of its prologue or its one or more epilogues will be referred to here as the
function’s body.</p>
<p>A typical function prologue has the form:</p>
<pre class="programlisting">    mov     [rsp+8],rcx         ; store parameter in shadow space if necessary
    push    r14                 ; save any non-volatile registers to be used
    push    r13                 ;
    sub     rsp,size            ; allocate stack for local variables if needed
    lea     r13,[bias+rsp]      ; use r13 as a frame pointer with an offset
</pre>
<p>When a frame pointer is needed the programmer can choose which register is used
(<span class="quote">«<span class="quote">bias</span>»</span> will be explained later).
Although it does not have to be used for access to the allocated space, it must be
assigned in the prologue and remain unchanged during the execution of the body of the
function.</p>
<p>If a large amount of stack space is used it is also necessary to call <code class="literal">__chkstk</code> with size in RAX prior to allocating this stack space in order
to add memory pages to the stack if needed (see the Microsoft Visual Studio 2005
documentation for further details).</p>
<p>The matching form of the epilogue is:</p>
<pre class="programlisting">    lea     rsp,[r13-bias]      ; this is not part of the official epilogue
    add     rsp,size            ; the official epilogue starts here
    pop     r13
    pop     r14
    ret
</pre>
<p>The following can also be used provided that a frame pointer register has been
established:</p>
<pre class="programlisting">    lea     rsp,[r13+size-bias]
    pop     r13
    pop     r14
    ret
</pre>
<p>These are the only two forms of epilogue allowed. It must start either with an
<code class="literal">add rsp,const</code> instruction or with <code class="literal">lea
rsp,[const+fp_register]</code>; the first form can be used either with or without a frame
pointer register but the second form requires one. These instructions are then followed
by zero or more 8 byte register pops and a return instruction (which can be replaced with
a limited set of jump instructions as described in Microsoft documentation). Epilogue
forms are highly restricted because this allows the exception dispatch code to locate
them without the need for unwind data in addition to that provided for the prologue.</p>
<p>The data on the location and length of each function prologue, on any fixed stack
allocation and on any saved non-volatile registers is recorded in special sections in the
object code. Yasm provides macros to create this data that will now be described (with
examples of the way they are used).</p>
</div>
<div class="section" title="14.2.4. Stack Frame Details">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="objfmt-win64-frame-details" id="objfmt-win64-frame-details"></a>14.2.4. Stack Frame Details</h3>
</div>
</div>
</div>
<p>There are two types of stack frame that need to be considered in creating unwind
data.</p>
<p>The first, shown at left in <a class="xref" href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#win64-stack-frame-detailed" title="Рисунок 14.2. x64 Detailed Stack Frame">Рисунок&nbsp;14.2</a>, involves only a
fixed allocation of space on the stack and results in a stack pointer that remains fixed
in value within the function’s body except during calls to other functions. In this
type of stack frame the stack pointer value at the end of the prologue is used as the
base for the offsets in the unwind primitives and macros described later. It must be 16
byte aligned at this point.</p>
<div class="figure"><a name="win64-stack-frame-detailed" id="win64-stack-frame-detailed"></a>
<p class="title"><b>Рисунок 14.2. x64 Detailed Stack Frame</b></p>
<div class="figure-contents">
<div class="mediaobject"><img src="./Yasm User Manual_files/stack-frame-detailed.png" alt="x64 Detailed Stack Frame"></div>
</div>
</div>
<br class="figure-break">
<p>In the second type of frame, shown in <a class="xref" href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#win64-stack-frame-detailed" title="Рисунок 14.2. x64 Detailed Stack Frame">Рисунок&nbsp;14.2</a>, stack space is
dynamically allocated with the result that the stack pointer value is statically
unpredictable and cannot be used as a base for unwind offsets. In this situation a frame
pointer register must be used to provide this base address. Here the base for unwind
offsets is the lower end of the fixed allocation area on the stack, which is typically
the value of the stack pointer when the frame register is assigned. It must be 16 byte
aligned and must be assigned before any unwind macros with offsets are used.</p>
<p>In order to allow the maximum amount of data to be accessed with single byte offsets
(-128 to \+127) from the frame pointer register, it is normal to offset its value towards
the centre of the allocated area (the <span class="quote">«<span class="quote">bias</span>»</span> introduced earlier). The identity of the frame pointer
register and this offset, which must be a multiple of 16 bytes, is recorded in the unwind
data to allow the stack frame base address to be calculated from the value in the frame
register.</p>
</div>
<div class="section" title="14.2.5. Yasm Primitives for Unwind Operations">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="objfmt-win64-unwind-primitives" id="objfmt-win64-unwind-primitives"></a>14.2.5. Yasm Primitives for Unwind Operations</h3>
</div>
</div>
</div>
<p>Here are the low level facilities Yasm provides to create unwind data.</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="literal">proc_frame <em class="replaceable"><code>name</code></em></code></span></dt>
<dd>Generates a function table entry in <code class="literal">.pdata</code> and unwind
information in <code class="literal">.xdata</code> for a function’s structured
exception handling data.</dd>
<dt><span class="term"><code class="literal">[pushreg <em class="replaceable"><code>reg</code></em>]</code></span></dt>
<dd>Generates unwind data for the specified non-volatile register. Use only for
non-volatile integer registers; for volatile registers use an <code class="literal">[allocstack 8]</code> instead.</dd>
<dt><span class="term"><code class="literal">[setframe <em class="replaceable"><code>reg</code></em>, <em class="replaceable"><code>offset</code></em>]</code></span></dt>
<dd>Generates unwind data for a frame register and its stack offset. The offset must be a
multiple of 16 and be less than or equal to 240.</dd>
<dt><span class="term"><code class="literal">[allocstack <em class="replaceable"><code>size</code></em>]</code></span></dt>
<dd>Generates unwind data for stack space. The size must be a multiple of 8.</dd>
<dt><span class="term"><code class="literal">[savereg <em class="replaceable"><code>reg</code></em>, <em class="replaceable"><code>offset</code></em>]</code></span></dt>
<dd>Generates unwind data for the specified register and offset; the offset must be
positive multiple of 8 relative to the base of the procedure’s frame.</dd>
<dt><span class="term"><code class="literal">[savexmm128 <em class="replaceable"><code>reg</code></em>, <em class="replaceable"><code>offset</code></em>]</code></span></dt>
<dd>Generates unwind data for the specified XMM register and offset; the offset must be
positive multiple of 16 relative to the base of the procedure’s frame.</dd>
<dt><span class="term"><code class="literal">[pushframe <em class="replaceable"><code>code</code></em>]</code></span></dt>
<dd>Generates unwind data for a 40 or 48 byte (with an optional error code) frame used to
store the result of a hardware exception or interrupt.</dd>
<dt><span class="term"><code class="literal">[endprolog]</code></span></dt>
<dd>Signals the end of the prologue; must be in the first 255 bytes of the function.</dd>
<dt><span class="term"><code class="literal">endproc_frame</code></span></dt>
<dd>Used at the end of functions started with <code class="literal">proc_frame</code>.</dd>
</dl>
</div>
<p><a class="xref" href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#objfmt-win64-unwind-primitives-example" title="Пример 14.1. Win64 Unwind Primitives">Пример&nbsp;14.1</a> shows how these
primitives are used (this is based on an example provided in Microsoft Visual Studio 2005
documentation).</p>
<div class="example"><a name="objfmt-win64-unwind-primitives-example" id="objfmt-win64-unwind-primitives-example"></a>
<p class="title"><b>Пример 14.1. Win64 Unwind Primitives</b></p>
<div class="example-contents">
<pre class="programlisting">PROC_FRAME      sample
    db          0x48            ; emit a REX prefix to enable hot-patching
    push        rbp             ; save prospective frame pointer
    [pushreg    rbp]            ; create unwind data for this rbp register push
    sub         rsp,0x40        ; allocate stack space
    [allocstack 0x40]           ; create unwind data for this stack allocation
    lea         rbp,[rsp+0x20]  ; assign the frame pointer with a bias of 32
    [setframe   rbp,0x20]       ; create unwind data for a frame register in rbp
    movdqa      [rbp],xmm7      ; save a non-volatile XMM register
    [savexmm128 xmm7, 0x20]     ; create unwind data for an XMM register save
    mov         [rbp+0x18],rsi  ; save rsi
    [savereg    rsi,0x38]       ; create unwind data for a save of rsi
    mov         [rsp+0x10],rdi  ; save rdi
    [savereg    rdi, 0x10]      ; create unwind data for a save of rdi
[endprolog]

    ; We can change the stack pointer outside of the prologue because we
    ; have a frame pointer.  If we didn't have one this would be illegal.
    ; A frame pointer is needed because of this stack pointer modification.

    sub         rsp,0x60        ; we are free to modify the stack pointer
    mov         rax,0           ; we can unwind this access violation
    mov         rax,[rax]

    movdqa      xmm7,[rbp]      ; restore the registers that weren't saved
    mov         rsi,[rbp+0x18]  ; with a push; this is not part of the
    mov         rdi,[rbp-0x10]  ; official epilog

    lea         rsp,[rbp-0x20]  ; This is the official epilog
    pop         rbp
    ret
ENDPROC_FRAME
</pre></div>
</div>
<br class="example-break"></div>
<div class="section" title="14.2.6. Yasm Macros for Formal Stack Operations">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="objfmt-win64-unwind-macros" id="objfmt-win64-unwind-macros"></a>14.2.6. Yasm Macros for Formal Stack Operations</h3>
</div>
</div>
</div>
<p>From the descriptions of the YASM primitives given earlier it can be seen that there
is a close relationship between each normal stack operation and the related primitive
needed to generate its unwind data. In consequence it is sensible to provide a set of
macros that perform both operations in a single macro call. Yasm provides the following
macros that combine the two operations.</p>
<div class="variablelist">
<dl>
<dt><span class="term"><code class="literal">proc_frame <em class="replaceable"><code>name</code></em></code></span></dt>
<dd>Generates a function table entry in <code class="literal">.pdata</code> and unwind
information in <code class="literal">.xdata</code>.</dd>
<dt><span class="term"><code class="literal">alloc_stack <em class="replaceable"><code>n</code></em></code></span></dt>
<dd>Allocates a stack area of <em class="replaceable"><code>n</code></em> bytes.</dd>
<dt><span class="term"><code class="literal">save_reg <em class="replaceable"><code>reg</code></em>, <em class="replaceable"><code>loc</code></em></code></span></dt>
<dd>Saves a non-volatile register <em class="replaceable"><code>reg</code></em> at offset
<em class="replaceable"><code>loc</code></em> on the stack.</dd>
<dt><span class="term"><code class="literal">push_reg <em class="replaceable"><code>reg</code></em></code></span></dt>
<dd>Pushes a non-volatile register <em class="replaceable"><code>reg</code></em> on the
stack.</dd>
<dt><span class="term"><code class="literal">rex_push_reg <em class="replaceable"><code>reg</code></em></code></span></dt>
<dd>Pushes a non-volatile register <em class="replaceable"><code>reg</code></em> on the
stack using a 2 byte push instruction.</dd>
<dt><span class="term"><code class="literal">save_xmm128 <em class="replaceable"><code>reg</code></em>, <em class="replaceable"><code>loc</code></em></code></span></dt>
<dd>Saves a non-volatile XMM register <em class="replaceable"><code>reg</code></em> at
offset <em class="replaceable"><code>loc</code></em> on the stack.</dd>
<dt><span class="term"><code class="literal">set_frame <em class="replaceable"><code>reg</code></em>, <em class="replaceable"><code>loc</code></em></code></span></dt>
<dd>Sets the frame register <em class="replaceable"><code>reg</code></em> to offset
<em class="replaceable"><code>loc</code></em> on the stack.</dd>
<dt><span class="term"><code class="literal">push_eflags</code></span></dt>
<dd>Pushes the eflags register</dd>
<dt><span class="term"><code class="literal">push_rex_eflags</code></span></dt>
<dd>Pushes the eflags register using a 2 byte push instruction (allows hot
patching).</dd>
<dt><span class="term"><code class="literal">push_frame <em class="replaceable"><code>code</code></em></code></span></dt>
<dd>Pushes a 40 byte frame and an optional 8 byte error code onto the stack.</dd>
<dt><span class="term"><code class="literal">end_prologue</code> ,</span> <span class="term"><code class="literal">end_prolog</code></span></dt>
<dd>Ends the function prologue (this is an alternative to <code class="literal">[endprolog]</code>).</dd>
<dt><span class="term"><code class="literal">endproc_frame</code></span></dt>
<dd>Used at the end of funtions started with <code class="literal">proc_frame</code>.</dd>
</dl>
</div>
<p><a class="xref" href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#objfmt-win64-unwind-macros-example" title="Пример 14.2. Win64 Unwind Macros">Пример&nbsp;14.2</a> is <a class="xref" href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#objfmt-win64-unwind-primitives-example" title="Пример 14.1. Win64 Unwind Primitives">Пример&nbsp;14.1</a> using these higher
level macros.</p>
<div class="example"><a name="objfmt-win64-unwind-macros-example" id="objfmt-win64-unwind-macros-example"></a>
<p class="title"><b>Пример 14.2. Win64 Unwind Macros</b></p>
<div class="example-contents">
<pre class="programlisting">PROC_FRAME       sample         ; start the prologue
    rex_push_reg rbp            ; push the prospective frame pointer
    alloc_stack  0x40           ; allocate 64 bytes of local stack space
    set_frame    rbp, 0x20      ; set a frame register to [rsp+32]
    save_xmm128  xmm7,0x20      ; save xmm7, rsi &amp;amp; rdi to the local stack space
    save_reg     rsi, 0x38      ;    unwind base address:  [rsp_after_entry - 72]
    save_reg     rdi, 0x10      ;    frame register value: [rsp_after_entry - 40]
END_PROLOGUE
    sub          rsp,0x60       ; we can now change the stack pointer
    mov          rax,0          ; and unwind this access violation
    mov          rax,[rax]      ; because we have a frame pointer

    movdqa       xmm7,[rbp]     ; restore the registers that weren't saved with
    mov          rsi,[rbp+0x18] ; a push (not a part of the official epilog)
    mov          rdi,[rbp-0x10]

    lea          rsp,[rbp-0x20] ; the official epilogue
    pop          rbp
    ret
ENDPROC_FRAME
</pre></div>
</div>
<br class="example-break"></div>
</div>
</div>
<div class="chapter" title="Глава 15. xdf: Extended Dynamic Object Format">
<div class="titlepage">
<div>
<div>
<h2 class="title"><a name="objfmt-xdf" id="objfmt-xdf"></a>Глава 15. <code class="literal">xdf</code>: Extended Dynamic Object Format</h2>
</div>
</div>
</div>
<p><a class="indexterm" name="idp61245872" id="idp61245872"></a> <a class="indexterm" name="idp61251248" id="idp61251248"></a></p>
</div>
</div>
<div class="part" title="Часть VI. Debugging Formats">
<div class="titlepage">
<div>
<div>
<h1 class="title"><a name="dbgfmts" id="dbgfmts"></a>Часть&nbsp;VI.&nbsp;Debugging
Formats</h1>
</div>
</div>
</div>
<div class="partintro" title="Debugging Formats">
<p>The chapters in this part of the book document Yasm’s support for various debugging
formats.</p>
<div class="toc">
<p><b>Содержание</b></p>
<dl>
<dt><span class="chapter"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#dbgfmt-cv8">16. <code class="literal">cv8</code>:
CodeView Debugging Format for VC8</a></span></dt>
<dt><span class="chapter"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#dbgfmt-dwarf2">17. <code class="literal">dwarf2</code>: DWARF2 Debugging Format</a></span></dt>
<dt><span class="chapter"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#dbgfmt-stabs">18. <code class="literal">stabs</code>:
Stabs Debugging Format</a></span></dt>
</dl>
</div>
</div>
<div class="chapter" title="Глава 16. cv8: CodeView Debugging Format for VC8">
<div class="titlepage">
<div>
<div>
<h2 class="title"><a name="dbgfmt-cv8" id="dbgfmt-cv8"></a>Глава 16. <code class="literal">cv8</code>: CodeView Debugging Format for VC8</h2>
</div>
</div>
</div>
<p><a class="indexterm" name="idp61255344" id="idp61255344"></a> <a class="indexterm" name="idp61256496" id="idp61256496"></a> <a class="indexterm" name="idp61257392" id="idp61257392"></a> <a class="indexterm" name="idp61262512" id="idp61262512"></a></p>
</div>
<div class="chapter" title="Глава 17. dwarf2: DWARF2 Debugging Format">
<div class="titlepage">
<div>
<div>
<h2 class="title"><a name="dbgfmt-dwarf2" id="dbgfmt-dwarf2"></a>Глава 17.
<code class="literal">dwarf2</code>: DWARF2 Debugging Format</h2>
</div>
</div>
</div>
<p><a class="indexterm" name="idp61264816" id="idp61264816"></a> <a class="indexterm" name="idp61265968" id="idp61265968"></a> <a class="indexterm" name="idp61266864" id="idp61266864"></a> <a class="indexterm" name="idp61268016" id="idp61268016"></a>
<a class="indexterm" name="idp61268912" id="idp61268912"></a></p>
</div>
<div class="chapter" title="Глава 18. stabs: Stabs Debugging Format">
<div class="titlepage">
<div>
<div>
<h2 class="title"><a name="dbgfmt-stabs" id="dbgfmt-stabs"></a>Глава 18.
<code class="literal">stabs</code>: Stabs Debugging Format</h2>
</div>
</div>
</div>
<p><a class="indexterm" name="idp61271344" id="idp61271344"></a> <a class="indexterm" name="idp61272496" id="idp61272496"></a> <a class="indexterm" name="idp61273648" id="idp61273648"></a> <a class="indexterm" name="idp61274544" id="idp61274544"></a>
<a class="indexterm" name="idp61275696" id="idp61275696"></a> <a class="indexterm" name="idp61276592" id="idp61276592"></a></p>
</div>
</div>
<div class="part" title="Часть VII. Architectures">
<div class="titlepage">
<div>
<div>
<h1 class="title"><a name="architectures" id="architectures"></a>Часть&nbsp;VII.&nbsp;Architectures</h1>
</div>
</div>
</div>
<div class="partintro" title="Architectures">
<p>The chapters in this part of the book document Yasm’s support for various
instruction set architectures.</p>
<div class="toc">
<p><b>Содержание</b></p>
<dl>
<dt><span class="chapter"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#arch-x86">19. x86 Architecture</a></span></dt>
<dd>
<dl>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#arch-x86-instructions">19.1.
Instructions</a></span></dt>
<dd>
<dl>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#arch-x86-nop">19.1.1. NOP Padding</a></span></dt>
</dl>
</dd>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#arch-x86-modes">19.2. Execution Modes and
Extensions</a></span></dt>
<dd>
<dl>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#arch-x86-cpu">19.2.1. CPU Options</a></span></dt>
</dl>
</dd>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#arch-x86-registers">19.3. Registers</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#arch-x86-segmentation">19.4.
Segmentation</a></span></dt>
</dl>
</dd>
</dl>
</div>
</div>
<div class="chapter" title="Глава 19. x86 Architecture">
<div class="titlepage">
<div>
<div>
<h2 class="title"><a name="arch-x86" id="arch-x86"></a>Глава 19. x86
Architecture</h2>
</div>
</div>
</div>
<div class="toc">
<p><b>Содержание</b></p>
<dl>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#arch-x86-instructions">19.1.
Instructions</a></span></dt>
<dd>
<dl>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#arch-x86-nop">19.1.1. NOP Padding</a></span></dt>
</dl>
</dd>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#arch-x86-modes">19.2. Execution Modes and
Extensions</a></span></dt>
<dd>
<dl>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#arch-x86-cpu">19.2.1. CPU Options</a></span></dt>
</dl>
</dd>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#arch-x86-registers">19.3. Registers</a></span></dt>
<dt><span class="section"><a href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#arch-x86-segmentation">19.4.
Segmentation</a></span></dt>
</dl>
</div>
<p><a class="indexterm" name="idp61280432" id="idp61280432"></a> The <a class="indexterm" name="idp61281328" id="idp61281328"></a>x86 architecture is the generic name for a
multi-vendor 16-bit, 32-bit, and most recently 64-bit architecture. It was originally
developed by Intel in the 8086 series of CPU, extended to 32-bit by Intel in the 80386
CPU, and extended by AMD to 64 bits in the Opteron and Athlon 64 CPU lines. While as of
2007, Intel and AMD are the highest volume manufacturers of x86 CPUs, many other vendors
have also manufactured x86 CPUs. Generally the manufacturers have cross-licensed (or
copied) major improvements to the architecture, but there are some unique features
present in many of the implementations.</p>
<div class="section" title="19.1. Instructions">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="arch-x86-instructions" id="arch-x86-instructions"></a>19.1. Instructions</h2>
</div>
</div>
</div>
<p>The x86 architecture has a variable instruction size that allows for moderate code
compression while also allowing for very complex operand combinations as well as a very
large instruction set size with many extensions. Instructions generally vary from zero to
three operands with only a single memory operand allowed.</p>
<div class="section" title="19.1.1. NOP Padding">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="arch-x86-nop" id="arch-x86-nop"></a>19.1.1. NOP Padding</h3>
</div>
</div>
</div>
<p><a class="indexterm" name="idp61284144" id="idp61284144"></a> <a class="indexterm" name="idp61285296" id="idp61285296"></a> <a class="indexterm" name="idp61286192" id="idp61286192"></a> <a class="indexterm" name="idp61287728" id="idp61287728"></a></p>
<p>Different processors have different recommendations for the <a class="indexterm" name="idp61288880" id="idp61288880"></a>NOP (no operation) instructions used for <a class="indexterm" name="idp61289520" id="idp61289520"></a>padding in code. Padding is commonly
performed to align loop boundaries to maximize performance, and it is key that the
padding itself add minimal overhead. While the one-byte NOP <code class="literal">90h</code> is standard across all x86 implementations, more recent generations
of processors recommend different variations for longer padding sequences for optimal
performance. Most processors that claim a 686 (e.g. Pentium Pro) generation or newer
featureset support the <span class="quote">«<span class="quote">long</span>»</span> NOP
opcode <code class="literal">0Fh 1Fh</code>, although this opcode was undocumented until
recently. Older processors that do not support these dedicated long NOP opcodes generally
recommended alternative longer NOP sequences; while these sequences work as NOPs, they
can cause decoding inefficiencies on newer processors.</p>
<p>Because of the various NOP recommendations, the code generated by the Yasm
<code class="literal">ALIGN</code> directive depends on both the execution mode
(<code class="literal">BITS</code>) setting and the processor selected by the
<code class="literal">CPU</code> directive (see <a class="xref" href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#arch-x86-cpu" title="19.2.1. CPU Options">Раздел&nbsp;19.2.1</a>). <a class="xref" href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#x86-nop-modes" title="Таблица 19.1. x86 NOP Padding Modes">Таблица&nbsp;19.1</a> lists the various
combinations of generated NOPs.</p>
<div class="table"><a name="x86-nop-modes" id="x86-nop-modes"></a>
<p class="title"><b>Таблица 19.1. x86 NOP Padding Modes</b></p>
<div class="table-contents">
<table summary="x86 NOP Padding Modes" border="1">
<colgroup>
<col class="col_1">
<col class="col_2">
<col class="col_3"></colgroup>
<thead>
<tr>
<th align="left" valign="top"><code class="literal">BITS</code></th>
<th align="left" valign="top"><code class="literal">CPU</code></th>
<th align="left" valign="top">Padding</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top">
<p><code class="literal">16</code></p>
</td>
<td align="left" valign="top">
<p>Any</p>
</td>
<td align="left" valign="top">
<p>16-bit short NOPs</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><code class="literal">32</code></p>
</td>
<td align="left" valign="top">
<p>None given, or less than <code class="literal">686</code></p>
</td>
<td align="left" valign="top">
<p>32-bit short NOPs (no long NOPs)</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><code class="literal">32</code></p>
</td>
<td align="left" valign="top">
<p><code class="literal">686</code> or newer Intel processor</p>
</td>
<td align="left" valign="top">
<p>Intel guidelines, using long NOPs</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><code class="literal">32</code></p>
</td>
<td align="left" valign="top">
<p><code class="literal">K6</code> or newer AMD processor</p>
</td>
<td align="left" valign="top">
<p>AMD K10 guidelines, using long NOPs</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><code class="literal">64</code></p>
</td>
<td align="left" valign="top">
<p>None</p>
</td>
<td align="left" valign="top">
<p>Intel guidelines, using long NOPs</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><code class="literal">64</code></p>
</td>
<td align="left" valign="top">
<p><code class="literal">686</code> or newer Intel processor</p>
</td>
<td align="left" valign="top">
<p>Intel guidelines, using long NOPs</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><code class="literal">64</code></p>
</td>
<td align="left" valign="top">
<p><code class="literal">K6</code> or newer AMD processor</p>
</td>
<td align="left" valign="top">
<p>AMD K10 guidelines, using long NOPs</p>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<br class="table-break">
<p>In addition, the above defaults may be overridden by passing one of the options in
<a class="xref" href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#x86-nop-cpu" title="Таблица 19.2. x86 NOP CPU Directive Options">Таблица&nbsp;19.2</a> to the
<code class="literal">CPU</code> directive.</p>
<div class="table"><a name="x86-nop-cpu" id="x86-nop-cpu"></a>
<p class="title"><b>Таблица 19.2. x86 NOP <code class="literal">CPU</code>
Directive Options</b></p>
<div class="table-contents">
<table summary="x86 NOP CPU Directive Options" border="1">
<colgroup>
<col class="col_1">
<col class="col_2"></colgroup>
<thead>
<tr>
<th align="left" valign="top">Name</th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top">
<p><a class="indexterm" name="idp61352624" id="idp61352624"></a><code class="literal">basicnop</code></p>
</td>
<td align="left" valign="top">
<p>Long NOPs not used</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><a class="indexterm" name="idp61355568" id="idp61355568"></a><code class="literal">intelnop</code></p>
</td>
<td align="left" valign="top">
<p>Intel guidelines, using long NOPs</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><a class="indexterm" name="idp61358640" id="idp61358640"></a><code class="literal">amdnop</code></p>
</td>
<td align="left" valign="top">
<p>AMD K10 guidelines, using long NOPs</p>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<br class="table-break"></div>
</div>
<div class="section" title="19.2. Execution Modes and Extensions">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="arch-x86-modes" id="arch-x86-modes"></a>19.2. Execution Modes and Extensions</h2>
</div>
</div>
</div>
<p>The x86 has been extended in many ways throughout its history, remaining mostly
backwards compatible while adding execution modes and large extensions to the instruction
set. A modern x86 processor can operate in one of four major modes: 16-bit real mode,
16-bit protected mode, 32-bit protected mode, and 64-bit long mode. The primary
difference between real and protected mode is in the handling of segments: in real mode
the segments directly address memory as 16-byte pages, whereas in protected mode the
segments are instead indexes into a descriptor table that contains the physical base and
size of the segment. 32-bit protected mode allows paging and virtual memory as well as a
32-bit rather than a 16-bit offset.</p>
<p>The 16-bit and 32-bit operating modes both allow for use of both 16-bit and 32-bit
registers via instruction prefixes that set the operation and address size to either
16-bit or 32-bit, with the active operating mode setting the default operation size and
the <span class="quote">«<span class="quote">other</span>»</span> size being flagged
with a prefix. These operation and address sizes also affect the size of immediate
operands: for example, an instruction with a 32-bit operation size with an immediate
operand will have a 32-bit value in the encoded instruction, excepting optimizations such
as sign-extended 8-bit values.</p>
<p>Unlike the 16-bit and 32-bit modes, 64-bit long mode is more of a break from the
<span class="quote">«<span class="quote">legacy</span>»</span> modes. Long mode
obsoletes several instructions. It is also the only mode in which 64-bit registers are
available; 64-bit registers cannot be accessed from either 16-bit or 32-bit mode. Also,
unlike the other modes, most encoded values in long mode are limited to 32 bits in size.
A small subset of the <code class="literal">MOV</code> instructions allow 64 bit encoded
values, but values greater than 32 bits in other instructions must come from a register.
Partly due to this limitation, but also due to the wide use of relocatable shared
libraries, long mode also adds a new addressing mode: <code class="literal">RIP</code>-relative.</p>
<div class="section" title="19.2.1. CPU Options">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="arch-x86-cpu" id="arch-x86-cpu"></a>19.2.1. CPU Options</h3>
</div>
</div>
</div>
<p>The NASM parser allows setting what subsets of instructions and operands are accepted
by Yasm via use of the <code class="literal">CPU</code> directive (see <a class="xref" href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-directive-cpu" title="4.8. CPU: Defining CPU Dependencies">Раздел&nbsp;4.8</a>). As the x86 architecture has
a very large number of extensions, both specific feature flags such as <span class="quote">«<span class="quote">SSE3</span>»</span> and CPU names such as <span class="quote">«<span class="quote">P4</span>»</span> can be specified. The feature flags have
both normal and <span class="quote">«<span class="quote">no</span>»</span>-prefixed
versions to turn on and off a single feature, while the CPU names turn on only the
features listed, turning off all other features. <a class="xref" href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#x86-cpu-features" title="Таблица 19.3. x86 CPU Feature Flags">Таблица&nbsp;19.3</a> lists the
feature flags, and <a class="xref" href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#x86-cpus" title="Таблица 19.4. x86 CPU Names">Таблица&nbsp;19.4</a> lists the CPU names Yasm
supports. Having both feature flags and CPU names allows for combinations such as
<code class="literal">CPU P3 nofpu</code>. Both feature flags and CPU names are case
insensitive.</p>
<div class="table"><a name="x86-cpu-features" id="x86-cpu-features"></a>
<p class="title"><b>Таблица 19.3. x86 CPU Feature Flags</b></p>
<div class="table-contents">
<table summary="x86 CPU Feature Flags" border="1">
<colgroup>
<col class="col_1">
<col class="col_2"></colgroup>
<thead>
<tr>
<th align="left" valign="top">Name</th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top">
<p><code class="literal">FPU</code></p>
</td>
<td align="left" valign="top">
<p>Floating Point Unit (FPU) instructions</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><code class="literal">MMX</code></p>
</td>
<td align="left" valign="top">
<p>MMX SIMD instructions</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><code class="literal">SSE</code></p>
</td>
<td align="left" valign="top">
<p>Streaming SIMD Extensions (SSE) instructions</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><code class="literal">SSE2</code></p>
</td>
<td align="left" valign="top">
<p>Streaming SIMD Extensions 2 instructions</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><code class="literal">SSE3</code></p>
</td>
<td align="left" valign="top">
<p>Streaming SIMD Extensions 3 instructions</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><code class="literal">SSSE3</code></p>
</td>
<td align="left" valign="top">
<p>Supplemental Streaming SIMD Extensions 3 instructions</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><code class="literal">SSE4.1</code></p>
</td>
<td align="left" valign="top">
<p>Streaming SIMD Extensions 4, Penryn subset (47 instructions)</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><code class="literal">SSE4.2</code></p>
</td>
<td align="left" valign="top">
<p>Streaming SIMD Extensions 4, Nehalem subset (7 instructions)</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><code class="literal">SSE4</code></p>
</td>
<td align="left" valign="top">
<p>All Streaming SIMD Extensions 4 instructions (both SSE4.1 and SSE4.2)</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><code class="literal">SSE4a</code></p>
</td>
<td align="left" valign="top">
<p>Streaming SIMD Extensions 4a (AMD)</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><code class="literal">SSE5</code></p>
</td>
<td align="left" valign="top">
<p>Streaming SIMD Extensions 5</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><code class="literal">XSAVE</code></p>
</td>
<td align="left" valign="top">
<p>XSAVE instructions</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><code class="literal">AVX</code></p>
</td>
<td align="left" valign="top">
<p>Advanced Vector Extensions instructions</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><code class="literal">FMA</code></p>
</td>
<td align="left" valign="top">
<p>Fused Multiply-Add instructions</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><code class="literal">AES</code></p>
</td>
<td align="left" valign="top">
<p>Advanced Encryption Standard instructions</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><code class="literal">CLMUL</code>, <code class="literal">PCLMULQDQ</code></p>
</td>
<td align="left" valign="top">
<p>PCLMULQDQ instruction</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><code class="literal">3DNow</code></p>
</td>
<td align="left" valign="top">
<p>3DNow! instructions</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><code class="literal">Cyrix</code></p>
</td>
<td align="left" valign="top">
<p>Cyrix-specific instructions</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><code class="literal">AMD</code></p>
</td>
<td align="left" valign="top">
<p>AMD-specific instructions (older than K6)</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><code class="literal">SMM</code></p>
</td>
<td align="left" valign="top">
<p>System Management Mode instructions</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><code class="literal">Prot</code>, <code class="literal">Protected</code></p>
</td>
<td align="left" valign="top">
<p>Protected mode only instructions</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><code class="literal">Undoc</code>, <code class="literal">Undocumented</code></p>
</td>
<td align="left" valign="top">
<p>Undocumented instructions</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><code class="literal">Obs</code>, <code class="literal">Obsolete</code></p>
</td>
<td align="left" valign="top">
<p>Obsolete instructions</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><code class="literal">Priv</code>, <code class="literal">Privileged</code></p>
</td>
<td align="left" valign="top">
<p>Privileged instructions</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><code class="literal">SVM</code></p>
</td>
<td align="left" valign="top">
<p>Secure Virtual Machine instructions</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><code class="literal">PadLock</code></p>
</td>
<td align="left" valign="top">
<p>VIA PadLock instructions</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><code class="literal">EM64T</code></p>
</td>
<td align="left" valign="top">
<p>Intel EM64T or better instructions (not necessarily 64-bit only)</p>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<br class="table-break">
<div class="table"><a name="x86-cpus" id="x86-cpus"></a>
<p class="title"><b>Таблица 19.4. x86 CPU Names</b></p>
<div class="table-contents">
<table summary="x86 CPU Names" border="1">
<colgroup>
<col class="col_1">
<col class="col_2">
<col class="col_3"></colgroup>
<thead>
<tr>
<th align="left" valign="top">Name</th>
<th align="left" valign="top">Feature Flags</th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top">
<p><code class="literal">8086</code></p>
</td>
<td align="left" valign="top">
<p><code class="literal">Priv</code></p>
</td>
<td align="left" valign="top">
<p>Intel 8086</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><code class="literal">186</code>, <code class="literal">80186</code>, <code class="literal">i186</code></p>
</td>
<td align="left" valign="top">
<p><code class="literal">Priv</code></p>
</td>
<td align="left" valign="top">
<p>Intel 80186</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><code class="literal">286</code>, <code class="literal">80286</code>, <code class="literal">i286</code></p>
</td>
<td align="left" valign="top">
<p><code class="literal">Priv</code></p>
</td>
<td align="left" valign="top">
<p>Intel 80286</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><code class="literal">386</code>, <code class="literal">80386</code>, <code class="literal">i386</code></p>
</td>
<td align="left" valign="top">
<p><code class="literal">SMM</code>, <code class="literal">Prot</code>, <code class="literal">Priv</code></p>
</td>
<td align="left" valign="top">
<p>Intel 80386</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><code class="literal">486</code>, <code class="literal">80486</code>, <code class="literal">i486</code></p>
</td>
<td align="left" valign="top">
<p><code class="literal">FPU</code>, <code class="literal">SMM</code>, <code class="literal">Prot</code>, <code class="literal">Priv</code></p>
</td>
<td align="left" valign="top">
<p>Intel 80486</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><code class="literal">586</code>, <code class="literal">i586</code>, <code class="literal">Pentium</code>, <code class="literal">P5</code></p>
</td>
<td align="left" valign="top">
<p><code class="literal">FPU</code>, <code class="literal">SMM</code>, <code class="literal">Prot</code>, <code class="literal">Priv</code></p>
</td>
<td align="left" valign="top">
<p>Intel Pentium</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><code class="literal">686</code>, <code class="literal">i686</code>, <code class="literal">P6</code>, <code class="literal">PPro</code>, <code class="literal">PentiumPro</code></p>
</td>
<td align="left" valign="top">
<p><code class="literal">FPU</code>, <code class="literal">SMM</code>, <code class="literal">Prot</code>, <code class="literal">Priv</code></p>
</td>
<td align="left" valign="top">
<p>Intel Pentium Pro</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><code class="literal">P2</code>, <code class="literal">Pentium2</code>, <code class="literal">Pentium-2</code>, <code class="literal">PentiumII</code>, <code class="literal">Pentium-II</code></p>
</td>
<td align="left" valign="top">
<p><code class="literal">MMX</code>, <code class="literal">FPU</code>, <code class="literal">SMM</code>, <code class="literal">Prot</code>, <code class="literal">Priv</code></p>
</td>
<td align="left" valign="top">
<p>Intel Pentium II</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><code class="literal">P3</code>, <code class="literal">Pentium3</code>, <code class="literal">Pentium-3</code>, <code class="literal">PentiumIII</code>, <code class="literal">Pentium-III</code>, <code class="literal">Katmai</code></p>
</td>
<td align="left" valign="top">
<p><code class="literal">SSE</code>, <code class="literal">MMX</code>, <code class="literal">FPU</code>, <code class="literal">SMM</code>, <code class="literal">Prot</code>, <code class="literal">Priv</code></p>
</td>
<td align="left" valign="top">
<p>Intel Pentium III</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><code class="literal">P4</code>, <code class="literal">Pentium4</code>, <code class="literal">Pentium-4</code>, <code class="literal">PentiumIV</code>, <code class="literal">Pentium-IV</code>, <code class="literal">Williamette</code></p>
</td>
<td align="left" valign="top">
<p><code class="literal">SSE2</code>, <code class="literal">SSE</code>, <code class="literal">MMX</code>, <code class="literal">FPU</code>, <code class="literal">SMM</code>,
<code class="literal">Prot</code>, <code class="literal">Priv</code></p>
</td>
<td align="left" valign="top">
<p>Intel Pentium 4</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><code class="literal">IA64</code>, <code class="literal">IA-64</code>, <code class="literal">Itanium</code></p>
</td>
<td align="left" valign="top">
<p><code class="literal">SSE2</code>, <code class="literal">SSE</code>, <code class="literal">MMX</code>, <code class="literal">FPU</code>, <code class="literal">SMM</code>,
<code class="literal">Prot</code>, <code class="literal">Priv</code></p>
</td>
<td align="left" valign="top">
<p>Intel Itanium (x86)</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><code class="literal">K6</code></p>
</td>
<td align="left" valign="top">
<p><code class="literal">3DNow</code>, <code class="literal">MMX</code>, <code class="literal">FPU</code>, <code class="literal">SMM</code>, <code class="literal">Prot</code>, <code class="literal">Priv</code></p>
</td>
<td align="left" valign="top">
<p>AMD K6</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><code class="literal">Athlon</code>, <code class="literal">K7</code></p>
</td>
<td align="left" valign="top">
<p><code class="literal">SSE</code>, <code class="literal">3DNow</code>, <code class="literal">MMX</code>, <code class="literal">FPU</code>, <code class="literal">SMM</code>,
<code class="literal">Prot</code>, <code class="literal">Priv</code></p>
</td>
<td align="left" valign="top">
<p>AMD Athlon</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><code class="literal">Hammer</code>, <code class="literal">Clawhammer</code>,
<code class="literal">Opteron</code>, <code class="literal">Athlon64</code>, <code class="literal">Athlon-64</code></p>
</td>
<td align="left" valign="top">
<p><code class="literal">SSE2</code>, <code class="literal">SSE</code>, <code class="literal">3DNow</code>, <code class="literal">MMX</code>, <code class="literal">FPU</code>, <code class="literal">SMM</code>, <code class="literal">Prot</code>, <code class="literal">Priv</code></p>
</td>
<td align="left" valign="top">
<p>AMD Athlon64 and Opteron</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><code class="literal">Prescott</code></p>
</td>
<td align="left" valign="top">
<p><code class="literal">SSE3</code>, <code class="literal">SSE2</code>, <code class="literal">SSE</code> <code class="literal">MMX</code>, <code class="literal">FPU</code>,
<code class="literal">SMM</code>, <code class="literal">Prot</code>, <code class="literal">Priv</code></p>
</td>
<td align="left" valign="top">
<p>Intel codename Prescott</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><code class="literal">Conroe</code>, <code class="literal">Core2</code></p>
</td>
<td align="left" valign="top">
<p><code class="literal">SSSE3</code>, <code class="literal">SSE3</code>, <code class="literal">SSE2</code>, <code class="literal">SSE</code>, <code class="literal">MMX</code>, <code class="literal">FPU</code>, <code class="literal">SMM</code>,
<code class="literal">Prot</code>, <code class="literal">Priv</code></p>
</td>
<td align="left" valign="top">
<p>Intel codename Conroe</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><code class="literal">Penryn</code></p>
</td>
<td align="left" valign="top">
<p><code class="literal">SSE4.1</code>, <code class="literal">SSSE3</code>, <code class="literal">SSE3</code>, <code class="literal">SSE2</code>, <code class="literal">SSE</code>, <code class="literal">MMX</code>, <code class="literal">FPU</code>,
<code class="literal">SMM</code>, <code class="literal">Prot</code>, <code class="literal">Priv</code></p>
</td>
<td align="left" valign="top">
<p>Intel codename Penryn</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><code class="literal">Nehalem</code>, <code class="literal">Corei7</code></p>
</td>
<td align="left" valign="top">
<p><code class="literal">XSAVE</code>, <code class="literal">SSE4.2</code>, <code class="literal">SSE4.1</code>, <code class="literal">SSSE3</code>, <code class="literal">SSE3</code>, <code class="literal">SSE2</code>, <code class="literal">SSE</code>, <code class="literal">MMX</code>, <code class="literal">FPU</code>,
<code class="literal">SMM</code>, <code class="literal">Prot</code>, <code class="literal">Priv</code></p>
</td>
<td align="left" valign="top">
<p>Intel codename Nehalem</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><code class="literal">Westmere</code></p>
</td>
<td align="left" valign="top">
<p><code class="literal">CLMUL</code>, <code class="literal">AES</code>, <code class="literal">XSAVE</code>, <code class="literal">SSE4.2</code>, <code class="literal">SSE4.1</code>, <code class="literal">SSSE3</code>, <code class="literal">SSE3</code>, <code class="literal">SSE2</code>, <code class="literal">SSE</code>, <code class="literal">MMX</code>, <code class="literal">FPU</code>,
<code class="literal">SMM</code>, <code class="literal">Prot</code>, <code class="literal">Priv</code></p>
</td>
<td align="left" valign="top">
<p>Intel codename Westmere</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><code class="literal">Sandybridge</code></p>
</td>
<td align="left" valign="top">
<p><code class="literal">AVX</code>, <code class="literal">CLMUL</code>, <code class="literal">AES</code>, <code class="literal">XSAVE</code>, <code class="literal">SSE4.2</code>, <code class="literal">SSE4.1</code>, <code class="literal">SSSE3</code>, <code class="literal">SSE3</code>, <code class="literal">SSE2</code>, <code class="literal">SSE</code>, <code class="literal">MMX</code>, <code class="literal">FPU</code>, <code class="literal">SMM</code>,
<code class="literal">Prot</code>, <code class="literal">Priv</code></p>
</td>
<td align="left" valign="top">
<p>Intel codename Sandy Bridge</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><code class="literal">Venice</code></p>
</td>
<td align="left" valign="top">
<p><code class="literal">SSE3</code>, <code class="literal">SSE2</code>, <code class="literal">SSE</code>, <code class="literal">3DNow</code>, <code class="literal">MMX</code>, <code class="literal">FPU</code>, <code class="literal">SMM</code>,
<code class="literal">Prot</code>, <code class="literal">Priv</code></p>
</td>
<td align="left" valign="top">
<p>AMD codename Venice</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><code class="literal">K10</code>, <code class="literal">Phenom</code>, <code class="literal">Family10h</code></p>
</td>
<td align="left" valign="top">
<p><code class="literal">SSE4a</code>, <code class="literal">SSE3</code>, <code class="literal">SSE2</code>, <code class="literal">SSE</code>, <code class="literal">3DNow</code>, <code class="literal">MMX</code>, <code class="literal">FPU</code>, <code class="literal">SMM</code>, <code class="literal">Prot</code>, <code class="literal">Priv</code></p>
</td>
<td align="left" valign="top">
<p>AMD codename K10</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><code class="literal">Bulldozer</code></p>
</td>
<td align="left" valign="top">
<p><code class="literal">SSE5</code>, <code class="literal">SSE4a</code>, <code class="literal">SSE3</code>, <code class="literal">SSE2</code>, <code class="literal">SSE</code>, <code class="literal">3DNow</code>, <code class="literal">MMX</code>, <code class="literal">FPU</code>, <code class="literal">SMM</code>,
<code class="literal">Prot</code>, <code class="literal">Priv</code></p>
</td>
<td align="left" valign="top">
<p>AMD codename Bulldozer</p>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<br class="table-break">
<p>In order to have access to 64-bit instructions, <span class="emphasis"><em>both</em></span> a 64-bit capable CPU must be selected, and 64-bit
assembly mode must be set (in NASM syntax) by either using <code class="literal">BITS
64</code> (see <a class="xref" href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#nasm-directive-bits-top" title="4.1. Specifying Target Processor Mode">Раздел&nbsp;4.1</a>) or targetting a 64-bit
object format such as <code class="literal">elf64</code>.</p>
<p>The default CPU setting is for the latest processor and all feature flags to be
enabled; e.g. all x86 instructions for any processor, including all instruction set
extensions and 64-bit instructions.</p>
</div>
</div>
<div class="section" title="19.3. Registers">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="arch-x86-registers" id="arch-x86-registers"></a>19.3. Registers</h2>
</div>
</div>
</div>
<p>The 64-bit x86 register set consists of 16 general purpose registers, only 8 of which
are available in 16-bit and 32-bit mode. The core eight 16-bit registers are <code class="literal">AX</code>, <code class="literal">BX</code>, <code class="literal">CX</code>,
<code class="literal">DX</code>, <code class="literal">SI</code>, <code class="literal">DI</code>, <code class="literal">BP</code>, and <code class="literal">SP</code>. The least significant 8 bits of the first four of these registers
are accessible via the <code class="literal">AL</code>, <code class="literal">BL</code>,
<code class="literal">CL</code>, and <code class="literal">DL</code> in all execution
modes. In 64-bit mode, the least significant 8 bits of the other four of these registers
are also accessible; these are named <code class="literal">SIL</code>, <code class="literal">DIL</code>, <code class="literal">SPL</code>, and <code class="literal">BPL</code>. The most significant 8 bits of the first four 16-bit registers are
also available, although there are some restrictions on when they can be used in 64-bit
mode; these are named <code class="literal">AH</code>, <code class="literal">BH</code>,
<code class="literal">CH</code>, and <code class="literal">DH</code>.</p>
<p>The 80386 extended these registers to 32 bits while retaining all of the 16-bit and
8-bit names that were available in 16-bit mode. The new extended registers are denoted by
adding a <span class="emphasis"><em>E</em></span> prefix; thus the core eight 32-bit
registers are named <code class="literal">EAX</code>, <code class="literal">EBX</code>,
<code class="literal">ECX</code>, <code class="literal">EDX</code>, <code class="literal">ESI</code>, <code class="literal">EDI</code>, <code class="literal">EBP</code>,
and <code class="literal">ESP</code>. The original 8-bit and 16-bit register names map
into the least significant portion of the 32-bit registers.</p>
<p>64-bit long mode further extended these registers to 64 bits in size by adding a
<span class="emphasis"><em>R</em></span> prefix to the 16-bit name; thus the base eight
64-bit registers are named <code class="literal">RAX</code>, <code class="literal">RBX</code>, etc. Long mode also added eight extra registers named numerically
<code class="literal">r8</code> through <code class="literal">r15</code>. The least
significant 32 bits of these registers are available via a <span class="emphasis"><em>d</em></span> suffix (<code class="literal">r8d</code> through
<code class="literal">r15d</code>), the least significant 16 bits via a <span class="emphasis"><em>w</em></span> suffix (<code class="literal">r8w</code> through
<code class="literal">r15w</code>), and the least significant 8 bits via a <span class="emphasis"><em>b</em></span> suffix (<code class="literal">r8b</code> through
<code class="literal">r15b</code>).</p>
<p><a class="xref" href="http://www.tortall.net/projects/yasm/manual/ru/html/manual.html#x86-registers" title="Рисунок 19.1. x86 General Purpose Registers">Рисунок&nbsp;19.1</a> summarizes
the full 64-bit x86 general purpose register set.</p>
<div class="figure"><a name="x86-registers" id="x86-registers"></a>
<p class="title"><b>Рисунок 19.1. x86 General Purpose Registers</b></p>
<div class="figure-contents">
<div class="mediaobject"><img src="./Yasm User Manual_files/x86-registers.png" alt="x86 General Purpose Registers"></div>
</div>
</div>
<br class="figure-break"></div>
<div class="section" title="19.4. Segmentation">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="arch-x86-segmentation" id="arch-x86-segmentation"></a>19.4. Segmentation</h2>
</div>
</div>
</div>
<p><a class="indexterm" name="idp61705264" id="idp61705264"></a> <a class="indexterm" name="idp61706416" id="idp61706416"></a></p>
</div>
</div>
</div>
<div class="part" title="Часть VIII. Index">
<div class="titlepage">
<div>
<div>
<h1 class="title"><a name="_index"></a>Часть&nbsp;VIII.&nbsp;Index</h1>
</div>
</div>
</div>
</div>
</div>


</body></html>